{"version":3,"file":"CourseBuilder.js","sources":["webpack://[name]/./src/apis/google-classroom-sync.ts","webpack://[name]/./src/components/course-builder/courses/course-module-list.tsx","webpack://[name]/./src/components/course-builder/courses/course-module.tsx","webpack://[name]/./src/components/course-builder/courses/create-new.tsx","webpack://[name]/./src/components/course-builder/courses/edit-course.tsx","webpack://[name]/./src/components/course-builder/courses/index.tsx","webpack://[name]/./src/components/course-builder/courses/inner-edit-course.tsx","webpack://[name]/./src/components/course-builder/index.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-task/basic-editable-task-fields.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-task/edit-task.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-task/index.ts","webpack://[name]/./src/components/course-builder/modal-pages/edit-task/previewable-task-fields.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-task/save-or-cancel-buttons.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-task/search-results.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-task/task-content-fragment.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-task/task-status-fragment.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-workflow-link.tsx","webpack://[name]/./src/components/course-builder/schools/new-school.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-resource-list.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-task-list.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-teacher-list.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-workflow-link.tsx","webpack://[name]/./src/components/course-builder/sub-components/school-courses.tsx","webpack://[name]/./src/components/course-builder/sub-components/select-study-groups.tsx","webpack://[name]/./src/components/course-builder/sub-components/select-teacher.tsx","webpack://[name]/./src/components/course-builder/sub-components/weighted-items-table.tsx","webpack://[name]/./src/components/course-builder/subjects/index.tsx","webpack://[name]/./src/repos/school-courses.ts","webpack://[name]/./src/utils/cached-response.ts"],"sourcesContent":["import { __awaiter, __extends, __generator, __values } from \"tslib\";\nimport { GoogleWebClient } from './google-webclient';\nimport { mockTuitionStudents } from './mock/mock-classroom-data';\nimport { env } from '../globals/KED.env';\n/**\n*\n*/\nvar ClassroomSync = /** @class */ (function (_super) {\n    __extends(ClassroomSync, _super);\n    function ClassroomSync() {\n        return _super.call(this, { scopes: [\n                'https://www.googleapis.com/auth/script.external_request'\n            ] }) || this;\n    }\n    /**\n    *\n    * @param func function name to call in ClassroomService\n    * @param params optional parameters to send to function\n    *\n    * Calls the relevant funciton in ClassroomService\n    * The paramaters must be what is expected in the called function\n    * in ClassroomService and can only be basic types: string,\n    * number, object or boolean.\n    *\n    */\n    ClassroomSync.prototype.callSync = function (func, params) {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, KEDToken;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        data = params ? {\n                            'function': func,\n                            'parameters': params\n                        } : {\n                            'function': func\n                        };\n                        // using dev-mode right now so we only need to run clasp push on ClassroomService\n                        // to be able to use devMode the user calling the script needs to be an editor on the\n                        // project in GAS\n                        data.devMode = false;\n                        return [4 /*yield*/, env.bearerProvider.getBearer()];\n                    case 2:\n                        KEDToken = _a.sent();\n                        data.parameters.push(KEDToken.token);\n                        return [4 /*yield*/, fetch('https://script.googleapis.com/v1/scripts/M1H0BlTkv983PNVTJjDXjNqXLxmQiBgGz:run?alt=json', {\n                                method: 'post',\n                                headers: {\n                                    'Accept': 'application/json',\n                                    'Content-Type': 'application/json',\n                                    'Authorization': 'Bearer ' + this.authToken\n                                },\n                                body: JSON.stringify(data)\n                            }).then(function (resp) { return resp.json(); })];\n                    case 3: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    /**\n    *\n    * @param param0\n    */\n    ClassroomSync.prototype.initSync = function (course, origCourse, fullSyncNeeded) {\n        return __awaiter(this, void 0, void 0, function () {\n            var emptyOrMock, _a, _b, group, data, edsSchoolNameGymn, studyGroupStudents, _c, _d, group, tuitionGroupStudents, e_1_1, _e, subset, changes;\n            var e_2, _f, e_1, _g;\n            return __generator(this, function (_h) {\n                switch (_h.label) {\n                    case 0:\n                        emptyOrMock = {};\n                        if (course.school === 'KED') {\n                            try {\n                                for (_a = __values(course.studyGroups), _b = _a.next(); !_b.done; _b = _a.next()) {\n                                    group = _b.value;\n                                    emptyOrMock[group] = mockTuitionStudents[group] ? mockTuitionStudents[group].map(function (s) { return s.studentEmailAddress; }) : [];\n                                }\n                            }\n                            catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                            finally {\n                                try {\n                                    if (_b && !_b.done && (_f = _a.return)) _f.call(_a);\n                                }\n                                finally { if (e_2) throw e_2.error; }\n                            }\n                        }\n                        return [4 /*yield*/, env.kedBackendClient.http.get('schools', { 'cacheBust': 'static', 'name': course.school }).then(function (resp) { return resp.json(); })];\n                    case 1:\n                        data = _h.sent();\n                        edsSchoolNameGymn = data[0].edsSchoolNameGymn;\n                        studyGroupStudents = edsSchoolNameGymn ? {} : emptyOrMock;\n                        if (!course.studyGroups) return [3 /*break*/, 9];\n                        if (!edsSchoolNameGymn) return [3 /*break*/, 9];\n                        _h.label = 2;\n                    case 2:\n                        _h.trys.push([2, 7, 8, 9]);\n                        _c = __values(course.studyGroups), _d = _c.next();\n                        _h.label = 3;\n                    case 3:\n                        if (!!_d.done) return [3 /*break*/, 6];\n                        group = _d.value;\n                        return [4 /*yield*/, env.edsClient.getTuitionGroupStudents({ schoolName: edsSchoolNameGymn, tuitionGroupName: group })];\n                    case 4:\n                        tuitionGroupStudents = _h.sent();\n                        studyGroupStudents[group] = tuitionGroupStudents.map(function (s) { return s.studentEmailAddress; });\n                        _h.label = 5;\n                    case 5:\n                        _d = _c.next();\n                        return [3 /*break*/, 3];\n                    case 6: return [3 /*break*/, 9];\n                    case 7:\n                        e_1_1 = _h.sent();\n                        e_1 = { error: e_1_1 };\n                        return [3 /*break*/, 9];\n                    case 8:\n                        try {\n                            if (_d && !_d.done && (_g = _c.return)) _g.call(_c);\n                        }\n                        finally { if (e_1) throw e_1.error; }\n                        return [7 /*endfinally*/];\n                    case 9:\n                        _e = this.diffCourse(course, origCourse), subset = _e.subset, changes = _e.changes;\n                        // send the changes to classroom-service with {id, school code} to update classrooms\n                        // should we send the users from the groups or should classroom-service get these from EDS?\n                        // if we handle users in kedcomponents a check if there are changes should probably be made?\n                        return [2 /*return*/, this.updateClassroom({ course: subset, changes: changes, studyGroupStudents: studyGroupStudents })];\n                }\n            });\n        });\n    };\n    ClassroomSync.prototype.archive = function (course) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                console.log('archiving');\n                return [2 /*return*/, this.callSync('archive', [course])];\n            });\n        });\n    };\n    ClassroomSync.prototype.delete = function (subset) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                console.log('deleteing');\n                return [2 /*return*/, this.callSync('deleteClassrooms', [subset])];\n            });\n        });\n    };\n    /**\n    *\n    * @param course current course state\n    * @param origCourse previous course state\n    *\n    * Creates a subset of course and maakes a diff against previous course state\n    * Note: there are probably more we could filter out before sending to ClasasroomService\n    */\n    ClassroomSync.prototype.diffCourse = function (course, origCourse) {\n        // Filter out assignments from tasks and subset to only properties we are interested in\n        var subsetAssignments = function (tasks, modules) {\n            var skipTasks = [];\n            modules.filter(function (m) { return m.inactive; }).map(function (m) {\n                skipTasks = skipTasks.concat(m.taskIds);\n            });\n            var assignments = tasks.filter(function (t) { return t.assignment === true && !skipTasks.includes(t.id); });\n            return assignments.map(function (t) {\n                var assignment = t.assignment, deadline = t.deadline, id = t.id, name = t.name, resources = t.resources, templateFile = t.templateFile, sendToUrkund = t.sendToUrkund;\n                return { assignment: assignment, deadline: deadline, id: id, name: name, resources: resources, templateFile: templateFile, sendToUrkund: sendToUrkund };\n            });\n        };\n        // create the subset of course\n        var subset = (function (_a) {\n            var id = _a.id, school = _a.school, code = _a.code, name = _a.name, description = _a.description, tasks = _a.tasks, responsibleTeachers = _a.responsibleTeachers, studyGroups = _a.studyGroups;\n            return ({\n                id: id,\n                school: school,\n                code: code,\n                name: name,\n                description: description,\n                tasks: tasks,\n                responsibleTeachers: responsibleTeachers,\n                studyGroups: studyGroups\n            });\n        })(course);\n        // only handle tsaks that are aassignments\n        subset.tasks = subsetAssignments(subset.tasks, course.modules);\n        var changes = origCourse ? {\n            tasks: subsetAssignments(origCourse.tasks, origCourse.modules),\n            responsibleTeachers: origCourse.responsibleTeachers,\n            studyGroups: origCourse.studyGroups\n        } : false;\n        return { subset: subset, changes: changes };\n    };\n    ClassroomSync.prototype.updateClassroom = function (_a) {\n        var course = _a.course, changes = _a.changes, studyGroupStudents = _a.studyGroupStudents;\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_b) {\n                return [2 /*return*/, this.callSync('updateClassrooms', [course, changes, studyGroupStudents])];\n            });\n        });\n    };\n    return ClassroomSync;\n}(GoogleWebClient));\nexport { ClassroomSync };\n","import { __awaiter, __extends, __generator } from \"tslib\";\nimport * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { createUUID } from 'kedbackend/client';\nimport { CourseModuleComponent } from './course-module';\nvar CourseModuleList = /** @class */ (function (_super) {\n    __extends(CourseModuleList, _super);\n    function CourseModuleList(props) {\n        var _this = _super.call(this, props) || this;\n        _this._moduleRefs = {};\n        _this.state = {};\n        return _this;\n    }\n    CourseModuleList.prototype.addModule = function () {\n        this.props.host.update({ modules: { $push: [{\n                        name: \"Ny kursmodul\",\n                        id: createUUID(),\n                        resources: [],\n                        taskIds: []\n                    }\n                ] } });\n    };\n    CourseModuleList.prototype.getOrderedModules = function () {\n        var course = this.props.course;\n        var moduleOrder = course.moduleOrder || course.modules.map(function (m) { return m.id; });\n        return moduleOrder\n            // Map ordered id to module\n            .map(function (id) { return course.modules.find(function (m) { return m.id === id; }); })\n            // Ignore entries that only exists in moduleOrder but not in modules\n            .filter(function (m) { return !!m; })\n            // Append modules at end that are not listed in moduleOrder\n            .concat(course.modules.filter(function (m) { return !moduleOrder.find(function (id) { return m.id === id; }); }));\n    };\n    CourseModuleList.prototype.reorder = function (moduleId, direction) {\n        return __awaiter(this, void 0, void 0, function () {\n            var course, orderedModules, moduleIndex, newModuleIndex, currentModuleAtPosition, moduleOrder, origScrollPos, elemModule;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        course = this.props.course;\n                        orderedModules = this.getOrderedModules();\n                        moduleIndex = orderedModules.findIndex(function (m) { return m.id === moduleId; });\n                        newModuleIndex = moduleIndex + direction;\n                        if (newModuleIndex < 0 || newModuleIndex >= orderedModules.length) {\n                            // Cannot order outside limits.\n                            return [2 /*return*/];\n                        }\n                        currentModuleAtPosition = orderedModules[newModuleIndex];\n                        moduleOrder = orderedModules.map(function (m) { return m.id; });\n                        moduleOrder[newModuleIndex] = moduleId;\n                        moduleOrder[moduleIndex] = currentModuleAtPosition.id;\n                        origScrollPos = document.documentElement.scrollTop;\n                        return [4 /*yield*/, this.props.host.update({\n                                moduleOrder: { $set: moduleOrder }\n                            })];\n                    case 1:\n                        _a.sent();\n                        elemModule = findDOMNode(this._moduleRefs[moduleId]);\n                        if (elemModule) {\n                            try {\n                                window.scrollTo({ top: origScrollPos }); // Prohibit default scrolling directly upwards on move up.\n                                if (elemModule.getBoundingClientRect().top < 0 || elemModule.getBoundingClientRect().bottom > document.documentElement.scrollHeight) {\n                                    elemModule.scrollIntoView({ behavior: 'smooth', block: 'start' });\n                                }\n                            }\n                            catch (e) {\n                                // Only Chrome beta supports the arguments given above. Default for older browsers.\n                                window.scrollTo(null, origScrollPos);\n                                if (elemModule.getBoundingClientRect().top < 0 || elemModule.getBoundingClientRect().bottom > document.documentElement.scrollHeight) {\n                                    elemModule.scrollIntoView(true);\n                                }\n                            }\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CourseModuleList.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, course = _a.course, host = _a.host, idsNotCoveredByAnyTask = _a.idsNotCoveredByAnyTask;\n        var moduleOrder = course.moduleOrder || course.modules.map(function (m) { return m.id; });\n        var orderedModules = this.getOrderedModules();\n        return React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\", ref: function (elem) { return _this._elem = elem; } },\n            orderedModules.map(function (module) { return React.createElement(CourseModuleComponent, { ref: function (elem) { return _this._moduleRefs[module.id] = elem; }, key: module.id, course: course, module: module, onReorder: function (direction) { return _this.reorder(module.id, direction); }, getOrderedModules: function () { return _this.getOrderedModules(); }, host: host, idsNotCoveredByAnyTask: idsNotCoveredByAnyTask }); }),\n            React.createElement(\"div\", { className: \"btn btn-large\", onClick: function () { return _this.addModule(); } }, \"L\\u00E4gg till kursmodul\"));\n    };\n    return CourseModuleList;\n}(React.Component));\nexport { CourseModuleList };\n","import { __assign, __extends, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { EditableResourceList } from '../sub-components/editable-resource-list';\nimport { EditableTaskList } from '../sub-components/editable-task-list';\nimport update from 'react-addons-update';\nimport { RemoveItem } from '../sub-components/remove-item';\nimport { L, showError } from \"../../../utils/utils\";\nimport { Wysiwyg } from '../../utility-components/wysiwyg';\nimport actions_swedish from '../../utility-components/wysiwyg/actions-sv';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\nimport { ContentEditableField } from '../../utility-components/content-editable-field';\nimport { computeUpdatedOrder } from '../../course-builder-ks/logic/task-order';\nimport { features } from '../../../features';\nvar DEFAULT_KNOWLEDGE_MATRIX = [{\n        abilityIds: [],\n        EIds: [],\n        CIds: [],\n        AIds: []\n    }];\nvar CourseModuleComponent = /** @class */ (function (_super) {\n    __extends(CourseModuleComponent, _super);\n    function CourseModuleComponent(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            editMandatoryContent: false\n        };\n        return _this;\n    }\n    CourseModuleComponent.prototype.getModuleIndex = function () {\n        var _a = this.props, course = _a.course, module = _a.module;\n        return course.modules.findIndex(function (m) { return m.id === module.id; });\n    };\n    CourseModuleComponent.prototype.getModuleOrderIndex = function () {\n        var _a = this.props, course = _a.course, module = _a.module;\n        var orderedModules = this.props.getOrderedModules();\n        return orderedModules.findIndex(function (m) { return m.id === module.id; });\n    };\n    CourseModuleComponent.prototype.updateModule = function (moduleUpdates) {\n        var module = this.props.module;\n        var updatedModule = update(module, moduleUpdates);\n        var moduleIndex = this.getModuleIndex();\n        this.props.host.update({ modules: { $splice: [[moduleIndex, 1, updatedModule]] } });\n    };\n    /* This method works for both adding new tasks to the task table\n    and adding references to existing tasks. The magic of that has to do with\n    whether task.$meta = 'add' or not and is done in EditCourse.save()\n    */\n    CourseModuleComponent.prototype.onTaskAdded = function (task, taskCustomization) {\n        // Add task ID to module taskIds list:\n        var courseUpdates = {};\n        var taskIds = this.props.module.taskIds.slice();\n        taskIds.push(task.id);\n        // Add physical Task to Course.tasks.\n        if (!this.props.course.tasks.some(function (t) { return t.id === task.id; })) {\n            courseUpdates.tasks = { $push: [task] };\n        }\n        var customizations = __assign({}, (this.props.module.taskCustomizations || {}));\n        if (taskCustomization)\n            customizations[task.id] = taskCustomization;\n        var moduleIndex = this.getModuleIndex();\n        courseUpdates.modules = {};\n        courseUpdates.modules[moduleIndex] = {\n            taskIds: { $set: taskIds },\n            taskCustomizations: { $set: customizations }\n        };\n        // Update module\n        this.props.host.update(courseUpdates);\n    };\n    CourseModuleComponent.prototype.onTaskUpdated = function (task) {\n        if (!task.$meta)\n            throw new Error(L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Hoppsan, blev lite knas. Fel ID: \", \"\"], [\"Hoppsan, blev lite knas. Fel ID: \", \"\"])), 'Pa7Dq'));\n        var taskIndex = this.props.course.tasks.findIndex(function (t) { return t.id === task.id; });\n        if (taskIndex >= 0) {\n            this.props.host.update({ tasks: { $splice: [[taskIndex, 1, task]] } });\n        }\n    };\n    CourseModuleComponent.prototype.onTaskCustomized = function (taskId, customization) {\n        var customizations = __assign({}, (this.props.module.taskCustomizations || {}));\n        customizations[taskId] = customization;\n        this.updateModule({ taskCustomizations: { $set: customizations } });\n    };\n    CourseModuleComponent.prototype.onTaskDeleted = function (id) {\n        // Remove task ID from module taskIds list.\n        // This depends on the fact that EditCourse._setState() maintains\n        // removed Task links (which it actually does (or should do at least)).\n        this.updateModule({\n            taskIds: { $set: this.props.module.taskIds.filter(function (tid) { return tid !== id; }) },\n            taskCustomizations: {\n                $apply: function (customizations) {\n                    var copy = __assign({}, customizations);\n                    delete copy[id];\n                    return copy;\n                }\n            }\n        });\n    };\n    CourseModuleComponent.prototype.onTaskReplaced = function (id, task) {\n        var idxTask = this.props.module.taskIds.indexOf(id);\n        if (idxTask < 0) {\n            showError(L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Kunde inte spara uppgift. Felkod d72kQ\"], [\"Kunde inte spara uppgift. Felkod d72kQ\"]))));\n            return;\n        }\n        var moduleUpdates = {\n            // Replace old id with new id:\n            taskIds: { $splice: [[idxTask, 1, task.id]] },\n            taskCustomizations: {\n                $apply: function (customizations) {\n                    var copy = __assign({}, customizations);\n                    delete copy[id];\n                    return copy;\n                }\n            }\n        };\n        var updatedModule = update(this.props.module, moduleUpdates);\n        var moduleIndex = this.getModuleIndex();\n        this.props.host.update({\n            // Apply moduleUpdates from above:\n            modules: { $splice: [[moduleIndex, 1, updatedModule]] },\n            // Add the new task to Course.tasks.\n            // Don't remove the old one! Why? Because it may be referenced\n            // by another module in same course! Let EditCourse._setState()\n            // do the \"garbage collection\" instead.\n            tasks: { $set: this.props.course.tasks.concat(task) }\n        });\n    };\n    CourseModuleComponent.prototype.onTasksReordered = function (source, target, placement) {\n        var newTaskIds = computeUpdatedOrder(this.props.course.tasks, this.props.module.taskIds, source, target, placement, { appendLeftovers: false });\n        this.updateModule({\n            taskIds: { $set: newTaskIds }\n        });\n    };\n    CourseModuleComponent.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, course = _a.course, host = _a.host, module = _a.module, idsNotCoveredByAnyTask = _a.idsNotCoveredByAnyTask;\n        var moduleIndex = this.getModuleIndex();\n        var moduleOrderedIndex = this.getModuleOrderIndex();\n        var knowledgeMatrixDiv;\n        var updateModule = this.updateModule.bind(this);\n        var week = 1;\n        var startWeekOptions = [\"--\"];\n        var endWeekOptions = [\"--\"];\n        for (var i = 0; i < 51; ++i) {\n            startWeekOptions.push('' + week);\n            endWeekOptions.push('' + ++week);\n        }\n        return React.createElement(OpenCloseBox, { inactivated: !features.cbCollapseBoxes, title: React.createElement(React.Fragment, null,\n                React.createElement(\"div\", { style: { float: \"right\" } },\n                    moduleOrderedIndex > 0 && React.createElement(\"span\", null,\n                        React.createElement(\"i\", { className: \"fas fa-arrow-circle-up selectable\", \"aria-hidden\": \"true\", onClick: function (e) { e.stopPropagation(); _this.props.onReorder(-1); } }),\n                        \" \"),\n                    moduleOrderedIndex < course.modules.length - 1 && React.createElement(\"span\", null,\n                        React.createElement(\"i\", { className: \"fas fa-arrow-circle-down selectable\", \"aria-hidden\": \"true\", onClick: function (e) { e.stopPropagation(); _this.props.onReorder(1); } }),\n                        \" \"),\n                    React.createElement(RemoveItem, { title: \"Ta bort modulen\", style: { display: 'inline-block' }, onClick: function (e) { e.stopPropagation(); confirm(L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Ta bort modul \", \"?\"], [\"Ta bort modul \", \"?\"])), module.name)) && host.update({ modules: { $splice: [[moduleIndex, 1]] } }); } })),\n                React.createElement(\"p\", null, module.name)), headerOpen: module.name == 'Ny kursmodul' },\n            React.createElement(\"div\", { className: \"course-module ked_boxed\", style: { position: 'relative' } },\n                React.createElement(ContentEditableField, { text: module.name, tag: 'h3', className: 'renameable-text', maxChars: 100, placeholder: \"Namnl\\u00F6s modul\", onChange: function (newName) { return updateModule({ name: { $set: newName } }); } }),\n                React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n                    React.createElement(\"div\", { className: \"horizontalItem center\" },\n                        React.createElement(\"p\", null, \"Startvecka\")),\n                    React.createElement(\"div\", { className: \"horizontalItem center\" },\n                        React.createElement(\"select\", { value: module.startWeek || \"--\", onChange: function (ev) { return updateModule({ startWeek: {\n                                    $set: ev.target.value === '--' ?\n                                        undefined :\n                                        parseInt(ev.target.value)\n                                }\n                            }); } }, startWeekOptions.map(function (o) { return React.createElement(\"option\", { key: o, value: o }, o); }))),\n                    React.createElement(\"div\", { className: \"horizontalItem center\" },\n                        React.createElement(\"p\", null, \"Slutvecka\")),\n                    React.createElement(\"div\", { className: \"horizontalItem center\" },\n                        React.createElement(\"select\", { value: module.endWeek || \"--\", onChange: function (ev) { return updateModule({ endWeek: {\n                                    $set: ev.target.value === '--' ?\n                                        undefined :\n                                        parseInt(ev.target.value)\n                                }\n                            }); } }, endWeekOptions.map(function (o) { return React.createElement(\"option\", { key: o, value: o }, o); })))),\n                React.createElement(\"h4\", null, \"Kursmodulens introduktion\"),\n                React.createElement(Wysiwyg, { actions: [\n                        \"bold\",\n                        \"italic\",\n                        \"underline\",\n                        \"strikethrough\",\n                        \"heading2\",\n                        \"heading3\",\n                        \"olist\",\n                        \"ulist\",\n                        \"outdent\",\n                        \"indent\",\n                        \"line\",\n                        \"link\",\n                        \"image\"\n                    ], defaultActions: actions_swedish, html: module.mandatoryContent, onChange: function (html) {\n                        updateModule({ mandatoryContent: { $set: html } });\n                    } }),\n                React.createElement(\"h4\", null, \"Uppgifter\"),\n                React.createElement(EditableTaskList, { taskIds: module.taskIds, taskCustomizations: module.taskCustomizations, course: course, module: module, host: host, idsNotCoveredByAnyTask: idsNotCoveredByAnyTask, onTaskAdded: function (task, taskCustomization) { return _this.onTaskAdded(task, taskCustomization); }, onTaskUpdated: function (task) { return _this.onTaskUpdated(task); }, onTaskCustomizationUpdated: function (taskId, customization) {\n                        return _this.onTaskCustomized(taskId, customization);\n                    }, onTaskDeleted: function (id) { return _this.onTaskDeleted(id); }, onTaskReplaced: function (id, task) { return _this.onTaskReplaced(id, task); }, onTasksReordered: function (source, target, placement) { return _this.onTasksReordered(source, target, placement); } }),\n                React.createElement(\"h4\", null, \"Modulresurser\"),\n                React.createElement(\"p\", { className: \"subHeader\" }, \"(Eventuella resuser f\\u00F6r redovisning av modulen samt f\\u00F6r modulen som helhet)\"),\n                React.createElement(EditableResourceList, { resources: module.resources, onUpdate: function (resourcesUpdates) { return updateModule({ resources: resourcesUpdates }); }, host: host }),\n                React.createElement(\"div\", { style: { position: 'absolute', top: 0, right: 0 } },\n                    moduleOrderedIndex > 0 && React.createElement(\"span\", null,\n                        React.createElement(\"i\", { className: \"fas fa-arrow-circle-up selectable\", \"aria-hidden\": \"true\", onClick: function () { return _this.props.onReorder(-1); } }),\n                        \" \"),\n                    moduleOrderedIndex < course.modules.length - 1 && React.createElement(\"span\", null,\n                        React.createElement(\"i\", { className: \"fas fa-arrow-circle-down selectable\", \"aria-hidden\": \"true\", onClick: function () { return _this.props.onReorder(1); } }),\n                        \" \"),\n                    React.createElement(RemoveItem, { title: \"Ta bort modulen\", style: { display: 'inline-block' }, onClick: function () { return confirm(L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Ta bort modul \", \"?\"], [\"Ta bort modul \", \"?\"])), module.name)) && host.update({ modules: { $splice: [[moduleIndex, 1]] } }); } })),\n                React.createElement(\"div\", { className: \"horizontal-align\" },\n                    React.createElement(\"div\", { className: \"horizontaItem activateCourseModule\" },\n                        React.createElement(\"div\", { className: \"btn btn-info\" + (module.inactive ? \" btn-activate\" : \" btn-inactivate\"), onClick: function () { return updateModule({ inactive: { $set: !module.inactive } }); } }, module.inactive ? 'Aktivera modulen' : 'Inaktivera modulen')))));\n    };\n    return CourseModuleComponent;\n}(React.Component));\nexport { CourseModuleComponent };\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4;\n","import { __awaiter, __extends, __generator, __makeTemplateObject, __read, __spread } from \"tslib\";\nimport * as React from 'react';\nimport { CourseBanner } from \"./course-banner\";\nimport { L, showError, flatten, compareProp, showInfo, maxLength, compareProps, distinct } from \"../../../utils/utils\";\nimport env from '../../../globals/KED.env';\nimport { Link } from 'react-router-dom';\nimport { Spinner } from \"../sub-components/spinner\";\nimport { SchoolCourses } from \"../sub-components/school-courses\";\nimport { TextInput } from '../../utility-components/form-field-text-input';\nimport { AlignHorizontal } from '../../utility-components/align-horizontal';\nimport { HorizontalItem } from '../../utility-components/horizontal-item';\nvar CreateNewCourse = /** @class */ (function (_super) {\n    __extends(CreateNewCourse, _super);\n    function CreateNewCourse(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            courseOptions: null,\n            selectedTemplateId: \"--\",\n            courses: null,\n            selectedCourseId: \"\"\n        };\n        return _this;\n    }\n    CreateNewCourse.prototype.componentDidMount = function () {\n        this.load().catch(showError);\n    };\n    CreateNewCourse.prototype.load = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var subjects, courses, courseOptions;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        showInfo(\"Laddar kurser\");\n                        return [4 /*yield*/, env.kedBackendClient.list(\"subjects\", {\n                                tags: [\"schoolType:gymnasium\"],\n                                include: \"courseTemplates\"\n                            })];\n                    case 1:\n                        subjects = _a.sent();\n                        courses = flatten(subjects.map(function (s) { return s.courseTemplates; }))\n                            .sort(compareProps([\"name\", \"dateTime\"]));\n                        // If two courses have the same name, they will be secondary sorted by date imported.\n                        // By running the distinct() call below, we will make sure that only the latest imported\n                        // course with that name is loaded.\n                        // This is the case for \"Webbutveckling 1\" - a course that used to occur on a subject with\n                        // another name in 2018, but in 2019 occurs on a new subject, so it's by definition another\n                        // course, but same name.\n                        courses = distinct(courses, function (c) { return c.name; });\n                        courseOptions = __spread([\n                            { id: \"--\", name: \"--\" }\n                        ], courses, [\n                            { id: \"---\", name: \"---\" },\n                            { id: \"custom\", name: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Egen kurs\"], [\"Egen kurs\"]))) }\n                        ]);\n                        showInfo(\"\");\n                        this.setState({ courseOptions: courseOptions });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CreateNewCourse.prototype.onSelectCourse = function (id) {\n        return __awaiter(this, void 0, void 0, function () {\n            var derivedCourses, courseOptions, kedStandardOptions, teacherMade, courses;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (id === 'custom') {\n                            this.setState({\n                                selectedTemplateId: id\n                            });\n                        }\n                        return [4 /*yield*/, env.kedBackendClient.list(\"courses\", { hasEdgesTo: [id] })];\n                    case 1:\n                        derivedCourses = _a.sent();\n                        courseOptions = derivedCourses\n                            .filter(function (course) { return course.active; })\n                            .map(function (_a) {\n                            var id = _a.id, school = _a.school, description = _a.description, createdBy = _a.createdBy, modifiedBy = _a.modifiedBy;\n                            if (description)\n                                description = maxLength(description, 80);\n                            var descriptionOrAuthor = description ||\n                                (createdBy ? createdBy.name + \"s version\" :\n                                    modifiedBy && modifiedBy.name + \"s version\");\n                            return {\n                                id: id,\n                                name: school === 'standard' ?\n                                    description ? \"Standard - \" + description : \"Standard\" :\n                                    school + \" - \" + maxLength(descriptionOrAuthor, 90),\n                                school: school\n                            };\n                        }).sort(compareProp(\"name\"));\n                        kedStandardOptions = courseOptions.filter(function (option) { return option.school === \"standard\"; });\n                        teacherMade = courseOptions.filter(function (option) { return option.school !== \"standard\"; });\n                        courses = __spread(kedStandardOptions, [\n                            { id: id, name: \"Tom\" }\n                        ], teacherMade);\n                        this.setState({\n                            courses: courses,\n                            selectedTemplateId: id,\n                            selectedCourseId: courses[0].id\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CreateNewCourse.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, courseOptions = _a.courseOptions, selectedTemplateId = _a.selectedTemplateId, courses = _a.courses, selectedCourseId = _a.selectedCourseId, customCourseName = _a.customCourseName, customCoursePoints = _a.customCoursePoints;\n        var customCourseCode = customCourseName && (this.state.customCourseCode || \"CUST-\" + customCourseName.substr(0, 5).toUpperCase());\n        return React.createElement(\"div\", { style: { outline: 0 } },\n            React.createElement(CourseBanner, { title: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Kursbyggaren\"], [\"Kursbyggaren\"]))), activePage: \"courseBuilder\", routes: { feedback: this.props.feedbackUrl } }),\n            React.createElement(\"div\", { className: \"sv-row sv-layout\" },\n                React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\n                    React.createElement(\"div\", { className: \"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\" },\n                        React.createElement(\"div\", { className: \"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\" },\n                            React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\n                                React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-7\" },\n                                    React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                                        React.createElement(\"h2\", null, \"Skapa ny kurs\"),\n                                        React.createElement(\"hr\", null),\n                                        React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n                                            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                                React.createElement(\"p\", null, \"V\\u00E4lj gymnasiekurs :\"))),\n                                        React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n                                            React.createElement(\"div\", { className: \"horizontalItem top\" }, !courseOptions ?\n                                                React.createElement(\"div\", null,\n                                                    React.createElement(Spinner, null),\n                                                    React.createElement(\"select\", { disabled: true, value: \"\" },\n                                                        React.createElement(\"option\", null, \"--\"))) :\n                                                React.createElement(\"select\", { value: selectedTemplateId, onChange: function (ev) { return _this.onSelectCourse(ev.target.value).catch(showError); } }, courseOptions.map(function (course) {\n                                                    return React.createElement(\"option\", { key: course.id, value: course.id }, course.name);\n                                                })))),\n                                        selectedTemplateId === 'custom' ? React.createElement(React.Fragment, null,\n                                            React.createElement(AlignHorizontal, null,\n                                                React.createElement(HorizontalItem, null,\n                                                    React.createElement(TextInput, { id: \"customCourseName\", autoFocus: true, label: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Kursens namn\"], [\"Kursens namn\"]))), value: customCourseName || '', onChange: function (value) {\n                                                            return _this.setState({ customCourseName: value });\n                                                        } })),\n                                                React.createElement(HorizontalItem, null,\n                                                    React.createElement(TextInput, { id: \"customCourseCode\", label: L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Kurskod\"], [\"Kurskod\"]))), size: 12, value: customCourseCode || '', onChange: function (customCourseCode) { return _this.setState({ customCourseCode: customCourseCode }); } }))),\n                                            React.createElement(TextInput, { id: \"customCoursePoints\", label: L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Po\\u00E4ng\"], [\"Po\\u00E4ng\"]))), size: 3, value: '' + (customCoursePoints || ''), onChange: function (value) {\n                                                    var numPoints = value ? parseInt(value) : 0;\n                                                    if (!isNaN(numPoints) && numPoints < 1000) {\n                                                        _this.setState({ customCoursePoints: numPoints });\n                                                    }\n                                                } }),\n                                            React.createElement(\"br\", null),\n                                            React.createElement(\"br\", null),\n                                            React.createElement(Link, { className: \"btn btn-large\", to: \"/courses/create-custom/\" + encodeURIComponent(JSON.stringify({ name: customCourseName, code: customCourseCode, points: customCoursePoints })) }, \"Skapa\")) : courses && React.createElement(React.Fragment, null,\n                                            React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n                                                React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                                    React.createElement(\"p\", null, \"Utg\\u00E5 fr\\u00E5n version: \"))),\n                                            React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n                                                React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                                    React.createElement(\"select\", { value: selectedCourseId, onChange: function (ev) { return _this.setState({\n                                                            selectedCourseId: ev.target.value\n                                                        }); } }, courses.map(function (course) {\n                                                        return React.createElement(\"option\", { key: course.id, value: course.id }, course.name);\n                                                    })))),\n                                            React.createElement(\"br\", null),\n                                            React.createElement(\"br\", null),\n                                            selectedCourseId && React.createElement(Link, { to: \"/courses/create-from-template/\" + this.state.selectedCourseId, className: \"btn btn-large\" }, \"Skapa\")))),\n                                React.createElement(\"div\", { className: \"sv-layout sv-column-5\" },\n                                    React.createElement(SchoolCourses, null))))))));\n    };\n    return CreateNewCourse;\n}(React.Component));\nexport { CreateNewCourse };\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5;\n","import { __assign, __awaiter, __extends, __generator, __makeTemplateObject, __read, __spread, __values } from \"tslib\";\nimport * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { L, showInfo, showError } from '../../../utils/utils';\nimport { hasChanges } from '../utils';\nimport { BatchRunner, createUUID } from 'kedbackend/client';\nimport env from '../../../globals/KED.env';\nimport { CourseBanner } from './course-banner';\nimport { InnerEditCourse } from './inner-edit-course';\nimport update from 'react-addons-update';\nimport { updateDocumentGraphs, applyEtags, updateCourseBuilderStatus, loadCourse, updateCreationStamp, updateModificationStamp } from '../utils';\nimport { RemoveItem } from '../sub-components/remove-item';\nimport { getUncoveredKnowledgeRequirements, getSoftAccessList } from './business-logic';\nimport cfg from '../../../globals/KED.cfg';\nimport { Spinner } from \"../sub-components/spinner\";\nimport { mySchoolCoursesRepo } from '../../../repos/school-courses';\nimport { preserveImpersonationQuery } from \"../../../access-control\";\nimport { getCurrentUser } from '../../../globals/current-user';\nimport { features } from '../../../features/features';\nimport { ClassroomSync } from '../../../apis/google-classroom-sync';\nvar catcher = cfg.ENVIRONMENT === 'production' ?\n    showError : null;\nvar CONFIRM_NAVIGATE_MESSAGE = L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Du har osparat data. V\\u00E4lj avbryt och tryck CTRL+S om du vill spara f\\u00F6rst.\"], [\"Du har osparat data. V\\u00E4lj avbryt och tryck CTRL+S om du vill spara f\\u00F6rst.\"])));\nvar DEFAULT_STATE = {\n    origCourse: null,\n    origTemplate: null,\n    course: null,\n    dialogContainers: [],\n    hasUnsavedData: false,\n    view: 'courseBuilder',\n    classroomSyncInProgress: false\n};\nvar EditCourse = /** @class */ (function (_super) {\n    __extends(EditCourse, _super);\n    function EditCourse(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = __assign({}, DEFAULT_STATE);\n        _this.update = _this.update.bind(_this);\n        _this.refDialog = _this.refDialog.bind(_this);\n        _this.contentYPos = 0;\n        _this.onKeyDown = _this.onKeyDown.bind(_this);\n        _this.beforeUnload = _this.beforeUnload.bind(_this);\n        _this.onClickPreventUnload = _this.onClickPreventUnload.bind(_this);\n        _this.isSaving = false;\n        _this.dialogs = [];\n        if (props.view)\n            _this.state = __assign(__assign({}, _this.state), { view: props.view });\n        return _this;\n    }\n    EditCourse.prototype.setStatePromised = function (state) {\n        return this._setState(__assign({ hasUnsavedData: true }, state));\n    };\n    EditCourse.prototype.setNonSaveableDataState = function (state) {\n        return this._setState(state);\n    };\n    EditCourse.prototype._setState = function (state) {\n        var _this = this;\n        if (state.course) {\n            {\n                //\n                // Maintain course task links (remove links to tasks that are not used\n                // by any module)\n                //\n                var _a = state.course, tasks = _a.tasks, modules = _a.modules;\n                var usedTaskIds_1 = {};\n                modules.forEach(function (module) { return module.taskIds.forEach(function (id) { return usedTaskIds_1[id] = true; }); });\n                var filteredCourseTasks = tasks.filter(function (t) { return usedTaskIds_1[t.id]; });\n                var modifiedCourse = __assign({}, state.course);\n                modifiedCourse.tasks = filteredCourseTasks;\n                state = __assign(__assign({}, state), { course: modifiedCourse });\n            }\n        }\n        // Invoke our course into state property allCourses so that the\n        // right-hand side list of courses gets update immediately with\n        // the publishable state of this course.\n        var allCourses = state.allCourses || this.state.allCourses;\n        var course = state.course || this.state.course;\n        if (allCourses) {\n            var idxOurCourse = allCourses.findIndex(function (c) { return c.id === _this.props.id; });\n            allCourses = update(allCourses, { $splice: [[idxOurCourse, 1, course]] });\n            state = __assign({}, state);\n            state.allCourses = allCourses;\n        }\n        return new Promise(function (resolve) { return _super.prototype.setState.call(_this, function () { return state; }, resolve); });\n    };\n    EditCourse.prototype.componentWillMount = function () {\n        this.load().catch(catcher);\n        window.addEventListener('keydown', this.onKeyDown);\n        window.addEventListener('beforeunload', this.beforeUnload);\n        document.body.addEventListener('click', this.onClickPreventUnload);\n    };\n    EditCourse.prototype.componentWillUnmount = function () {\n        window.removeEventListener('keydown', this.onKeyDown);\n        window.removeEventListener('beforeunload', this.beforeUnload);\n        document.body.removeEventListener('click', this.onClickPreventUnload);\n        updateCourseBuilderStatus('');\n    };\n    EditCourse.prototype.componentWillReceiveProps = function (nextProps) {\n        if (this.state && this.state.course) {\n            if (nextProps.id !== this.props.id || nextProps.templateId !== this.props.templateId) {\n                this.setStatePromised(DEFAULT_STATE);\n            }\n        }\n        if (nextProps.view !== this.props.view) {\n            this.setNonSaveableDataState({ view: nextProps.view });\n        }\n    };\n    EditCourse.prototype.componentDidUpdate = function (prevProps, prevState) {\n        if (this.contentDiv) {\n            var contentDiv = findDOMNode(this.contentDiv);\n            if (contentDiv) {\n                this.contentYPos = contentDiv.getBoundingClientRect().top;\n            }\n        }\n        if (prevState && prevState.course) {\n            // This was not the initial update.\n            // If props have been updated to point out another course or template, reset component:\n            if (this.props.id !== prevProps.id || this.props.templateId !== prevProps.templateId) {\n                this.load().catch(catcher);\n            }\n        }\n        if (!prevState.hasUnsavedData && this.state.hasUnsavedData) {\n            updateCourseBuilderStatus('unsaved');\n        }\n    };\n    EditCourse.prototype.loadFromTemplate = function (templateId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var template, course, mySchool;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        showInfo(\"Laddar data frn mall...\");\n                        return [4 /*yield*/, loadCourse(templateId, { includeTemplateChain: true })];\n                    case 1:\n                        template = _a.sent();\n                        course = updateCreationStamp(Date.now(), template, env.currentUser);\n                        course.id = createUUID();\n                        course.parentId = templateId;\n                        course.active = false;\n                        course.isTemplate = false;\n                        course.templateChain = __spread(course.templateChain);\n                        course.templateChain.push({ id: templateId, $meta: 'ref' });\n                        mySchool = env.currentUser.school;\n                        course.school = mySchool;\n                        course.description = \"\";\n                        course.responsibleTeachers = [{ name: env.currentUser.displayName, email: env.currentUser.mail, access: 'full', url: env.currentUser.mail }];\n                        delete course.studyGroups;\n                        course.acl = [\n                            \"role:USER:R\",\n                            \"schoolRole:\" + mySchool + \"/EMPLOYEE:S\" // Other teachers at same school should be able to modify the course.\n                        ];\n                        delete course.$etag;\n                        delete course.createdBy;\n                        delete course.createdDate;\n                        delete course.modifiedBy;\n                        delete course.modifiedDate;\n                        delete course.activatedBy;\n                        delete course.activatedDate;\n                        delete course.googleClassRoomCode;\n                        delete course.googleClassRoomURL;\n                        delete course.googleCreateClassrooms;\n                        return [4 /*yield*/, this.setStatePromised({ course: course, origCourse: null, origTemplate: template })];\n                    case 2:\n                        _a.sent();\n                        showInfo(\"\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditCourse.prototype.loadCustomParams = function (_a) {\n        var name = _a.name, code = _a.code, points = _a.points;\n        var now = Date.now();\n        var mySchool = env.currentUser.school;\n        var user = env.currentUser;\n        var course = {\n            id: createUUID(),\n            name: name,\n            code: code,\n            points: points,\n            dateTime: now,\n            createdDate: now,\n            createdBy: {\n                name: user.displayName,\n                url: \"mailto:\" + user.mail\n            },\n            subjectId: \"custom\",\n            subjectCode: \"custom\",\n            active: false,\n            isTemplate: false,\n            templateChain: [],\n            school: mySchool,\n            description: \"\",\n            responsibleTeachers: [{ name: user.displayName, email: user.mail, access: 'full', url: user.mail }],\n            acl: [\n                \"role:USER:R\",\n                \"schoolRole:\" + mySchool + \"/EMPLOYEE:S\" // Other teachers at same school should be able to modify the course.\n            ],\n            resources: [],\n            modules: [],\n            knowledgeRequirementsOrder: [],\n            centralContentOrder: [],\n            abilitiesOrder: [],\n            images: [],\n            knowledgeRequirements: [],\n            centralContent: [],\n            abilities: [],\n            tasks: [],\n            schoolType: \"gymnasium\",\n            tags: [\n                \"sub:CUSTOM\",\n                \"course:\" + code,\n                \"schoolType:gymnasium\"\n            ]\n        };\n        this.setState({ course: course, origCourse: course, origTemplate: null });\n    };\n    EditCourse.prototype.load = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        updateCourseBuilderStatus('');\n                        if (!this.props.id) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.loadExistingCourse(this.props.id)];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 5];\n                    case 2:\n                        if (!this.props.templateId) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.loadFromTemplate(this.props.templateId)];\n                    case 3:\n                        _a.sent();\n                        return [3 /*break*/, 5];\n                    case 4:\n                        if (this.props.customParams) {\n                            this.loadCustomParams(this.props.customParams);\n                        }\n                        else {\n                            throw new Error(L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Ogiltig parameter. customParams, id eller templateId m\\u00E5ste anges\"], [\"Ogiltig parameter. customParams, id eller templateId m\\u00E5ste anges\"]))));\n                        }\n                        _a.label = 5;\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditCourse.prototype.loadExistingCourse = function (courseId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var course;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        showInfo(\"Laddar kurs\");\n                        return [4 /*yield*/, loadCourse(courseId)];\n                    case 1:\n                        course = _a.sent();\n                        if (!course.responsibleTeachers)\n                            course.responsibleTeachers = [{ name: env.currentUser.displayName, email: env.currentUser.mail, access: 'full', url: env.currentUser.mail }];\n                        return [4 /*yield*/, this.setNonSaveableDataState({ course: course, origCourse: course })];\n                    case 2:\n                        _a.sent();\n                        showInfo(\"\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditCourse.prototype.update = function (courseUpdates) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.setStatePromised({ course: update(this.state.course, courseUpdates) })];\n                    case 1:\n                        _a.sent();\n                        //check classroom changes\n                        if (features.studyGroups) {\n                            this._checkClassroomChanges();\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditCourse.prototype.deleteCourse = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var courseSchool, parentId, courseId, classroomSync, children, br, children_1, children_1_1, childCourse;\n            var e_1, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        showInfo(\"Raderar kursen...\");\n                        courseSchool = this.state.course.school;\n                        parentId = this.state.course.parentId;\n                        courseId = this.props.id;\n                        classroomSync = new ClassroomSync();\n                        classroomSync.delete({ responsibleTeachers: this.state.course.responsibleTeachers, id: courseId });\n                        return [4 /*yield*/, env.kedBackendClient.list(\"courses\", {\n                                hasEdgesTo: [this.props.id]\n                            })];\n                    case 1:\n                        children = _b.sent();\n                        br = new BatchRunner();\n                        try {\n                            for (children_1 = __values(children), children_1_1 = children_1.next(); !children_1_1.done; children_1_1 = children_1.next()) {\n                                childCourse = children_1_1.value;\n                                /* CANNOT DO THIS. MAY NOT HAVE ACCESS! if (childCourse.parentId === courseId) {\n                                  // Reconnect child with my parent instead, as I will be disappearing...\n                                  childCourse.parentId = parentId;\n                                  br.put(\"courses\", childCourse);\n                                }*/\n                            }\n                        }\n                        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                        finally {\n                            try {\n                                if (children_1_1 && !children_1_1.done && (_a = children_1.return)) _a.call(children_1);\n                            }\n                            finally { if (e_1) throw e_1.error; }\n                        }\n                        br.delete(\"courses\", courseId);\n                        return [4 /*yield*/, env.kedBackendClient.batch(br.mutationRequests)];\n                    case 2:\n                        _b.sent();\n                        if (courseSchool === env.currentUser.school) {\n                            mySchoolCoursesRepo.delete(courseId);\n                        }\n                        showInfo(\"\");\n                        location.hash = \"#/courses/new\";\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * In case that the course has changes which should be synced with classroom\n     * Ask the user if the sync should be done\n     */\n    EditCourse.prototype.confirmSaveAndSync = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, course, origCourse, syncWithClassroom;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.state, course = _a.course, origCourse = _a.origCourse;\n                        syncWithClassroom = false;\n                        //confirm should not be displayed in case the checkbox was saved and the feature flag is off\n                        if (origCourse && course.googleCreateClassrooms && !course.inSyncWithClassroom && features.studyGroups) {\n                            syncWithClassroom = confirm(L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Synkronisera kurs kurs med Classroom?\"], [\"Synkronisera kurs kurs med Classroom?\"]))));\n                        }\n                        return [4 /*yield*/, syncWithClassroom];\n                    case 1:\n                        (_b.sent()) ? this.syncWithClassroomAndSave() : this.save();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditCourse.prototype.save = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, course, origCourse, classroomSync, result, catcher_1, enableTeacherRights, origAccessList, modifiedAccessList, currentUser, err_1, errorMessage;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.state, course = _a.course, origCourse = _a.origCourse;\n                        if (!(features.studyGroups && origCourse && origCourse.googleCreateClassrooms && !course.googleCreateClassrooms)) return [3 /*break*/, 4];\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        classroomSync = new ClassroomSync();\n                        return [4 /*yield*/, classroomSync.archive(course)];\n                    case 2:\n                        result = _b.sent();\n                        if (!result.done) {\n                            showError(L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Classroom course could not be archived\"], [\"Classroom course could not be archived\"]))));\n                        }\n                        return [3 /*break*/, 4];\n                    case 3:\n                        catcher_1 = _b.sent();\n                        return [3 /*break*/, 4];\n                    case 4:\n                        enableTeacherRights = features.teacherRights;\n                        origAccessList = this.state.origCourse ? getSoftAccessList(this.state.origCourse) : [];\n                        modifiedAccessList = getSoftAccessList(this.state.course);\n                        currentUser = getCurrentUser();\n                        if (enableTeacherRights &&\n                            (!currentUser.roles.includes(\"ADMIN\") &&\n                                !__spread(origAccessList, modifiedAccessList).some(function (_a) {\n                                    var email = _a.email, url = _a.url, access = _a.access;\n                                    return (email || url) === currentUser.mail && // url is for backward compat! Has been renamed to email.\n                                        (!access || // Backward compat. Was not possible to set access before!\n                                            access === 'edit' || // Edit is fine\n                                            access === 'full');\n                                }))) {\n                            showError(L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Kursen kunde inte sparas. L\\u00E4gg till dig sj\\u00E4lv i listan p\\u00E5 ansvariga l\\u00E4rare\"], [\"Kursen kunde inte sparas. L\\u00E4gg till dig sj\\u00E4lv i listan p\\u00E5 ansvariga l\\u00E4rare\"]))));\n                            return [2 /*return*/];\n                        }\n                        if (this.isSaving)\n                            return [2 /*return*/];\n                        _b.label = 5;\n                    case 5:\n                        _b.trys.push([5, 7, 8, 9]);\n                        this.isSaving = true;\n                        return [4 /*yield*/, this._save()];\n                    case 6:\n                        _b.sent();\n                        return [3 /*break*/, 9];\n                    case 7:\n                        err_1 = _b.sent();\n                        errorMessage = err_1 && err_1.message ? err_1.message : L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Ett ok\\u00E4nt fel har intr\\u00E4ffat...\"], [\"Ett ok\\u00E4nt fel har intr\\u00E4ffat...\"])));\n                        if (err_1) {\n                            if (err_1.name === 'http409' || err_1.name === 'http412' || err_1.name === 'http404') {\n                                // Conflict. Show a nicer error message:\n                                errorMessage = L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"Kursen har redigerad av annan anv\\u00E4ndare. Ladda om sidan och g\\u00F6r om \\u00E4ndrinarna.\"], [\"Kursen har redigerad av annan anv\\u00E4ndare. Ladda om sidan och g\\u00F6r om \\u00E4ndrinarna.\"])));\n                            }\n                            else if (err_1.name === 'http403') {\n                                if (this.state.course.isTemplate)\n                                    errorMessage = L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"Ingen beh\\u00F6righet att spara kursmallen. Endast administrat\\u00F6rer kan redigera kursmallar.\"], [\"Ingen beh\\u00F6righet att spara kursmallen. Endast administrat\\u00F6rer kan redigera kursmallar.\"])));\n                                else if (this.state.course.school)\n                                    errorMessage = L(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"Ingen beh\\u00F6righet att spara kursen \", \". Kursen kan bara redigeras av anst\\u00E4llda p\\u00E5 \", \"\"], [\"Ingen beh\\u00F6righet att spara kursen \", \". Kursen kan bara redigeras av anst\\u00E4llda p\\u00E5 \", \"\"])), this.state.course.name, this.state.course.school);\n                            }\n                        }\n                        showError(errorMessage);\n                        updateCourseBuilderStatus('error');\n                        return [3 /*break*/, 9];\n                    case 8:\n                        this.isSaving = false;\n                        return [7 /*endfinally*/];\n                    case 9: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditCourse.prototype.syncInProgress = function () {\n        return this.state.classroomSyncInProgress;\n    };\n    EditCourse.prototype.syncWithClassroomAndSave = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, course, origCourse, classroomSync, fullSyncNeeded, syncResult, err_2;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.state, course = _a.course, origCourse = _a.origCourse;\n                        return [4 /*yield*/, this.save()];\n                    case 1:\n                        _b.sent();\n                        // if there is still unsaved data it means that an error encountered during save. \n                        // sync with google classroom will be canceled\n                        if (this.state.hasUnsavedData) {\n                            showError(L(templateObject_10 || (templateObject_10 = __makeTemplateObject([\"Synkronisering med Classroom skulle inte ske\"], [\"Synkronisering med Classroom skulle inte ske\"]))));\n                            return [2 /*return*/];\n                        }\n                        _b.label = 2;\n                    case 2:\n                        _b.trys.push([2, 7, , 8]);\n                        this.setState({ classroomSyncInProgress: true });\n                        classroomSync = new ClassroomSync();\n                        if (!course.googleCreateClassrooms) return [3 /*break*/, 6];\n                        fullSyncNeeded = course.inSyncWithClassroom == null;\n                        return [4 /*yield*/, classroomSync.initSync(course, origCourse, fullSyncNeeded)];\n                    case 3:\n                        syncResult = _b.sent();\n                        if (!syncResult.done) return [3 /*break*/, 5];\n                        this.update({ inSyncWithClassroom: { $set: true } });\n                        this.setState({ classroomSyncInProgress: false });\n                        //update inSyncWithClassroom flag\n                        return [4 /*yield*/, this._save(true)];\n                    case 4:\n                        //update inSyncWithClassroom flag\n                        _b.sent();\n                        showInfo(L(templateObject_11 || (templateObject_11 = __makeTemplateObject([\"Synkronisering med framg\\u00E5ng\"], [\"Synkronisering med framg\\u00E5ng\"]))));\n                        return [3 /*break*/, 6];\n                    case 5:\n                        showError(L(templateObject_12 || (templateObject_12 = __makeTemplateObject([\"Fel vid synkronisering med Classroom\"], [\"Fel vid synkronisering med Classroom\"]))));\n                        this.setState({ classroomSyncInProgress: false });\n                        _b.label = 6;\n                    case 6: return [3 /*break*/, 8];\n                    case 7:\n                        err_2 = _b.sent();\n                        catcher;\n                        return [3 /*break*/, 8];\n                    case 8: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditCourse.prototype._save = function (silentSave) {\n        if (silentSave === void 0) { silentSave = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, course, origCourse, origTemplate, doesAllTasksCoverAllRequirements, modifiedCourse, batch, orig, newCourseTasks, tags, isExistingCourse, schoolId, schoolId, schoolId, conflictedCourses, res;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.state, course = _a.course, origCourse = _a.origCourse, origTemplate = _a.origTemplate;\n                        doesAllTasksCoverAllRequirements = getUncoveredKnowledgeRequirements(course).length === 0;\n                        !silentSave && showInfo(L(templateObject_13 || (templateObject_13 = __makeTemplateObject([\"Sparar...\"], [\"Sparar...\"]))));\n                        modifiedCourse = updateModificationStamp(Date.now(), course, env.currentUser);\n                        batch = new BatchRunner();\n                        orig = origCourse || origTemplate;\n                        newCourseTasks = modifiedCourse.tasks.map(function (task) {\n                            if (task.$meta === 'add' || task.$meta === 'update') {\n                                var origTask = orig.tasks.find(function (t) { return t.id === task.id; });\n                                return updateDocumentGraphs(origTask || {}, task, \"tasks\", {\n                                    knowledgeRequirements: 'knowledge-requirements',\n                                    centralContent: 'central-content',\n                                    abilities: 'abilities'\n                                }, batch);\n                            }\n                            else {\n                                var updatedTask = __assign({}, task);\n                                delete updatedTask.$meta;\n                                return updatedTask;\n                            }\n                        });\n                        modifiedCourse = update(modifiedCourse, { tasks: { $set: newCourseTasks } });\n                        modifiedCourse = updateDocumentGraphs(origCourse || {}, modifiedCourse, 'courses', {\n                            templateChain: 'courses',\n                            centralContent: 'central-content',\n                            knowledgeRequirements: 'knowledge-requirements',\n                            abilities: 'abilities',\n                            images: 'images',\n                            tasks: 'tasks'\n                        }, batch);\n                        modifiedCourse = __assign({}, modifiedCourse);\n                        modifiedCourse.publishable = doesAllTasksCoverAllRequirements;\n                        tags = (modifiedCourse.tags || []).filter(function (tag) { return tag !== 'incomplete'; });\n                        modifiedCourse.tags = modifiedCourse.publishable ?\n                            tags : tags.concat(\"incomplete\");\n                        isExistingCourse = origCourse && !this.props.customParams;\n                        if (!!isExistingCourse) return [3 /*break*/, 3];\n                        // A new course should be added:\n                        batch.add('courses', modifiedCourse);\n                        if (!course.school) return [3 /*break*/, 2];\n                        return [4 /*yield*/, mySchoolCoursesRepo.getSchoolId()];\n                    case 1:\n                        schoolId = _b.sent();\n                        batch.link(\"schools\", schoolId, \"courses\", course.id, \"courses\");\n                        if (course.active) {\n                            batch.link(\"schools\", schoolId, \"courses\", course.id, \"activeCourses\");\n                        }\n                        _b.label = 2;\n                    case 2: return [3 /*break*/, 7];\n                    case 3:\n                        // An existing course should be updated:\n                        batch.put('courses', modifiedCourse);\n                        if (!(!origCourse.active && course.active)) return [3 /*break*/, 5];\n                        return [4 /*yield*/, mySchoolCoursesRepo.getSchoolId()];\n                    case 4:\n                        schoolId = _b.sent();\n                        batch.link(\"schools\", schoolId, \"courses\", course.id, \"activeCourses\");\n                        return [3 /*break*/, 7];\n                    case 5:\n                        if (!(origCourse.active && !course.active)) return [3 /*break*/, 7];\n                        return [4 /*yield*/, mySchoolCoursesRepo.getSchoolId()];\n                    case 6:\n                        schoolId = _b.sent();\n                        batch.unlink(\"schools\", schoolId, \"courses\", course.id, \"activeCourses\");\n                        _b.label = 7;\n                    case 7:\n                        if (!(modifiedCourse.subjectCode === 'custom')) return [3 /*break*/, 9];\n                        return [4 /*yield*/, env.kedBackendClient.list(\"courses\", {\n                                tags: [\"course:\" + modifiedCourse.code]\n                            })];\n                    case 8:\n                        conflictedCourses = _b.sent();\n                        conflictedCourses = conflictedCourses.filter(function (c) { return c.id !== modifiedCourse.id; });\n                        conflictedCourses = conflictedCourses.filter(function (c) { return c.subjectCode !== \"custom\"; });\n                        if (conflictedCourses.length > 0) {\n                            throw new Error(L(templateObject_14 || (templateObject_14 = __makeTemplateObject([\"Kursens kurskod f\\u00E5r inte vara samma som kurskoder fr\\u00E5n skolverket: \", \"\"], [\"Kursens kurskod f\\u00E5r inte vara samma som kurskoder fr\\u00E5n skolverket: \", \"\"])), modifiedCourse.code));\n                        }\n                        _b.label = 9;\n                    case 9: return [4 /*yield*/, env.kedBackendClient.batch(batch.mutationRequests)];\n                    case 10:\n                        res = _b.sent();\n                        !silentSave && showInfo(isExistingCourse ? L(templateObject_15 || (templateObject_15 = __makeTemplateObject([\"\\u00C4ndringarna har sparats\"], [\"\\u00C4ndringarna har sparats\"]))) : L(templateObject_16 || (templateObject_16 = __makeTemplateObject([\"Kursen har skapats\"], [\"Kursen har skapats\"]))));\n                        // Update state to reflect what has been posted:\n                        if (res && res.newEtags)\n                            modifiedCourse = applyEtags(modifiedCourse, res.newEtags, [\"images\", \"tasks\"]);\n                        if (course.school === env.currentUser.school) {\n                            // Update mySchoolCoursesRepo\n                            if (!isExistingCourse) {\n                                mySchoolCoursesRepo.insert(modifiedCourse);\n                            }\n                            else {\n                                mySchoolCoursesRepo.update(modifiedCourse);\n                            }\n                        }\n                        return [4 /*yield*/, this.setNonSaveableDataState({ course: modifiedCourse, origCourse: modifiedCourse, hasUnsavedData: false })];\n                    case 11:\n                        _b.sent();\n                        updateCourseBuilderStatus('');\n                        if (!isExistingCourse) {\n                            // This was the creation of a new course. Correct the route now when the user enters an edit state:\n                            location.hash = \"#/courses/\" + modifiedCourse.id + \"/edit\";\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditCourse.prototype._checkClassroomChanges = function () {\n        var _a = this.state, course = _a.course, origCourse = _a.origCourse;\n        var arr1set = course.tasks.filter(function (x) { return x.assignment; });\n        if (!origCourse) {\n            course.inSyncWithClassroom = false;\n            this.setStatePromised({ course: course });\n            return;\n        }\n        //if (course.inSyncWithClassroom) {\n        var arr2set = origCourse.tasks.filter(function (x) { return x.assignment; });\n        //check tasks added or removed\n        var hasTeacherChanges = hasChanges(origCourse.responsibleTeachers, course.responsibleTeachers);\n        //\n        var hasTasksChanges = arr1set.filter(function (x) { return !arr2set.find(function (y) { return y.id == x.id; }); }).length > 0 || arr2set.filter(function (x) { return !arr1set.find(function (y) { return y.id == x.id; }); }).length > 0;\n        //check if any task renamed or changed its type\n        if (!hasTasksChanges) {\n            hasTasksChanges = arr1set.some(function (e1) { return arr2set.find(function (e2) {\n                return e2.id === e1.id && e2.name !== e1.name;\n            }) != null; });\n        }\n        var hasStudyGroupsChanges = hasChanges(origCourse.studyGroups, course.studyGroups);\n        //checks are made with the previous object in case that the user will revert the changes\n        var prevStatus = course.inSyncWithClassroom;\n        course.inSyncWithClassroom = !(hasTeacherChanges || hasTasksChanges || hasStudyGroupsChanges);\n        if (prevStatus != course.inSyncWithClassroom) {\n            this.setStatePromised({ course: course });\n        }\n    };\n    EditCourse.prototype.activateAndSave = function () {\n        var _this = this;\n        var course = __assign({}, this.state.course);\n        if (!course.active) {\n            /*const uncoveredRequirements = getUncoveredKnowledgeRequirements(course);\n            if (uncoveredRequirements.length > 0)\n              return showError (L`Det finns kunskapskrav som inte uppfylls av ngon modul. Kan inte aktivera kursen frrn alla kunskapskrav finns med.`);\n            */\n            course.active = true;\n            course.activatedBy = {\n                name: env.currentUser.displayName,\n                url: \"mailto:\" + env.currentUser.mail\n            };\n            course.activatedDate = Date.now();\n            this.setStatePromised({ course: course })\n                .then(function () { return _this.save(); })\n                .catch(catcher);\n        }\n    };\n    EditCourse.prototype.inactivateAndSave = function () {\n        var _this = this;\n        var course = __assign({}, this.state.course);\n        if (course.active) {\n            course.active = false;\n            course.inactivatedBy = {\n                name: env.currentUser.displayName,\n                url: \"mailto:\" + env.currentUser.mail\n            };\n            course.inactivatedDate = Date.now();\n            this.setStatePromised({ course: course })\n                .then(function () { return _this.save(); })\n                .catch(catcher);\n        }\n    };\n    EditCourse.prototype.openDialog = function (dialogContainer) {\n        this.setNonSaveableDataState({ dialogContainers: this.state.dialogContainers.concat(dialogContainer) });\n    };\n    EditCourse.prototype.closeDialog = function () {\n        var dialogContainers = this.state.dialogContainers;\n        var length = dialogContainers.length;\n        length && this.setNonSaveableDataState({ dialogContainers: dialogContainers.slice(0, length - 1) });\n        // Now sync the direct 'dialogs' property with the new state:\n        while (this.dialogs.length >= length)\n            this.dialogs.pop();\n    };\n    EditCourse.prototype.refDialog = function (dialog, index) {\n        this.dialogs[index] = dialog; // Setting per index instead of push(). Works even if the ref attribute could be invoked multiple times.\n    };\n    EditCourse.prototype.onKeyDown = function (ev) {\n        if (ev.which === 83 && (ev.ctrlKey || ev.metaKey)) { // CTRL-S\n            ev.preventDefault();\n            if (this.state.dialogContainers.length > 0) {\n                this.saveDialog();\n                return;\n            }\n            this.save();\n        }\n        else if (ev.which === 27 && this.state.dialogContainers.length > 0) {\n            this.closeDialog();\n            ev.preventDefault();\n        }\n        else if (ev.which === 13) {\n            var targetElem = ev.target;\n            if (this.state.dialogContainers.length > 0 &&\n                targetElem.tagName !== 'TEXTAREA' &&\n                targetElem.tagName !== 'INPUT' &&\n                targetElem.tagName !== 'SELECT' &&\n                targetElem.tagName !== 'OPTION' &&\n                !targetElem.contentEditable) {\n                this.saveDialog();\n            }\n        }\n    };\n    EditCourse.prototype.beforeUnload = function (ev) {\n        if (this.state.dialogContainers.length > 0 || this.state.hasUnsavedData) {\n            if (!env.kedBackendClient.http.bearerProvider.wantsRedirect) {\n                ev.returnValue = CONFIRM_NAVIGATE_MESSAGE;\n                return ev.returnValue;\n            }\n        }\n    };\n    EditCourse.prototype.onClickPreventUnload = function (ev) {\n        if (ev.target && ('' + ev.target.tagName).toLowerCase() === 'a') {\n            var a = ev.target;\n            if (a.href && a.getAttribute('href') !== '#' && !a.target) {\n                if (this.state.dialogContainers.length > 0 || this.state.hasUnsavedData) {\n                    if (!confirm(CONFIRM_NAVIGATE_MESSAGE)) {\n                        ev.preventDefault();\n                        ev.stopPropagation();\n                        return false;\n                    }\n                }\n            }\n        }\n    };\n    EditCourse.prototype.saveDialog = function () {\n        if (this.state.dialogContainers.length > 0) {\n            var dialog = this.dialogs[this.state.dialogContainers.length - 1]; // YES, should reference this.dialogs by length of dialogContainers. Strange yes, but leave it so!\n            dialog && dialog.save();\n        }\n    };\n    EditCourse.prototype.render = function () {\n        var _this = this;\n        var isAdmin = env.currentUser.roles.indexOf(\"ADMIN\") >= 0;\n        var course = this.state.course;\n        return !this.state.course ? React.createElement(\"div\", { style: { outline: 0 } },\n            React.createElement(CourseBanner, { title: \"\", activePage: this.state.view, routes: { feedback: this.props.feedbackUrl } }),\n            React.createElement(\"p\", null,\n                React.createElement(Spinner, null),\n                \"V.g. v\\u00E4nta medan kursen laddas...\")) :\n            React.createElement(\"div\", { style: { outline: 0 } },\n                React.createElement(CourseBanner, { title: course.name + \" - \" + course.points + \"p\", activePage: this.state.view, routes: {\n                        studentPage: preserveImpersonationQuery(this.props.viewCourseUrl, { courseId: this.props.id }),\n                        feedback: this.props.feedbackUrl\n                    }, host: this, course: course, origCourse: this.state.origCourse, backgroundImage: course.images.filter(function (img) { return img.id === course.imageId; }).map(function (img) { return img.url; })[0], isTemplate: course.isTemplate }),\n                React.createElement(\"div\", { className: \"sv-row sv-layout\" },\n                    React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\n                        React.createElement(\"div\", { className: \"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\" },\n                            React.createElement(\"div\", { className: \"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\", ref: function (div) { return _this.contentDiv = div; } },\n                                React.createElement(InnerEditCourse, { course: this.state.course, origCourse: this.state.origCourse, host: this }),\n                                React.createElement(\"br\", null),\n                                this.state.dialogContainers.map(function (_a, i) {\n                                    var Component = _a.Component, props = _a.props;\n                                    return React.createElement(\"div\", { key: i },\n                                        React.createElement(\"div\", { className: \"darken\" }),\n                                        React.createElement(\"div\", { className: \"modal-page-wrap\" },\n                                            React.createElement(\"div\", { className: \"modal-page\" },\n                                                React.createElement(Component, __assign({ ref: function (dialog) { return _this.refDialog(dialog, i); } }, props)),\n                                                React.createElement(RemoveItem, { onClick: function () { return _this.closeDialog(); } }))));\n                                }))))));\n    };\n    return EditCourse;\n}(React.Component));\nexport { EditCourse };\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10, templateObject_11, templateObject_12, templateObject_13, templateObject_14, templateObject_15, templateObject_16;\n","export { EditCourse } from './edit-course';\n","import { __extends, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { EditableResourceList } from '../sub-components/editable-resource-list';\nimport { dtFormat } from '../utils';\nimport { CourseModuleList } from './course-module-list';\nimport { SchoolCourses } from '../sub-components/school-courses';\nimport { getUncoveredKnowledgeRequirements, sanityCheck, getIdsNotCoveredByTasks, getSoftAccessList } from './business-logic';\nimport { setCourseImage } from \"./course-banner\";\nimport { Spinner, TimeoutSpinner } from '../sub-components/spinner';\nimport { EditableTeacherList } from '../sub-components/editable-teacher-list';\nimport { showError, L } from \"../../../utils/utils\";\nimport { WeightedItemsTable } from '../sub-components/weighted-items-table';\nimport { Wysiwyg } from '../../utility-components/wysiwyg/index';\nimport actions_swedish from '../../utility-components/wysiwyg/actions-sv';\nimport { EditableWorkFlowLink } from '../sub-components/editable-workflow-link';\nimport { getCurrentUser } from '../../../globals/current-user';\nimport { SelectStudyGroups } from '../sub-components/select-study-groups';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\nimport { features } from '../../../features';\nimport { TextInput } from '../../utility-components/form-field-text-input';\nimport { AlignHorizontal } from '../../utility-components/align-horizontal';\nimport { HorizontalItem } from '../../utility-components/horizontal-item';\nimport { Suspense } from 'react';\n;\nvar InnerEditCourse = /** @class */ (function (_super) {\n    __extends(InnerEditCourse, _super);\n    function InnerEditCourse(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            changeImageUrl: false\n        };\n        return _this;\n    }\n    InnerEditCourse.prototype.setImageUrl = function (imageUrl) {\n        var course = this.props.course;\n        if (!course.imageId) {\n        }\n    };\n    InnerEditCourse.prototype.render = function () {\n        var _a = this.props, course = _a.course, origCourse = _a.origCourse, host = _a.host;\n        var uncoveredKnowledgeRequirements = getUncoveredKnowledgeRequirements(course);\n        var idsNotCoveredByAnyTask = getIdsNotCoveredByTasks(course);\n        var sanityCheckWarnings = sanityCheck(course);\n        var courseImage = course.images.find(function (img) { return img.id === course.imageId; });\n        var courseImageIsDataUrl = courseImage && courseImage.url.startsWith('data:');\n        var courseIsUploaded = courseImage && courseImage.url.indexOf('storage.googleapis.com') > 0;\n        var softAccessList = getSoftAccessList(course);\n        var currentUser = getCurrentUser();\n        var canDelete = !features.teacherRights || softAccessList.some(function (user) { return user.email === currentUser.mail && user.access === 'full'; });\n        var displayStudyGroups = features.studyGroups;\n        return React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\n            React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-7\" },\n                React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                    course.isTemplate && React.createElement(\"h1\", null, \"Kursmall\"),\n                    React.createElement(\"h2\", null, \"Kurs\\u00F6vergripande\"),\n                    React.createElement(OpenCloseBox, { title: React.createElement(\"p\", null, \"Kurs\\u00F6vergripande\"), headerOpen: true, inactivated: !features.cbCollapseBoxes },\n                        React.createElement(\"div\", { className: \"ked_boxed\" },\n                            React.createElement(\"div\", null,\n                                course.subjectId === \"custom\" && React.createElement(React.Fragment, null,\n                                    React.createElement(\"h3\", null, \"Kursens namn och po\\u00E4ng\"),\n                                    React.createElement(AlignHorizontal, null,\n                                        React.createElement(HorizontalItem, null,\n                                            React.createElement(TextInput, { id: \"customCourseName\", autoFocus: true, label: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Kursens namn\"], [\"Kursens namn\"]))), value: course.name, onChange: function (value) { return host.update({ name: { $set: value } }); } })),\n                                        React.createElement(HorizontalItem, null,\n                                            React.createElement(TextInput, { id: \"customCourseCode\", label: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Kurskod\"], [\"Kurskod\"]))), size: 12, value: course.code || '', onChange: function (courseCode) { return host.update({ code: { $set: courseCode } }); } }))),\n                                    React.createElement(TextInput, { id: \"customCoursePoints\", label: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Po\\u00E4ng\"], [\"Po\\u00E4ng\"]))), size: 3, value: '' + (course.points || ''), onChange: function (value) {\n                                            var numPoints = value ? parseInt(value) : 0;\n                                            if (!isNaN(numPoints) && numPoints < 1000) {\n                                                host.update({ points: { $set: { numPoints: numPoints } } });\n                                            }\n                                        } }),\n                                    React.createElement(\"br\", null)),\n                                React.createElement(\"h3\", null, \"Kursens bild\"),\n                                courseImageIsDataUrl ?\n                                    React.createElement(\"p\", null, \"Kursens bild ligger i databasen. F\\u00F6r att \\u00E4ndra bild m\\u00E5ste du dra och sl\\u00E4ppa en ny bild ovanp\\u00E5 den gamla h\\u00F6gst upp p\\u00E5 denna sida. Bilden kan antingen vara fr\\u00E5n en annan webbsida. Lokala bildfiler g\\u00E5r ocks\\u00E5 bra att dra och sl\\u00E4ppa.\")\n                                    : courseIsUploaded ? React.createElement(\"p\", null, \"Kursens bild ligger i Kunskapsskolans Google moln. F\\u00F6r att \\u00E4ndra bild m\\u00E5ste du dra och sl\\u00E4ppa en ny bild ovanp\\u00E5 den gamla h\\u00F6gst upp p\\u00E5 denna sida. Bilden kan antingen vara fr\\u00E5n en annan webbsida. Lokala bildfiler g\\u00E5r ocks\\u00E5 bra att dra och sl\\u00E4ppa.\") : courseImage ? React.createElement(\"div\", null,\n                                        React.createElement(\"textarea\", { value: courseImage.url, style: { width: '100%', height: '30px' }, onChange: function (ev) { return setCourseImage(course, origCourse, host, ev.target.value); } }),\n                                        React.createElement(\"p\", null, \"Bilden som visas h\\u00F6gst upp h\\u00E4mtas fr\\u00E5n angiven URL. F\\u00F6r att \\u00E4ndra bild kan du redigera URL ovan. Ett annat s\\u00E4tt att \\u00E4ndra bild \\u00E4r att dra och sl\\u00E4ppa en ny bild \\u00F6ver den gamla h\\u00F6gst upp p\\u00E5 sidan.\")) :\n                                        React.createElement(\"p\", null, \"Kursen saknar egen bild. L\\u00E4gg till en bild genom att dra och sl\\u00E4ppa en bild p\\u00E5 kurs-bannern h\\u00F6gst upp p\\u00E5 den h\\u00E4r sidan.\"),\n                                React.createElement(\"br\", null)),\n                            !course.isTemplate && React.createElement(\"div\", null,\n                                React.createElement(\"h3\", null, \"Beskrivning\"),\n                                React.createElement(\"p\", { className: \"subHeader\" }, \"(Beskrivning av kursen. F\\u00F6r att skilja mellan olika varianter av samma gymnasiekurs)\"),\n                                React.createElement(\"textarea\", { className: \"inputTextBox inputTextSmall\", value: course.description, onChange: function (ev) { return host.update({ description: { $set: ev.target.value } }); } }),\n                                React.createElement(\"br\", null)),\n                            React.createElement(\"div\", null,\n                                React.createElement(\"h3\", null, \"Upptaktstext\"),\n                                React.createElement(\"p\", { className: \"subHeader\" }, \"(texten ska visas p\\u00E5 kursens upptaktssektion)\"),\n                                React.createElement(Wysiwyg, { html: course.runUpText, defaultActions: actions_swedish, actions: [\n                                        \"bold\",\n                                        \"italic\",\n                                        \"underline\",\n                                        \"strikethrough\",\n                                        \"heading2\",\n                                        \"heading3\",\n                                        \"olist\",\n                                        \"ulist\",\n                                        \"outdent\",\n                                        \"indent\",\n                                        \"line\",\n                                        \"link\",\n                                        \"image\"\n                                    ], onChange: function (newHtml) { return host.update({ runUpText: { $set: newHtml } }); } }),\n                                React.createElement(\"br\", null)),\n                            React.createElement(\"h3\", null, \"Kursresurser\"),\n                            React.createElement(\"p\", { className: \"subHeader\" }, \"(Resurser f\\u00F6r upptakt och kursen som helhet)\"),\n                            React.createElement(EditableResourceList, { resources: course.resources, onUpdate: function (resourcesUpdates) { return host.update({ resources: resourcesUpdates }); }, host: host }),\n                            React.createElement(\"br\", null),\n                            React.createElement(\"h3\", null, \"Arbetsg\\u00E5ng\"),\n                            React.createElement(\"p\", { className: \"subHeader\" }, \"(Eventuell l\\u00E4nk till arbetsg\\u00E5ng f\\u00F6r kursen)\"),\n                            React.createElement(EditableWorkFlowLink, { url: course.workFlowLink, onUpdate: function (updates) { return host.update({ workFlowLink: updates }); }, host: host }),\n                            React.createElement(\"br\", null),\n                            !course.isTemplate && React.createElement(\"div\", null,\n                                React.createElement(\"h3\", null, \"Google Classroom\"),\n                                displayStudyGroups ? React.createElement(\"div\", { className: \"align-horizontal\" },\n                                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                        React.createElement(\"div\", { className: \"checkBox\" + (course.googleCreateClassrooms ? \" checked\" : \"\"), onClick: function () { host.update({ googleCreateClassrooms: { $set: !course.googleCreateClassrooms } }); } })),\n                                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                        \"Skapa klassrum f\\u00F6r kursen \",\n                                        React.createElement(\"br\", null),\n                                        React.createElement(\"em\", null, \"(kursen m\\u00E5ste sparas innan du kan synkronisera med Classroom)\")))\n                                    :\n                                        React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n                                            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                                React.createElement(\"input\", { placeholder: \"Google classroom URL\", type: \"text\", size: 30, value: course.googleClassRoomURL, onChange: function (ev) { return host.update({ googleClassRoomURL: { $set: ev.target.value } }); } })),\n                                            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                                React.createElement(\"input\", { placeholder: \"kod\", type: \"text\", size: 8, value: course.googleClassRoomCode, onChange: function (ev) { return host.update({ googleClassRoomCode: { $set: ev.target.value } }); } })))),\n                            course.isTemplate ? null : React.createElement(React.Fragment, null,\n                                React.createElement(EditableTeacherList, { school: course.school, teachers: course.responsibleTeachers, onUpdate: function (teachersUpdate) {\n                                        host.update({ responsibleTeachers: { $set: teachersUpdate } });\n                                    } }),\n                                React.createElement(\"br\", null),\n                                displayStudyGroups && React.createElement(\"div\", { className: \"select-studygroups\" },\n                                    React.createElement(\"h3\", null, L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Undervisningsgrupper\"], [\"Undervisningsgrupper\"])))),\n                                    React.createElement(Suspense, { fallback: React.createElement(TimeoutSpinner, null) },\n                                        React.createElement(SelectStudyGroups, { school: course.school, courseCode: course.code, selectedStudyGroups: course.studyGroups || [], onUpdate: function (studyGroups) { return host.update({ studyGroups: { $set: studyGroups } }); }, placeholder: L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Koppla undervisningsgrupper till kursen...\"], [\"Koppla undervisningsgrupper till kursen...\"]))) })))))),\n                    React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                        React.createElement(\"div\", { id: \"Kursensmoduler\" }),\n                        React.createElement(\"h2\", null, \"Kursens moduler\"),\n                        React.createElement(\"hr\", null)),\n                    React.createElement(CourseModuleList, { host: host, course: course, idsNotCoveredByAnyTask: idsNotCoveredByAnyTask }),\n                    React.createElement(\"div\", null,\n                        React.createElement(\"br\", null),\n                        React.createElement(WeightedItemsTable, { course: course })),\n                    React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                        React.createElement(\"h2\", null, \"Kursens status\"),\n                        React.createElement(\"hr\", null),\n                        course.createdBy && course.createdDate && React.createElement(\"p\", null,\n                            \"Kursen skapades \",\n                            dtFormat(course.createdDate),\n                            \" av \",\n                            React.createElement(\"strong\", null, course.createdBy.name),\n                            \".\"),\n                        course.modifiedBy && course.modifiedDate && React.createElement(\"p\", null,\n                            \"Kursen redigerades senast \",\n                            dtFormat(course.modifiedDate),\n                            \" av \",\n                            React.createElement(\"strong\", null, course.modifiedBy.name),\n                            \".\"),\n                        course.active ? React.createElement(\"p\", null,\n                            \"Kursen \\u00E4r \",\n                            React.createElement(\"strong\", null, \"AKTIV\"),\n                            \" sedan \",\n                            dtFormat(course.activatedDate),\n                            \" av \",\n                            React.createElement(\"strong\", null, course.activatedBy.name),\n                            \".\") : React.createElement(\"p\", null,\n                            \"Kursen \\u00E4r \",\n                            React.createElement(\"strong\", null, \"INAKTIV\"),\n                            course.inactivatedBy ? React.createElement(\"span\", null,\n                                \"sedan \",\n                                dtFormat(course.inactivatedDate),\n                                \" av \",\n                                React.createElement(\"strong\", null, course.inactivatedBy.name),\n                                \".\") : React.createElement(\"span\", null, \".\")),\n                        (uncoveredKnowledgeRequirements.length === 0 ?\n                            React.createElement(\"p\", { className: \"markedGreen\" }, \"Modulernas kunskapskrav t\\u00E4cker skolverkets krav f\\u00F6r denna kurs\") :\n                            React.createElement(\"div\", { className: \"markedRed warning-box\" },\n                                React.createElement(\"div\", { className: \"warningFlag\" },\n                                    React.createElement(\"i\", { className: \"fas fa-exclamation-triangle\", \"aria-hidden\": \"true\" })),\n                                React.createElement(\"p\", null, \"Modulernas kunskapskrav t\\u00E4cker inte skolverkets krav f\\u00F6r denna kurs.\"))),\n                        sanityCheckWarnings.map(function (warning) { return React.createElement(\"div\", { key: warning, className: \"markedRed warning-box\" },\n                            React.createElement(\"div\", { className: \"warningFlag\" },\n                                React.createElement(\"i\", { className: \"fas fa-exclamation-triangle\", \"aria-hidden\": \"true\" })),\n                            React.createElement(\"p\", null, warning)); }),\n                        React.createElement(\"br\", null),\n                        React.createElement(\"div\", { className: \"btn btn-large\", onClick: function () { return host.confirmSaveAndSync(); } }, \"Spara\"),\n                        course.active ?\n                            React.createElement(\"div\", { className: \"btn btn-info btn-large\", onClick: function () { return host.inactivateAndSave(); } }, \"Inaktivera och spara\") :\n                            React.createElement(\"div\", { className: \"btn btn-info btn-large\", onClick: function () { return host.activateAndSave(); } }, \"Aktivera och spara\")),\n                    React.createElement(\"br\", null),\n                    React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                        canDelete && !course.isTemplate && (origCourse ? React.createElement(\"div\", { className: \"btn btn-warning btn-large pull-right\", onClick: function () {\n                                if (confirm(L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Bekr\\u00E4fta borttagning av kursen \\\"\", \" - \", \"\\\" f\\u00F6r skolan \", \"\\n\\nKursen kommar att raderas helt!\\n\\n\\u00C4r du s\\u00E4ker?\"], [\"Bekr\\u00E4fta borttagning av kursen \\\"\", \" - \", \"\\\" f\\u00F6r skolan \", \"\\\\n\\\\nKursen kommar att raderas helt!\\\\n\\\\n\\u00C4r du s\\u00E4ker?\"])), course.name, course.description, course.school)))\n                                    host.deleteCourse().catch(showError);\n                            } }, \"Ta bort kurs\") : React.createElement(\"div\", { className: \"btn btn-warning btn-large pull-right\", onClick: function () { return history.go(-1); } }, \"Avbryt\")),\n                        origCourse && course.googleCreateClassrooms && displayStudyGroups &&\n                            React.createElement(\"div\", { className: \"btn btn-primary btn-large pull-right\", onClick: function () { return host.syncWithClassroomAndSave(); } },\n                                host.syncInProgress() ? React.createElement(Spinner, null) :\n                                    (course.inSyncWithClassroom ? React.createElement(\"span\", null,\n                                        React.createElement(\"i\", { className: \"fas fa-check\", \"aria-hidden\": \"true\" })) : React.createElement(\"span\", null,\n                                        React.createElement(\"i\", { className: \"fas fa-code-branch\" }))),\n                                \"\\u00A0Synk med Classroom\")))),\n            React.createElement(\"div\", { className: \"sv-layout sv-column-5\" },\n                React.createElement(SchoolCourses, null)));\n    };\n    return InnerEditCourse;\n}(React.Component));\nexport { InnerEditCourse };\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6;\n","import { __extends, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { L } from '../../utils/utils';\nimport { HashRouter as Router, Route } from 'react-router-dom';\nimport { ErrorSuccessFeedback } from '../../utils/error-success-feedback';\nimport { Schools } from './schools';\nimport { NewSchool } from './schools/new-school';\nimport env from '../../globals/KED.env';\n// Views\nimport { Subjects, ShowSubject } from './subjects';\nimport { EditCourse } from './courses';\nimport { EditSchool } from \"./schools/edit-school\";\nimport { CourseBanner } from \"./courses/course-banner\";\nimport { CreateNewCourse } from \"./courses/create-new\";\n// Keep Session Alive\nimport { keepSessionAlive } from '../../utils/keep-session-alive';\nkeepSessionAlive();\nvar CourseBuilder = /** @class */ (function (_super) {\n    __extends(CourseBuilder, _super);\n    function CourseBuilder(props) {\n        return _super.call(this, props) || this;\n    }\n    CourseBuilder.prototype.render = function () {\n        var _this = this;\n        var isAuthorized = env.currentUser.roles.some(function (role) { return role === \"ADMIN\" || role === \"EMPLOYEE\"; });\n        var isAdmin = env.currentUser.roles.some(function (role) { return role === \"ADMIN\"; });\n        return React.createElement(\"div\", { className: \"course-builder\" },\n            React.createElement(Router, null, isAuthorized ? React.createElement(\"div\", null,\n                React.createElement(Route, { exact: true, path: \"/\", render: function (_a) {\n                        var match = _a.match;\n                        return isAdmin ?\n                            React.createElement(Schools, { viewCourseUrl: _this.props.viewCourseUrl, feedbackUrl: _this.props.feedbackUrl }) :\n                            React.createElement(CreateNewCourse, { feedbackUrl: _this.props.feedbackUrl });\n                    } }),\n                React.createElement(Route, { exact: true, path: \"/schools\", render: function (_a) {\n                        var match = _a.match;\n                        return React.createElement(Schools, { viewCourseUrl: _this.props.viewCourseUrl, feedbackUrl: _this.props.feedbackUrl });\n                    } }),\n                React.createElement(Route, { exact: true, path: \"/schools/new/gymnasium\", render: function () { return React.createElement(NewSchool, { type: \"gymnasium\", feedbackUrl: _this.props.feedbackUrl }); } }),\n                React.createElement(Route, { exact: true, path: \"/schools/new/primary\", render: function () { return React.createElement(NewSchool, { type: \"primary\", feedbackUrl: _this.props.feedbackUrl }); } }),\n                React.createElement(Route, { exact: true, path: \"/schools/:id/edit\", render: function (_a) {\n                        var match = _a.match;\n                        return React.createElement(EditSchool, { id: match.params.id, title: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Editera skola\"], [\"Editera skola\"]))), feedbackUrl: _this.props.feedbackUrl });\n                    } }),\n                React.createElement(Route, { exact: true, path: \"/subjects\", render: function () { return React.createElement(Subjects, { feedbackUrl: _this.props.feedbackUrl }); } }),\n                React.createElement(Route, { path: \"/subjects/:id\", render: function (_a) {\n                        var match = _a.match;\n                        return React.createElement(ShowSubject, { id: match.params.id, feedbackUrl: _this.props.feedbackUrl });\n                    } }),\n                React.createElement(Route, { exact: true, path: \"/courses/new\", render: function () { return React.createElement(CreateNewCourse, { feedbackUrl: _this.props.feedbackUrl }); } }),\n                React.createElement(Route, { path: \"/courses/create-from-template/:templateId\", render: function (_a) {\n                        var match = _a.match;\n                        return React.createElement(EditCourse, { templateId: match.params.templateId, view: \"courseBuilder\", viewCourseUrl: _this.props.viewCourseUrl, feedbackUrl: _this.props.feedbackUrl });\n                    } }),\n                React.createElement(Route, { path: \"/courses/create-custom/:customParams\", render: function (_a) {\n                        var match = _a.match;\n                        return React.createElement(EditCourse, { customParams: JSON.parse(decodeURIComponent(match.params.customParams)), view: \"courseBuilder\", viewCourseUrl: _this.props.viewCourseUrl, feedbackUrl: _this.props.feedbackUrl });\n                    } }),\n                React.createElement(Route, { path: \"/courses/:id/edit\", render: function (_a) {\n                        var match = _a.match;\n                        return React.createElement(EditCourse, { id: match.params.id, view: \"courseBuilder\", viewCourseUrl: _this.props.viewCourseUrl, feedbackUrl: _this.props.feedbackUrl });\n                    } })) : React.createElement(\"div\", null,\n                React.createElement(Route, { path: \"/\", render: function () { return React.createElement(\"div\", null,\n                        React.createElement(CourseBanner, { title: \"Kursbyggaren\", activePage: \"courseBuilder\", routes: { feedback: _this.props.feedbackUrl } }),\n                        React.createElement(\"h2\", null, \"Beh\\u00F6righet saknas\"),\n                        React.createElement(\"p\", null, \"Detta verktyg \\u00E4r endast till f\\u00F6r anst\\u00E4llda p\\u00E5 Kunskapsskolan.\"),\n                        React.createElement(\"h3\", null, \"Anv\\u00E4ndarattribut\"),\n                        React.createElement(\"table\", { className: \"ked_boxed\", style: { border: \"1px solid #eee\" } },\n                            React.createElement(\"thead\", null,\n                                React.createElement(\"tr\", null,\n                                    React.createElement(\"th\", null, \"Attribut\"),\n                                    React.createElement(\"th\", null, \"V\\u00E4rde\"))),\n                            React.createElement(\"tbody\", null, Object.keys(env.currentUser).map(function (attr) { return React.createElement(\"tr\", { key: attr },\n                                React.createElement(\"td\", null, attr),\n                                React.createElement(\"td\", null, env.currentUser[attr])); })))); } }))),\n            React.createElement(ErrorSuccessFeedback, null));\n    };\n    return CourseBuilder;\n}(React.Component));\nexport { CourseBuilder };\nvar templateObject_1;\n","import ReactDatePicker from \"react-datepicker\";\nimport moment from 'moment';\nimport * as React from 'react';\nimport { TaskMigrationBox } from \"./task-migration-box\";\nimport { GooglePicker } from '../../../../apis/google-picker';\nimport { DriveButton } from \"../../../../apis/buttons\";\nimport { TaskContentFragment } from \"./task-content-fragment\";\nimport { UICheckbox } from \"../../../utility-components/checkbox\";\nimport { FileView } from '../../../course-viewer/subcomponents/task-fileview';\nexport function BasicEditableTaskFields(_a) {\n    var task = _a.task, course = _a.course, writeAccess = _a.writeAccess, features = _a.features, editTask = _a.editTask, templates = _a.templates;\n    var showGooglePicker = features.picker;\n    if (task.contentType === undefined) {\n        task.contentType = task.url != '' ? 'url' : 'desc';\n    }\n    return React.createElement(\"div\", null,\n        React.createElement(\"h2\", null, \"Uppgiftens namn och l\\u00E4nk\"),\n        React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                React.createElement(\"p\", null, \"Uppgiftens namn:\")),\n            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                React.createElement(\"input\", { autoFocus: true, type: \"text\", size: 35, value: task.name, disabled: !writeAccess, readOnly: !writeAccess, onChange: function (ev) {\n                        editTask.updateTaskOrCustomization(\"name\", { $set: ev.target.value });\n                    } }))),\n        task.migratedTexts && writeAccess && React.createElement(TaskMigrationBox, { task: task, course: course, updateLink: function (id, linkOrUnlink) { return editTask.updateLink(id, linkOrUnlink); } }),\n        React.createElement(\"h2\", null, \"Inneh\\u00E5llstyp\"),\n        React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                React.createElement(\"p\", null, \"V\\u00E4lj:\")),\n            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                React.createElement(\"select\", { value: task.contentType, onChange: function (ev) {\n                        editTask.updateTaskOrCustomization(\"contentType\", { $set: ev.target.value });\n                    } },\n                    React.createElement(\"option\", { value: \"url\" }, \"L\\u00E4nk\"),\n                    React.createElement(\"option\", { value: \"desc\" }, \"Beskrivning\")))),\n        task.contentType == 'url' ? React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                React.createElement(\"p\", null, \"URL:\")),\n            React.createElement(\"div\", { className: \"horizontalItem top align-horizontal\" },\n                React.createElement(\"div\", { className: \"horizontalItem top\" },\n                    React.createElement(\"input\", { className: \"horizontalItem\", type: \"text\", size: 35, value: task.url, disabled: !writeAccess, readOnly: !writeAccess, onChange: function (ev) {\n                            editTask.updateTaskOrCustomization(\"url\", { $set: ev.target.value });\n                        } })),\n                React.createElement(\"div\", { className: \"horizontalItem top\" }, showGooglePicker && React.createElement(DriveButton, { label: \"\", action: function () {\n                        var picker = new GooglePicker({ upload: true });\n                        picker.show().then(function (files) {\n                            var fileurl = files[0].url;\n                            var viewurl = fileurl.substr(0, fileurl.lastIndexOf('/')) + \"/view\";\n                            if (viewurl == task.url)\n                                return;\n                            editTask.updateTaskOrCustomization(\"url\", { $set: viewurl });\n                        });\n                    } })))) : React.createElement(React.Fragment, null, (writeAccess || !!task.content) && React.createElement(TaskContentFragment, { writeAccess: writeAccess, task: task, editTask: editTask })),\n        React.createElement(React.Fragment, null,\n            React.createElement(\"h2\", null, \"Inl\\u00E4mningsuppgift\"),\n            React.createElement(UICheckbox, { state: (editTask.getTaskProp(\"assignment\") ? \"checked\" : \"\"), onChange: function () {\n                    editTask.updateTaskOrCustomization(\"assignment\", { $set: !editTask.getTaskProp(\"assignment\") });\n                }, label: \"Den h\\u00E4r uppgiften \\u00E4r en inl\\u00E4mningsuppgift\" }),\n            task.assignment && features.picker && React.createElement(React.Fragment, null,\n                React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"p\", null, \"V\\u00E4lj mall:\")),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"select\", { value: task.templateFile ? task.templateFile.fileId : '-', onChange: function (ev) {\n                                var newValue = ev.target.value;\n                                if (newValue === '-') {\n                                    // do not use template\n                                    editTask.updateTemplateView(null);\n                                }\n                                else if (newValue.startsWith('t:')) {\n                                    editTask.updateTemplateView({ fileId: newValue });\n                                }\n                                else {\n                                    // Picked file\n                                    var picker = new GooglePicker({ limitType: 'google-apps' });\n                                    picker.show().then(function (files) { return editTask.updateTemplateView(files[0]); });\n                                }\n                            } },\n                            React.createElement(\"option\", { value: \"-\" }, \"Ingen mall\"),\n                            templates ? templates.map(function (template, idx) {\n                                return React.createElement(\"option\", { key: idx, value: \"t:\" + template.fileId },\n                                    template.grade ? template.grade + \": \" : \"\",\n                                    template.title);\n                            }) : null,\n                            task.templateFile && !task.templateFile.fileId.startsWith('t:') ?\n                                React.createElement(\"option\", { value: task.templateFile.fileId },\n                                    \"Egen mall: \",\n                                    task.templateFile.name) :\n                                React.createElement(\"option\", { value: \"4\" }, \"Egen mall\")))),\n                task.templateFile && React.createElement(\"div\", { className: \"spaced\" },\n                    React.createElement(FileView, { size: \"large\", thumbnail: task.templateFile.iconUrl, title: task.templateFile.name, url: task.templateFile.url }),\n                    course.googleCreateClassrooms && React.createElement(\"p\", null,\n                        React.createElement(\"em\", null, \"Obs! Uppgiften hamnar i kursens Classroom som en inl\\u00E4mingsuppgift.\")))),\n            editTask.getTaskProp(\"assignment\") && React.createElement(React.Fragment, null,\n                React.createElement(\"p\", null, \"Inl\\u00E4mningsdatum\"),\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(ReactDatePicker, { nextMonthButtonLabel: \"\", previousMonthButtonLabel: \"\", showWeekNumbers: true, selected: editTask.getTaskProp(\"deadline\") && moment(editTask.getTaskProp(\"deadline\")).toDate(), dateFormat: \"yyyy-MM-dd\", locale: \"sv\", popperPlacement: \"bottom-start\", onChange: function (value) {\n                                editTask.updateTaskOrCustomization(\"deadline\", { $set: moment(value).format(\"YYYY-MM-DD\") });\n                            } })),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" }, editTask.getTaskProp(\"deadline\") && React.createElement(\"a\", { className: \"deleteDate\", href: \"#\", title: \"Ta bort inl\\u00E4mningsdatum\", onClick: function (ev) {\n                            ev.preventDefault();\n                            editTask.updateTaskOrCustomization(\"deadline\", { $set: null });\n                        } }))),\n                React.createElement(UICheckbox, { state: ((task.sendToUrkund == null ? true : task.sendToUrkund) ? \"checked\" : \"\"), onChange: function () {\n                        return editTask.updateTaskOrCustomization(\"sendToUrkund\", { $set: task.sendToUrkund == null ? false : !task.sendToUrkund });\n                    }, label: \"Skicka inl\\u00E4mningar till Urkund\" }),\n                task.templateFile && React.createElement(UICheckbox, { state: (task.additionalUploads ? \"checked\" : \"\"), label: \"Till\\u00E5t inl\\u00E4mning av andra/ytterligare filer\", onChange: function () {\n                        return editTask.updateTaskOrCustomization(\"additionalUploads\", { $set: task.additionalUploads == null ? true : !task.additionalUploads });\n                    } }))));\n}\n","import { __assign, __awaiter, __extends, __generator, __makeTemplateObject, __read } from \"tslib\";\nimport * as React from 'react';\nimport { createUUID } from 'kedbackend/client';\nimport { KnowledgeMatrix } from '../../sub-components/knowledge-matrix';\nimport update from 'react-addons-update';\nimport { hasWriteAccess } from '../../../../access-control';\nimport { SelectRelatedDocs } from '../../sub-components/select-related-docs';\nimport validUrl from 'valid-url';\nimport { L, showError } from \"../../../../utils/utils\";\nimport { CachedResponse } from \"../../../../utils/cached-response\";\nimport env from '../../../../globals/KED.env';\nimport { Spinner } from \"../../sub-components/spinner\";\nimport { Features, features } from '../../../../features';\nimport { SearchResults } from './search-results';\nimport { BasicEditableTaskFields } from './basic-editable-task-fields';\nimport { TaskStatusFragment } from './task-status-fragment';\nimport { SaveOrCancelButtons } from './save-or-cancel-buttons';\nimport { PreviewableTaskFields } from './previewable-task-fields';\nimport { GoogleDrive } from '../../../../apis/google-drive';\nimport { TemplatesFileId } from '../../../../apis/configs';\nimport { washHtml } from '../../../utility-components/wysiwyg/wash-html';\nvar EditTask = /** @class */ (function (_super) {\n    __extends(EditTask, _super);\n    function EditTask(props) {\n        var _this = _super.call(this, props) || this;\n        _this.features = new Features();\n        var writeAccess = !props.task || hasWriteAccess(env.currentUser, props.task);\n        _this.state = {\n            title: props.task ?\n                writeAccess ? L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Redigera uppgift till \\\"\", \"\\\"\"], [\"Redigera uppgift till \\\"\", \"\\\"\"])), props.module.name) : L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Visa uppgift till \\\"\", \"\\\"\"], [\"Visa uppgift till \\\"\", \"\\\"\"])), props.module.name) :\n                props.searchMode ? L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"S\\u00F6k ny uppgift till \\\"\", \"\\\"\"], [\"S\\u00F6k ny uppgift till \\\"\", \"\\\"\"])), props.module.name) : L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"L\\u00E4gg till egen uppgift till \\\"\", \"\\\"\"], [\"L\\u00E4gg till egen uppgift till \\\"\", \"\\\"\"])), props.module.name),\n            futureAbilitiesOpen: false,\n            taskCustomization: props.taskCustomization || {},\n            task: props.task ? __assign({ $meta: props.task.$meta || 'update' }, props.task) : props.searchMode ? null :\n                // No task was given. Set $meta = 'add' to inform EditCourse.save()\n                // to add the task to the tasks table.\n                {\n                    id: createUUID(),\n                    $meta: 'add',\n                    tags: [\n                        \"sub:\" + props.course.subjectCode,\n                        \"course:\" + props.course.code\n                    ],\n                    school: !props.course.isTemplate && env.currentUser.school,\n                    resources: [],\n                    abilities: [],\n                    centralContent: [],\n                    futureAbilities: [],\n                    knowledgeRequirements: [],\n                    name: \"\",\n                    url: \"\",\n                    acl: props.course.isTemplate ? [\n                        \"role:USER:R\" // (OK to keep after kursbygg-changes). Templates (which will be empty!) will not have tasks. If they had, might not tasks should not be possible to modify. (An ADMIN could belong to a school! Other non-admins at that school should not be able to edit it)\n                    ] : [\n                        \"role:USER:R\",\n                        \"schoolRole:\" + env.currentUser.school + \"/EMPLOYEE:S\"\n                    ]\n                },\n            searchMarkedIds: props.searchMode && [],\n            searchResult: props.searchMode && [],\n            isSearching: props.searchMode\n        };\n        if (props.searchMode) {\n            _this.searchResponse = new CachedResponse(function () {\n                return env.kedBackendClient.list(\"tasks\", {\n                    tags: \"course:\" + props.course.code,\n                    include: ['knowledgeRequirements', 'abilities', 'centralContent'],\n                    flags: ['includeIdsOnly']\n                });\n            });\n        }\n        return _this;\n    }\n    EditTask.prototype.setStatePromised = function (state) {\n        var _this = this;\n        return new Promise(function (resolve) { return _super.prototype.setState.call(_this, function () { return state; }, resolve); });\n    };\n    EditTask.prototype.componentDidMount = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var err_1;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.props.searchMode) return [3 /*break*/, 8];\n                        this.setStatePromised({ isSearching: true });\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 5, 6, 8]);\n                        return [4 /*yield*/, this.searchResponse.query()];\n                    case 2:\n                        _a.sent();\n                        if (!(this.state.searchMarkedIds && this.state.searchMarkedIds.length === 0)) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.updateSearchResult(this.state.searchMarkedIds)];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [3 /*break*/, 8];\n                    case 5:\n                        err_1 = _a.sent();\n                        showError(err_1);\n                        return [3 /*break*/, 8];\n                    case 6: return [4 /*yield*/, this.setStatePromised({ isSearching: false })];\n                    case 7:\n                        _a.sent();\n                        return [7 /*endfinally*/];\n                    case 8:\n                        if (!features.picker) return [3 /*break*/, 10];\n                        return [4 /*yield*/, fetch(TemplatesFileId).then(function (resp) { return resp.json(); }).then(function (data) {\n                                _this.setStatePromised({ templates: data });\n                                if (_this.state.task && _this.state.task.templateFile) {\n                                    var templateFile = _this.state.task.templateFile;\n                                    if (templateFile.fileId) {\n                                        _this.updateTemplateView(templateFile);\n                                    }\n                                }\n                            })];\n                    case 9:\n                        _a.sent();\n                        _a.label = 10;\n                    case 10: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditTask.prototype.updateSearchMarkedIds = function (searchMarkedIds) {\n        return __awaiter(this, void 0, void 0, function () {\n            var setStatePromise;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        setStatePromise = this.setStatePromised({ task: null, searchMarkedIds: searchMarkedIds, previewTaskContent: null });\n                        if (!!this.searchResponse.result) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.searchResponse.promise];\n                    case 1:\n                        _a.sent();\n                        // Refresh searchMarkedIds now as user might have clicked around while waiting for\n                        // tasks to load...\n                        return [4 /*yield*/, setStatePromise];\n                    case 2:\n                        // Refresh searchMarkedIds now as user might have clicked around while waiting for\n                        // tasks to load...\n                        _a.sent(); // So we know state has been reflected...\n                        searchMarkedIds = this.state.searchMarkedIds;\n                        _a.label = 3;\n                    case 3: return [4 /*yield*/, this.updateSearchResult(searchMarkedIds)];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditTask.prototype.updateSearchResult = function (searchMarkedIds) {\n        return __awaiter(this, void 0, void 0, function () {\n            var allTasksForSubject, searchResult;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.searchResponse.query()];\n                    case 1:\n                        allTasksForSubject = _a.sent();\n                        searchResult = allTasksForSubject.filter(function (t) {\n                            return searchMarkedIds.every(function (id) {\n                                return t.knowledgeRequirements.some(function (kr) { return kr.id === id; }) ||\n                                    t.abilities.some(function (a) { return a.id === id; }) ||\n                                    t.centralContent.some(function (c) { return c.id === id; });\n                            });\n                        });\n                        this.setStatePromised({\n                            searchResult: searchResult\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditTask.prototype.onMarkChanged = function (id, isMarked) {\n        var searchMode = this.props.searchMode;\n        if (searchMode) {\n            var searchMarkedIds = this.state.searchMarkedIds;\n            this.updateSearchMarkedIds(isMarked ?\n                searchMarkedIds.concat(id) :\n                searchMarkedIds.filter(function (x) { return x !== id; })).catch(showError);\n            return;\n        }\n        this.updateLink(id, isMarked);\n    };\n    EditTask.prototype.updateLink = function (id, linkOrUnlink) {\n        var course = this.props.course;\n        var task = this.state.task;\n        // One of the following three will be found:\n        var ability = course.abilities.find(function (a) { return a.id === id; });\n        var knowledgeRequirement = course.knowledgeRequirements.find(function (r) { return r.id === id; });\n        var centralContent = course.centralContent.find(function (cc) { return cc.id === id; });\n        var _a = __read(ability ?\n            [\"abilities\", ability] :\n            knowledgeRequirement ?\n                [\"knowledgeRequirements\", knowledgeRequirement] :\n                centralContent ?\n                    [\"centralContent\", centralContent] :\n                    [null, null], 2), collectionProp = _a[0], item = _a[1];\n        if (!collectionProp) {\n            console.error(\"Could not find marked id \" + id);\n            return;\n        }\n        var updatedCollection = task[collectionProp].slice();\n        var currentPos = updatedCollection.findIndex(function (doc) { return doc.id === id; });\n        if (linkOrUnlink) {\n            if (currentPos < 0) {\n                updatedCollection.push(item);\n            }\n        }\n        else {\n            if (currentPos >= 0) {\n                updatedCollection.splice(currentPos, 1);\n            }\n        }\n        var updatedTask = __assign({}, task);\n        updatedTask[collectionProp] = updatedCollection;\n        // Clear migratedTexts from task.\n        // First deep clone:\n        if (task && task.migratedTexts) {\n            updatedTask.migratedTexts = __assign({}, task.migratedTexts);\n            if (task.migratedTexts[collectionProp]) {\n                updatedTask.migratedTexts[collectionProp] = __assign({}, task.migratedTexts[collectionProp]);\n                // Delete the id within the deep clone:\n                delete updatedTask.migratedTexts[collectionProp][id];\n            }\n        }\n        this.setStatePromised({\n            task: updatedTask\n        });\n    };\n    EditTask.prototype.updateTemplateView = function (templateFile) {\n        return __awaiter(this, void 0, void 0, function () {\n            var drive, tFileId_1, file, tFile;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        drive = new GoogleDrive();\n                        if (!(templateFile && templateFile.fileId.startsWith('t:'))) return [3 /*break*/, 2];\n                        tFileId_1 = templateFile.fileId.replace('t:', '');\n                        return [4 /*yield*/, drive.getFile(tFileId_1)];\n                    case 1:\n                        file = _a.sent();\n                        if (file) {\n                            file.fileId = 't:' + file.fileId;\n                            tFile = this.state.templates.filter(function (tpl) { return tpl.fileId == tFileId_1; })[0];\n                            file.name = tFile ? tFile.title : file.name;\n                            templateFile = { fileId: file.fileId, name: file.name, mimeType: file.mimeType, modifiedTime: Number(file.modiifiedTime), url: file.url, iconUrl: file.thumbnailUrl };\n                        }\n                        else {\n                            templateFile = null;\n                        }\n                        _a.label = 2;\n                    case 2:\n                        this.updateTaskOrCustomization(\"templateFile\", { $set: templateFile });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditTask.prototype.save = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, task, taskCustomization, writeAccess;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.state, task = _a.task, taskCustomization = _a.taskCustomization;\n                        writeAccess = hasWriteAccess(env.currentUser, task);\n                        if (!writeAccess) return [3 /*break*/, 5];\n                        if (task.sendToUrkund == undefined)\n                            task.sendToUrkund = true; // sendToUrkund is default so setting this here, perhaps there is a better place for this!\n                        if (!task.url && !task.content)\n                            throw new Error(L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Uppgiften m\\u00E5ste antingen ha en URL eller ett inneh\\u00E5ll\"], [\"Uppgiften m\\u00E5ste antingen ha en URL eller ett inneh\\u00E5ll\"]))));\n                        if (task.url && !validUrl.isUri(task.url))\n                            throw new Error(L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Angiven URL '\", \"' \\u00E4r ogiltig. Den ska b\\u00F6rja med http: eller https:\"], [\"Angiven URL '\", \"' \\u00E4r ogiltig. Den ska b\\u00F6rja med http: eller https:\"])), task.url));\n                        if (!(this.props.task && this.props.task.id !== task.id)) return [3 /*break*/, 2];\n                        // Replace existing task with copy\n                        return [4 /*yield*/, this.props.onReplace(this.props.task.id, task)];\n                    case 1:\n                        // Replace existing task with copy\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 2: \n                    // Update existing task\n                    return [4 /*yield*/, this.props.onSave(task, null)];\n                    case 3:\n                        // Update existing task\n                        _b.sent();\n                        _b.label = 4;\n                    case 4: return [3 /*break*/, 9];\n                    case 5:\n                        if (!this.props.searchMode) return [3 /*break*/, 7];\n                        return [4 /*yield*/, this.props.onSave(task, taskCustomization)];\n                    case 6:\n                        _b.sent();\n                        return [3 /*break*/, 9];\n                    case 7:\n                        if (this.props.course.isTemplate && task.$meta === 'add')\n                            throw new Error(L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"Du saknar beh\\u00F6righet f\\u00F6r att spara nya versioner av uppgifter i kursmallen\"], [\"Du saknar beh\\u00F6righet f\\u00F6r att spara nya versioner av uppgifter i kursmallen\"]))));\n                        return [4 /*yield*/, this.props.onSaveCustomization(taskCustomization)];\n                    case 8:\n                        _b.sent();\n                        _b.label = 9;\n                    case 9: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditTask.prototype.copyTask = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var taskCopy;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        taskCopy = __assign(__assign(__assign({}, this.state.task), (this.state.taskCustomization || {})), { id: createUUID(), acl: this.props.course.isTemplate ? [\n                                \"role:USER:R\" // (OK to keep but this check might become unnescesary if we totally remove the possibility to edit templates) Template tasks should not be possible to modify. (An ADMIN could belong to a school! Other non-admins at that school should not be able to edit it)\n                            ] : [\n                                \"role:USER:R\",\n                                \"schoolRole:\" + env.currentUser.school + \"/EMPLOYEE:S\"\n                            ], school: this.props.course.school });\n                        taskCopy.$meta = 'add';\n                        return [4 /*yield*/, this.setStatePromised({\n                                task: taskCopy,\n                                title: L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"Redigera kopierad uppgift till \\\"\", \"\\\"\"], [\"Redigera kopierad uppgift till \\\"\", \"\\\"\"])), this.props.module.name),\n                                taskCustomization: undefined\n                            })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    EditTask.prototype.getTaskProp = function (taskProp) {\n        var _a = this.state, task = _a.task, taskCustomization = _a.taskCustomization;\n        var customization = taskCustomization && taskCustomization[taskProp];\n        return customization !== undefined ?\n            customization :\n            task[taskProp];\n    };\n    EditTask.prototype.updateTaskOrCustomization = function (taskProp, updates) {\n        var _a = this.state, task = _a.task, taskCustomization = _a.taskCustomization;\n        var writeAccess = task && hasWriteAccess(env.currentUser, task);\n        if (writeAccess && (!taskCustomization || taskCustomization[taskProp] === undefined)) {\n            var newTask = __assign({}, task);\n            newTask[taskProp] = update(task[taskProp], updates);\n            this.setStatePromised({ task: newTask });\n        }\n        else {\n            var newCustomization = __assign({}, taskCustomization);\n            newCustomization[taskProp] = update(newCustomization[taskProp] || task[taskProp], updates);\n            this.setStatePromised({ taskCustomization: newCustomization });\n        }\n    };\n    EditTask.prototype.render = function () {\n        var _a = this.props, course = _a.course, module = _a.module, onCancel = _a.onCancel, onDelete = _a.onDelete, idsNotCoveredByAnyTask = _a.idsNotCoveredByAnyTask, searchMode = _a.searchMode;\n        var _b = this.state, task = _b.task, taskCustomization = _b.taskCustomization, title = _b.title, searchResult = _b.searchResult, searchMarkedIds = _b.searchMarkedIds, isSearching = _b.isSearching, templates = _b.templates;\n        var markedIds = searchMode ?\n            searchMarkedIds :\n            task.centralContent.map(function (x) { return x.id; })\n                .concat(task.abilities.map(function (x) { return x.id; }))\n                .concat(task.knowledgeRequirements.map(function (x) { return x.id; }));\n        var writeAccess = task && hasWriteAccess(env.currentUser, task);\n        var taskUrlValid = task && validUrl.isUri(task.url);\n        var features = this.features;\n        return React.createElement(React.Fragment, null,\n            React.createElement(\"h1\", null, title),\n            React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-6\" },\n                React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                    React.createElement(\"div\", { className: \"ked_boxed\" },\n                        React.createElement(\"h3\", null, searchMode ?\n                            \"Filtrera p kunskapskrav\" : writeAccess ?\n                            \"Vlj kunskapskrav\" :\n                            \"Kunskapskrav\"),\n                        searchMode ?\n                            React.createElement(\"p\", null, \"Markera de kunskapskrav som uppgiften m\\u00E5ste t\\u00E4cka.\") : writeAccess &&\n                            React.createElement(\"p\", null, \"Markera de kunskapskrav som din uppgift t\\u00E4cker.\"),\n                        React.createElement(KnowledgeMatrix, { knowledgeRequirements: course.knowledgeRequirements, markedIds: markedIds, idsToMarkNotOk: idsNotCoveredByAnyTask, markMode: searchMode || writeAccess, migratedIds: task && task.migratedTexts && task.migratedTexts.knowledgeRequirements, onMarkChanged: this.onMarkChanged.bind(this) }))),\n                React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                    React.createElement(SelectRelatedDocs, { options: course.abilities, title: writeAccess || searchMode ? \"Vlj frmgor\" : \"Frmgor\", markedIds: markedIds, markMode: writeAccess || searchMode, migratedIds: task && task.migratedTexts && task.migratedTexts.abilities, onMarkChanged: this.onMarkChanged.bind(this) })),\n                React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                    React.createElement(SelectRelatedDocs, { options: course.centralContent, title: writeAccess || searchMode ? \"Vlj centralt innehll\" : \"Centralt innehll\", markedIds: markedIds, markMode: writeAccess || searchMode, migratedIds: task && task.migratedTexts && task.migratedTexts.centralContent, onMarkChanged: this.onMarkChanged.bind(this) }))),\n            React.createElement(\"div\", { className: \"sv-layout sv-column-6\" },\n                React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                    isSearching && React.createElement(\"p\", null,\n                        React.createElement(Spinner, null),\n                        \" Laddar uppgifter...\"),\n                    searchResult ?\n                        /*\n                        *\n                        * Search Results Fragent\n                        *\n                        *\n                        */\n                        React.createElement(React.Fragment, null,\n                            React.createElement(SearchResults, { searchMarkedIds: searchMarkedIds, searchResult: searchResult, task: task, writeAccess: writeAccess, taskCustomization: taskCustomization, editTask: this }),\n                            this.state.previewTaskContent ?\n                                React.createElement(\"div\", { dangerouslySetInnerHTML: { __html: washHtml(this.state.previewTaskContent) } })\n                                : task && React.createElement(PreviewableTaskFields, { writeAccess: writeAccess, task: task, taskCustomization: taskCustomization, editTask: this }),\n                            task && React.createElement(TaskStatusFragment, { task: task })) :\n                        /*\n                        *\n                        * Edit Tasks Fragment\n                        *\n                        *\n                        */\n                        React.createElement(React.Fragment, null,\n                            task && React.createElement(BasicEditableTaskFields, { task: task, course: course, writeAccess: writeAccess, features: features, editTask: this, templates: templates }),\n                            task && React.createElement(PreviewableTaskFields, { writeAccess: writeAccess, task: task, taskCustomization: taskCustomization, editTask: this }),\n                            task && React.createElement(TaskStatusFragment, { task: task }))),\n                task && React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                    React.createElement(\"hr\", null),\n                    React.createElement(\"br\", null),\n                    React.createElement(SaveOrCancelButtons, { writeAccess: writeAccess, editTask: this }))));\n    };\n    return EditTask;\n}(React.Component));\nexport { EditTask };\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8;\n","export * from './edit-task';\n","import { __assign } from \"tslib\";\nimport * as React from 'react';\nimport { EditableResourceList } from '../../sub-components/editable-resource-list';\nexport function PreviewableTaskFields(_a) {\n    var writeAccess = _a.writeAccess, task = _a.task, taskCustomization = _a.taskCustomization, editTask = _a.editTask;\n    return React.createElement(React.Fragment, null,\n        React.createElement(React.Fragment, null,\n            React.createElement(\"h3\", null, \"Uppgiftens l\\u00E4randem\\u00E5l\"),\n            React.createElement(\"div\", null,\n                React.createElement(\"textarea\", { className: \"inputTextBox learning-goal-box\", disabled: !writeAccess, value: task.learningGoal, onChange: function (ev) {\n                        var newTask = __assign({}, task);\n                        newTask.learningGoal = ev.target.value;\n                        editTask.setStatePromised({ task: newTask });\n                    } }))),\n        React.createElement(\"br\", null),\n        React.createElement(React.Fragment, null,\n            taskCustomization && taskCustomization.resources ?\n                React.createElement(\"h3\", null, \"Resurser f\\u00F6r uppgiften (modifierad f\\u00F6r denna kursinstans)\") :\n                React.createElement(\"h3\", null, \"Resurser kopplade till uppgiften\"),\n            React.createElement(EditableResourceList, { resources: (taskCustomization && taskCustomization.resources) || task.resources, host: editTask.props.host, onUpdate: function (resourceUpdates) {\n                    editTask.updateTaskOrCustomization(\"resources\", resourceUpdates);\n                } })));\n}\n","import * as React from 'react';\nimport { showError } from '../../../../utils/utils';\nexport function SaveOrCancelButtons(_a) {\n    var writeAccess = _a.writeAccess, editTask = _a.editTask;\n    return React.createElement(React.Fragment, null,\n        !!editTask.props.onDelete && React.createElement(\"div\", { className: \"btn btn-warning btn-large pull-right\", onClick: function () { return editTask.props.onDelete(); } }, \"Ta bort fr\\u00E5n kursmodul\"),\n        React.createElement(\"div\", { className: \"pull-right\" }, \"\\u00A0\"),\n        React.createElement(\"div\", { className: \"btn btn-warning btn-large pull-right\", onClick: function () { return editTask.props.onCancel(); } }, \"Avbryt\"),\n        React.createElement(\"div\", { className: \"btn btn-large\", onClick: function () { return editTask.save().catch(showError); } }, \"Spara\"),\n        !writeAccess && React.createElement(\"div\", { className: \"btn btn-large\", onClick: function () { return editTask.copyTask().catch(showError); } }, \"Skapa kopia av den h\\u00E4r uppgiften\"));\n}\n","import * as React from \"react\";\nimport { findDOMNode } from 'react-dom';\nimport { shortPersonNameFormat, shortDateFormat } from \"../../utils\";\nexport function SearchResults(_a) {\n    var searchMarkedIds = _a.searchMarkedIds, searchResult = _a.searchResult, task = _a.task, editTask = _a.editTask, writeAccess = _a.writeAccess, taskCustomization = _a.taskCustomization;\n    return React.createElement(\"div\", { className: \"task-search-result\" + (!editTask.state.task && !editTask.state.previewTaskContent ? \" fixed\" : \"\") },\n        searchMarkedIds.length === 0 ?\n            React.createElement(\"h2\", null, \"Samtliga uppgifter f\\u00F6r kursen\") :\n            React.createElement(\"h2\", null, \"Uppgifter som t\\u00E4cker valda filter\"),\n        React.createElement(\"table\", null,\n            React.createElement(\"tbody\", null, searchResult\n                .filter(task ?\n                function (foundTask) { return foundTask.id === task.id; } :\n                function () { return true; })\n                .map(function (foundTask) { return React.createElement(React.Fragment, { key: foundTask.id },\n                React.createElement(\"tr\", null,\n                    React.createElement(\"td\", null,\n                        React.createElement(\"div\", { tabIndex: 1, className: \"checkBox\" + (task && task.id === foundTask.id ? \" checked\" : \"\"), onClick: function () { return toggleChooseTask(foundTask); } })),\n                    React.createElement(\"td\", null, foundTask.content ?\n                        React.createElement(\"a\", { href: \"#\", onClick: function (ev) {\n                                toggleChooseTask(foundTask);\n                                ev.preventDefault();\n                                ev.stopPropagation();\n                            } }, foundTask.name) :\n                        React.createElement(\"a\", { href: foundTask.url, target: \"_blank\" }, foundTask.name)),\n                    React.createElement(\"td\", null, shortPersonNameFormat(foundTask.modifiedBy.name)),\n                    React.createElement(\"td\", null, foundTask.school || \"Standard\"),\n                    React.createElement(\"td\", null, shortDateFormat(foundTask.modifiedDate)))); }))),\n        React.createElement(\"br\", null),\n        React.createElement(\"hr\", null));\n    function toggleChooseTask(foundTask) {\n        if (task && task.id === foundTask.id) {\n            editTask.updateSearchMarkedIds(searchMarkedIds);\n        }\n        else {\n            findDOMNode(editTask).parentElement.scrollTop = 0;\n            editTask.setStatePromised({ task: foundTask, previewTaskContent: null });\n        }\n    }\n}\n","import { __assign } from \"tslib\";\nimport * as React from 'react';\nimport { Wysiwyg } from '../../../utility-components/wysiwyg';\nimport actions_swedish from '../../../utility-components/wysiwyg/actions-sv';\nexport function TaskContentFragment(_a) {\n    var writeAccess = _a.writeAccess, task = _a.task, editTask = _a.editTask;\n    return React.createElement(Wysiwyg, { actions: [\n            \"bold\",\n            \"italic\",\n            \"underline\",\n            \"strikethrough\",\n            \"heading2\",\n            \"heading3\",\n            \"olist\",\n            \"ulist\",\n            \"outdent\",\n            \"indent\",\n            \"line\",\n            \"link\",\n            \"image\"\n        ], defaultActions: actions_swedish, readOnly: !writeAccess, html: task.content, onChange: function (html) {\n            var newTask = __assign({}, task);\n            newTask.content = html;\n            editTask.setState({ task: newTask });\n        } });\n}\n","import * as React from 'react';\nimport { dtFormat } from '../../utils';\nexport function TaskStatusFragment(_a) {\n    var task = _a.task;\n    return React.createElement(React.Fragment, null,\n        React.createElement(\"h3\", null, \"Uppgiftens status\"),\n        task.createdBy && task.createdDate && React.createElement(\"p\", null,\n            \"Uppgiften skapades \",\n            dtFormat(task.createdDate),\n            \" av \",\n            React.createElement(\"strong\", null, task.createdBy.name),\n            \".\"),\n        task.modifiedBy && task.modifiedDate && React.createElement(\"p\", null,\n            \"Uppgiften redigerades senast \",\n            dtFormat(task.modifiedDate),\n            \" av \",\n            React.createElement(\"strong\", null, task.modifiedBy.name),\n            \".\"));\n}\n","import { __extends, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport validUrl from 'valid-url';\nvar EditWorkflowLink = /** @class */ (function (_super) {\n    __extends(EditWorkflowLink, _super);\n    function EditWorkflowLink(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = { url: _this.props.url || '' };\n        return _this;\n    }\n    EditWorkflowLink.prototype.save = function () {\n        var url = this.state.url;\n        if (!validUrl.isUri(url))\n            throw new Error(L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Angiven URL '\", \"' \\u00E4r ogiltig. Ska b\\u00F6rja med http: eller https:\"], [\"Angiven URL '\", \"' \\u00E4r ogiltig. Ska b\\u00F6rja med http: eller https:\"])), url));\n        this.props.onSave(url);\n    };\n    EditWorkflowLink.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, onSave = _a.onSave, onDelete = _a.onDelete;\n        var state = this.state;\n        var isValidUrl = validUrl.isUri(this.state.url);\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                React.createElement(\"h2\", null, \"Koppla en arbetsg\\u00E5ng till kursen\"),\n                React.createElement(\"p\", null, \"Det g\\u00E5r bara att l\\u00E4gga in en arbetsg\\u00E5ng per kurs.\"),\n                React.createElement(\"br\", null),\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" }, \"L\\u00E4nk:\"),\n                    React.createElement(\"div\", { className: \"horizontalItem top \" },\n                        React.createElement(\"input\", { type: \"text\", tabIndex: 1, size: 50, value: state.url, onChange: function (ev) { return _this.setState({ url: ev.target.value }); } })),\n                    React.createElement(\"div\", { className: \"horizontalItem top spaced\" })),\n                React.createElement(\"br\", null)),\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\", id: \"svid12_492422d515badf36646e4ff1\" },\n                onDelete && React.createElement(\"div\", { tabIndex: 2, className: \"btn btn-warning btn-large pull-right\", onClick: function () { return onDelete(); } }, \"Ta bort arbetsg\\u00E5ng\"),\n                React.createElement(\"a\", { tabIndex: 1, className: \"btn btn-large\" + (isValidUrl ? \"\" : \" btn-inactive\"), onClick: isValidUrl && (function () { return onSave(state.url); }) }, \"Spara\")));\n    };\n    return EditWorkflowLink;\n}(React.Component));\nexport { EditWorkflowLink };\nvar templateObject_1;\n","import { __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { EditSchool } from './edit-school';\nimport { L } from '../../../utils/utils';\nexport var NewSchool = function (props) { return React.createElement(EditSchool, { title: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"L\\u00E4gg till skola\"], [\"L\\u00E4gg till skola\"]))), type: props.type, feedbackUrl: props.feedbackUrl }); };\nvar templateObject_1;\n","import * as React from 'react';\nimport { EditResource } from '../modal-pages/edit-resource';\nimport { updateModificationAndCreationStamps } from '../utils';\nimport env from '../../../globals/KED.env';\nimport { DriveButton } from '../../../apis/buttons';\nimport { GooglePicker } from '../../../apis/google-picker';\nimport { features } from '../../../features';\nimport { DraggableList } from '../../utility-components/draggable-list';\nimport { reorder } from '../../course-builder-ks/logic/change-sort-order';\nimport { compareProps } from '../../../utils/utils';\nexport var EditableResourceList = function (_a) {\n    var resources = _a.resources, onUpdate = _a.onUpdate, host = _a.host;\n    var sortedDatasource = resources.sort(compareProps(\"order\"));\n    function getEditLink(resource) {\n        var idx = sortedDatasource.indexOf(resource);\n        return React.createElement(\"a\", { className: \"editItem\", onClick: function () { return host.openDialog({\n                Component: EditResource,\n                props: {\n                    title: \"Redigera resurs\",\n                    resource: resource,\n                    onSave: function (editedResource) {\n                        var updatedResource = updateModificationAndCreationStamps(editedResource, env.currentUser);\n                        onUpdate({ $splice: [[idx, 1, updatedResource]] });\n                        host.closeDialog();\n                    },\n                    onDelete: function () {\n                        onUpdate({ $splice: [[idx, 1]] });\n                        host.closeDialog();\n                    }\n                }\n            }); } });\n    }\n    function onResourceSort(source, target, placement) {\n        var orderedDocuments = sortedDatasource.map(function (resource, index) { return { id: index.toString(), order: resource.order || Date.now() }; });\n        var sourceIndex = sortedDatasource.indexOf(source).toString();\n        var newOrder = reorder(orderedDocuments, sourceIndex, sortedDatasource.indexOf(target).toString(), placement);\n        source.order = newOrder;\n        var updatedResource = updateModificationAndCreationStamps(source, env.currentUser);\n        onUpdate({ $splice: [[sourceIndex, 1, updatedResource]] });\n    }\n    var showGooglePicker = features.picker;\n    return React.createElement(\"div\", null,\n        DraggableList({\n            objectList: sortedDatasource,\n            renderEditLink: getEditLink,\n            renderLink: (function (resource) { return React.createElement(\"a\", { href: resource.url, target: \"_blank\" }, resource.name); }),\n            onSort: onResourceSort\n        }),\n        React.createElement(\"div\", { className: \"horizontal-align spaced\" },\n            React.createElement(\"div\", { className: \"horizontaItem top\" },\n                React.createElement(\"a\", { className: \"btn\", onClick: function () { return host.openDialog({\n                        Component: EditResource,\n                        props: {\n                            title: \"Lgg till resurs\",\n                            onSave: function (newResource) {\n                                newResource.order = Date.now();\n                                var updatedResource = updateModificationAndCreationStamps(newResource, env.currentUser);\n                                onUpdate({ $push: [updatedResource] });\n                                host.closeDialog();\n                            }\n                        }\n                    }); } },\n                    React.createElement(\"i\", { className: \"fas fa-paperclip\", \"aria-hidden\": true }),\n                    \" L\\u00E4gg till resurs\")),\n            showGooglePicker && React.createElement(\"div\", { className: \"horizontaItem top\" },\n                React.createElement(DriveButton, { label: \"L\\u00E4gg till fr\\u00E5n Drive\", action: function () {\n                        var picker = new GooglePicker({ upload: true, multiple: true });\n                        picker.show().then(function (files) {\n                            files.forEach(function (file) {\n                                var newResource = { url: file.url, name: file.name };\n                                var updatedResource = updateModificationAndCreationStamps(newResource, env.currentUser);\n                                onUpdate({ $push: [updatedResource] });\n                            });\n                        });\n                    } }))));\n};\n","import { __extends } from \"tslib\";\nimport * as React from 'react';\nimport { EditTask } from '../modal-pages/edit-task';\nimport { updateModificationAndCreationStamps } from \"../utils\";\nimport env from '../../../globals/KED.env';\nimport { hasWriteAccess } from \"../../../access-control\";\nimport { SortableTaskList } from '../../utility-components/sortable-task-list';\nimport { getOrderedDocs } from '../../course-builder-ks/logic/ordered-requirements';\nvar EditableTaskList = /** @class */ (function (_super) {\n    __extends(EditableTaskList, _super);\n    function EditableTaskList(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {};\n        return _this;\n    }\n    EditableTaskList.prototype.openTaskDialog = function (task) {\n        var _a = this.props, taskCustomizations = _a.taskCustomizations, course = _a.course, host = _a.host, module = _a.module, taskIds = _a.taskIds, onTaskAdded = _a.onTaskAdded, onTaskUpdated = _a.onTaskUpdated, onTaskCustomizationUpdated = _a.onTaskCustomizationUpdated, onTaskDeleted = _a.onTaskDeleted, idsNotCoveredByAnyTask = _a.idsNotCoveredByAnyTask, onTaskReplaced = _a.onTaskReplaced;\n        host.openDialog({\n            Component: EditTask,\n            props: {\n                task: task,\n                taskCustomization: taskCustomizations && taskCustomizations[task.id],\n                module: module,\n                course: course,\n                host: host,\n                idsNotCoveredByAnyTask: idsNotCoveredByAnyTask,\n                onSave: function (task) {\n                    var updatedTask = updateModificationAndCreationStamps(task, env.currentUser);\n                    onTaskUpdated(updatedTask);\n                    host.closeDialog();\n                },\n                onSaveCustomization: function (customization) {\n                    onTaskCustomizationUpdated(task.id, customization);\n                    host.closeDialog();\n                },\n                onDelete: function () {\n                    onTaskDeleted(task.id);\n                    host.closeDialog();\n                },\n                onReplace: function (taskId, newTask) {\n                    onTaskReplaced(taskId, newTask);\n                    host.closeDialog();\n                },\n                onCancel: function () { return host.closeDialog(); }\n            }\n        });\n    };\n    EditableTaskList.prototype.render = function () {\n        var _this = this;\n        var props = this.props;\n        var tasks = getOrderedDocs(props.course.tasks, props.taskIds, { appendLeftovers: false });\n        return React.createElement(\"div\", null,\n            React.createElement(SortableTaskList, { taskMetas: tasks.map(function (task) { return ({ task: task, isTaskOwner: hasWriteAccess(env.currentUser, task) }); }), renderEditLink: function (_a) {\n                    var task = _a.task, isTaskOwner = _a.isTaskOwner;\n                    return React.createElement(\"div\", { className: isTaskOwner ?\n                            \"editItem\" :\n                            \"viewItem\", onClick: function () { return _this.openTaskDialog(task); } });\n                }, renderLink: function (_a) {\n                    var task = _a.task;\n                    return task.content ?\n                        // Rather than linking to url, show the task's content (by opening\n                        // the task dialog)\n                        React.createElement(\"a\", { href: \"#\", onClick: function (ev) {\n                                ev.preventDefault();\n                                _this.openTaskDialog(task);\n                            } }, task.name) :\n                        React.createElement(\"a\", { href: task.url, target: \"_blank\" }, task.name);\n                }, onSort: function (source, target, placement) {\n                    _this.props.onTasksReordered(source, target, placement);\n                } }),\n            React.createElement(\"br\", null),\n            React.createElement(\"a\", { className: \"btn\", onClick: function () {\n                    var _a = _this.props, course = _a.course, host = _a.host, idsNotCoveredByAnyTask = _a.idsNotCoveredByAnyTask, module = _a.module, onTaskAdded = _a.onTaskAdded, onTaskCustomizationUpdated = _a.onTaskCustomizationUpdated;\n                    props.host.openDialog({\n                        Component: EditTask,\n                        props: {\n                            searchMode: true,\n                            module: module,\n                            course: course,\n                            host: host,\n                            idsNotCoveredByAnyTask: idsNotCoveredByAnyTask,\n                            onSave: function (choosenTask, taskCustomization) {\n                                choosenTask = updateModificationAndCreationStamps(choosenTask, env.currentUser);\n                                onTaskAdded(choosenTask, taskCustomization);\n                                host.closeDialog();\n                            },\n                            onCancel: function () { return host.closeDialog(); }\n                        }\n                    });\n                } },\n                React.createElement(\"i\", { className: \"fas fa-search\", \"aria-hidden\": true }),\n                \" S\\u00F6k uppgift\"),\n            \"\\u00A0\",\n            React.createElement(\"a\", { onClick: function () {\n                    var _a = _this.props, course = _a.course, host = _a.host, module = _a.module, taskIds = _a.taskIds, onTaskAdded = _a.onTaskAdded, onTaskUpdated = _a.onTaskUpdated, onTaskDeleted = _a.onTaskDeleted, idsNotCoveredByAnyTask = _a.idsNotCoveredByAnyTask;\n                    host.openDialog({\n                        Component: EditTask,\n                        props: {\n                            module: module,\n                            course: course,\n                            host: host,\n                            idsNotCoveredByAnyTask: idsNotCoveredByAnyTask,\n                            onSave: function (newTask) {\n                                newTask = updateModificationAndCreationStamps(newTask, env.currentUser);\n                                onTaskAdded(newTask);\n                                host.closeDialog();\n                            },\n                            onCancel: function () { return host.closeDialog(); }\n                        }\n                    });\n                }, className: \"btn\" },\n                React.createElement(\"i\", { className: \"fas fa-plus\", \"aria-hidden\": true }),\n                \" L\\u00E4gg till egen uppgift\"));\n    };\n    return EditableTaskList;\n}(React.Component));\nexport { EditableTaskList };\n","import { __assign, __makeTemplateObject, __read, __spread } from \"tslib\";\nimport React, { useRef, useState, Suspense } from 'react';\nimport { RemoveItem } from \"./remove-item\";\nimport { L } from '../../../utils/utils';\nimport { SelectTeacher } from './select-teacher';\nimport { TimeoutSpinner } from './spinner';\nimport { features } from '../../../features';\nexport function EditableTeacherList(_a) {\n    var school = _a.school, teachers = _a.teachers, onUpdate = _a.onUpdate;\n    var nameElem = useRef();\n    var _b = __read(useState(false), 2), selectingTeacher = _b[0], setSelectingTeacher = _b[1];\n    var displayTeacherRights = features.teacherRights;\n    return React.createElement(\"div\", { className: \"teachers-list\" },\n        React.createElement(\"h3\", null, \"Ansvariga l\\u00E4rare\"),\n        React.createElement(\"table\", { style: { width: \"100%\" } },\n            React.createElement(\"thead\", null, teachers.length > 0 && React.createElement(\"tr\", null,\n                React.createElement(\"th\", { style: { width: \"15%\" } }, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Namn\"], [\"Namn\"])))),\n                React.createElement(\"th\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"E-postadress\"], [\"E-postadress\"])))),\n                displayTeacherRights && React.createElement(\"th\", { style: { width: \"24px\" } }, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Beh\\u00F6righet\"], [\"Beh\\u00F6righet\"])))),\n                React.createElement(\"th\", { style: { width: \"24px\" } }))),\n            React.createElement(\"tbody\", null, teachers.map(function (teacher, idx) {\n                return React.createElement(\"tr\", { key: idx },\n                    React.createElement(\"td\", null,\n                        React.createElement(\"input\", { type: \"text\", ref: nameElem, value: teacher.name, autoFocus: !teacher.name && idx > 0, onChange: function (ev) {\n                                if (ev.target.value || teacher.email) {\n                                    // Update row\n                                    var clone = __spread(teachers);\n                                    clone[idx] = __assign(__assign({}, teacher), { name: ev.target.value });\n                                    onUpdate(clone);\n                                }\n                                else {\n                                    // Remove row\n                                    onUpdate(__spread(teachers.slice(0, idx), teachers.slice(idx + 1)));\n                                }\n                            } })),\n                    React.createElement(\"td\", null,\n                        React.createElement(\"input\", { type: \"text\", style: { width: \"100%\" }, value: teacher.email || teacher.url, onKeyDown: function (ev) {\n                                if (ev.which === 9 &&\n                                    !ev.shiftKey &&\n                                    idx === teachers.length - 1 &&\n                                    (teachers.length < 1 || !!teachers[teachers.length - 1].name)) {\n                                    setSelectingTeacher(true);\n                                    ev.preventDefault();\n                                }\n                            }, onChange: function (ev) {\n                                var editedTeacher = __assign(__assign({}, teacher), { url: ev.target.value, email: ev.target.value });\n                                if (ev.target.value || teacher.name) {\n                                    // Update row\n                                    var clone = __spread(teachers);\n                                    clone[idx] = editedTeacher;\n                                    onUpdate(clone);\n                                }\n                                else {\n                                    // Remove row\n                                    onUpdate(__spread(teachers.slice(0, idx), teachers.slice(idx + 1)));\n                                }\n                            } })),\n                    displayTeacherRights && React.createElement(\"td\", null,\n                        React.createElement(\"select\", { disabled: !(teacher.email || teacher.url), value: teacher.access || 'edit', onChange: function (ev) {\n                                var clone = __spread(teachers);\n                                clone[idx] = __assign(__assign({}, teacher), { access: ev.target.value });\n                                onUpdate(clone);\n                            } },\n                            React.createElement(\"option\", { value: \"read\" }, L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"L\\u00E4sa\"], [\"L\\u00E4sa\"])))),\n                            React.createElement(\"option\", { value: \"edit\" }, L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Redigera\"], [\"Redigera\"])))),\n                            React.createElement(\"option\", { value: \"full\" }, L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Full\"], [\"Full\"])))))),\n                    React.createElement(\"td\", null,\n                        React.createElement(RemoveItem, { onClick: function () {\n                                onUpdate(__spread(teachers.slice(0, idx), teachers.slice(idx + 1)));\n                            } })));\n            }))),\n        React.createElement(\"br\", null),\n        selectingTeacher ?\n            React.createElement(Suspense, { fallback: React.createElement(TimeoutSpinner, null) },\n                React.createElement(SelectTeacher, { school: school, selectedTeachers: teachers, onBlur: function () { return setSelectingTeacher(false); }, onSelect: function (_a) {\n                        var name = _a.name, email = _a.email;\n                        var newTeacher = {\n                            name: name,\n                            email: email,\n                            url: email,\n                            access: 'edit'\n                        };\n                        var clone = __spread(teachers);\n                        clone.push(newTeacher);\n                        onUpdate(clone);\n                        setSelectingTeacher(false);\n                    } })) :\n            React.createElement(\"a\", { className: \"btn\", onClick: function () {\n                    setSelectingTeacher(true);\n                } },\n                React.createElement(\"i\", { className: \"fas fa-user-plus\", \"aria-hidden\": true }), L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\" L\\u00E4gg till ansvarig l\\u00E4rare\"], [\" L\\u00E4gg till ansvarig l\\u00E4rare\"])))));\n}\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7;\n","import { __extends } from \"tslib\";\nimport * as React from 'react';\nimport { EditWorkflowLink } from '../modal-pages/edit-workflow-link';\nvar EditableWorkFlowLink = /** @class */ (function (_super) {\n    __extends(EditableWorkFlowLink, _super);\n    function EditableWorkFlowLink(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {};\n        return _this;\n    }\n    EditableWorkFlowLink.prototype.render = function () {\n        var _a = this.props, host = _a.host, onUpdate = _a.onUpdate, url = _a.url;\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"taskContainer\" }, url &&\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"a\", { className: \"editItem\", onClick: function () { return host.openDialog({\n                                Component: EditWorkflowLink,\n                                props: {\n                                    url: url,\n                                    onSave: function (newUrl) {\n                                        onUpdate({ $set: newUrl });\n                                        host.closeDialog();\n                                    },\n                                    onDelete: function () {\n                                        onUpdate({ $set: undefined });\n                                        host.closeDialog();\n                                    }\n                                }\n                            }); } })),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"a\", { href: url, target: \"_blank\" }, \"Nuvarande arbetsg\\u00E5ng\")))),\n            !url && React.createElement(\"a\", { className: \"btn\", onClick: function () { return host.openDialog({\n                    Component: EditWorkflowLink,\n                    props: {\n                        onSave: function (newUrl) {\n                            onUpdate({ $set: newUrl });\n                            host.closeDialog();\n                        }\n                    }\n                }); } },\n                React.createElement(\"i\", { className: \"fas fa-paperclip\", \"aria-hidden\": true }),\n                \" Koppla en arbetsg\\u00E5ng till kursen\"));\n    };\n    return EditableWorkFlowLink;\n}(React.Component));\nexport { EditableWorkFlowLink };\n","import { __extends } from \"tslib\";\nimport * as React from 'react';\nimport { showError, compareProp } from '../../../utils/utils';\nimport { mySchoolCoursesRepo } from \"../../../repos/school-courses\";\nimport { Spinner } from \"./spinner\";\nimport { Link } from 'react-router-dom';\nimport { shortDateFormat } from \"../utils\";\nimport env from '../../../globals/KED.env';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\nvar SchoolCourses = /** @class */ (function (_super) {\n    __extends(SchoolCourses, _super);\n    function SchoolCourses(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            schoolCourses: null\n        };\n        _this.onSchoolCoursesUpdated = _this.onSchoolCoursesUpdated.bind(_this);\n        return _this;\n    }\n    SchoolCourses.prototype.componentDidMount = function () {\n        mySchoolCoursesRepo.subscribe(this.onSchoolCoursesUpdated).catch(showError);\n    };\n    SchoolCourses.prototype.componentWillUnmount = function () {\n        mySchoolCoursesRepo.unsubscribe(this.onSchoolCoursesUpdated);\n    };\n    SchoolCourses.prototype.onSchoolCoursesUpdated = function (schoolCourses) {\n        var compareName = compareProp(\"name\");\n        var compareCreatedDate = compareProp(\"createdDate\");\n        schoolCourses.sort(function (a, b) { return compareName(a, b) || compareCreatedDate(a, b); });\n        this.setState({ schoolCourses: schoolCourses });\n    };\n    SchoolCourses.prototype.outputCourses = function (courses, header, open) {\n        return (React.createElement(OpenCloseBox, { title: React.createElement(\"p\", null, header), headerOpen: open, contentClassName: \"odd-even\" }, courses.map(function (course) {\n            return React.createElement(\"div\", { className: \"schoolCourse\", key: course.id },\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\n                        React.createElement(Link, { to: \"/courses/\" + course.id + \"/edit\", className: \"editItem\" })),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(Link, { to: \"/courses/\" + course.id + \"/edit\" }, course.name)),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" }, course.active && React.createElement(\"div\", { className: \"pill active\" }, \"Aktiv\")),\n                    course.active && !course.publishable && React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"div\", { className: \"pill incomplete\" }, \"Inkomplett\"))),\n                React.createElement(\"div\", { className: \"horizontalItem top\" },\n                    React.createElement(\"p\", null, course.description)),\n                React.createElement(\"div\", { className: \"horizontalItem top\" }, course.modifiedBy ?\n                    React.createElement(\"p\", { className: \"small\" },\n                        \"Redigerad av \",\n                        course.modifiedBy.name,\n                        \" / \",\n                        shortDateFormat(course.modifiedDate)) :\n                    React.createElement(\"p\", { className: \"small\", style: { fontStyle: 'italic' } }, \" \")));\n        })));\n    };\n    SchoolCourses.prototype.render = function () {\n        var schoolCourses = this.state.schoolCourses;\n        var myCourses = [];\n        var othersCourses = [];\n        if (schoolCourses) {\n            var me_1 = env.currentUser.mail;\n            schoolCourses.forEach(function (course) {\n                if (course.activatedBy && course.activatedBy.url == me_1) {\n                    myCourses.push(course);\n                }\n                else if (course.responsibleTeachers.filter(function (t) { return t.url == me_1; }).length > 0) {\n                    myCourses.push(course);\n                }\n                else {\n                    othersCourses.push(course);\n                }\n            });\n        }\n        return React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n            React.createElement(\"div\", { className: \"ked_boxed\" },\n                React.createElement(\"h3\", null, \"Skolans kurser\"),\n                React.createElement(\"div\", { className: \"taskContainer odd-even\" }, !schoolCourses ?\n                    React.createElement(\"p\", null,\n                        React.createElement(Spinner, null),\n                        \" Laddar skolans kurser\") :\n                    React.createElement(React.Fragment, null,\n                        this.outputCourses(myCourses, 'Mina kurser', true),\n                        this.outputCourses(othersCourses, 'Andra kurser', false))),\n                location.hash !== \"#/courses/new\" && React.createElement(Link, { className: \"btn\", to: \"/courses/new\", onClick: function () { return window.scroll(0, 0); } }, \"Skapa ny kurs\")));\n    };\n    return SchoolCourses;\n}(React.Component));\nexport { SchoolCourses };\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { L } from '../../../utils/utils';\nimport Select from 'react-select';\nimport { env } from '../../../globals/KED.env';\nimport { db } from '../../../globals/db';\nimport { mockTuitionGroups } from '../../../apis/mock/mock-classroom-data';\nimport { withObserve } from '../../utility-components/with-observe';\nexport var SelectStudyGroups = withObserve(function (_a) {\n    var school = _a.school, courseCode = _a.courseCode, selectedStudyGroups = _a.selectedStudyGroups, placeholder = _a.placeholder, onUpdate = _a.onUpdate;\n    // Mock-data for KED\n    var emptyOrMock = school === 'KED' && mockTuitionGroups[courseCode] ? mockTuitionGroups[courseCode] : [];\n    // Map given {school} to its name in EDS:\n    var edsSchoolNameGymn = db.schools\n        .cacheOptimized() // Will add cacheBust to the query (making server add cache header)\n        .name(school).single() // Get the single school instance with name={school}\n        .read().edsSchoolNameGymn; // Read it the suspense-way (throwing Promise if not there...)\n    // List studygroups for that school and given course:\n    var studyGroups = edsSchoolNameGymn ? env.edsClient.suspense.getSchoolTuitionGroups({\n        schoolName: edsSchoolNameGymn,\n        courseCode: courseCode\n    }) : emptyOrMock;\n    // Convert to option objects as react-select wants them:\n    var options = studyGroups.map(function (sg) { return ({\n        label: sg.tuitionGroupName,\n        value: sg.tuitionGroupName\n    }); });\n    // Display the mutliselect:\n    return React.createElement(Select, { isMulti: true, options: options, value: selectedStudyGroups.map(function (group) { return ({ label: group, value: group }); }), placeholder: placeholder, noOptionsMessage: function () { return L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Kunde inte hitta undervisningsgrupper f\\u00F6r denna kurs\"], [\"Kunde inte hitta undervisningsgrupper f\\u00F6r denna kurs\"]))); }, onChange: function (options) {\n            onUpdate(options.map(function (_a) {\n                var value = _a.value;\n                return value;\n            }));\n        } });\n});\nvar templateObject_1;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { db } from '../../../globals/db';\nimport { env } from '../../../globals/KED.env';\nimport { arrayToLookup, compareProps, L } from '../../../utils/utils';\nimport { cfg } from '../../../globals/KED.cfg';\nimport Select from 'react-select';\nimport { isAdminOrTeacherAtSchool } from '../../../access-control';\nimport { mockTeachers } from '../../../apis/mock/mock-classroom-data';\nimport { withObserve } from '../../utility-components/with-observe';\nexport var SelectTeacher = withObserve(function (_a) {\n    //\n    // Load the teacher list asynchronically (using suspense)\n    //\n    var school = _a.school, selectedTeachers = _a.selectedTeachers, onSelect = _a.onSelect, onBlur = _a.onBlur;\n    // Mock-data for KED\n    var emptyOrMock = school === 'KED' ? mockTeachers : [];\n    // Suspense-read from KedBackend:\n    var edsSchoolNameGymn = db.schools.cacheOptimized().name(school).single().read().edsSchoolNameGymn;\n    // Suspense-read from EDS:\n    var edsTeachers = edsSchoolNameGymn ?\n        env.edsClient.suspense.getSchoolTeachers({ schoolName: edsSchoolNameGymn }) :\n        emptyOrMock;\n    var teacherList = edsTeachers.map(function (_a) {\n        var teacherFirstName = _a.teacherFirstName, teacherLastName = _a.teacherLastName, teacherEmailAddress = _a.teacherEmailAddress;\n        return ({\n            label: teacherFirstName + \" \" + teacherLastName,\n            value: teacherEmailAddress\n        });\n    });\n    // Add current user to the list (in case current user is ADMIN or EMPLOYEE at the school)\n    var addCurrentUser = isAdminOrTeacherAtSchool(env.currentUser, school);\n    if (addCurrentUser && !teacherList.some(function (t) { return t.value === env.currentUser.mail; })) {\n        teacherList.push({ label: env.currentUser.displayName, value: env.currentUser.mail });\n    }\n    // Filter out already selected teachers:\n    var teacherSet = arrayToLookup(selectedTeachers, function (t) { return t.email; });\n    teacherList = teacherList\n        .filter(function (t) { return !teacherSet[t.value]; }) // Remove already added ones\n        .sort(compareProps([\"label\"], cfg.KED_LOCALE)); // Sort by name\n    // Show the select:\n    return React.createElement(Select, { isMulti: false, options: teacherList, defaultMenuIsOpen: true, autoFocus: true, onBlur: function () { return onBlur(); }, placeholder: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"V\\u00E4lj bland skolans l\\u00E4rare...\"], [\"V\\u00E4lj bland skolans l\\u00E4rare...\"]))), noOptionsMessage: function () { return L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Det finns inga fler l\\u00E4rare att v\\u00E4lja fr\\u00E5n\"], [\"Det finns inga fler l\\u00E4rare att v\\u00E4lja fr\\u00E5n\"]))); }, onChange: function (option) {\n            var _a = option, label = _a.label, value = _a.value;\n            onSelect({ name: label, email: value });\n        } });\n});\nvar templateObject_1, templateObject_2;\n","import { __extends } from \"tslib\";\nimport * as React from 'react';\nimport { getTasksPerId } from \"../courses/business-logic\";\nimport { futureAbilities } from \"../../../contracts/ked-models\";\nimport { OpenCloseBox } from \"../../utility-components/open-close-box\";\nvar WeightedItemsTable = /** @class */ (function (_super) {\n    __extends(WeightedItemsTable, _super);\n    function WeightedItemsTable(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            isOpen: false\n        };\n        return _this;\n    }\n    WeightedItemsTable.prototype.render = function () {\n        var course = this.props.course;\n        var isOpen = this.state.isOpen;\n        var rows = [];\n        var tasksPerId = getTasksPerId(course);\n        rows.push(React.createElement(\"tr\", { key: \"centralContent\", className: \"covered-item-label\" },\n            React.createElement(\"td\", { colSpan: 2 }, \"Centralt inneh\\u00E5ll\")));\n        course.centralContent.forEach(function (cc, idx) { return rows.push(React.createElement(\"tr\", { key: cc.id, className: idx % 2 ? \"tableOdd\" : \"\" },\n            React.createElement(\"td\", null,\n                React.createElement(\"p\", { className: \"criteriaText\", dangerouslySetInnerHTML: { __html: cc.name } })),\n            React.createElement(\"td\", null,\n                React.createElement(\"p\", null, (tasksPerId[cc.id] || []).length)))); });\n        rows.push(React.createElement(\"tr\", { key: \"abilities\", className: \"covered-item-label\" },\n            React.createElement(\"td\", { colSpan: 2 }, \"F\\u00F6rm\\u00E5gor\")));\n        course.abilities.forEach(function (ability, idx) { return rows.push(React.createElement(\"tr\", { key: ability.id, className: idx % 2 ? \"tableOdd\" : \"\" },\n            React.createElement(\"td\", null,\n                React.createElement(\"p\", { className: \"abilityText\", dangerouslySetInnerHTML: { __html: ability.name } })),\n            React.createElement(\"td\", null,\n                React.createElement(\"p\", null, (tasksPerId[ability.id] || []).length)))); });\n        rows.push(React.createElement(\"tr\", { key: \"futureAbilities\", className: \"covered-item-label\" },\n            React.createElement(\"td\", { colSpan: 2 }, \"Framtidsf\\u00F6rm\\u00E5gor\")));\n        futureAbilities.forEach(function (futureAbilityText, idx) { return rows.push(React.createElement(\"tr\", { key: futureAbilityText, className: idx % 2 ? \"tableOdd\" : \"\" },\n            React.createElement(\"td\", null,\n                React.createElement(\"p\", { className: \"abilityText\" }, futureAbilityText)),\n            React.createElement(\"td\", null,\n                React.createElement(\"p\", null, (tasksPerId[futureAbilityText] || []).length)))); });\n        return React.createElement(OpenCloseBox, { className: \"larger\", title: React.createElement(\"p\", null, \"Kursens t\\u00E4ckningstabell\"), contentClassName: \"weighted-items-table\" },\n            React.createElement(\"p\", null, \"Tabellen anger hur m\\u00E5nga uppgifter som ber\\u00F6r varje del.\"),\n            React.createElement(\"table\", null,\n                React.createElement(\"tbody\", null, rows)));\n    };\n    return WeightedItemsTable;\n}(React.Component));\nexport { WeightedItemsTable };\n","import { __extends, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { L } from '../../../utils/utils';\nexport { ShowSubject } from './show-subject';\nimport { CourseBanner } from \"../courses/course-banner\";\nimport { SubjectsInner } from './subjects-inner';\nvar Subjects = /** @class */ (function (_super) {\n    __extends(Subjects, _super);\n    function Subjects(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            isListingSubjects: true,\n            primarySchoolSubjects: [],\n            uploadedSubject: null\n        };\n        return _this;\n    }\n    Subjects.prototype.render = function () {\n        return React.createElement(\"div\", null,\n            React.createElement(CourseBanner, { title: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\u00C4mnen\"], [\"\\u00C4mnen\"]))), activePage: \"subjects\", routes: { feedback: this.props.feedbackUrl } }),\n            React.createElement(SubjectsInner, { linkPrefix: \"/subjects/\" }));\n    };\n    return Subjects;\n}(React.Component));\nexport { Subjects };\nvar templateObject_1;\n","import { __awaiter, __extends, __generator, __makeTemplateObject } from \"tslib\";\nimport { Repo } from './repo';\nimport env from '../globals/KED.env';\nimport { flatten, L } from \"../utils/utils\";\nvar SchoolCoursesRepo = /** @class */ (function (_super) {\n    __extends(SchoolCoursesRepo, _super);\n    function SchoolCoursesRepo(getSchoolName) {\n        var _this = _super.call(this, {\n            query: function () { return __awaiter(_this, void 0, void 0, function () {\n                var schoolName, schools;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            schoolName = getSchoolName();\n                            return [4 /*yield*/, env.kedBackendClient.list(\"schools\", {\n                                    name: schoolName,\n                                    include: [\"courses\"]\n                                })];\n                        case 1:\n                            schools = _a.sent();\n                            this._schoolId = schools.length > 0 && schools[0].id;\n                            if (!this._schoolId)\n                                throw new Error(L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Skolan \", \" finns inte registrerad i systemet.\\n          Kontakta en administrat\\u00F6r f\\u00F6r Kursbyggarverktyget och be om att l\\u00E4gga till skolan med namnet \\\"\", \"\\\"\"], [\"Skolan \", \" finns inte registrerad i systemet.\\n          Kontakta en administrat\\u00F6r f\\u00F6r Kursbyggarverktyget och be om att l\\u00E4gga till skolan med namnet \\\"\", \"\\\"\"])), schoolName, schoolName));\n                            return [2 /*return*/, flatten(schools.map(function (school) { return school.courses; }))];\n                    }\n                });\n            }); }\n        }) || this;\n        return _this;\n    }\n    SchoolCoursesRepo.prototype.getSchoolId = function () {\n        var _this = this;\n        return this.ensureHasData().then(function () { return _this._schoolId; });\n    };\n    return SchoolCoursesRepo;\n}(Repo));\nexport var mySchoolCoursesRepo = new SchoolCoursesRepo(function () { return env.currentUser.school; });\nvar templateObject_1;\n","var CachedResponse = /** @class */ (function () {\n    function CachedResponse(queryer) {\n        this.queryer = queryer;\n        this.promise = null;\n        this.result = null;\n    }\n    CachedResponse.prototype.query = function () {\n        var _this = this;\n        return this.promise ?\n            this.promise :\n            (this.promise = this.queryer().then(function (x) { return _this.result = x; }));\n    };\n    CachedResponse.prototype.reset = function () {\n        this.promise = null;\n    };\n    return CachedResponse;\n}());\nexport { CachedResponse };\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1MA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxNA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1KA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1vBA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjNA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9GA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpaA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}