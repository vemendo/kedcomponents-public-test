{"version":3,"file":"TeacherViewApp.min.js","sources":["webpack://[name]/TeacherViewApp.min.js"],"sourcesContent":["(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[17],{306:function(e,t,n){\"use strict\";n.r(t);var a=n(2),s=n.n(a),r=n(312),l=n(301),i=n(310),u=n(102),c=n(0),d=n(279),o=n(108),m=n(89),f=n(5),g=n.n(f),h=n(166),b=n(4),p=n(3),E=n(9),v=function(e){var t=e.assignment,n=e.shouldGetUrkundStatus,s=e.task,r=e.studentView,l=Object(c.f)(Object(a.useState)(t),2),i=l[0],u=l[1],d=Object(a.useContext)(H),o=d.school,m=d.selectedCourse;function f(e){return Object(c.b)(this,void 0,void 0,(function(){var t,n,a,r,l,i,d,f;return Object(c.d)(this,(function(g){switch(g.label){case 0:return t=b.b.kedBackendClient.http,n=e.user,a=e.filename,[4,u(Object(c.a)(Object(c.a)({},e),{isRefreshing:!0}))];case 1:g.sent(),g.label=2;case 2:return g.trys.push([2,8,,10]),[4,t.get(\"assignments/urkund/\"+o+\"/\"+m.id+\"/\"+s.id+\"/\"+n+\"/\"+a)];case 3:return(r=g.sent()).status>=400?(l=p.c.bind,i=[void 0,r.status],[4,r.text()]):[3,5];case 4:throw new(l.apply(p.c,i.concat([g.sent()])));case 5:return[4,r.text()];case 6:return d=g.sent(),[4,u(Object(c.a)(Object(c.a)({},e),{isRefreshing:!1,metadata:Object(c.a)(Object(c.a)({},e.metadata),{urkundResponse:d})}))];case 7:return g.sent(),[3,10];case 8:return f=g.sent(),[4,u(Object(c.a)(Object(c.a)({},e),{isRefreshing:!1,refreshError:f}))];case 9:return g.sent(),[3,10];case 10:return[2]}}))}))}return Object(a.useEffect)((function(){n&&(u(Object(c.a)(Object(c.a)({},t),{isRefreshing:!0})),f(t))}),[n,t]),a.createElement(\"tr\",{key:i.mediaLink,style:i.metadata.$meta?{opacity:.5}:{}},r?a.createElement(\"td\",null,s.name):a.createElement(\"td\",null,a.createElement(\"a\",{href:\"mailto:\"+i.user},i.metadata.userDisplayName||i.user)),a.createElement(\"td\",null,i.metadata.driveFileId?a.createElement(h.a,{file:i}):a.createElement(\"a\",{href:\"#\",onClick:function(e){e.preventDefault(),e.stopPropagation(),Object(h.b)(i)}},Object(E.l)(i.filename,32))),a.createElement(\"td\",{className:\"assignment-date-col\"},g()(i.uploadDate).format(\"YYYY-MM-DD HH:mm\")),Object(h.c)(i,f,n))},k=n(31),j=function(e,t,n,a){var s=Object.assign([],e),r=t.length>0&&n.filter((function(e){return t.includes(e.tuitionGroupName)})),l=t.length>0?s.filter((function(e){return Object(E.k)(r).find((function(t){return t.studentEmailAddress===e.user}))})):s;return a&&l.length>0&&l.forEach((function(e){e.shouldRefresh=!1,e.metadata&&e.metadata.urkundExternalId&&e.metadata.urkundExternalId.length>0&&!e.metadata.urkundUploadError&&(!e.metadata.urkundLastPoll||[\"Accepted\",\"Submitted\"].indexOf(JSON.parse(e.metadata.urkundResponse)[0].Status.State)>=0&&parseInt(e.metadata.urkundLastPoll)<g()().add(-15,\"seconds\").toDate().getTime())&&(e.shouldRefresh=!0)})),l};function O(e){var t;try{t=new URL(e).href}catch(e){t=window.location.origin+\"/\"+t}return t}var N=function(e){var t=e.assignments,n=e.checkWithUrkund,s=e.task,r=Object(a.useContext)(k.a).intl,l=a.useContext(F),i=l.filterStudyGroups,u=l.tuitionStudents,c=j(t,i,u,n);return c.length>0?a.createElement(\"table\",{className:\"task-assignments-table\"},a.createElement(\"thead\",null,a.createElement(\"tr\",null,a.createElement(\"th\",null,r.formatMessage({id:\"teacherView.assignmentStudentName\",defaultMessage:\"Elev\"})),a.createElement(\"th\",null,r.formatMessage({id:\"teacherView.assignmentFileName\",defaultMessage:\"Filnamn\"})),a.createElement(\"th\",null,r.formatMessage({id:\"teacherView.assignmentSubmittedAt\",defaultMessage:\"Inlamnat\"})),a.createElement(\"th\",null,r.formatMessage({id:\"teacherView.assignmentReport\",defaultMessage:\"Rapport\"})),a.createElement(\"th\",null,r.formatMessage({id:\"teacherView.assignmentGrade\",defaultMessage:\"Niva\"})))),a.createElement(\"tbody\",null,c.map((function(e){return a.createElement(v,{task:s,key:e.uploadDate,assignment:e,shouldGetUrkundStatus:e.shouldRefresh})})))):a.createElement(\"div\",null,r.formatMessage({id:\"teacherView.noTaskAssignments\",defaultMessage:\"Inga uppdrag uppladdade för denna uppgift\"}))},y=n(20);function w(e){return function(t){var n=Object(c.f)(Object(a.useState)({emailSendInProgress:!1,data:[]}),2),s=n[0],r=n[1],l=Object(a.useContext)(k.a).intl;return a.createElement(e,Object(c.a)({},t,{emailInfo:s,setEmailInfo:function(e){return r(Object(c.a)(Object(c.a)({},s),{data:s.data.find((function(t){return t.sendTo.email===e.sendTo.email&&e.taskId===t.taskId}))?s.data.filter((function(t){return t.sendTo.email!==e.sendTo.email||e.taskId!==t.taskId})):Object(c.h)(s.data,[e])}))},sendReminder:function(){return Object(c.b)(this,void 0,void 0,(function(){var e,t,n,a,i;return Object(c.d)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,4,,5]),e=b.b.kedBackendClient.http,r(Object(c.a)(Object(c.a)({},s),{emailSendInProgress:!0})),[4,e.post(\"email/reminder\",s.data)];case 1:return 200===(t=u.sent()).status?[3,3]:(r(Object(c.a)(Object(c.a)({},s),{emailSendInProgress:!1})),n=p.c.bind,a=[void 0,t.status],[4,t.text()]);case 2:throw new(n.apply(p.c,a.concat([u.sent()])));case 3:return r(Object(c.a)(Object(c.a)({},s),{emailSendInProgress:!1})),Object(E.o)(l.formatMessage({id:\"teacherView.emailRemindersSentMsg\",defaultMessage:\"Reminders successfully sent\"})),[3,5];case 4:return i=u.sent(),r(Object(c.a)(Object(c.a)({},s),{emailSendInProgress:!1})),Object(E.n)(i),[3,5];case 5:return[2]}}))}))}}))}}var S=n(23),M=w((function(e){var t=e.notSubmittedUsers,n=e.moduleName,s=e.task,r=e.setEmailInfo,l=e.emailInfo,i=e.sendReminder,u=Object(a.useContext)(k.a).intl,c=Object(a.useContext)(H),d=c.selectedCourse,o=c.courseViewerUrl,m=t&&t.length;return t&&0!==t.length?a.createElement(\"div\",{className:\"not-submitted-users taskContainer\"},a.createElement(\"h4\",null,u.formatMessage({id:\"teacherView.notSubmittedAssignments\",defaultMessage:\"Ej lämnat in\"})),t.map((function(e,t){return a.createElement(\"div\",{key:\"notHandedIn_\"+t,className:\"align-horizontal student-row\"+(m===t+1?\" last\":\"\")},a.createElement(\"div\",{className:\"horizontalItem top pull-right\",onClick:function(){Object(S.f)(o,{courseId:d.id});r({sendTo:{email:e.email,firstName:e.firstName,lastName:e.lastName},courseName:d.name,moduleName:n,taskName:s.name,taskId:s.id,taskDeadline:s.deadline,courseTaskUrl:O(o)+\"?courseId=\"+d.id+\"&module=\"+n+\"&taskId=\"+s.id})}},a.createElement(\"div\",{className:\"checkBox\"+(l.data.find((function(t){return t.sendTo.email===e.email}))?\" checked\":\"\")})),a.createElement(\"div\",{className:\"horizontalItem top\"},e.displayName))})),a.createElement(\"div\",{className:\"align-horizontal remind-assignment\"},a.createElement(\"div\",{className:\"horizontalItem top pull-right\"},a.createElement(\"button\",{className:\"btn btn-info\"+(l.emailSendInProgress?\" disabled\":\"\"),disabled:l.emailSendInProgress,onClick:function(){l.data.length>0?i():Object(E.n)(u.formatMessage({id:\"teacherView.sendEmailAtLeastOneRecipientErr\",defaultMessage:\"At least one student should be selected\"}))}},l.emailSendInProgress?a.createElement(a.Fragment,null,a.createElement(y.a,null),u.formatMessage({id:\"teacherView.emailReminderInProgress\",defaultMessage:\"Pågående\"})):a.createElement(a.Fragment,null,u.formatMessage({id:\"teacherView.remindBtn\",defaultMessage:\"Påminn\"})))))):null})),I=n(98),C=Object(I.a)((function(e){var t=e.course,n=e.entity,a=e.moduleId,r=e.taskId,l=e.notificationdigests,i=s.a.useContext(H).seenDigestsObservable.read(),u=0,c=l[t.id];if(c)if(\"course\"===n)t.modules.forEach((function(e){e.taskIds.forEach((function(e){u+=o(c[e])}))}));else if(\"module\"===n){var d=t.modules.find((function(e){return e.id==a}));d&&d.taskIds.forEach((function(e){u+=o(c[e])}))}else\"task\"===n&&(u+=o(c[r]));function o(e){return e?e.filter((function(e){return!i.find((function(t){return t.digest===e.digest}))})).length:0}return u>0&&s.a.createElement(\"div\",{className:\"notification-icon\"},u)})),V=n(86),x=function(e){var t=e.task,n=e.assignments,s=e.notSubmittedUsers,r=e.module,l=a.useContext(H),i=l.notificationdigests,u=l.selectedCourse,d=l.seenDigestsObservable;return a.createElement(m.a,{onOpenClose:function(e){return function(e){return Object(c.b)(this,void 0,void 0,(function(){var a,s,r=this;return Object(c.d)(this,(function(l){switch(l.label){case 0:return e&&i[u.id][t.id]?[4,Object(p.k)(b.b.currentUser.mail+u.id)]:[3,3];case 1:return a=l.sent(),[4,d.load()];case 2:s=l.sent(),n.forEach((function(e){return Object(c.b)(r,void 0,void 0,(function(){var t;return Object(c.d)(this,(function(n){switch(n.label){case 0:return[4,Object(p.k)(e.user+e.courseId+e.taskId+e.uploadDate+(e.metadata.driveFileId||\"\"))];case 1:return t=n.sent(),s&&s.find((function(e){return e.digest===t}))||V.c.seenStudentAssignments.add({id:Object(p.h)(),tags:[a],digest:t}),[2]}}))}))})),l.label=3;case 3:return[2]}}))}))}(e)},className:\"task-container\",title:a.createElement(\"div\",{className:\"notification-container\"},a.createElement(\"span\",null,t.name),a.createElement(C,{course:u,entity:\"task\",taskId:t.id,notificationdigests:i})),headerOpen:!1},a.createElement(\"div\",{className:\"ked_boxed\"},a.createElement(N,{task:t,assignments:n,checkWithUrkund:void 0===t.sendToUrkund||t.sendToUrkund}),a.createElement(\"br\",null),a.createElement(M,{notSubmittedUsers:s,moduleName:r.name,task:t})))},U=function(e){var t=e.module,n=e.tasks,s=Object(a.useContext)(k.a).intl,r=Object(a.useContext)(H),l=r.notificationdigests,i=r.selectedCourse,u=Object(a.useContext)(F),d=u.filterStudyGroups,o=u.tuitionStudents,f=l[i.id];return n&&n.length>0&&a.createElement(a.Fragment,null,a.createElement(m.a,{title:a.createElement(\"div\",{className:\"notification-container\"},a.createElement(\"span\",null,t.name),a.createElement(C,{course:i,entity:\"module\",moduleId:t.id,notificationdigests:l})),headerOpen:!1},f&&Object.keys(f).length>0?a.createElement(\"div\",null,n.map((function(e){var n=f[e.id]?f[e.id].map((function(e){return e.assignment})):[],s=i.studyGroups&&i.studyGroups.length>0&&function(e){var t=[];return(d.length>0?i.studyGroups.filter((function(e){return d.includes(e)})):i.studyGroups).forEach((function(n){var a=o&&o.filter((function(a){return a.tuitionGroupName===n&&!e.find((function(e){return e.user===a.studentEmailAddress}))&&!t.find((function(e){return e.email===a.studentEmailAddress}))})).map((function(e){return{displayName:e.studentFirstName+\" \"+e.studentLastName,email:e.studentEmailAddress}}));a&&t.push.apply(t,Object(c.h)(a))})),t.map((function(e){var t=Object(c.f)(e.displayName.split(\" \")),n=t[0],a=t.slice(1);return Object(c.a)(Object(c.a)({},e),{firstName:n,lastName:a.join(\" \")})})).sort(Object(E.h)([\"lastName\",\"firstName\"]))}(n);return(s&&s.length>0||n&&n.length>0)&&a.createElement(x,{key:e.id,task:e,module:t,assignments:n,notSubmittedUsers:s})}))):a.createElement(\"div\",null,s.formatMessage({id:\"teacherView.noUploadedAssignmentsForModule\",defaultMessage:\"No assignments have been uploaded for this module\"}))))},T=n(141),G=n(136),D=n(96),A=w((function(e){var t=e.notHandedInModuleTasks,n=e.selectedUser,s=e.emailInfo,r=e.setEmailInfo,l=e.sendReminder,i=Object(a.useContext)(k.a).intl,u=Object(a.useContext)(H),c=u.selectedCourse,d=u.courseViewerUrl;return a.createElement(a.Fragment,null,a.createElement(\"table\",{className:\"task-assignments-table not-submitted\"},a.createElement(\"thead\",null,a.createElement(\"tr\",null,a.createElement(\"th\",null,i.formatMessage({id:\"teacherView.assignmentTaskName\",defaultMessage:\"Uppgift\"})),a.createElement(\"th\",null,i.formatMessage({id:\"teacherView.assignmentTaskDescription\",defaultMessage:\"Description\"})),a.createElement(\"th\",null,i.formatMessage({id:\"teacherView.assignmentTaskDeadline\",defaultMessage:\"Deadline\"})),a.createElement(\"th\",null))),a.createElement(\"tbody\",null,Object.keys(t).map((function(e){return t[e].map((function(t){return a.createElement(\"tr\",{key:t.name},a.createElement(\"td\",null,t.name),a.createElement(\"td\",null,t.content?Object(E.l)(t.content,32):\"\"),a.createElement(\"td\",null,t.deadline),a.createElement(\"td\",{onClick:function(){r({sendTo:{email:n.studentEmailAddress,firstName:n.studentFirstName,lastName:n.studentLastName},courseName:c.name,moduleName:e,taskName:t.name,taskId:t.id,taskDeadline:t.deadline,courseTaskUrl:O(d)+\"?courseId=\"+c.id+\"&module=\"+e+\"&taskId=\"+t.id})}},a.createElement(\"div\",{className:\"checkBox\"+(s.data.find((function(e){return e.taskName===t.name}))?\" checked\":\"\")})))}))})))),a.createElement(\"div\",{className:\"not-submitted-users taskContainer\"},a.createElement(\"div\",{className:\"align-horizontal remind-assignment\"},a.createElement(\"div\",{className:\"horizontalItem top pull-right\"},a.createElement(\"button\",{className:\"btn\",disabled:s.emailSendInProgress,onClick:function(){s.data.length>0?l():Object(E.n)(i.formatMessage({id:\"teacherView.sendEmailAtLeastOneRecipientErr\",defaultMessage:\"At least one student should be selected\"}))}},s.emailSendInProgress?a.createElement(a.Fragment,null,a.createElement(y.a,null),i.formatMessage({id:\"teacherView.emailReminderInProgress\",defaultMessage:\"Pågående\"})):a.createElement(a.Fragment,null,i.formatMessage({id:\"teacherView.remindBtn\",defaultMessage:\"Påminn\"})))))))})),P=function(e){var t=e.selectedUser,n=a.useContext(k.a).intl,s=Object(a.useContext)(H),r=s.tasks,l=s.selectedCourse,i=s.notificationdigests,u=Object(a.useContext)(F),d=u.filterStudyGroups,o=u.tuitionStudents,m={};l.modules.map((function(e){return m[e.name]=Object(c.h)(r.filter((function(t){return e.taskIds.find((function(e){return e===t.id}))})))}));var f=Object(E.k)(Object.keys(m).map((function(e){return m[e]}))),g=i[l.id],h={};Object.keys(m).map((function(e){return h[e]=m[e].filter((function(e){return!g[e.id]||!g[e.id].find((function(e){return e.assignment.user===t}))}))}));var b=f.map((function(e){if(g[e.id]){var n=g[e.id].filter((function(e){return e.assignment.user===t})).map((function(e){return e.assignment}));return{task:e,assignments:j(n,d,o,e.sendToUrkund)}}return{task:null,assignments:[]}})),p=o.find((function(e){return e.studentEmailAddress===t}));return a.createElement(\"div\",{className:\"filtered-view task-container\"},a.createElement(\"div\",{className:\"ked_boxed\"},b&&b.filter((function(e){return e.assignments.length>0})).length>0&&a.createElement(\"table\",{className:\"task-assignments-table\"},a.createElement(\"thead\",null,a.createElement(\"tr\",null,a.createElement(\"th\",null,n.formatMessage({id:\"teacherView.assignmentTaskName\",defaultMessage:\"Uppgift\"})),a.createElement(\"th\",null,n.formatMessage({id:\"teacherView.assignmentFileName\",defaultMessage:\"Filnamn\"})),a.createElement(\"th\",null,n.formatMessage({id:\"teacherView.assignmentSubmittedAt\",defaultMessage:\"Inlamnat\"})),a.createElement(\"th\",null,n.formatMessage({id:\"teacherView.assignmentReport\",defaultMessage:\"Rapport\"})),a.createElement(\"th\",null,n.formatMessage({id:\"teacherView.assignmentGrade\",defaultMessage:\"Niva\"})))),a.createElement(\"tbody\",null,b.map((function(e){return e.assignments&&e.assignments.map((function(t){return a.createElement(v,{studentView:!0,task:e.task,key:t.uploadDate,assignment:t,shouldGetUrkundStatus:t.shouldRefresh})}))})))),a.createElement(\"br\",null),a.createElement(A,{notHandedInModuleTasks:h,selectedUser:p})))},R=n(115),F=Object(a.createContext)({filterStudyGroups:[],tuitionStudents:[]}),B=function(){var e=Object(a.useContext)(k.a).intl,t=Object(a.useContext)(H),n=t.tasks,s=t.selectedCourse,r=t.edsSchool,l=t.school,i=Object(c.f)(Object(a.useState)({selectedStudent:{label:null,value:null},selectedStudyGroups:[]}),2),u=i[0],d=i[1],o=\"KED\"===l&&s&&s.studyGroups&&Object.keys(R.c).filter((function(e){return s.studyGroups.includes(e)})).map((function(e){return R.c[e]})),m=s&&Object(E.k)(r?Object(D.c)(s.studyGroups.map((function(e){return function(){return b.b.edsClient.suspense.getTuitionGroupStudents({schoolName:r,tuitionGroupName:e})}}))):o),f=m?Array.from(new Set(m.map((function(e){return e.studentEmailAddress})))).map((function(e){var t=m.find((function(t){return t.studentEmailAddress===e}));return{label:t.studentFirstName+\" \"+t.studentLastName,value:t.studentEmailAddress}})):[];return a.createElement(a.Fragment,null,\" \",a.createElement(G.a,null),s?a.createElement(F.Provider,{value:{filterStudyGroups:u.selectedStudyGroups,tuitionStudents:m}},a.createElement(\"div\",{className:\"sv-row sv-layout sv-skip-spacer\"},a.createElement(\"h2\",null,e.formatMessage({id:\"teacherView.assignmentsViewTitle\",defaultMessage:\"Inlämningsuppgifter\"})),a.createElement(\"p\",null,e.formatMessage({id:\"teacherView.assignmentsViewDescription\",defaultMessage:{defaultDescriptionMessage:\"Här listas samtliga inlämningsuppgifter i din/dina kurser du handleder.Klicka till höger för att välja kurs. Kursens uppgifter syns nedan. Du kan öppna/dölja varje modul.\"}})),a.createElement(\"h3\",null,s.name,\"-\",s.description),s.studyGroups&&s.studyGroups.length>0&&a.createElement(\"div\",{className:\"sv-row sv-layout sv-skip-spacer\"},a.createElement(\"div\",{className:\"horizontalItem top pull-right study-group-filter\"},a.createElement(T.a,{isDisabled:u.selectedStudent.value,isMulti:!0,options:s.studyGroups.map((function(e){return{label:e,value:e}})),value:u.selectedStudyGroups.map((function(e){return{label:e,value:e}})),placeholder:e.formatMessage({id:\"teacherView.filterByStudygroupsPlaceholder\",defaultMessage:\"Välj undervisningsgrupp\"}),onChange:function(e){d(Object(c.a)(Object(c.a)({},u),{selectedStudyGroups:e.map((function(e){return e.value}))}))}})),a.createElement(\"div\",{className:\"horizontalItem top pull-right study-group-filter\"},a.createElement(T.a,{className:\"basic-single\",classNamePrefix:\"select\",options:f,value:u.selectedStudent.value?{label:u.selectedStudent.label,value:u.selectedStudent.value}:null,isClearable:!0,placeholder:e.formatMessage({id:\"teacherView.filterByStudent\",defaultMessage:\"Välj student\"}),onChange:function(e){d({selectedStudyGroups:[],selectedStudent:e||{label:null,value:null}})}}))),u.selectedStudent.value?a.createElement(P,{selectedUser:u.selectedStudent.value}):s.modules.map((function(e){var t=n.filter((function(t){return e.taskIds.find((function(e){return e===t.id}))}));return t.length>0?a.createElement(U,{tasks:t,key:e.id,module:e}):null})))):null)},z=n(300),_=function(e){var t=e.courseBuilderUrl,n=Object(a.useContext)(k.a).intl,r=Object(a.useContext)(H),l=r.notificationdigests,i=r.teacherCourses,u=r.selectedCourse;return s.a.createElement(\"div\",{className:\"sv-html-portlet sv-portlet sv-skip-spacer\"},s.a.createElement(\"div\",{className:\"ked_boxed\"},s.a.createElement(\"h3\",null,n.formatMessage({id:\"teacherView.coursesViewTitle\",defaultMessage:\"Mina kurser/ uppgifter\"})),s.a.createElement(\"div\",{className:\"taskContainer odd-even\"},i.map((function(e){return s.a.createElement(\"div\",{key:e.id+e.code,className:\"align-horizontal\"},s.a.createElement(\"div\",{className:\"teacherSchoolCourse\"},s.a.createElement(\"div\",{className:\"horizontalItem top pull-right\"},s.a.createElement(\"a\",{target:\"_blank\",href:Object(S.f)(t,{})+\"#/courses/\"+e.id+\"/edit\",className:\"editItem\"})),s.a.createElement(\"div\",{className:\"horizontalItem top\"},s.a.createElement(\"div\",{className:\"notification-container\"},s.a.createElement(z.a,{key:\"linkCourse_\"+e.id,className:u&&u.id===e.id?\"selected\":\"\",to:\"/overview/course/\"+e.id+\"/assignments\"},e.name,\" - \",e.description),s.a.createElement(C,{key:\"notifictiona_\"+e.id,notificationdigests:l,entity:\"course\",course:e})))))})))),b.b.currentUser.roles.includes(\"ADMIN\")&&s.a.createElement(z.a,{to:\"/admin/emailtemplate\"},\"Manage Email Template\"))},L={notificationdigests:{},selectedCourse:null,teacherCourses:[],seenDigestsObservable:new D.a([]),school:\"\",edsSchool:\"\",tasks:[],courseViewerUrl:\"\"},H=Object(a.createContext)(L),Y=Object(d.a)(Object(I.a)((function(e){var t,n=e.match,s=e.courseBuilderUrl,r=e.courseViewerUrl,l=(l=n?n.params.courseId:null)||null,i=[],d=V.c.schools.tags(\"gymnasium\").name(b.b.currentUser.school).include(\"courses\").single().read(),m=d?d.courses:[];if(m){var f=b.b.currentUser.mail;m.forEach((function(e){e.modules.length>0&&(e.activatedBy&&e.activatedBy.url==f?i.push(e):e.responsibleTeachers.filter((function(e){return e.url==f})).length>0&&i.push(e))}))}var g=((i=i.sort(Object(E.h)([\"name\",\"dateTime\"])))?V.c.tasks.hasEdgesFrom(i.map((function(e){return e.id}))).toValue().read():[]).filter((function(e){return!0===e.assignment})),h=d.name,v=i.map((function(e){return e.id})).join(\",\"),k=i.find((function(e){return e.id===l})),j={};if(v.length>0){var O=b.b.kedBackendClient.http.suspenseGet(\"assignments/notificationdigests\",{school:h,courseIds:v});if(200!==O.status)throw new p.c(O.status,O.text());j=O.json()}var N=Object(p.l)(i.map((function(e){return b.b.currentUser.mail+e.id}))),y=N.length>0?(t=V.c.seenStudentAssignments).tags.apply(t,Object(c.h)(N)).toValue():new D.a([]),w={notificationdigests:j,selectedCourse:k,teacherCourses:i,seenDigestsObservable:y,school:h,edsSchool:d.edsSchoolNameGymn,tasks:g,courseViewerUrl:r};return a.createElement(H.Provider,{value:w},a.createElement(o.a,{left:a.createElement(a.Suspense,{fallback:a.createElement(u.a,null)},a.createElement(B,{key:k?k.id:\"\"})),right:a.createElement(_,{courseBuilderUrl:s}),rightWidth:5}))}))),J=n(99),K=n(163),W=Object(d.a)(Object(I.a)((function(e){e.match;var t=Object(K.a)().roles.includes(\"ADMIN\"),n=[\"[FirstName]\",\"[LastName]\",\"[CourseName]\",\"[ModuleName]\",\"[TaskName]\",\"[TaskDeadline]\",\"[TeacherName]\",\"[TaskUrl]\"],r=V.c.emailTemplates.tags(\"email-type: assignment-reminder\").single({onZero:function(){}}).read(),l=Object(c.f)(Object(a.useState)(r?{content:r.content,subject:r.subject}:{content:\"\",subject:\"\"}),2),i=l[0],u=l[1];return s.a.createElement(\"div\",{className:\"sv-html-portlet sv-portlet sv-skip-spacer\"},s.a.createElement(\"div\",{className:\"ked_boxed\"},s.a.createElement(\"h4\",null,\"Email reminder template\"),s.a.createElement(\"p\",{className:\"subHeader\"},\"(Compose the email template. Possible parameters are: \"+n.join(\",\")+\")\"),s.a.createElement(\"input\",{placeholder:\"Subject\",value:i.subject,className:\"inputTextBox inputTextSmall\",onChange:function(e){return u(Object(c.a)(Object(c.a)({},i),{subject:e.target.value}))}}),s.a.createElement(J.a,{actions:[\"bold\",\"italic\",\"underline\",\"strikethrough\",\"heading2\",\"heading3\",\"olist\",\"ulist\",\"outdent\",\"indent\",\"line\",\"image\"],readOnly:!t,html:i.content,onChange:function(e){return u(Object(c.a)(Object(c.a)({},i),{content:e}))}}),s.a.createElement(\"button\",{className:\"btn\",onClick:function(){!function(){var e,t,a=i.content.match(/\\[(.*?)\\]/gm),s=i.subject.match(/\\[(.*?)\\]/gm);if(e=null!=a&&a.every((function(e){return-1!==n.indexOf(e)})),t=null!=s&&s.every((function(e){return-1!==n.indexOf(e)})),e&&t)try{r?V.c.emailTemplates.update(r,{content:i.content,subject:i.subject}):V.c.emailTemplates.add({id:Object(p.h)(),tags:[\"email-type: assignment-reminder\"],content:i.content,subject:i.subject}),Object(E.o)(\"Template successfully saved\")}catch(e){Object(E.n)(e)}else Object(E.n)(\"Invalid parameters were used in template. Please use only the specified ones and try again.\")}()}},\"Submit\")))}))),Z=n(112);n.d(t,\"TeacherViewApp\",(function(){return $}));var $=function(e){var t=e.courseBuilderUrl,n=e.viewCourseUrl;return s.a.createElement(r.a,null,s.a.createElement(\"div\",{className:\"teacher-view\"},s.a.createElement(l.a,{path:\"/\",exact:!0,render:function(){return s.a.createElement(i.a,{to:\"/overview\"})}}),s.a.createElement(l.a,{path:\"/overview/(course)?/:courseId?/(assignments)?\",render:function(){return s.a.createElement(a.Suspense,{fallback:s.a.createElement(u.a,null)},s.a.createElement(Y,{courseBuilderUrl:t,courseViewerUrl:n}))}}),s.a.createElement(l.a,{exact:!0,path:\"/admin/emailtemplate\",render:function(){return s.a.createElement(a.Suspense,{fallback:s.a.createElement(u.a,null)},s.a.createElement(W,null))}}),s.a.createElement(Z.a,null)))}}}]);"],"mappings":"AAAA","sourceRoot":""}