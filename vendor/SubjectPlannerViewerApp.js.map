{"version":3,"file":"SubjectPlannerViewerApp.js","sources":["webpack://[name]/./src/components/course-builder-ks/common/dialog-content.tsx","webpack://[name]/./src/components/course-builder-ks/common/field-limits.ts","webpack://[name]/./src/components/course-builder-ks/common/future-abilities-box.tsx","webpack://[name]/./src/components/course-builder-ks/common/select-word-bank.tsx","webpack://[name]/./src/components/course-builder-ks/logic/compute-task-tags-and-subject.ts","webpack://[name]/./src/components/course-builder-ks/logic/get-draft-id.ts","webpack://[name]/./src/components/course-builder-ks/logic/is-ked-staff.ts","webpack://[name]/./src/components/course-builder-ks/viewer-editor/add-content-button.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/add-tab-button.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/clickable-school-div.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-area.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/add-task-button.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/content-box.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/course-content-types.ts","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/embedded-html.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/index.ts","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/learning-tasks-content-box.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/learning-tasks-settings.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/learning-tasks-with-common-goals.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/learning-tasks-with-separate-goals.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/resource-list-view.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/rich-text.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/word-bank-content-box.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-contents/word-bank-content-settings.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-tab-area.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-tab-content-box.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-tab/tab-classes.ts","webpack://[name]/./src/components/course-builder-ks/viewer-editor/course-viewer-page.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/editor-footer-buttons.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/index.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/left-course-area.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/list-courses/index.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/list-courses/student-courses-box.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/redirect-to-step.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/resource-editor.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/tab-settings-admin.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/tab-settings-requirements.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/tab-settings.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/left-column/edit-requirements.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/right-column/basic-editable-task-fields.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/right-column/edit-task-form.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/right-column/introduction-text-editor.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/right-column/task-description-editor.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/right-column/task-embedded-html-editor.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/right-column/task-footer-buttons.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/right-column/task-working-procedure-editor.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/task-editor.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/texts.ts","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/viewer/task-viewer-page.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/task/viewer/task-viewer.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/delta-boxes.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/delta-helper-funcs.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/deltadoc-box.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/deltalink-box.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/draft-delta-view.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/index.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/model-friendly-names.ts","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/reset-course-button.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/undo-deltas-button.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/version-history-page.tsx","webpack://[name]/./src/components/course-builder-ks/viewer-editor/version-history/version-history-view.tsx","webpack://[name]/./src/utils/get-school-name-from-branch-id.ts"],"sourcesContent":["import { __assign, __extends, __read, __spread } from \"tslib\";\nimport React from 'react';\nimport { Dialogs } from '../../utility-components/dialogs';\nimport { DialogsContext } from './dialog-context';\nexport var setupDialogs = function (Component) {\n    return /** @class */ (function (_super) {\n        __extends(DialogContent, _super);\n        function DialogContent(props) {\n            var _this = _super.call(this, props) || this;\n            _this.state = {\n                dialogs: []\n            };\n            _this.openDialog = _this.openDialog.bind(_this);\n            _this.closeDialog = _this.closeDialog.bind(_this);\n            return _this;\n        }\n        DialogContent.prototype.openDialog = function (dialog) {\n            this.setState({ dialogs: __spread(this.state.dialogs, [dialog]) });\n        };\n        DialogContent.prototype.closeDialog = function () {\n            this.setState({ dialogs: this.state.dialogs.slice(0, this.state.dialogs.length - 1) });\n        };\n        DialogContent.prototype.render = function () {\n            var dialogs = this.state.dialogs;\n            return React.createElement(DialogsContext.Provider, { value: { openDialog: this.openDialog, closeDialog: this.closeDialog } },\n                React.createElement(Component, __assign({}, this.props)),\n                React.createElement(Dialogs, { dialogs: dialogs, popDialog: this.closeDialog }));\n        };\n        return DialogContent;\n    }(React.Component));\n};\n","export var FieldLimits = {\n    MAX_CHARS_IN_CONTENTS: 4000,\n    MAX_CHARS_TASK_NAMES: 64,\n    MAX_CHARS_TASK_INTRO_TEXT: 200\n};\n","import React from 'react';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\nexport var FutureAbilitiesBox = function (_a) {\n    var title = _a.title, selectedFAs = _a.selectedFAs;\n    return React.createElement(OpenCloseBox, { title: React.createElement(\"p\", null, title), className: \"larger\" },\n        React.createElement(\"div\", { className: \"abilityList\" }, selectedFAs.map(function (fa) {\n            return React.createElement(\"div\", { key: fa, className: \"contentPart\" },\n                React.createElement(\"div\", { className: \"contentText\" },\n                    React.createElement(\"p\", null, fa)));\n        })));\n};\n","import React, { Suspense } from \"react\";\nimport { WordBankContentSettings } from \"../viewer-editor/course-contents/word-bank-content-settings\";\nimport { TimeoutEllipsisLoader } from \"../../course-builder/sub-components/ellipsis-loader\";\nimport { cfg } from \"../../../globals/KED.cfg\";\nexport var SelectWordBank = function (_a) {\n    var subject = _a.subject, step = _a.step, onSelect = _a.onSelect;\n    return (React.createElement(\"div\", { style: { minHeight: 400 } },\n        React.createElement(Suspense, { fallback: React.createElement(TimeoutEllipsisLoader, null) },\n            React.createElement(WordBankContentSettings, { subjectName: subject, stepNo: step, onChange: function (_a) {\n                    var name = _a.name, key = _a.key;\n                    var url = cfg.KED_WORDBANKS_URL + \"?subject=\" + subject + \"&step=\" + step + \"&list=\" + key;\n                    onSelect({ name: name, url: url });\n                } }))));\n};\n","import { __read, __spread } from \"tslib\";\nimport { flatten, distinct } from '../../../utils/utils';\nexport function computeTaskTagsAndSubject(course, tab, block) {\n    var tags = [course.id];\n    if (course.type === 'step-course' && block && tab.type === 'step-course-tab') {\n        tags.push(\"blockStep:\" + block.id + \":\" + tab.stepNo);\n    }\n    else if (course.type === 'theme-course') {\n        tags.push(\"tab:\" + tab.id);\n    }\n    if (tab.tabClass === 'mission-tab') {\n        // If task belongs to a mission tab,\n        // it should be tagged with all the subjects of the course\n        var otherSubjectTabs = course.tabs\n            .filter(function (tab) { return tab.tabClass === 'subject-tab'; });\n        var subjects = distinct(otherSubjectTabs.map(function (tab) { return tab.subject; }), function (s) { return s.subjectCode; });\n        var courseCodeTags = distinct(flatten(otherSubjectTabs.map(function (tab) { return tab.tags.filter(function (tag) { return tag.startsWith(\"course:\"); }); })));\n        tags.push.apply(tags, __spread(subjects.map(function (s) { return \"sub:\" + s.subjectCode; })));\n        tags.push.apply(tags, __spread(courseCodeTags));\n        var subject = subjects.map(function (s) { return s.subjectName; }).join(', ');\n        return { tags: tags, subject: subject };\n    }\n    else {\n        tags.push.apply(tags, __spread((tab || block).tags.filter(function (tag) { return tag.startsWith(\"course:\"); })));\n        if (course.type === 'theme-course')\n            tags.push.apply(tags, __spread(tab.tags.filter(function (tag) { return tag.startsWith(\"sub:\"); })));\n        else\n            tags.push.apply(tags, __spread(block.tags.filter(function (tag) { return tag.startsWith(\"sub:\"); })));\n        var subject = course.type === 'theme-course' ?\n            tab.subject.subjectName :\n            course.subject.subjectName;\n        return { tags: tags, subject: subject };\n    }\n}\n","import { db } from '../../../globals/db';\nexport function getDraftId(school, courseId) {\n    return db.schools.name(school).cacheOptimized().single() // Get the school Observable\n        .switchMap(function (school) {\n        return db.branches\n            .hasEdgesFrom([school.officialBranchId]) // The official draft has edges from the official school branch\n            .name(\"draft\") // There might be other personal drafts in future. Requirement of the common draft is that it is named \"draft\"\n            .tags(courseId) // Find the one tagged with the courseId. There are several drafts - one for each course.\n            .idsOnly()\n            .map(function (_a) {\n            var id = _a.id;\n            return id;\n        })\n            .first();\n    });\n}\n","import env from '../../../globals/KED.env';\nimport { isAdminOrTeacherAtSchool } from '../../../access-control';\nexport function isKedStaff() {\n    return isAdminOrTeacherAtSchool(env.currentUser, \"standard\");\n}\n","import { __extends, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { createUUID } from 'kedbackend/client';\nimport { isKedStaff } from '../logic/is-ked-staff';\nvar CONTENT_TYPES = {\n    \"rich-text\": L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Textruta\"], [\"Textruta\"]))),\n    \"youtube-movie\": L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Youtube film\"], [\"Youtube film\"]))),\n    \"learning-goals\": L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"L\\u00E4randem\\u00E5l och uppgifter\"], [\"L\\u00E4randem\\u00E5l och uppgifter\"]))),\n    \"resource-list\": L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Resurslista\"], [\"Resurslista\"]))),\n    \"embedded-html\": L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Inb\\u00E4ddad HTML\"], [\"Inb\\u00E4ddad HTML\"]))),\n    \"word-bank\": L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Ordbank\"], [\"Ordbank\"])))\n};\nvar ADD_TITLES = {\n    \"rich-text\": L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"L\\u00E4gg till text\"], [\"L\\u00E4gg till text\"]))),\n    \"youtube-movie\": L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"L\\u00E4gg till youtube film\"], [\"L\\u00E4gg till youtube film\"]))),\n    \"learning-goals\": L(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"L\\u00E4gg till l\\u00E4randem\\u00E5l och uppgifter\"], [\"L\\u00E4gg till l\\u00E4randem\\u00E5l och uppgifter\"]))),\n    \"resource-list\": L(templateObject_10 || (templateObject_10 = __makeTemplateObject([\"L\\u00E4gg till resurslista\"], [\"L\\u00E4gg till resurslista\"]))),\n    \"embedded-html\": L(templateObject_11 || (templateObject_11 = __makeTemplateObject([\"L\\u00E4gg till inb\\u00E4ddad HTML\"], [\"L\\u00E4gg till inb\\u00E4ddad HTML\"]))),\n    \"word-bank\": L(templateObject_12 || (templateObject_12 = __makeTemplateObject([\"L\\u00E4gg till ordbank\"], [\"L\\u00E4gg till ordbank\"])))\n};\nvar AddContentButton = /** @class */ (function (_super) {\n    __extends(AddContentButton, _super);\n    function AddContentButton(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            open: false,\n            contentType: 'rich-text'\n        };\n        return _this;\n    }\n    AddContentButton.prototype.computeTags = function () {\n        var _a = this.props, course = _a.course, tab = _a.tab, courseBlock = _a.courseBlock;\n        return [\n            course.id,\n            tab.type === 'step-course-tab' ?\n                \"blockStep:\" + courseBlock.id + \":\" + tab.stepNo :\n                \"tab:\" + tab.id\n        ];\n    };\n    AddContentButton.prototype.createContent = function () {\n        var _a = this.props, tab = _a.tab, branch = _a.branch, type = _a.type, schoolName = _a.schoolName;\n        var newContent = this.newContent(type || this.state.contentType);\n        newContent.acl = [\"role:USER:R\", \"schoolRole:\" + schoolName + \"/EMPLOYEE:S\"];\n        branch.courseTabs.addRelated(tab, \"contents\", newContent);\n        this.setState({ open: false });\n    };\n    AddContentButton.prototype.newContent = function (contentType) {\n        switch (contentType) {\n            case \"rich-text\": return this.newRichText();\n            case \"learning-goals\": return this.newLearningGoal();\n            case \"embedded-html\": return this.newEmbeddedHTML();\n            case \"word-bank\": return this.newWordBank();\n            case \"resource-list\": return this.newResourceList();\n            default: throw new Error(\"Not implemented\");\n        }\n    };\n    AddContentButton.prototype.newWordBank = function () {\n        return {\n            type: 'word-bank',\n            tags: this.computeTags(),\n            id: createUUID(),\n            order: Date.now(),\n            locked: this.props.tab.locked,\n            lockDelete: isKedStaff(),\n            hidden: false,\n            selectedWordBank: null\n        };\n    };\n    AddContentButton.prototype.newRichText = function () {\n        return {\n            type: \"rich-text\",\n            tags: this.computeTags(),\n            id: createUUID(),\n            order: Date.now(),\n            locked: this.props.course.type !== \"theme-course\" && this.props.tab.locked,\n            lockDelete: isKedStaff(),\n            hidden: false,\n            html: '',\n        };\n    };\n    AddContentButton.prototype.newEmbeddedHTML = function () {\n        return {\n            type: \"embedded-html\",\n            tags: this.computeTags(),\n            id: createUUID(),\n            order: Date.now(),\n            locked: this.props.tab.locked,\n            lockDelete: isKedStaff(),\n            hidden: false,\n            html: ''\n        };\n    };\n    AddContentButton.prototype.newLearningGoal = function () {\n        return {\n            type: \"learning-goals\",\n            tags: this.computeTags(),\n            id: createUUID(),\n            locked: this.props.course.type !== \"theme-course\" && this.props.tab.locked,\n            lockDelete: isKedStaff(),\n            hidden: false,\n            hasCommonLearningGoals: this.props.course.type === 'theme-course',\n            commonLearningGoals: [],\n            order: Date.now(),\n            hiddenTasks: [],\n        };\n    };\n    AddContentButton.prototype.newResourceList = function () {\n        return {\n            type: \"resource-list\",\n            tags: this.computeTags(),\n            id: createUUID(),\n            locked: false,\n            lockDelete: isKedStaff(),\n            order: Date.now(),\n            hidden: false,\n            resources: []\n        };\n    };\n    AddContentButton.prototype.render = function () {\n        var _this = this;\n        if (this.state.open) {\n            return React.createElement(\"div\", null,\n                React.createElement(\"select\", { onChange: function (ev) { return _this.setState({ contentType: ev.target.value }); } }, Object.keys(CONTENT_TYPES).map(function (contentType) {\n                    return React.createElement(\"option\", { key: contentType, value: contentType }, CONTENT_TYPES[contentType]);\n                })),\n                React.createElement(\"a\", { className: \"btn pull-right\", onClick: function () { return _this.setState({ open: false }); } }, L(templateObject_13 || (templateObject_13 = __makeTemplateObject([\"Avbryt\"], [\"Avbryt\"])))),\n                React.createElement(\"a\", { className: \"btn btn-default\", onClick: function () { return _this.createContent(); } }, L(templateObject_14 || (templateObject_14 = __makeTemplateObject([\"Skapa\"], [\"Skapa\"])))));\n        }\n        return React.createElement(React.Fragment, null,\n            React.createElement(\"a\", { className: \"btn\", onClick: function () {\n                    if (_this.props.type) {\n                        _this.createContent();\n                    }\n                    else {\n                        _this.setState({ open: true });\n                    }\n                } },\n                React.createElement(\"i\", { className: \"fas fa-plus\", \"aria-hidden\": \"true\" }),\n                this.props.type ? ADD_TITLES[this.props.type] : L(templateObject_15 || (templateObject_15 = __makeTemplateObject([\"L\\u00E4gg till inneh\\u00E5ll\"], [\"L\\u00E4gg till inneh\\u00E5ll\"])))),\n            \"\\u00A0\");\n    };\n    return AddContentButton;\n}(React.Component));\nexport { AddContentButton };\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10, templateObject_11, templateObject_12, templateObject_13, templateObject_14, templateObject_15;\n","import { __assign, __awaiter, __extends, __generator, __makeTemplateObject, __read, __spread } from \"tslib\";\nimport * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { createUUID } from 'kedbackend/client';\nimport { withRouter } from 'react-router';\nimport { isKedStaff } from '../logic/is-ked-staff';\nvar AddTabButton = /** @class */ (function (_super) {\n    __extends(AddTabButton, _super);\n    function AddTabButton(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            editingName: false,\n            name: \"\"\n        };\n        return _this;\n    }\n    AddTabButton.prototype.createTab = function (tabName) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, type, branch, draftId, course, school, history, block, stepNo, tabTemplate, newTab;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        this.setState({ editingName: false, name: \"\" });\n                        _a = this.props, type = _a.type, branch = _a.branch, draftId = _a.draftId, course = _a.course, school = _a.school, history = _a.history, block = _a.block, stepNo = _a.stepNo;\n                        tabTemplate = {\n                            id: createUUID(),\n                            tabTitle: tabName,\n                            name: tabName,\n                            order: Date.now(),\n                            locked: isKedStaff() ? true : false,\n                            acl: [\"role:USER:R\", \"schoolRole:\" + school + \"/EMPLOYEE:S\"],\n                        };\n                        newTab = (type === 'theme-course-tab' ?\n                            __assign({ type: 'theme-course-tab', tabClass: 'content-tab', tags: [\n                                    this.props.course.id,\n                                    \"tab:\" + tabTemplate.id\n                                ] }, tabTemplate) :\n                            __assign(__assign({ type: 'step-course-tab', tabClass: 'content-tab', tags: __spread(block.tags, [\n                                    \"blockStep:\" + block.id + \":\" + stepNo\n                                ]) }, tabTemplate), { stepNo: stepNo }));\n                        /*const topContent: RichTextContent = {\n                          type: 'rich-text',\n                          id: createUUID(),\n                          tags: [this.props.course.id],\n                          html: `<h2>${tabName}</h2`,\n                          order: Date.now(),\n                          locked: true,\n                          hidden: false\n                        };*/\n                        if (newTab.type === 'step-course-tab') {\n                            branch.courseBlocks.addRelated(block, \"tabs\", newTab);\n                        }\n                        else {\n                            branch.courseInstances.addRelated(course, \"tabs\", newTab);\n                        }\n                        //branch.courseTabs.addRelated(newTab.id, \"contents\", topContent);\n                        return [4 /*yield*/, branch.saveNow()];\n                    case 1:\n                        //branch.courseTabs.addRelated(newTab.id, \"contents\", topContent);\n                        _b.sent();\n                        history.push(\"/\" + school + \"/courses/\" + course.id + \"/tabs/\" + newTab.id + \"/drafts/\" + draftId + \"/edit\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AddTabButton.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, school = _a.school, course = _a.course, branch = _a.branch;\n        var _b = this.state, editingName = _b.editingName, name = _b.name;\n        return React.createElement(React.Fragment, null,\n            React.createElement(\"a\", { onClick: editingName ? null : function (ev) { return _this.setState({ editingName: true, name: '' }); } },\n                React.createElement(\"i\", { className: \"fas fa-plus\", \"aria-hidden\": \"true\" }),\n                !editingName ?\n                    ' ' + L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Ny flik\"], [\"Ny flik\"]))) :\n                    React.createElement(\"input\", { type: \"text\", style: { color: \"black\" }, autoFocus: true, placeholder: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Fliknamn\"], [\"Fliknamn\"]))), value: name, size: 30, onChange: function (ev) { return _this.setState({ name: ev.target.value }); }, onKeyPress: function (ev) {\n                            if (ev.key === 'Enter') {\n                                _this.createTab(name);\n                            }\n                        }, onBlur: function () { return _this.setState({ editingName: false }); } })));\n    };\n    return AddTabButton;\n}(React.Component));\nvar AddTabButtonWithRouter = withRouter(AddTabButton);\nexport { AddTabButtonWithRouter as AddTabButton };\nvar templateObject_1, templateObject_2;\n","import { __awaiter, __extends, __generator, __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { db } from '../../../globals/db';\nimport { Spinner } from '../../course-builder/sub-components/spinner';\nimport { withRouter } from 'react-router';\nimport { L } from '../../../utils/utils';\nimport { isAdminOrTeacherAtSchool, preserveImpersonationQuery } from '../../../access-control';\nimport env from '../../../globals/KED.env';\nimport { getDraftId } from '../logic/get-draft-id';\nvar ClickableSchoolDivWithRouter = /** @class */ (function (_super) {\n    __extends(ClickableSchoolDivWithRouter, _super);\n    function ClickableSchoolDivWithRouter(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            open: false\n        };\n        return _this;\n    }\n    ClickableSchoolDivWithRouter.prototype.open = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var schools;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.setState({ open: true });\n                        if (!!this.state.schools) return [3 /*break*/, 2];\n                        return [4 /*yield*/, db.schools\n                                .tags(\"primary\")\n                                .map(function (_a) {\n                                var id = _a.id, name = _a.name, displayName = _a.displayName;\n                                return ({ id: id, name: name, displayName: displayName || name || \"<namnlös>\" });\n                            })\n                                .toValue().load()];\n                    case 1:\n                        schools = _a.sent();\n                        this.setState({ schools: schools });\n                        _a.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClickableSchoolDivWithRouter.prototype.close = function () {\n        this.setState({ open: false });\n    };\n    ClickableSchoolDivWithRouter.prototype.selectSchool = function (school) {\n        return __awaiter(this, void 0, void 0, function () {\n            function getRoute() {\n                return __awaiter(this, void 0, void 0, function () {\n                    var otherDraftId, _a;\n                    return __generator(this, function (_b) {\n                        switch (_b.label) {\n                            case 0:\n                                _a = draftId;\n                                if (!_a) return [3 /*break*/, 2];\n                                return [4 /*yield*/, getDraftId(school, courseId).load()];\n                            case 1:\n                                _a = (_b.sent());\n                                _b.label = 2;\n                            case 2:\n                                otherDraftId = _a;\n                                if (taskId && contentId && otherDraftId && (isAdminOrTeacherAtSchool(env.currentUser, school) || canImpersonate)) {\n                                    return [2 /*return*/, \"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tabId || \"$\") + \"/contents/\" + contentId + \"/tasks/\" + taskId + \"/drafts/\" + otherDraftId + \"/edit\"];\n                                }\n                                else if (taskId) {\n                                    return [2 /*return*/, \"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tabId || \"$\") + \"/tasks/\" + taskId];\n                                }\n                                else if (otherDraftId && (isAdminOrTeacherAtSchool(env.currentUser, school) || canImpersonate)) {\n                                    return [2 /*return*/, \"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tabId || \"$\") + \"/drafts/\" + otherDraftId + \"/edit\"];\n                                }\n                                else {\n                                    return [2 /*return*/, \"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tabId || \"$\")];\n                                }\n                                return [2 /*return*/];\n                        }\n                    });\n                });\n            }\n            var _a, match, history, _b, courseId, tabId, draftId, contentId, taskId, canImpersonate, route, baseUrl;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = this.props, match = _a.match, history = _a.history;\n                        _b = match.params, courseId = _b.courseId, tabId = _b.tabId, draftId = _b.draftId, contentId = _b.contentId, taskId = _b.taskId;\n                        canImpersonate = env.currentUser.roles.includes(\"ADMIN\") || // Is admin\n                            location.search.includes('role=');\n                        if (!(school !== this.props.school)) return [3 /*break*/, 2];\n                        return [4 /*yield*/, getRoute()];\n                    case 1:\n                        route = _c.sent();\n                        if (canImpersonate) {\n                            baseUrl = preserveImpersonationQuery(location.pathname, school === 'standard' ?\n                                { role: undefined, school: school } :\n                                { role: \"EMPLOYEE\", school: school });\n                            location.href = baseUrl + \"#\" + route;\n                        }\n                        else {\n                            // Not an admin, just redirect to the route and normal access control will apply\n                            history.push(route);\n                        }\n                        _c.label = 2;\n                    case 2:\n                        this.close();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClickableSchoolDivWithRouter.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, school = _a.school, draftId = _a.draftId, displayName = _a.displayName;\n        var _b = this.state, open = _b.open, schools = _b.schools;\n        return React.createElement(\"div\", { tabIndex: 1, style: { outline: 0 }, onBlur: function () { return _this.close(); } }, !open ? React.createElement(React.Fragment, null,\n            React.createElement(\"h5\", { onClick: function () { return _this.open(); } }, school !== \"standard\" ? (displayName || school) : L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Standard\"], [\"Standard\"])))),\n            draftId && React.createElement(\"p\", { className: \"pageSideText\" }, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Arbetsversion\"], [\"Arbetsversion\"]))))) : !schools ?\n            React.createElement(Spinner, null) : React.createElement(React.Fragment, null,\n            React.createElement(\"h5\", { onClick: function () { return _this.close(); } }, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"V\\u00E4xla skola\"], [\"V\\u00E4xla skola\"])))),\n            React.createElement(\"ul\", null,\n                React.createElement(\"li\", { onClick: function () { return _this.selectSchool(\"standard\"); } }, L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Standard\"], [\"Standard\"])))),\n                schools.filter(function (_a) {\n                    var name = _a.name;\n                    return name !== 'standard';\n                })\n                    .sort(function (a, b) { return a.displayName.localeCompare(b.displayName, [\"sv\", \"en\"]); })\n                    .map(function (_a) {\n                    var id = _a.id, school = _a.name, displayName = _a.displayName;\n                    return React.createElement(\"li\", { key: id, onClick: function () { return _this.selectSchool(school); } }, displayName);\n                }))));\n    };\n    return ClickableSchoolDivWithRouter;\n}(React.Component));\nexport var ClickableSchoolDiv = withRouter(ClickableSchoolDivWithRouter);\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4;\n","import { __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { TwoColumnsPage } from '../common/two-columns-page';\nimport { WeekPlanner } from '../../weekplanner/weekplanner';\nimport env from '../../../globals/KED.env';\nimport cfg from '../../../globals/KED.cfg';\nimport { withRouter } from 'react-router-dom';\nimport { ResourceListView } from './course-contents/resource-list-view';\nimport { LeftCourseArea } from './left-course-area';\nimport { Suspense } from 'react';\nimport { TimeoutEllipsisLoader } from '../../course-builder/sub-components/ellipsis-loader';\nimport { DraftDeltaView } from './version-history/draft-delta-view';\nexport var CourseArea = withRouter(function (_a) {\n    var school = _a.school, courseId = _a.courseId, draftId = _a.draftId, course = _a.course, branch = _a.branch, tabs = _a.tabs, activeTab = _a.activeTab, editMode = _a.editMode, history = _a.history, block = _a.block;\n    var tab = tabs.filter(function (tab) { return tab.id === activeTab; })[0] || tabs[0];\n    var currentTabResources = tab &&\n        branch.courseContents.hasEdgesFrom([tab.id]).filter(function (x) { return x.type === \"resource-list\"; });\n    return React.createElement(TwoColumnsPage, { right: editMode && draftId ?\n            // In edit mode, show the draft edits to the right\n            React.createElement(\"div\", null, tab && React.createElement(Suspense, { fallback: React.createElement(TimeoutEllipsisLoader, null) },\n                React.createElement(DraftDeltaView, { allowCherryPick: school !== 'standard', branchId: draftId, partTagPrefix: course.type === 'step-course' ?\n                        \"blockStep:\" :\n                        \"tab:\", partTag: course.type === 'step-course' ?\n                        \"blockStep:\" + block.id + \":\" + tab.stepNo :\n                        \"tab:\" + tab.id, partLabel: course.type === 'step-course' ? L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"steg \", \"\"], [\"steg \", \"\"])), tab.stepNo) :\n                        tab.name }))) :\n            // In view mode, show WeekPlanner to the right\n            // In view mode, show Resources to the right\n            React.createElement(React.Fragment, null,\n                React.createElement(WeekPlanner, { env: env, viewCourseUrl: cfg.KED_COURSE_VIEWER_URL }),\n                currentTabResources && React.createElement(ResourceListView, { resourceListContents: currentTabResources })), rightWidth: 5, left: React.createElement(Suspense, { fallback: React.createElement(TimeoutEllipsisLoader, null) },\n            React.createElement(LeftCourseArea, { courseId: courseId, editMode: editMode, school: school, course: course, branch: branch, tab: tab, draftId: draftId, block: block, activeTab: activeTab })) });\n});\nvar templateObject_1;\n","import { __awaiter, __extends, __generator, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { L } from '../../../../utils/utils';\nimport { createUUID } from 'kedbackend/client';\nimport { withRouter } from 'react-router';\nimport { isKedStaff } from '../../logic/is-ked-staff';\nimport { computeTaskTagsAndSubject } from '../../logic/compute-task-tags-and-subject';\nvar AddTaskButton = /** @class */ (function (_super) {\n    __extends(AddTaskButton, _super);\n    function AddTaskButton(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            editingName: false,\n            name: \"\"\n        };\n        return _this;\n    }\n    AddTaskButton.prototype.createTask = function (taskName) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, branch, draftId, course, tab, school, content, history, block, learningGoal, _b, tags, subject, newTask;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        this.setState({ editingName: false, name: \"\" });\n                        _a = this.props, branch = _a.branch, draftId = _a.draftId, course = _a.course, tab = _a.tab, school = _a.school, content = _a.content, history = _a.history, block = _a.block, learningGoal = _a.learningGoal;\n                        _b = computeTaskTagsAndSubject(course, tab, block), tags = _b.tags, subject = _b.subject;\n                        newTask = {\n                            id: createUUID(),\n                            tags: tags,\n                            name: taskName,\n                            acl: [\"role:USER:R\", \"schoolRole:\" + school + \"/EMPLOYEE:S\"],\n                            url: \"\",\n                            taskType: 'task',\n                            learningGoal: learningGoal,\n                            futureAbilities: [],\n                            resources: [],\n                            subject: subject\n                        };\n                        branch.courseContents.addRelated(content, \"tasks\", newTask);\n                        return [4 /*yield*/, branch.saveNow()];\n                    case 1:\n                        _c.sent();\n                        history.push(\"/\" + school + \"/courses/\" + course.id + \"/tabs/\" + tab.id + \"/contents/\" + content.id + \"/tasks/\" + newTask.id + \"/drafts/\" + draftId + \"/edit\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AddTaskButton.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, editingName = _a.editingName, name = _a.name;\n        return React.createElement(React.Fragment, null,\n            React.createElement(\"a\", { className: \"btn\", onClick: editingName ? null : function (ev) { return _this.setState({ editingName: true, name: '' }); } },\n                React.createElement(\"i\", { className: \"fas fa-plus\", \"aria-hidden\": \"true\" }),\n                !editingName ?\n                    ' ' + (isKedStaff() ? L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"L\\u00E4gg till uppgift\"], [\"L\\u00E4gg till uppgift\"]))) : L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"L\\u00E4gg till egen uppgift\"], [\"L\\u00E4gg till egen uppgift\"])))) :\n                    React.createElement(\"input\", { type: \"text\", autoFocus: true, placeholder: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Uppgiftens namn\"], [\"Uppgiftens namn\"]))), value: name, size: 50, onChange: function (ev) { return _this.setState({ name: ev.target.value }); }, onKeyPress: function (ev) {\n                            if (ev.key === 'Enter') {\n                                _this.createTask(name);\n                            }\n                        }, onBlur: function () { return _this.setState({ editingName: false }); } })));\n    };\n    return AddTaskButton;\n}(React.Component));\nvar AddTaskButtonWithRouter = withRouter(AddTaskButton);\nexport { AddTaskButtonWithRouter as AddTaskButton };\nvar templateObject_1, templateObject_2, templateObject_3;\n","import { __assign } from \"tslib\";\nimport React from 'react';\nimport { RichTextContentBox } from './rich-text';\nimport { LearningTasksContentBox } from './learning-tasks-content-box';\nimport { EmbeddedHTMLContentBox } from './embedded-html';\nimport { WordBankContentBox } from './word-bank-content-box';\n/*export const ContentBox = ({repo, content}: CourseContentProps)=> (\n  <div className={[\"course-content-box\", \"ked_boxed\"].join(' ')} style={{position: 'relative'}}>\n    <ConcreteComponent {...{repo, content}} />\n    <div style={{position: 'absolute', top: 0, right: 0}}>\n        {moduleOrderedIndex > 0 && <span>\n          <i className=\"fas fa-arrow-circle-up selectable\"\n            aria-hidden=\"true\"\n            onClick={()=>this.props.onReorder(-1)} /> </span>}\n        {moduleOrderedIndex < course.modules.length - 1 && <span>\n          <i className=\"fas fa-arrow-circle-down selectable\"\n            aria-hidden=\"true\"\n            onClick={()=>this.props.onReorder(1)} /> </span>}\n        <RemoveItem\n          title=\"Ta bort modulen\"\n          style={{display: 'inline-block'}}\n          onClick={()=>confirm(L`Ta bort modul ${module.name}?`) && host.update({modules: {$splice: [[moduleIndex, 1]]}})} />\n      </div>\n  </div>\n)*/\nexport function CourseContentBox(_a) {\n    var repo = _a.repo, content = _a.content, siblingContents = _a.siblingContents, editMode = _a.editMode, course = _a.course, draftId = _a.draftId, school = _a.school, courseTab = _a.courseTab, reportNumChars = _a.reportNumChars, maxChars = _a.maxChars, block = _a.block;\n    switch (content.type) {\n        case \"rich-text\": return React.createElement(RichTextContentBox, __assign({}, { repo: repo, content: content, editMode: editMode, reportNumChars: reportNumChars, maxChars: maxChars, course: course }));\n        case \"learning-goals\": return React.createElement(LearningTasksContentBox, __assign({}, {\n            repo: repo,\n            content: content,\n            editMode: editMode,\n            course: course,\n            draftId: draftId,\n            courseTab: courseTab,\n            school: school,\n            block: block\n        }));\n        case \"embedded-html\": return React.createElement(EmbeddedHTMLContentBox, __assign({}, { repo: repo, content: content, editMode: editMode, reportNumChars: reportNumChars, maxChars: maxChars }));\n        case \"word-bank\": return React.createElement(WordBankContentBox, __assign({}, {\n            repo: repo,\n            editMode: editMode,\n            content: content,\n            siblingWordBanks: siblingContents.filter(function (c) { return c.type === 'word-bank' && c.id !== content.id; }),\n            course: course,\n            courseTab: courseTab\n        }));\n        default: return React.createElement(\"p\", null,\n            \"Ok\\u00E4nd inneh\\u00E5llstyp: \",\n            content.type);\n    }\n}\n","import { __makeTemplateObject } from \"tslib\";\nimport { L } from '../../../../utils/utils';\nexport var COURSE_CONTENT_TYPES = {\n    \"rich-text\": L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Textruta\"], [\"Textruta\"]))),\n    \"youtube-movie\": L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Youtube film\"], [\"Youtube film\"]))),\n    \"learning-goals\": L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"L\\u00E4randem\\u00E5l och uppgifter\"], [\"L\\u00E4randem\\u00E5l och uppgifter\"]))),\n    \"resource-list\": L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Resurslista\"], [\"Resurslista\"]))),\n    \"embedded-html\": L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Inb\\u00E4ddad HTML\"], [\"Inb\\u00E4ddad HTML\"]))),\n    \"word-bank\": L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Ordbank\"], [\"Ordbank\"])))\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { isKedStaff } from '../../logic/is-ked-staff';\nimport { L } from '../../../../utils/utils';\nexport var EmbeddedHTMLContentBox = function (_a) {\n    var content = _a.content, repo = _a.repo, editMode = _a.editMode, reportNumChars = _a.reportNumChars, maxChars = _a.maxChars;\n    return editMode && (!content.locked || isKedStaff()) ?\n        React.createElement(\"div\", null,\n            React.createElement(\"h4\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Inb\\u00E4ddat material\"], [\"Inb\\u00E4ddat material\"])))),\n            React.createElement(\"p\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Klipp in HTML kod nedan\"], [\"Klipp in HTML kod nedan\"])))),\n            React.createElement(\"textarea\", { style: { width: \"100%\", height: \"100px\" }, value: content.html, onChange: function (_a) {\n                    var html = _a.target.value;\n                    if (html.length > maxChars)\n                        return;\n                    repo.courseContents.update(content, { html: html });\n                    reportNumChars(html.length);\n                } })) :\n        React.createElement(\"div\", { dangerouslySetInnerHTML: { __html: content.html } });\n};\nvar templateObject_1, templateObject_2;\n","export * from './course-content-types';\nexport * from './content-box';\nexport * from './rich-text';\n","import { __assign, __makeTemplateObject } from \"tslib\";\nimport React from \"react\";\nimport { L } from \"../../../../utils/utils\";\nimport { LearningTasksSettings } from \"./learning-tasks-settings\";\nimport { isKedStaff } from \"../../logic/is-ked-staff\";\nimport { LearningTasksWithCommonGoals } from \"./learning-tasks-with-common-goals\";\nimport { LearningTasksWithSeparateGoals } from \"./learning-tasks-with-separate-goals\";\nexport var LearningTasksContentBox = function (_a) {\n    var content = _a.content, editMode = _a.editMode, repo = _a.repo, course = _a.course, school = _a.school, draftId = _a.draftId, courseTab = _a.courseTab, block = _a.block;\n    var hasCommonLearningGoals = content.hasCommonLearningGoals, commonLearningGoals = content.commonLearningGoals, tasks = content.tasks;\n    var refinedLearningGoals = commonLearningGoals\n        .map(function (goal) { return goal.trim(); })\n        .filter(function (goal) { return !!goal; });\n    // Requirements from KS to make learning tasks editable:\n    // 1. In edit mode, for all theme courses, for teachers, but not for step-courses by default.\n    var isLearningGoalsEditable = editMode &&\n        courseTab.tabClass !== \"mission-tab\" &&\n        (isKedStaff() || course.type === \"theme-course\");\n    return (React.createElement(\"div\", { className: \"ked_boxed\" },\n        isLearningGoalsEditable ? (React.createElement(LearningTasksSettings, { course: course, content: content, repo: repo, tab: courseTab })) : courseTab.tabClass === \"mission-tab\" ? (React.createElement(\"h2\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Uppdrag\"], [\"Uppdrag\"]))))) : course.type === \"theme-course\" ? (React.createElement(\"h2\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Uppgifter\"], [\"Uppgifter\"]))))) : (React.createElement(\"h2\", null, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"L\\u00E4randem\\u00E5l och uppgifter\"], [\"L\\u00E4randem\\u00E5l och uppgifter\"]))))),\n        React.createElement(\"hr\", null),\n        hasCommonLearningGoals && courseTab.tabClass !== \"mission-tab\" ? (React.createElement(LearningTasksWithCommonGoals, __assign({}, {\n            content: content,\n            editMode: editMode,\n            repo: repo,\n            course: course,\n            school: school,\n            draftId: draftId,\n            courseTab: courseTab,\n            block: block,\n            learningGoals: refinedLearningGoals\n        }))) : (React.createElement(LearningTasksWithSeparateGoals, __assign({}, {\n            content: content,\n            editMode: editMode,\n            repo: repo,\n            course: course,\n            school: school,\n            draftId: draftId,\n            courseTab: courseTab,\n            block: block,\n            learningGoals: refinedLearningGoals\n        })))));\n};\nvar templateObject_1, templateObject_2, templateObject_3;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { L } from '../../../../utils/utils';\nimport { AlignHorizontal } from '../../../utility-components/align-horizontal';\nimport { HorizontalItem } from '../../../utility-components/horizontal-item';\nexport var LearningTasksSettings = function (_a) {\n    var tab = _a.tab, content = _a.content, repo = _a.repo;\n    return React.createElement(\"div\", null,\n        React.createElement(\"h2\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"L\\u00E4randem\\u00E5l och uppgifter\"], [\"L\\u00E4randem\\u00E5l och uppgifter\"])))),\n        React.createElement(\"div\", null,\n            React.createElement(AlignHorizontal, null,\n                React.createElement(HorizontalItem, null,\n                    React.createElement(\"input\", { type: \"checkbox\", checked: content.hasCommonLearningGoals, onChange: function (ev) { return repo.courseContents.update(content, { hasCommonLearningGoals: !!ev.target.checked }); } })),\n                React.createElement(HorizontalItem, null,\n                    React.createElement(\"p\", null,\n                        \"\\u00A0\", L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Specificera gemensamma l\\u00E4randem\\u00E5l f\\u00F6r samtliga uppgifter\"], [\"Specificera gemensamma l\\u00E4randem\\u00E5l f\\u00F6r samtliga uppgifter\"]))))))),\n        React.createElement(\"div\", null,\n            React.createElement(\"p\", null, content.hasCommonLearningGoals ? L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Ange de gemensamma l\\u00E4randem\\u00E5len. Ange ett l\\u00E4randem\\u00E5l per rad.\"], [\"Ange de gemensamma l\\u00E4randem\\u00E5len. Ange ett l\\u00E4randem\\u00E5l per rad.\"]))) : L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Ange ett l\\u00E4randem\\u00E5l per rad.\"], [\"Ange ett l\\u00E4randem\\u00E5l per rad.\"])))),\n            React.createElement(\"textarea\", { className: \"learning-goal-box\", value: content.commonLearningGoals.join('\\n'), onChange: function (ev) { return repo.courseContents.update(content, {\n                    commonLearningGoals: ev.target.value.split('\\n')\n                }); } })));\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4;\n","import React from 'react';\nimport { arrayToLookup } from '../../../../utils/utils';\nimport { TaskList } from '../../../course-viewer/subcomponents/task-list';\nimport { AddTaskButton } from './add-task-button';\nimport { SortableTaskList } from '../../../utility-components/sortable-task-list';\nimport { Link } from 'react-router-dom';\nimport { computeUpdatedOrder, getSortedTasks } from '../../logic/task-order';\nexport var LearningTasksWithCommonGoals = function (_a) {\n    var school = _a.school, repo = _a.repo, content = _a.content, draftId = _a.draftId, editMode = _a.editMode, course = _a.course, courseTab = _a.courseTab, learningGoals = _a.learningGoals, block = _a.block;\n    var tasks = getSortedTasks(content);\n    var subjectToTasksLookup = arrayToLookup(tasks, function (t) { return t.subject || \"\"; });\n    var subject = course.type === 'step-course' ?\n        course.subject :\n        courseTab.subject;\n    if (subject && !subjectToTasksLookup[subject.subjectName]) {\n        // Make sure we have at least one subject heading if task list is empty:\n        subjectToTasksLookup[subject.subjectName] = [];\n    }\n    // TODO: Kolla här och i learning-tasks-with-separate-goals.\n    //  * Behövs subject-lookup?\n    //  * Kan vi bryta vy-varianten från edit varianten? (i båda fallen?)\n    // Sedan:\n    //  * Implementera edit varianterna. Lägg till.\n    //  * Implementera sortering funktionalitet i SortableTaskList.\n    //  * I all vyer av tasks (subject planner + courseviewer): \n    //    * Gå igenom alla task i den ordningen dom redan är i\n    //    * \n    return React.createElement(React.Fragment, null, Object.keys(subjectToTasksLookup).map(function (subject) {\n        var taskList = subjectToTasksLookup[subject];\n        var learningModuleTasks = taskList.map(function (task) { return ({\n            id: task.id,\n            name: task.name,\n            url: editMode ?\n                \"#/\" + school + \"/courses/\" + course.id + \"/tabs/\" + courseTab.id + \"/contents/\" + content.id + \"/tasks/\" + task.id + \"/drafts/\" + draftId + \"/edit\" :\n                draftId ?\n                    \"#/\" + school + \"/courses/\" + course.id + \"/tabs/\" + courseTab.id + \"/contents/\" + content.id + \"/tasks/\" + task.id + \"/drafts/\" + draftId :\n                    \"#/\" + school + \"/courses/\" + course.id + \"/tabs/\" + courseTab.id + \"/tasks/\" + task.id,\n            courseName: course.name,\n            learningGoal: subject,\n            step: courseTab.type === 'step-course-tab' ? courseTab.stepNo : undefined,\n            task: task,\n            courseInfo: {\n                school: school,\n                course: course.id,\n                tab: courseTab.id\n            }\n        }); });\n        function linkToTask(task) {\n            return \"/\" + school + \"/courses/\" + course.id + \"/tabs/\" + courseTab.id + \"/contents/\" + content.id + \"/tasks/\" + task.id + \"/drafts/\" + draftId + \"/edit\";\n        }\n        return (React.createElement(\"div\", { key: subject },\n            React.createElement(\"h5\", null, subject),\n            React.createElement(\"ul\", null, course.type === \"step-course\" ? learningGoals.map(function (lg) { return React.createElement(\"li\", { key: lg }, lg); }) : null),\n            !editMode ?\n                React.createElement(TaskList, { learningTasks: learningModuleTasks }) : React.createElement(React.Fragment, null,\n                React.createElement(SortableTaskList, { taskMetas: learningModuleTasks.map(function (_a) {\n                        var task = _a.task;\n                        return ({ task: task, isTaskOwner: true });\n                    }), renderEditLink: function (_a) {\n                        var task = _a.task;\n                        return React.createElement(React.Fragment, null,\n                            React.createElement(Link, { to: linkToTask(task), className: \"editItem\" }),\n                            \"\\u00A0\");\n                    }, renderLink: function (_a) {\n                        var task = _a.task;\n                        return React.createElement(Link, { to: linkToTask(task) }, task.name);\n                    }, onSort: function (source, target, placement) {\n                        var updatedOrder = computeUpdatedOrder(content.tasks, content.taskOrder, source, target, placement, { appendLeftovers: true });\n                        repo.courseContents.update(content, { taskOrder: updatedOrder });\n                    } }),\n                React.createElement(AddTaskButton, { branch: repo, content: content, course: course, school: school, draftId: draftId, tab: courseTab, block: block, learningGoal: \"\" }))));\n    }));\n};\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { L } from '../../../../utils/utils';\nimport { TaskList } from '../../../course-viewer/subcomponents/task-list';\nimport { AddTaskButton } from './add-task-button';\nimport { SortableTaskList } from '../../../utility-components/sortable-task-list';\nimport { Link } from 'react-router-dom';\nimport { computeUpdatedOrder, getSortedTasks } from '../../logic/task-order';\nexport var LearningTasksWithSeparateGoals = function (_a) {\n    var school = _a.school, repo = _a.repo, content = _a.content, draftId = _a.draftId, editMode = _a.editMode, course = _a.course, courseTab = _a.courseTab, learningGoals = _a.learningGoals, block = _a.block;\n    var tasks = getSortedTasks(content);\n    var cathegorizedTasks = {};\n    var goalToTasksLookup = learningGoals.reduce(function (res, goal) {\n        res[goal] = tasks.filter(function (task) {\n            if (task.learningGoal && task.learningGoal.split('\\n')\n                .map(function (line) { return line.trim().toLowerCase(); })\n                .includes(goal.toLowerCase())) {\n                cathegorizedTasks[task.id] = true;\n                return true;\n            }\n        });\n        return res;\n    }, {});\n    var uncathegorizedTasks = tasks.filter(function (t) { return !cathegorizedTasks[t.id]; });\n    if (courseTab.tabClass === 'mission-tab' || tasks.length === 0) {\n        goalToTasksLookup[''] = uncathegorizedTasks;\n    }\n    else if (uncathegorizedTasks.length > 0) {\n        goalToTasksLookup[L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\u00D6vergripande\"], [\"\\u00D6vergripande\"])))] = uncathegorizedTasks;\n    }\n    function linkToTask(task) {\n        return \"/\" + school + \"/courses/\" + course.id + \"/tabs/\" + courseTab.id + \"/contents/\" + content.id + \"/tasks/\" + task.id + \"/drafts/\" + draftId + \"/edit\";\n    }\n    return React.createElement(React.Fragment, null, Object.keys(goalToTasksLookup).map(function (goal) {\n        var taskList = goalToTasksLookup[goal];\n        var learningModuleTasks = taskList.map(function (task) { return ({\n            id: task.id,\n            name: task.name,\n            url: editMode ?\n                \"#/\" + school + \"/courses/\" + course.id + \"/tabs/\" + courseTab.id + \"/contents/\" + content.id + \"/tasks/\" + task.id + \"/drafts/\" + draftId + \"/edit\" :\n                draftId ?\n                    \"#/\" + school + \"/courses/\" + course.id + \"/tabs/\" + courseTab.id + \"/contents/\" + content.id + \"/tasks/\" + task.id + \"/drafts/\" + draftId :\n                    \"#/\" + school + \"/courses/\" + course.id + \"/tabs/\" + courseTab.id + \"/tasks/\" + task.id,\n            courseName: course.name,\n            learningGoal: courseTab.tabClass === 'mission-tab' ? L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Uppdrag\"], [\"Uppdrag\"]))) : goal,\n            step: courseTab.type === 'step-course-tab' ? courseTab.stepNo : undefined,\n            task: task,\n            courseInfo: {\n                school: school,\n                course: course.id,\n                tab: courseTab.id\n            }\n        }); });\n        return (React.createElement(\"div\", { key: goal },\n            goal && React.createElement(\"h4\", null, goal),\n            !editMode ?\n                React.createElement(TaskList, { learningTasks: learningModuleTasks }) :\n                React.createElement(React.Fragment, null,\n                    React.createElement(SortableTaskList, { taskMetas: learningModuleTasks.map(function (_a) {\n                            var task = _a.task;\n                            return ({ task: task, isTaskOwner: true });\n                        }), renderEditLink: function (_a) {\n                            var task = _a.task;\n                            return React.createElement(React.Fragment, null,\n                                React.createElement(Link, { to: linkToTask(task), className: \"editItem\" }),\n                                \"\\u00A0\");\n                        }, renderLink: function (_a) {\n                            var task = _a.task;\n                            return React.createElement(Link, { to: linkToTask(task) }, task.name);\n                        }, onSort: function (source, target, placement) {\n                            var updatedOrder = computeUpdatedOrder(content.tasks, content.taskOrder, source, target, placement, { appendLeftovers: true });\n                            repo.courseContents.update(content, { taskOrder: updatedOrder });\n                        } }),\n                    React.createElement(AddTaskButton, { branch: repo, content: content, course: course, school: school, draftId: draftId, tab: courseTab, block: block, learningGoal: goal }))));\n    }));\n};\nvar templateObject_1, templateObject_2;\n","import React from \"react\";\nimport { liveQueryView } from \"../../../utility-components/live-query-view\";\nimport { flatten, compareProps } from \"../../../../utils/utils\";\nexport var ResourceListView = liveQueryView(function (_a) {\n    var resourceListContents = _a.resourceListContents;\n    return resourceListContents\n        .orderBy(\"order\")\n        .toValue()\n        .map(function (contents) {\n        var resources = flatten(contents.map(function (content) { return content.resources.map(function (val, index) { val.order = val.order == null ? new Date().setHours(index) : val.order; return val; }) || []; }));\n        if (resources.length === 0)\n            return React.createElement(\"div\", null);\n        return (React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"ked_boxed\" },\n                React.createElement(\"h2\", null, \"Resurser\"),\n                React.createElement(\"hr\", null),\n                React.createElement(\"div\", { className: \"taskContainer\" }, resources.sort(compareProps(\"order\")).map(function (res) { return (React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"a\", { href: res.url, target: \"_blank\" }, res.name)))); })))));\n    });\n});\n","import React from 'react';\nimport { Wysiwyg } from '../../../utility-components/wysiwyg';\nimport actions from '../../../utility-components/wysiwyg/actions-sv';\nimport { isKedStaff } from '../../logic/is-ked-staff';\nimport { washHtml } from '../../../utility-components/wysiwyg/wash-html';\nexport var RichTextContentBox = function (_a) {\n    var content = _a.content, repo = _a.repo, editMode = _a.editMode, reportNumChars = _a.reportNumChars, maxChars = _a.maxChars, course = _a.course;\n    return editMode ? React.createElement(\"div\", null,\n        React.createElement(Wysiwyg, { html: content.html, defaultActions: actions, readOnly: !editMode || (content.locked && !isKedStaff() && course.type !== \"theme-course\"), reportNumChars: reportNumChars, maxChars: maxChars, actions: [\n                \"bold\",\n                \"italic\",\n                \"underline\",\n                \"strikethrough\",\n                \"heading2\",\n                \"heading3\",\n                \"olist\",\n                \"ulist\",\n                \"outdent\",\n                \"indent\",\n                \"line\",\n                \"link\",\n                \"image\",\n                \"clear\"\n            ], onChange: editMode && (function (html) { return repo.courseContents.update(content, { html: html }); }) })) : React.createElement(\"div\", null,\n        React.createElement(\"div\", { className: \"rich-text-readonly\", dangerouslySetInnerHTML: { __html: washHtml(content.html) } }));\n};\n","import { __assign, __read } from \"tslib\";\nimport React, { useState, useRef, useEffect } from 'react';\nimport { cfg } from '../../../../globals/KED.cfg';\nimport { WordBankContentSettings } from './word-bank-content-settings';\nimport { TimeoutEllipsisLoader } from '../../../course-builder/sub-components/ellipsis-loader';\nimport { isKedStaff } from '../../logic/is-ked-staff';\nexport function WordBankContentBox(_a) {\n    var repo = _a.repo, content = _a.content, siblingWordBanks = _a.siblingWordBanks, editMode = _a.editMode, course = _a.course, courseTab = _a.courseTab;\n    var selectedWordBank = content.selectedWordBank;\n    var subjectName = course.subject.subjectName;\n    var stepNo = courseTab.stepNo;\n    var iframeSrc = selectedWordBank && cfg.KED_WORDBANKS_URL + \"?preview=true&subject=\" + subjectName + \"&step=\" + stepNo + \"&list=\" + selectedWordBank.key;\n    var _b = __read(useState(200), 2), iframeHeight = _b[0], setIframeHeight = _b[1];\n    var iframeRef = useRef();\n    var wordBanksAlreadyAdded = siblingWordBanks.map(function (c) { return c.selectedWordBank && c.selectedWordBank.key; })\n        .filter(function (key) { return !!key; });\n    useEffect(function () { return setIframeHeight(200); }, [selectedWordBank && selectedWordBank.key]); // Reset iframe height whenever selected word bank changes and let onload fix it.\n    return React.createElement(React.Fragment, null,\n        editMode && (!content.locked || isKedStaff()) && React.createElement(React.Suspense, { fallback: React.createElement(TimeoutEllipsisLoader, null) },\n            React.createElement(WordBankContentSettings, __assign({}, { subjectName: subjectName, stepNo: stepNo, wordBanksAlreadyAdded: wordBanksAlreadyAdded }, { selectedWordBank: selectedWordBank, onChange: function (_a) {\n                    var name = _a.name, key = _a.key;\n                    repo.courseContents.update(content, { selectedWordBank: { name: name, key: key } });\n                } }))),\n        selectedWordBank &&\n            React.createElement(\"iframe\", { ref: iframeRef, scrolling: \"no\", frameBorder: \"0\", style: {\n                    width: \"100%\",\n                    height: iframeHeight,\n                    padding: 0,\n                    margin: 0\n                }, src: iframeSrc, onLoad: function () {\n                    setIframeHeight(iframeRef.current.contentWindow.document.body.scrollHeight);\n                } }));\n}\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { cfg } from '../../../../globals/KED.cfg';\nimport useFetch from 'fetch-suspense';\nimport { L } from '../../../../utils/utils';\nimport Select from 'react-select';\nexport function WordBankContentSettings(_a) {\n    var subjectName = _a.subjectName, stepNo = _a.stepNo, selectedWordBank = _a.selectedWordBank, wordBanksAlreadyAdded = _a.wordBanksAlreadyAdded, onChange = _a.onChange;\n    var apiUrl = cfg.KED_ENUM_WORDBANKS_URL + \"?sv.contenttype=application/json&subject=\" + subjectName + \"&step=\" + stepNo;\n    var availableWordBanks = useFetch(apiUrl);\n    // Filter out word banks that was already added to the same tab\n    availableWordBanks = availableWordBanks.filter(function (_a) {\n        var order = _a.order;\n        return (selectedWordBank && order === selectedWordBank.key) ||\n            !wordBanksAlreadyAdded ||\n            !wordBanksAlreadyAdded.includes(order);\n    });\n    return React.createElement(\"div\", null,\n        React.createElement(\"h3\", null, selectedWordBank ? selectedWordBank.name : L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"V\\u00E4lj ordbank\"], [\"V\\u00E4lj ordbank\"])))),\n        React.createElement(Select, { isMulti: false, placeholder: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"V\\u00E4lj bland ordbanker f\\u00F6r \", \", steg \", \"\"], [\"V\\u00E4lj bland ordbanker f\\u00F6r \", \", steg \", \"\"])), subjectName, stepNo), noOptionsMessage: function () { return L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Kunde inte hitta tillg\\u00E4ngliga ordbanker f\\u00F6r \", \", steg \", \"\"], [\"Kunde inte hitta tillg\\u00E4ngliga ordbanker f\\u00F6r \", \", steg \", \"\"])), subjectName, stepNo); }, options: availableWordBanks.map(function (_a) {\n                var name = _a.name, id = _a.id, order = _a.order, url = _a.url;\n                return ({ label: name, value: order });\n            }), value: selectedWordBank && { label: selectedWordBank.name, value: selectedWordBank.key }, onChange: function (option) { return onChange({ name: option.label, key: option.value }); } }));\n}\nvar templateObject_1, templateObject_2, templateObject_3;\n","import { __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { compareProp, L } from '../../../utils/utils';\nimport { AddContentButton } from './add-content-button';\nimport { isKedStaff } from '../logic/is-ked-staff';\nimport { TabSettings } from './tab-settings';\nimport { CourseTabContentBox } from './course-tab-content-box';\nimport { TabSettingsAdmin } from './tab-settings-admin';\nimport { ResourceEditor } from './resource-editor';\nimport { ExtraPageButtons } from '../../utility-components/extra-page-buttons';\nexport var CourseTabArea = function (_a) {\n    var course = _a.course, branch = _a.branch, block = _a.block, tab = _a.tab, editMode = _a.editMode, contents = _a.contents, school = _a.school, draftId = _a.draftId;\n    if (!tab) {\n        if (editMode)\n            return React.createElement(\"p\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Denna kurs saknar inneh\\u00E5ll. Skapa ny flik genom knappen ovan\"], [\"Denna kurs saknar inneh\\u00E5ll. Skapa ny flik genom knappen ovan\"]))));\n        else\n            return isKedStaff() ?\n                React.createElement(\"p\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Denna kurs saknar inneh\\u00E5ll. V\\u00E4lj Redigera knappen f\\u00F6r att l\\u00E4gga till flikar.\"], [\"Denna kurs saknar inneh\\u00E5ll. V\\u00E4lj Redigera knappen f\\u00F6r att l\\u00E4gga till flikar.\"])))) :\n                React.createElement(\"p\", null, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Denna kurs saknar inneh\\u00E5ll.\"], [\"Denna kurs saknar inneh\\u00E5ll.\"]))));\n    }\n    contents = contents.slice().sort(compareProp(\"order\"));\n    return React.createElement(\"div\", null,\n        editMode ? React.createElement(React.Fragment, null,\n            isKedStaff() || !tab.locked ?\n                React.createElement(TabSettings, { course: course, tab: tab, repo: branch }) :\n                null,\n            isKedStaff() ?\n                React.createElement(TabSettingsAdmin, { course: course, tab: tab, repo: branch, block: block }) :\n                null) : React.createElement(ExtraPageButtons, null),\n        contents.filter(function (c) { return c.type !== \"resource-list\"; }).map(function (content, contentOrderIndex) { return React.createElement(CourseTabContentBox, { key: content.id, content: content, branch: branch, contentOrderIndex: contentOrderIndex, contents: contents, course: course, draftId: draftId, editMode: editMode, school: school, block: block, tab: tab }); }),\n        !!editMode && React.createElement(ResourceEditor, { schoolName: school, courseId: course.id, tab: tab, repo: branch, contents: contents, block: block }),\n        !!editMode && (isKedStaff() || !tab.locked) && React.createElement(React.Fragment, null,\n            tab.tabClass === 'word-bank-tab' &&\n                // [ Add Word Bank ] button\n                React.createElement(AddContentButton, { type: \"word-bank\", tab: tab, branch: branch, course: course, schoolName: school, courseBlock: block }),\n            tab.tabClass !== 'word-bank-tab' &&\n                (tab.tabClass === 'mission-tab' || tab.tabClass === 'subject-tab' || course.type === 'step-course') &&\n                !contents.some(function (c) { return c.type === 'learning-goals'; }) &&\n                // [ Add Learning Goals ] button\n                React.createElement(AddContentButton, { type: \"learning-goals\", tab: tab, branch: branch, course: course, schoolName: school, courseBlock: block }),\n            React.createElement(AddContentButton, { type: \"rich-text\", tab: tab, branch: branch, course: course, schoolName: school, courseBlock: block }),\n            tab.tabClass === 'intro-tab' || tab.tabClass === 'run-up-tab' &&\n                // [ Add Embedded HTML ] button\n                React.createElement(AddContentButton, { type: \"embedded-html\", tab: tab, branch: branch, course: course, schoolName: school, courseBlock: block })));\n};\nvar templateObject_1, templateObject_2, templateObject_3;\n","import { __extends, __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { isKedStaff } from '../logic/is-ked-staff';\nimport { CourseContentBox, COURSE_CONTENT_TYPES } from './course-contents';\nimport { AlignHorizontal } from '../../utility-components/align-horizontal';\nimport { HorizontalItem } from '../../utility-components/horizontal-item';\nimport { L } from '../../../utils/utils';\nimport { RemoveItem } from '../../course-builder/sub-components/remove-item';\nimport { Emitter } from 'kedbackend/observable';\nimport { LazyContent } from '../../utility-components/lazy-content';\nimport { reorder } from '../logic/change-sort-order';\nimport { FieldLimits } from '../common/field-limits';\nvar MAX_CHARS_IN_CONTENTS = FieldLimits.MAX_CHARS_IN_CONTENTS;\nvar CourseTabContentBox = /** @class */ (function (_super) {\n    __extends(CourseTabContentBox, _super);\n    function CourseTabContentBox(props) {\n        var _this = _super.call(this, props) || this;\n        _this.numCharsObservable = new Emitter(0); // Dedicated state for a sub-part of the generated DOM (avoid infinite loop)\n        _this.state = {\n        //numChars: 0\n        };\n        return _this;\n    }\n    CourseTabContentBox.prototype.render = function () {\n        var _a = this.props, editMode = _a.editMode, content = _a.content, branch = _a.branch, course = _a.course, tab = _a.tab, school = _a.school, draftId = _a.draftId, contentOrderIndex = _a.contentOrderIndex, contents = _a.contents, block = _a.block;\n        var kedStaff = isKedStaff();\n        //theme courses learning goals and rich text should be always enabled\n        var contentEditAlwaysEnabled = editMode && tab.tabClass !== \"mission-tab\" && course.type === \"theme-course\"\n            && (content.type === 'learning-goals' || content.type === 'rich-text');\n        //step courses learning goals should be always unchecked and disabled\n        var stepCourseLearningGoalDisabled = course.type === \"step-course\" && content.type === 'learning-goals';\n        //const { numChars } = this.state;\n        var numCharsObservable = this.numCharsObservable;\n        return !editMode || (content.locked && !kedStaff) ?\n            //\n            // Not edit mode:\n            //\n            React.createElement(CourseContentBox, { key: content.id, repo: branch, content: content, siblingContents: contents, course: course, editMode: editMode, courseTab: tab, school: school, draftId: draftId, block: block }) :\n            //\n            // Edit mode:\n            //\n            React.createElement(\"div\", { key: content.id, className: [\"course-content-box\", content.type !== 'learning-goals' && \"ked_boxed\"].filter(function (x) { return !!x; }).join(' '), style: { position: 'relative' } },\n                React.createElement(AlignHorizontal, null,\n                    React.createElement(HorizontalItem, null,\n                        React.createElement(\"p\", { className: \"box-mini-label\" }, COURSE_CONTENT_TYPES[content.type])),\n                    React.createElement(HorizontalItem, null, kedStaff ?\n                        React.createElement(React.Fragment, null,\n                            \"\\u00A0\",\n                            React.createElement(\"input\", { type: \"checkbox\", checked: !stepCourseLearningGoalDisabled && !content.locked || contentEditAlwaysEnabled, disabled: contentEditAlwaysEnabled || stepCourseLearningGoalDisabled, onChange: function (ev) { return branch.courseContents.update(content, { locked: !ev.target.checked }); } }), L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Till\\u00E5t redigering\"], [\"Till\\u00E5t redigering\"]))),\n                            !stepCourseLearningGoalDisabled && !content.locked || contentEditAlwaysEnabled ? React.createElement(React.Fragment, null,\n                                \"\\u00A0\",\n                                React.createElement(\"input\", { type: \"checkbox\", checked: !content.lockDelete, onChange: function (ev) { return branch.courseContents.update(content, { lockDelete: !ev.target.checked }); } }), L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Till\\u00E5t d\\u00F6lja rutan\"], [\"Till\\u00E5t d\\u00F6lja rutan\"])))) : null) : null)),\n                React.createElement(CourseContentBox, { repo: branch, content: content, siblingContents: contents, course: course, editMode: true, school: school, draftId: draftId, courseTab: tab, maxChars: MAX_CHARS_IN_CONTENTS, reportNumChars: function (numChars) {\n                        // Avoid setting state because it turns out to be infinite loop.\n                        // (setState() leads to re-render of this whole component, leading to\n                        // re-render of CourseContentBox, that calls reportNumChars etc...)\n                        // Instead we communicate this particular state to a dedicated Observable\n                        // that will only update the particular component that is affected by it.\n                        numCharsObservable.dispatch(numChars);\n                        //this.setState({ numChars });\n                    }, block: block }),\n                React.createElement(\"div\", { style: { position: 'absolute', top: 0, right: 0 } },\n                    (kedStaff || !content.locked) && contentOrderIndex > 0 && React.createElement(\"span\", null,\n                        React.createElement(\"i\", { className: \"fas fa-arrow-circle-up selectable\", \"aria-hidden\": \"true\", onClick: function () {\n                                var newOrder = reorder(contents, content.id, contents[contentOrderIndex - 1].id, \"before\");\n                                if (newOrder) {\n                                    branch.courseContents.update(content, { order: newOrder });\n                                }\n                            } }),\n                        \" \"),\n                    (kedStaff || !content.locked) && contentOrderIndex < contents.length - 1 && React.createElement(\"span\", null,\n                        React.createElement(\"i\", { className: \"fas fa-arrow-circle-down selectable\", \"aria-hidden\": \"true\", onClick: function () {\n                                var newOrder = reorder(contents, content.id, contents[contentOrderIndex + 1].id, \"after\");\n                                if (newOrder) {\n                                    branch.courseContents.update(content, { order: newOrder });\n                                }\n                            } }),\n                        \" \"),\n                    kedStaff || !content.lockDelete ? React.createElement(RemoveItem, { title: school === 'standard' ? L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Ta bort inneh\\u00E5llsrutan\"], [\"Ta bort inneh\\u00E5llsrutan\"]))) : L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"D\\u00F6lj inneh\\u00E5llsrutan\"], [\"D\\u00F6lj inneh\\u00E5llsrutan\"]))), style: { display: 'inline-block' }, onClick: function () { return confirm(L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Ta bort inneh\\u00E5ll?\"], [\"Ta bort inneh\\u00E5ll?\"])))) && branch.courseTabs.removeRelated(tab, \"contents\", content); } })\n                        : null),\n                content.type === 'rich-text' ? React.createElement(LazyContent, null, numCharsObservable.map(function (numChars) {\n                    return React.createElement(\"div\", { className: [\"char-counter-bottom\"].concat(numChars >= MAX_CHARS_IN_CONTENTS ? \"overflowed\" : []).join(' ') }, L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Texten inneh\\u00E5ller \", \" av max \", \" till\\u00E5tna tecken\"], [\"Texten inneh\\u00E5ller \", \" av max \", \" till\\u00E5tna tecken\"])), numChars, MAX_CHARS_IN_CONTENTS));\n                })) :\n                    undefined);\n    };\n    return CourseTabContentBox;\n}(React.Component));\nexport { CourseTabContentBox };\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6;\n","import { __makeTemplateObject } from \"tslib\";\nimport { L } from '../../../../utils/utils';\nexport var CourseTabClasses = {\n    \"intro-tab\": L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Introduktionsflik\"], [\"Introduktionsflik\"]))),\n    \"run-up-tab\": L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Upptaktsflik\"], [\"Upptaktsflik\"]))),\n    \"subject-tab\": L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"\\u00C4mnesflik\"], [\"\\u00C4mnesflik\"]))),\n    \"mission-tab\": L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Uppdragsflik\"], [\"Uppdragsflik\"]))),\n    \"content-tab\": L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Generell flik\"], [\"Generell flik\"]))),\n    \"teacher-tab\": L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"L\\u00E4rarsida\"], [\"L\\u00E4rarsida\"]))),\n    \"word-bank-tab\": L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"Ordbank\"], [\"Ordbank\"])))\n};\nexport var TabTypesPerCourseType = {\n    \"step-course\": [\n        \"content-tab\",\n        \"intro-tab\",\n        \"teacher-tab\",\n        \"word-bank-tab\"\n    ],\n    \"theme-course\": [\n        \"content-tab\",\n        \"run-up-tab\",\n        \"subject-tab\",\n        \"mission-tab\",\n        \"teacher-tab\"\n    ]\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7;\n","import { __assign, __awaiter, __generator, __makeTemplateObject, __read } from \"tslib\";\nimport * as React from 'react';\nimport { db } from '../../../globals/db';\nimport { LazyBanner } from '../common/banner';\nimport { Emitter } from 'kedbackend/observable';\nimport { L, compareProp, compareProps, flatten, arrayToMap } from '../../../utils/utils';\nimport cfg from '../../../globals/KED.cfg';\nimport { preserveImpersonationQuery } from '../../../access-control';\nimport { AddTabButton } from './add-tab-button';\nimport { withRouter } from 'react-router';\nimport { CourseArea } from './course-area';\nimport { TaskEditor } from './task/task-editor';\nimport { ClickableSchoolDiv } from './clickable-school-div';\nimport { isEmployee } from '../logic/is-employee';\nimport { TaskViewerPage } from './task/viewer/task-viewer-page';\nimport { isKedStaff } from '../logic/is-ked-staff';\nimport { LazyContent } from '../../utility-components/lazy-content';\nimport { reorder } from '../logic/change-sort-order';\nimport { useEffect } from 'react';\nimport { features } from '../../../features';\nexport var CourseViewerPage = withRouter((function (_a) {\n    var school = _a.school, courseId = _a.courseId, activeTab = _a.activeTab, draftId = _a.draftId, editMode = _a.editMode, history = _a.history, contentId = _a.contentId, taskId = _a.taskId;\n    // Store the current page in local storage when it changes:\n    useEffect(function () {\n        if (courseId) {\n            localStorage.setItem(\"subjectPlannerLastCourse\", courseId);\n            if (activeTab && activeTab !== '$' && activeTab !== 'undefined') {\n                localStorage.setItem(\"subjectPlannerLastTab:\" + courseId, activeTab);\n            }\n            else {\n                localStorage.removeItem(\"subjectPlannerLastTab:\" + courseId);\n            }\n        }\n    }, [courseId, activeTab, contentId, taskId]);\n    var repo = editMode ?\n        db : // In edit mode, do not optimize cache, as it prohibits collaboration\n        db.optimizeCache();\n    var schoolObservable = repo.schools.name(school).single();\n    var branchObservable = draftId ? // In edit mode, draftId is defined.\n        new Emitter(repo.branch(draftId)) :\n        schoolObservable.map(function (school) { return repo.branch(school.officialBranchId); });\n    var courseObservable = branchObservable.switchMap(function (branch) {\n        return branch.courseInstances.include(\"blocks\", \"tabs\").id(courseId);\n    });\n    var intermediateObservableUnsorted = courseObservable.combineLatest(schoolObservable)\n        .switchMap(function (_a) {\n        var _b = __read(_a, 2), course = _b[0], schoolEntity = _b[1];\n        var branch = draftId ?\n            repo.branch(draftId) :\n            repo.branch(schoolEntity.officialBranchId);\n        // Retrieve deltas to point out modified tabs\n        var modifiedItemsObservable = (editMode && features.KDT592) ?\n            branch.deltas.toValue().map(function (deltas) {\n                var allTags = flatten(deltas.map(function (delta) {\n                    return delta.type === 'modify' ?\n                        (delta.targetTags || []) :\n                        (delta.sourceTags || []).concat(delta.targetTags || []);\n                }));\n                return arrayToMap(allTags, function (t) { return t; });\n            }) :\n            new Emitter({});\n        if (course.type === 'theme-course') {\n            var result_1 = { course: course, tabs: course.tabs, branch: branch, block: null, schoolEntity: schoolEntity };\n            // Retrieve deltas to point out modified tabs\n            return modifiedItemsObservable.map(function (modifiedItems) { return (__assign(__assign({}, result_1), { modifiedItems: modifiedItems })); });\n        }\n        if (activeTab && activeTab !== '$')\n            return branch.courseBlocks.hasEdgesTo([activeTab]).include(\"tabs\").toValue()\n                .combineLatest(modifiedItemsObservable)\n                .map(function (_a) {\n                var _b = __read(_a, 2), _c = __read(_b[0], 1), block = _c[0], modifiedItems = _b[1];\n                return ({\n                    course: course,\n                    tabs: block ? block.tabs : [],\n                    branch: branch,\n                    block: block || course.blocks[0],\n                    schoolEntity: schoolEntity,\n                    modifiedItems: modifiedItems\n                });\n            });\n        if (course.blocks.length > 0)\n            return branch.courseBlocks.include(\"tabs\").id(course.blocks[0].id)\n                .combineLatest(modifiedItemsObservable)\n                .map(function (_a) {\n                var _b = __read(_a, 2), block = _b[0], modifiedItems = _b[1];\n                return ({\n                    course: course,\n                    tabs: block.tabs,\n                    branch: branch,\n                    block: block,\n                    schoolEntity: schoolEntity,\n                    modifiedItems: modifiedItems\n                });\n            });\n        return new Emitter({ course: course, tabs: [], branch: branch, block: null, schoolEntity: schoolEntity });\n    });\n    var intermediateObservable = intermediateObservableUnsorted.map(function (vals) { return (__assign(__assign({}, vals), { tabs: vals.tabs && vals.tabs.sort(compareProps([\"stepNo\", \"order\"])) })); });\n    var bannerPropsObservable = intermediateObservable\n        .map(function (_a) {\n        var course = _a.course, tabs = _a.tabs, branch = _a.branch, block = _a.block, schoolEntity = _a.schoolEntity, modifiedItems = _a.modifiedItems;\n        return getCourseBannerProps(tabs, editMode, school, schoolEntity, draftId, course, branch, activeTab, block, modifiedItems);\n    });\n    return React.createElement(React.Fragment, null,\n        React.createElement(LazyBanner, { lazyProps: bannerPropsObservable }),\n        taskId ? editMode ?\n            React.createElement(LazyContent, null, intermediateObservable.map(function (_a) {\n                var branch = _a.branch, block = _a.block, course = _a.course, tabs = _a.tabs;\n                return React.createElement(TaskEditor, { school: school, course: course, draftId: draftId, branch: branch, activeTab: activeTab, contentId: contentId, taskId: taskId, blockId: block && block.id, tabs: tabs });\n            })) :\n            React.createElement(TaskViewerPage, { school: school, courseId: courseId, lazyRepo: branchObservable, activeTab: activeTab, taskId: taskId, contentId: contentId, draftId: draftId }) :\n            React.createElement(LazyContent, null, intermediateObservable.map(function (_a) {\n                var branch = _a.branch, block = _a.block, course = _a.course, tabs = _a.tabs;\n                return React.createElement(CourseArea, { school: school, courseId: courseId, draftId: draftId, course: course, branch: branch, tabs: tabs, activeTab: activeTab, editMode: editMode, block: block });\n            })));\n}));\nfunction getCourseBannerProps(tabs, editMode, school, schoolEntity, draftId, course, branch, activeTab, block, modifiedItems) {\n    var _this = this;\n    var kedStaff = isKedStaff();\n    var courseId = course.id;\n    var activeTabObj = tabs.filter(function (tab) { return tab.id === activeTab; })[0] || tabs[0];\n    if (course.type === 'step-course' && activeTabObj && activeTabObj.type === 'step-course-tab') {\n        tabs = tabs.filter(function (tab) { return tab.type === 'step-course-tab' && tab.stepNo === activeTabObj.stepNo; });\n    }\n    var bannerTabs = (editMode ? tabs : isEmployee() ? tabs.filter(function (tab) { return !tab.hidden; }) : tabs.filter(function (tab) { return !tab.hidden && tab.tabClass !== 'teacher-tab'; }))\n        .map(function (tab) { return ({\n        key: tab.id,\n        hidden: tab.hidden,\n        name: tab.tabTitle,\n        draggable: true,\n        link: editMode ?\n            \"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + tab.id + (draftId ? \"/drafts/\" + draftId : '') + \"/edit\" :\n            \"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + tab.id + (draftId ? \"/drafts/\" + draftId : '')\n    }); });\n    var buttons = [];\n    if (editMode && (kedStaff || course.allowAddTabs)) {\n        if (course.type === 'theme-course') {\n            buttons.push(React.createElement(AddTabButton, { type: \"theme-course-tab\", key: \"$addTab\", school: school, course: course, branch: branch, draftId: draftId }));\n        }\n        else {\n            var stepNo = activeTabObj ?\n                activeTabObj.stepNo :\n                block.stepNumbers[0] || 1;\n            buttons.push(React.createElement(AddTabButton, { type: \"step-course-tab\", key: \"$addTab\", school: school, course: course, branch: branch, draftId: draftId, block: block, stepNo: stepNo }));\n        }\n    }\n    if (kedStaff) {\n        // Remove the \"role\" attribute from query, as we want to stop impersonating an Employee when using the admin interface\n        buttons.push(React.createElement(\"a\", { href: preserveImpersonationQuery(cfg.KED_SUBJECT_PLANNER_ADMIN_URL, { role: undefined }) +\n                (\"#/admin/courses/\" + courseId + \"/settings\"), key: \"$settings\", title: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Inst\\u00E4llningar\"], [\"Inst\\u00E4llningar\"]))) },\n            React.createElement(\"i\", { className: \"fas fa-cog\", \"aria-hidden\": true }),\n            \"\\u00A0\"));\n    }\n    var bannerProps = {\n        title: course.name,\n        backgroundImage: null,\n        tabs: bannerTabs,\n        cornerBox: React.createElement(ClickableSchoolDiv, { school: school, draftId: draftId, displayName: schoolEntity.displayName || school }),\n        buttons: buttons,\n        activeTab: activeTab || (bannerTabs[0] && bannerTabs[0].key),\n        blocks: course.blocks && course.blocks.sort(compareProp(\"blockNo\")).map(function (_a) {\n            var blockId = _a.id, name = _a.name, stepNumbers = _a.stepNumbers;\n            return ({\n                id: blockId,\n                name: name,\n                steps: stepNumbers.map(function (stepNo) { return ({\n                    isActive: activeTabObj && stepNo === activeTabObj.stepNo,\n                    stepNo: stepNo,\n                    link: \"/\" + school + \"/courses/\" + courseId + \"/blocks/\" + blockId + \"/steps/\" + stepNo + (draftId ? \"/drafts/\" + draftId : '') + (editMode ? '/edit' : '')\n                }); })\n            });\n        }),\n        sortableTabs: editMode && (kedStaff || course.allowReorderTabs),\n        modifiedItems: modifiedItems,\n        onTabDrop: function (source, target, placement) { return __awaiter(_this, void 0, void 0, function () {\n            var newOrder, sourceTab;\n            return __generator(this, function (_a) {\n                newOrder = reorder(tabs, source, target, placement);\n                if (newOrder) {\n                    sourceTab = tabs.find(function (t) { return t.id === source; });\n                    if (sourceTab) {\n                        branch.courseTabs.update(sourceTab, { order: newOrder });\n                    }\n                }\n                return [2 /*return*/];\n            });\n        }); }\n    };\n    return bannerProps;\n}\nvar templateObject_1;\n","import { __awaiter, __generator, __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { L, showInfo } from '../../../utils/utils';\nimport { withRouter } from 'react-router';\nimport { db } from '../../../globals/db';\nimport { publishCoursePart, publishEntireCourse } from '../logic/publish-course';\nimport { HorizontalItem } from '../../utility-components/horizontal-item';\nimport { AlignHorizontal } from '../../utility-components/align-horizontal';\nimport { isKedStaff } from '../logic/is-ked-staff';\nimport { features } from '../../../features';\nvar ToggleHiddenTabButton = function (_a) {\n    var _b = _a.repo, repo = _b === void 0 ? null : _b, _c = _a.tab, tab = _c === void 0 ? null : _c;\n    return React.createElement(\"div\", { className: \"btn pull-right\", onClick: function (ev) { return repo.courseTabs.update(tab, { hidden: !tab.hidden }); } }, tab.hidden ? L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Visa fliken\"], [\"Visa fliken\"]))) : L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"D\\u00F6lj fliken\"], [\"D\\u00F6lj fliken\"]))));\n};\nexport var EditorFooterButtons = withRouter(function (_a) {\n    var school = _a.school, course = _a.course, tab = _a.tab, activeTab = _a.activeTab, draftId = _a.draftId, history = _a.history, courseType = _a.courseType, block = _a.block;\n    return React.createElement(React.Fragment, null,\n        tab && (isKedStaff() || !tab.locked || course.allowRemoveTabs) && (school !== \"standard\" ?\n            // Toggle hide/show\n            React.createElement(ToggleHiddenTabButton, { repo: db.branch(draftId), tab: tab }) :\n            // Delete button\n            React.createElement(\"div\", { className: \"btn btn-warning pull-right\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                    var draftRepo, courseTab, contents;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                draftRepo = db.branch(draftId);\n                                return [4 /*yield*/, draftRepo.courseTabs\n                                        .include(\"contents\")\n                                        .includeIdsOnly()\n                                        .id(activeTab)\n                                        .load()];\n                            case 1:\n                                courseTab = _a.sent();\n                                return [4 /*yield*/, draftRepo.courseContents\n                                        .include(\"tasks\")\n                                        .includeIdsOnly()\n                                        .ids(courseTab.contents.map(function (_a) {\n                                        var id = _a.id;\n                                        return id;\n                                    }))\n                                        .toValue().load()];\n                            case 2:\n                                contents = _a.sent();\n                                contents.forEach(function (content) {\n                                    content.tasks.forEach(function (task) {\n                                        draftRepo.courseContents.removeRelated(content, \"tasks\", task);\n                                    });\n                                });\n                                courseTab.contents.forEach(function (content) {\n                                    draftRepo.courseTabs.removeRelated(courseTab, \"contents\", content);\n                                });\n                                if (courseType === 'theme-course') {\n                                    draftRepo.courseInstances.removeRelated(course, \"tabs\", courseTab);\n                                }\n                                else if (block) {\n                                    draftRepo.courseBlocks.removeRelated(block, \"tabs\", courseTab);\n                                }\n                                return [4 /*yield*/, db.saveNow()];\n                            case 3:\n                                _a.sent();\n                                history.push(\"/\" + school + \"/courses/\" + course.id + \"/tabs/$/drafts/\" + draftId + \"/edit\");\n                                return [2 /*return*/];\n                        }\n                    });\n                }); } },\n                React.createElement(\"i\", { className: \"fas fa-trash-alt\", \"aria-hidden\": true }),\n                \"\\u00A0\", L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Ta bort fliken\"], [\"Ta bort fliken\"]))))),\n        React.createElement(\"div\", null,\n            React.createElement(AlignHorizontal, null,\n                React.createElement(HorizontalItem, null,\n                    React.createElement(\"button\", { className: \"btn\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                history.push(\"/\" + school + \"/courses/\" + course.id + \"/tabs/\" + (activeTab || '$') + \"/drafts/\" + draftId);\n                                return [2 /*return*/];\n                            });\n                        }); } },\n                        React.createElement(\"i\", { className: \"fas fa-eye\", \"aria-hidden\": true }),\n                        \"\\u00A0\", L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"F\\u00F6rhandsgranska\"], [\"F\\u00F6rhandsgranska\"]))))),\n                React.createElement(HorizontalItem, null,\n                    \"\\u00A0\",\n                    React.createElement(\"button\", { className: \"btn\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                history.push(\"/\" + school + \"/courses/\" + course.id + \"/history\");\n                                return [2 /*return*/];\n                            });\n                        }); } },\n                        React.createElement(\"i\", { className: \"fas fa-history\", \"aria-hidden\": true }),\n                        \"\\u00A0\", L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Versionshistorik\"], [\"Versionshistorik\"]))))),\n                React.createElement(HorizontalItem, null,\n                    \"\\u00A0\",\n                    React.createElement(\"button\", { className: \"btn btn-warning\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        if (!features.KDT592) return [3 /*break*/, 3];\n                                        return [4 /*yield*/, publishCoursePart({\n                                                school: school,\n                                                course: course,\n                                                tab: tab,\n                                                draftRepo: db.branch(draftId)\n                                            })];\n                                    case 1:\n                                        _a.sent();\n                                        return [4 /*yield*/, db.saveNow()];\n                                    case 2:\n                                        _a.sent();\n                                        showInfo(L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"\\u00C4ndringarna publicerades.\"], [\"\\u00C4ndringarna publicerades.\"]))));\n                                        return [3 /*break*/, 6];\n                                    case 3: \n                                    // This code path should be removed after week 44/2019\n                                    // It just acts as before KDT592\n                                    return [4 /*yield*/, publishEntireCourse({ school: school, course: course, draftRepo: db.branch(draftId) })];\n                                    case 4:\n                                        // This code path should be removed after week 44/2019\n                                        // It just acts as before KDT592\n                                        _a.sent();\n                                        return [4 /*yield*/, db.saveNow()];\n                                    case 5:\n                                        _a.sent();\n                                        history.push(\"/\" + school + \"/courses/\" + course.id + \"/tabs/\" + (activeTab || '$'));\n                                        _a.label = 6;\n                                    case 6: return [2 /*return*/];\n                                }\n                            });\n                        }); } },\n                        React.createElement(\"i\", { className: \"fas fa-play\", \"aria-hidden\": true }),\n                        \"\\u00A0\", L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"Publicera\"], [\"Publicera\"]))))))),\n        React.createElement(\"br\", null),\n        React.createElement(\"button\", { className: \"btn\", onClick: function () {\n                return history.push(\"/\" + school + \"/courses/\" + course.id + \"/tabs/\" + (activeTab || '$'));\n            } },\n            React.createElement(\"i\", { className: \"fas fa-arrow-left\", \"aria-hidden\": true }),\n            \"\\u00A0\", L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"Avsluta redigering\"], [\"Avsluta redigering\"])))));\n});\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8;\n","import { __makeTemplateObject, __read } from \"tslib\";\nimport * as React from 'react';\nimport { HashRouter as Router, Route, Redirect } from 'react-router-dom';\nimport { ErrorSuccessFeedback } from '../../../utils/error-success-feedback';\nimport { Banner } from '../common/banner';\nimport { liveQueryView } from '../../utility-components/live-query-view';\nimport { Schools, db } from '../../../globals/db';\nimport { CourseViewerPage } from './course-viewer-page';\nimport { TwoColumnsPage } from '../common/two-columns-page';\nimport { WeekPlanner } from '../../weekplanner/weekplanner';\nimport { ListCourses } from './list-courses';\nimport { L } from '../../../utils/utils';\nimport env from '../../../globals/KED.env';\nimport cfg from '../../../globals/KED.cfg';\nimport { RedirectToStep } from './redirect-to-step';\nimport { VersionHistoryPage } from './version-history';\nimport { keepSessionAlive } from '../../../utils/keep-session-alive';\nimport { setupDialogs } from '../common/dialog-content';\nimport { LazyContent } from '../../utility-components/lazy-content';\n// Keep Session Alive\nkeepSessionAlive();\nvar GetMySchoolAndResolveCourseId = liveQueryView(function (_a) {\n    var render = _a.render, courseIdOrName = _a.courseIdOrName;\n    if (courseIdOrName.length === 36 && courseIdOrName[8] === '-' && courseIdOrName[13] === '-' && courseIdOrName[18] === '-' && courseIdOrName[23] === '-') {\n        return Schools.mySchool.map(function (school) { return render(school, courseIdOrName); });\n    }\n    else {\n        return db.courseInstances\n            .name(courseIdOrName.replace('+', ' '))\n            .idsOnly()\n            .single()\n            .combineLatest(Schools.mySchool)\n            .map(function (_a) {\n            var _b = __read(_a, 2), course = _b[0], school = _b[1];\n            return render(school, course.id);\n        });\n    }\n});\nexport var SubjectPlannerViewerApp = setupDialogs(function () { return React.createElement(\"div\", { onKeyDown: function (ev) {\n        if (ev.which === 83 && (ev.ctrlKey || ev.metaKey)) { // CTRL-S\n            ev.preventDefault();\n            db.saveNow().then(function () {\n                /*// When saved, exit edit mode so that one can view the result as users see it.\n                if (location.hash.endsWith('/edit')) {\n                  location.hash = location.hash.substr(0, location.hash.length - '/edit'.length);\n                }*/\n            });\n        }\n    } },\n    React.createElement(Router, null,\n        React.createElement(React.Fragment, null,\n            React.createElement(Route, { path: \"/\", exact: true, render: function () {\n                    var lastCourse = localStorage.getItem(\"subjectPlannerLastCourse\");\n                    if (lastCourse) {\n                        return React.createElement(LazyContent, null, db.courseInstances.ids([lastCourse]).idsOnly().toValue().map(function (_a) {\n                            var _b = __read(_a, 1), course = _b[0];\n                            return course ?\n                                React.createElement(Redirect, { to: \"/courses/\" + lastCourse }) : // Course exists\n                                React.createElement(Redirect, { to: \"/courses\" });\n                        }) // Course does not exist\n                        );\n                    }\n                    return React.createElement(Redirect, { to: \"/courses\" });\n                } }),\n            React.createElement(Route, { path: \"/courses\", exact: true, render: function () { return React.createElement(React.Fragment, null,\n                    React.createElement(Banner, { title: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Kurser\"], [\"Kurser\"]))), tabs: [], activeTab: \"$\" }),\n                    React.createElement(TwoColumnsPage, { left: React.createElement(ListCourses, { showInactive: true }), right: React.createElement(WeekPlanner, { env: env, viewCourseUrl: cfg.KED_COURSE_VIEWER_URL }), rightWidth: 5 })); } }),\n            React.createElement(Route, { path: \"/courses/:courseIdOrName\", exact: false, render: function (_a) {\n                    var match = _a.match;\n                    return React.createElement(GetMySchoolAndResolveCourseId, { courseIdOrName: match.params.courseIdOrName, render: function (school, courseId) {\n                            return React.createElement(Redirect, { to: \"/\" + school.name + \"/courses/\" + courseId });\n                        } });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId;\n                    var lastTab = localStorage.getItem(\"subjectPlannerLastTab:\" + courseId);\n                    if (lastTab) {\n                        return React.createElement(Redirect, { to: \"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + lastTab });\n                    }\n                    return React.createElement(CourseViewerPage, { school: school, courseId: courseId });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/tabs/:tabId?\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, tabId = _b.tabId;\n                    return React.createElement(CourseViewerPage, { school: school, courseId: courseId, activeTab: tabId });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/settings/:draftId\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, draftId = _b.draftId;\n                    return React.createElement(CourseViewerPage, { school: school, courseId: courseId, activeTab: \"$settings\", draftId: draftId });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/tabs/:tabId/drafts/:draftId\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, tabId = _b.tabId, draftId = _b.draftId;\n                    return React.createElement(CourseViewerPage, { school: school, courseId: courseId, activeTab: tabId, draftId: draftId });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/tabs/:tabId/drafts/:draftId/edit\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, tabId = _b.tabId, draftId = _b.draftId;\n                    return React.createElement(CourseViewerPage, { school: school, courseId: courseId, activeTab: tabId, draftId: draftId, editMode: true });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/tabs/:tabId/tasks/:taskId\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, tabId = _b.tabId, taskId = _b.taskId;\n                    return React.createElement(CourseViewerPage, { school: school, courseId: courseId, activeTab: tabId, taskId: taskId, editMode: false });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/tabs/:tabId/contents/:contentId/tasks/:taskId/drafts/:draftId\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, tabId = _b.tabId, taskId = _b.taskId, draftId = _b.draftId, contentId = _b.contentId;\n                    return React.createElement(CourseViewerPage, { school: school, courseId: courseId, activeTab: tabId, taskId: taskId, contentId: contentId, draftId: draftId, editMode: false });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/tabs/:tabId/contents/:contentId/tasks/:taskId/drafts/:draftId/edit\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, tabId = _b.tabId, contentId = _b.contentId, taskId = _b.taskId, draftId = _b.draftId;\n                    return React.createElement(CourseViewerPage, { school: school, courseId: courseId, activeTab: tabId, contentId: contentId, taskId: taskId, draftId: draftId, editMode: true });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/blocks/:blockId/steps/:stepNo\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, blockId = _b.blockId, stepNo = _b.stepNo;\n                    return React.createElement(RedirectToStep, { school: school, courseId: courseId, blockId: blockId, stepNo: stepNo, draftId: null, editMode: false });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/blocks/:blockId/steps/:stepNo/drafts/:draftId/edit\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, blockId = _b.blockId, stepNo = _b.stepNo, draftId = _b.draftId;\n                    return React.createElement(RedirectToStep, { school: school, courseId: courseId, blockId: blockId, stepNo: stepNo, draftId: draftId, editMode: true });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/blocks/:blockId/steps/:stepNo/drafts/:draftId\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, blockId = _b.blockId, stepNo = _b.stepNo, draftId = _b.draftId;\n                    return React.createElement(RedirectToStep, { school: school, courseId: courseId, blockId: blockId, stepNo: stepNo, draftId: draftId, editMode: false });\n                } }),\n            React.createElement(Route, { exact: true, path: \"/:school/courses/:courseId/history\", render: function (_a) {\n                    var match = _a.match;\n                    var _b = match.params, school = _b.school, courseId = _b.courseId, blockId = _b.blockId, stepNo = _b.stepNo;\n                    return React.createElement(VersionHistoryPage, { school: school, courseId: courseId });\n                } }),\n            React.createElement(ErrorSuccessFeedback, null)))); });\nvar templateObject_1;\n","import { __awaiter, __generator, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { withObserve } from '../../utility-components/with-observe';\nimport { CourseTabArea } from './course-tab-area';\nimport { AlignHorizontal } from '../../utility-components/align-horizontal';\nimport { HorizontalItem } from '../../utility-components/horizontal-item';\nimport { db, CourseInstances } from '../../../globals/db';\nimport { withRouter } from 'react-router';\nimport { isTeacherAtSchool } from '../../../access-control';\nimport { env } from '../../../globals/KED.env';\nimport { L, showError } from '../../../utils/utils';\nimport { LazyContent } from '../../utility-components/lazy-content';\nimport { computePredestinatedId } from 'kedbackend/client';\nimport { EditorFooterButtons } from './editor-footer-buttons';\nimport { features } from '../../../features';\nimport { publishCoursePart, publishEntireCourse } from '../logic/publish-course';\nexport var LeftCourseArea = withRouter(withObserve((function (_a) {\n    var editMode = _a.editMode, school = _a.school, course = _a.course, courseId = _a.courseId, branch = _a.branch, tab = _a.tab, draftId = _a.draftId, block = _a.block, activeTab = _a.activeTab, history = _a.history;\n    var contents = tab ? branch.courseContents.include(\"tasks\").hasEdgesFrom([tab.id]).toValue().read() : [];\n    return React.createElement(React.Fragment, null,\n        React.createElement(CourseTabArea, { school: school, course: course, branch: branch, tab: tab, editMode: editMode, draftId: draftId, block: block, contents: contents }),\n        !editMode ? env.currentUser.roles.includes(\"ADMIN\") || isTeacherAtSchool(env.currentUser, school) ? React.createElement(React.Fragment, null,\n            React.createElement(\"br\", null),\n            React.createElement(\"hr\", null),\n            React.createElement(AlignHorizontal, null,\n                draftId && React.createElement(HorizontalItem, null,\n                    React.createElement(\"button\", { className: \"btn btn-large btn-warning\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        if (!features.KDT592) return [3 /*break*/, 3];\n                                        return [4 /*yield*/, publishCoursePart({\n                                                school: school,\n                                                tab: tab,\n                                                course: course,\n                                                draftRepo: db.branch(draftId)\n                                            })];\n                                    case 1:\n                                        _a.sent();\n                                        return [4 /*yield*/, db.saveNow()];\n                                    case 2:\n                                        _a.sent();\n                                        history.push(\"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tab ? tab.id : '$'));\n                                        return [3 /*break*/, 6];\n                                    case 3: \n                                    // This code path should be removed after week 44/2019\n                                    // It just acts as before KDT592\n                                    return [4 /*yield*/, publishEntireCourse({ school: school, course: course, draftRepo: db.branch(draftId) })];\n                                    case 4:\n                                        // This code path should be removed after week 44/2019\n                                        // It just acts as before KDT592\n                                        _a.sent();\n                                        return [4 /*yield*/, db.saveNow()];\n                                    case 5:\n                                        _a.sent();\n                                        history.push(\"/\" + school + \"/courses/\" + course.id + \"/tabs/\" + (activeTab || '$'));\n                                        _a.label = 6;\n                                    case 6: return [2 /*return*/];\n                                }\n                            });\n                        }); } },\n                        React.createElement(\"i\", { className: \"fas fa-lg fa-play\", \"aria-hidden\": true }),\n                        \"\\u00A0\", L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Publicera\"], [\"Publicera\"]))))),\n                React.createElement(LazyContent, null, CourseInstances.getBranchId(db.schools.cacheOptimized().name(school).single(), courseId).map(function (existingDraftId) { return React.createElement(React.Fragment, null,\n                    React.createElement(HorizontalItem, null,\n                        React.createElement(\"button\", { className: \"btn btn-large\", onClick: existingDraftId ?\n                                // Navigate to edit existing draft\n                                function () { return history.push(\"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tab ? tab.id : '$') + \"/drafts/\" + existingDraftId + \"/edit\"); } :\n                                // Create a draft for the branch and then navigate to it\n                                function () { return __awaiter(void 0, void 0, void 0, function () {\n                                    var schoolEntity, newDraftId, newDraftBranchDoc, error_1;\n                                    return __generator(this, function (_a) {\n                                        switch (_a.label) {\n                                            case 0:\n                                                _a.trys.push([0, 4, , 5]);\n                                                return [4 /*yield*/, db.schools.name(school).single().load()];\n                                            case 1:\n                                                schoolEntity = _a.sent();\n                                                return [4 /*yield*/, computePredestinatedId(schoolEntity.officialBranchId + courseId + \"draft\")];\n                                            case 2:\n                                                newDraftId = _a.sent();\n                                                newDraftBranchDoc = {\n                                                    id: newDraftId,\n                                                    acl: [\n                                                        \"role:USER:R\",\n                                                        \"schoolRole:\" + schoolEntity.name + \"/EMPLOYEE:S\"\n                                                    ],\n                                                    name: 'draft',\n                                                    schoolId: schoolEntity.id,\n                                                    treeParentId: schoolEntity.officialBranchId,\n                                                    tags: [courseId]\n                                                };\n                                                db.branches.addRelated({ id: schoolEntity.officialBranchId }, \"approvedChildren\", newDraftBranchDoc);\n                                                return [4 /*yield*/, db.saveNow()];\n                                            case 3:\n                                                _a.sent();\n                                                history.push(\"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tab ? tab.id : '$') + \"/drafts/\" + newDraftId + \"/edit\");\n                                                return [3 /*break*/, 5];\n                                            case 4:\n                                                error_1 = _a.sent();\n                                                showError(error_1);\n                                                return [3 /*break*/, 5];\n                                            case 5: return [2 /*return*/];\n                                        }\n                                    });\n                                }); } }, existingDraftId ? React.createElement(React.Fragment, null,\n                            React.createElement(\"i\", { className: \"fas fa-lg fa-pencil-alt\" }),\n                            \" \",\n                            draftId ? L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Forts\\u00E4tt redigera\"], [\"Forts\\u00E4tt redigera\"]))) : L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Redigera\"], [\"Redigera\"])))) : React.createElement(React.Fragment, null,\n                            React.createElement(\"i\", { className: \"fas fa-lg fa-plus\" }),\n                            \" \", L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Skapa skolans version av kursen\"], [\"Skapa skolans version av kursen\"])))))),\n                    draftId || !existingDraftId ? undefined : React.createElement(HorizontalItem, null,\n                        React.createElement(\"button\", { className: \"btn btn-large\", onClick: function () { return history.push(\"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tab ? tab.id : '$') + \"/drafts/\" + existingDraftId); } },\n                            React.createElement(\"i\", { className: \"fas fa-eye\" }),\n                            \" \", L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Visa redigerad version\"], [\"Visa redigerad version\"])))))); })),\n                draftId && React.createElement(HorizontalItem, null,\n                    React.createElement(\"button\", { className: \"btn btn-large\", onClick: function () {\n                            history.push(\"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tab ? tab.id : '$'));\n                        } },\n                        React.createElement(\"i\", { className: \"fas fa-lg fa-arrow-left\" }),\n                        \" \",\n                        editMode ? L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Avsluta redigering\"], [\"Avsluta redigering\"]))) : L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"Avsluta f\\u00F6rhandsgranskning\"], [\"Avsluta f\\u00F6rhandsgranskning\"]))))))) : undefined :\n            React.createElement(React.Fragment, null,\n                React.createElement(\"br\", null),\n                React.createElement(\"hr\", null),\n                React.createElement(EditorFooterButtons, { school: school, course: course, tab: tab, activeTab: activeTab, draftId: draftId, courseType: course.type, block: block })));\n})));\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { liveQueryView } from '../../../utility-components/live-query-view';\nimport { listCourseInstances } from '../../logic/list-course-instances';\nimport { L } from '../../../../utils/utils';\nimport { StudentCoursesBox } from './student-courses-box';\nexport var ListCourses = liveQueryView(function (_a) {\n    var showInactive = _a.showInactive;\n    return (showInactive ?\n        listCourseInstances() :\n        listCourseInstances().tags(\"active\")).orderBy(\"name\")\n        .map(function (_a) {\n        var id = _a.id, name = _a.name, type = _a.type, description = _a.description, tags = _a.tags;\n        return ({\n            id: id,\n            name: name,\n            type: type,\n            tags: tags,\n            description: description,\n            url: \"/courses/\" + id\n        });\n    })\n        .groupBy(\"type\")\n        .map(function (arraysByType) { return ({\n        themeCourses: arraysByType[\"theme-course\"],\n        stepCourses: arraysByType[\"step-course\"]\n    }); })\n        .map(function (_a) {\n        var themeCourses = _a.themeCourses, stepCourses = _a.stepCourses;\n        return React.createElement(React.Fragment, null,\n            themeCourses && React.createElement(StudentCoursesBox, { title: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Temakurser\"], [\"Temakurser\"]))), courses: themeCourses }),\n            stepCourses && React.createElement(StudentCoursesBox, { title: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Stegkurser\"], [\"Stegkurser\"]))), courses: stepCourses }));\n    });\n});\nvar templateObject_1, templateObject_2;\n","import React from 'react';\nimport { Link } from 'react-router-dom';\nimport { AlignHorizontal } from '../../../utility-components/align-horizontal';\nimport { HorizontalItem } from '../../../utility-components/horizontal-item';\nexport var StudentCoursesBox = function (_a) {\n    var title = _a.title, courses = _a.courses;\n    return React.createElement(\"div\", { className: \"ked_boxed\" },\n        React.createElement(\"h3\", null, title),\n        React.createElement(\"div\", { className: \"taskContainer odd-even\" }, courses.map(function (_a) {\n            var id = _a.id, name = _a.name, description = _a.description, tags = _a.tags;\n            return React.createElement(AlignHorizontal, null,\n                React.createElement(HorizontalItem, null,\n                    React.createElement(\"div\", { className: \"studentCourse\" },\n                        React.createElement(Link, { to: \"/courses/\" + id }, name),\n                        React.createElement(\"p\", { className: \"small\" }, description))),\n                tags.includes(\"active\") ? undefined : React.createElement(HorizontalItem, null,\n                    React.createElement(\"div\", { className: \"pill incomplete\" }, \"Inaktiv\")));\n        })));\n};\n","import React from 'react';\nimport { LazyContent } from '../../utility-components/lazy-content';\nimport { db } from '../../../globals/db';\nimport { compareProp } from '../../../utils/utils';\nimport { Redirect } from 'react-router-dom';\nexport var RedirectToStep = function (_a) {\n    var school = _a.school, courseId = _a.courseId, blockId = _a.blockId, draftId = _a.draftId, editMode = _a.editMode, stepNo = _a.stepNo;\n    return React.createElement(LazyContent, null, db.optimizeCache().schools.name(school).single()\n        .map(function (school) { return db.branch(school.officialBranchId); })\n        .switchMap(function (branchRepo) {\n        return branchRepo.courseBlocks.include(\"tabs\").id(blockId)\n            .map(function (block) {\n            var firstTab = block.tabs.filter(function (tab) { return '' + tab.stepNo === '' + stepNo; }).sort(compareProp(\"order\"))[0];\n            if (firstTab)\n                return React.createElement(Redirect, { to: \"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + firstTab.id + (draftId ? \"/drafts/\" + draftId : '') + ((draftId && editMode) ? '/edit' : '') });\n            return React.createElement(Redirect, { to: \"/\" + school + \"/courses/\" + courseId });\n        });\n    }));\n};\n","import { __makeTemplateObject, __read, __spread } from \"tslib\";\nimport React, { useContext } from \"react\";\nimport { L, flatten, compareProps } from \"../../../utils/utils\";\nimport { DialogsContext } from \"../common/dialog-context\";\nimport { EditResource } from \"../../course-builder/modal-pages/edit-resource\";\nimport { createUUID } from 'kedbackend/client';\nimport { DraggableList } from '../../utility-components/draggable-list';\nimport { reorder } from '../logic/change-sort-order';\nexport var ResourceEditor = function (_a) {\n    var contents = _a.contents, schoolName = _a.schoolName, courseId = _a.courseId, tab = _a.tab, repo = _a.repo, block = _a.block;\n    function editResourceLink(genericResource) {\n        var resourceListContent = genericResource.resourceListContent;\n        context.openDialog(React.createElement(EditResource, { title: \"Edit resource\", resource: genericResource.resource, onSave: function (editedResource) {\n                //resources[idx] = res;\n                var newResourcesProp = __spread(resourceListContent.resources);\n                // idx is normally 0, but can be >0 due to how this used to work before this change.\n                newResourcesProp[0] = editedResource;\n                repo.courseContents.update(resourceListContent, {\n                    resources: newResourcesProp\n                });\n                context.closeDialog();\n            }, onDelete: function () {\n                if (resourceListContent.resources.length === 1) {\n                    // Normal scenario\n                    repo.courseTabs.removeRelated(tab, \"contents\", resourceListContent);\n                }\n                else {\n                    // Backward compat scenario\n                    repo.courseContents.update(resourceListContent, {\n                        resources: resourceListContent.resources.filter(function (r, _idx) { return _idx.toString() !== genericResource.id; })\n                    });\n                }\n                context.closeDialog();\n            } }));\n    }\n    var resourceListContents = flatten(contents\n        .filter(function (content) { return content.type === \"resource-list\"; })\n        .map(function (resourceListContent) { return resourceListContent; })\n        .map(function (resourceListContent) {\n        var resources = resourceListContent.resources;\n        return resources.map(function (resource, idx) { return ({\n            resource: resource,\n            id: resources.length > 1 ? idx.toString() : resourceListContent.id,\n            resourceListContent: resourceListContent,\n            name: resource.name,\n            order: resource.order || new Date().setHours(idx) // We take into account the resource order because we still support the old raw saved resources\n        }); });\n    })).sort(compareProps(\"order\"));\n    function onResourceSort(source, targetId, placement) {\n        var newOrder = reorder(resourceListContents, source.id, targetId, placement);\n        if (newOrder) {\n            var resources = source.resourceListContent.resources;\n            //resources can have one or mutiple entries for one content document\n            var newResourcesProp = resources.length > 1 ? resources.find(function (res, index) { return index.toString() === source.id; }) : resources[0];\n            newResourcesProp.order = newOrder;\n            repo.courseContents.update(source.resourceListContent, {\n                resources: resources\n            });\n        }\n    }\n    var context = useContext(DialogsContext);\n    return (React.createElement(\"div\", { className: \"ked_boxed\" },\n        React.createElement(\"h4\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Resurser\"], [\"Resurser\"])))),\n        React.createElement(\"div\", null,\n            resourceListContents && DraggableList({\n                objectList: resourceListContents,\n                renderEditLink: function (resourceListContent) { return React.createElement(React.Fragment, null,\n                    React.createElement(\"a\", { className: \"editItem\", onClick: function () { return editResourceLink(resourceListContent); } }),\n                    \"\\u00A0\"); },\n                renderLink: function (genericResource) { return React.createElement(\"a\", { target: \"_blank\", href: genericResource.resource.url }, genericResource.resource.name); },\n                onSort: function (source, target, placement) { return onResourceSort(source, target.id, placement); }\n            }),\n            React.createElement(\"a\", { className: \"btn\", onClick: function () {\n                    return context.openDialog(React.createElement(EditResource, { title: \"Resurs\", onSave: function (resourceToAdd) {\n                            resourceToAdd.order = Date.now();\n                            repo.courseTabs.addRelated(tab, \"contents\", {\n                                type: \"resource-list\",\n                                id: createUUID(),\n                                resources: [resourceToAdd],\n                                order: Date.now(),\n                                locked: false,\n                                lockDelete: false,\n                                hidden: false,\n                                tags: [courseId, block && tab.type === 'step-course-tab' ?\n                                        \"blockStep:\" + block.id + \":\" + tab.stepNo :\n                                        \"tab:\" + tab.id],\n                                acl: [\"role:USER:R\", \"schoolRole:\" + schoolName + \"/EMPLOYEE:S\"],\n                            });\n                            context.closeDialog();\n                        } }));\n                } },\n                React.createElement(\"i\", { className: \"fas fa-plus\", \"aria-hidden\": \"true\" }), L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"L\\u00E4gg till resurs\"], [\"L\\u00E4gg till resurs\"])))))));\n};\nvar templateObject_1, templateObject_2;\n","import { __awaiter, __generator, __makeTemplateObject, __values } from \"tslib\";\nimport React from 'react';\nimport { AlignHorizontal } from '../../utility-components/align-horizontal';\nimport { HorizontalItem } from '../../utility-components/horizontal-item';\nimport { L } from '../../../utils/utils';\nimport { flatten } from '../../../utils/utils';\nimport { getSchoolYears, computeCourseInstanceTags } from '../logic/course-instance-tags';\nimport { TabRequirements } from './tab-settings-requirements';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\nexport var TabSettingsAdmin = function (_a) {\n    var tab = _a.tab, repo = _a.repo, course = _a.course, block = _a.block;\n    var _b = tab.subject ?\n        tab.subject :\n        course.type === 'theme-course' && course.subjects && course.subjects.length > 0 ?\n            { subjectCode: course.subjects[0].code, subjectName: course.subjects[0].name } :\n            course.type === 'step-course' ?\n                { subjectCode: course.subject.subjectCode, subjectName: course.subject.subjectName } :\n                { subjectCode: '', subjectName: '' }, subjectCode = _b.subjectCode, subjectName = _b.subjectName;\n    var courseSchoolYears = getSchoolYears(course.tags);\n    var schoolYear = getSchoolYears(tab.tags)[0] || courseSchoolYears[0] || null;\n    return (\n    //\n    // Edit \"standard\" school: Choose tab type\n    //\n    React.createElement(\"div\", { className: \"ked_boxed\" },\n        React.createElement(\"p\", { className: \"box-mini-label\" }, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Administrativa Inst\\u00E4llningar f\\u00F6r fliken \", \"\"], [\"Administrativa Inst\\u00E4llningar f\\u00F6r fliken \", \"\"])), tab.name || tab.tabTitle)),\n        React.createElement(AlignHorizontal, null,\n            React.createElement(HorizontalItem, null,\n                React.createElement(\"input\", { type: \"checkbox\", checked: tab.locked, onChange: function (ev) { return repo.courseTabs.update(tab, { locked: !!ev.target.checked }); } })),\n            React.createElement(HorizontalItem, null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"L\\u00E5s fliken fr\\u00E5n redigering f\\u00F6rutom d\\u00E4r det explicit till\\u00E5ts\"], [\"L\\u00E5s fliken fr\\u00E5n redigering f\\u00F6rutom d\\u00E4r det explicit till\\u00E5ts\"]))))),\n        course.type === 'step-course' && React.createElement(React.Fragment, null,\n            React.createElement(\"br\", null),\n            React.createElement(OpenCloseBox, { title: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Avancerat...\"], [\"Avancerat...\"]))) },\n                React.createElement(\"button\", { className: \"btn\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                        var schoolYear;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    schoolYear = getSchoolYears(block.tags)[0];\n                                    return [4 /*yield*/, updateSubjectAndSchoolYears(course, course.subject.subjectName, course.subject.subjectCode, schoolYear)];\n                                case 1:\n                                    _a.sent();\n                                    return [2 /*return*/];\n                            }\n                        });\n                    }); } }, L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"G\\u00F6r om kopplingen till \\u00E4mne och \\u00E5rskursspann\"], [\"G\\u00F6r om kopplingen till \\u00E4mne och \\u00E5rskursspann\"])))))),\n        course.type === 'theme-course' && tab.tabClass === 'subject-tab' && !!subjectCode && React.createElement(React.Fragment, null,\n            React.createElement(\"br\", null),\n            course.subjects.length > 1 && React.createElement(AlignHorizontal, null,\n                React.createElement(HorizontalItem, null,\n                    React.createElement(\"label\", { className: \"kclabel\" }, L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"\\u00C4mne\"], [\"\\u00C4mne\"]))))),\n                React.createElement(HorizontalItem, null,\n                    React.createElement(\"select\", { value: subjectCode, onChange: function (ev) { return __awaiter(void 0, void 0, void 0, function () {\n                            var subjectCode, subjectName;\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        subjectCode = ev.target.value;\n                                        subjectName = course.subjects\n                                            .filter(function (s) { return s.code === subjectCode; })\n                                            .map(function (s) { return s.name; })[0] || subjectCode;\n                                        return [4 /*yield*/, updateSubjectAndSchoolYears(course, subjectName, subjectCode, schoolYear)];\n                                    case 1:\n                                        _a.sent();\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); } }, course.subjects.map(function (_a) {\n                        var name = _a.name, code = _a.code;\n                        return React.createElement(\"option\", { key: code, value: code }, name);\n                    })))),\n            courseSchoolYears.length > 1 && React.createElement(React.Fragment, null,\n                React.createElement(AlignHorizontal, null,\n                    React.createElement(HorizontalItem, null,\n                        React.createElement(\"label\", { className: \"kclabel\" }, L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"V\\u00E4lj \\u00E5rskurs\"], [\"V\\u00E4lj \\u00E5rskurs\"]))))),\n                    React.createElement(HorizontalItem, null,\n                        React.createElement(\"select\", { value: schoolYear, onChange: function (ev) { return __awaiter(void 0, void 0, void 0, function () {\n                                var schoolYear, subjectName;\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0:\n                                            schoolYear = ev.target.value;\n                                            subjectName = course.subjects\n                                                .filter(function (s) { return s.code === subjectCode; })\n                                                .map(function (s) { return s.name; })[0] || subjectCode;\n                                            return [4 /*yield*/, updateSubjectAndSchoolYears(course, subjectName, subjectCode, schoolYear)];\n                                        case 1:\n                                            _a.sent();\n                                            return [2 /*return*/];\n                                    }\n                                });\n                            }); } }, courseSchoolYears.map(function (year) { return React.createElement(\"option\", { key: year, value: year }, L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"\\u00C5rskurs \", \"\"], [\"\\u00C5rskurs \", \"\"])), year)); })))),\n                React.createElement(\"div\", null,\n                    React.createElement(TabRequirements, { repo: repo, tab: tab })),\n                React.createElement(\"br\", null),\n                React.createElement(OpenCloseBox, { title: L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"Avancerat...\"], [\"Avancerat...\"]))) },\n                    React.createElement(\"button\", { className: \"btn\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, updateSubjectAndSchoolYears(course, subjectName, subjectCode, schoolYear)];\n                                    case 1:\n                                        _a.sent();\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); } }, L(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"G\\u00F6r om kopplingen till \\u00E4mne och \\u00E5rskursspann\"], [\"G\\u00F6r om kopplingen till \\u00E4mne och \\u00E5rskursspann\"])))))))));\n    function updateSubjectAndSchoolYears(course, subjectName, subjectCode, schoolYear) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tabTags, lgContents, tasks, tasks_1, tasks_1_1, task, tags;\n            var e_1, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        tabTags = computeCourseInstanceTags(tab.tags, [subjectCode], [schoolYear]);\n                        repo.courseTabs.update(tab, {\n                            subject: {\n                                subjectCode: subjectCode,\n                                subjectName: subjectName\n                            },\n                            tags: tabTags\n                        });\n                        return [4 /*yield*/, repo.courseContents\n                                .hasEdgesFrom([tab.id])\n                                .include(\"tasks\")\n                                .includeIdsAndNamesOnly()\n                                .toValue().load()];\n                    case 1:\n                        lgContents = _b.sent();\n                        tasks = flatten(lgContents.map(function (c) { return c.tasks; }));\n                        try {\n                            for (tasks_1 = __values(tasks), tasks_1_1 = tasks_1.next(); !tasks_1_1.done; tasks_1_1 = tasks_1.next()) {\n                                task = tasks_1_1.value;\n                                tags = computeCourseInstanceTags([course.id], [subjectCode], [schoolYear]);\n                                repo.tasks.update(task, { tags: tags, subject: subjectName });\n                            }\n                        }\n                        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                        finally {\n                            try {\n                                if (tasks_1_1 && !tasks_1_1.done && (_a = tasks_1.return)) _a.call(tasks_1);\n                            }\n                            finally { if (e_1) throw e_1.error; }\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { KnowledgeMatrix } from '../../course-builder/sub-components/knowledge-matrix';\nimport { LazyContent } from '../../utility-components/lazy-content';\nimport { getCourseCodesFromTags } from '../logic/get-course-codes-from-tags';\nimport { L } from '../../../utils/utils';\nimport { getStandardCoursesWithOrderedRequirements } from '../logic/get-standard-courses-with-ordered-requirements';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\nimport { SelectRelatedDocs } from '../../course-builder/sub-components/select-related-docs';\nexport var TabRequirements = function (_a) {\n    var repo = _a.repo, tab = _a.tab;\n    return React.createElement(LazyContent, null, getStandardCoursesWithOrderedRequirements(getCourseCodesFromTags(tab.tags))\n        .map(function (courseTemplates) { return courseTemplates.length === 0 ?\n        React.createElement(\"p\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Fliken \\u00E4r inte kopplad till n\\u00E5got \\u00E4mne / \\u00E5rskurs\"], [\"Fliken \\u00E4r inte kopplad till n\\u00E5got \\u00E4mne / \\u00E5rskurs\"]))))\n        :\n            React.createElement(\"div\", null, courseTemplates.map(function (_a) {\n                var id = _a.id, name = _a.name, abilities = _a.abilities, centralContent = _a.centralContent, knowledgeRequirements = _a.knowledgeRequirements;\n                return React.createElement(\"div\", { key: id },\n                    courseTemplates.length === 1 ? undefined : React.createElement(\"h1\", null, name),\n                    React.createElement(OpenCloseBox, { className: \"larger\", title: React.createElement(\"p\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"L\\u00E5s flikens kunskapskrav\"], [\"L\\u00E5s flikens kunskapskrav\"])))) },\n                        React.createElement(\"p\", null, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Markera de kunskapskrav som \\u00E4mnesfliken ska t\\u00E4cka.\"], [\"Markera de kunskapskrav som \\u00E4mnesfliken ska t\\u00E4cka.\"])))),\n                        React.createElement(LazyContent, null, repo[\"knowledge-requirements\"].hasEdgesFrom([tab.id]).idsOnly().toValue().map(function (tabsKrs) {\n                            return React.createElement(KnowledgeMatrix, { knowledgeRequirements: knowledgeRequirements, markedIds: tabsKrs.map(function (_a) {\n                                    var id = _a.id;\n                                    return id;\n                                }), markMode: true, onMarkChanged: function (markedId, isMarked) {\n                                    // Remove invalid knowledge requirements (those that are not part of the standard course)\n                                    // Can happen after changing school year / course or subject.\n                                    var invalidKrs = tabsKrs.filter(function (kr) { return !knowledgeRequirements.some(function (_a) {\n                                        var id = _a.id;\n                                        return kr.id === id;\n                                    }); });\n                                    invalidKrs.forEach(function (invalidKr) {\n                                        repo.courseTabs.removeRelated(tab, \"knowledgeRequirements\", invalidKr);\n                                    });\n                                    var markedDoc = knowledgeRequirements.filter(function (_a) {\n                                        var id = _a.id;\n                                        return id === markedId;\n                                    })[0];\n                                    if (isMarked) {\n                                        repo.courseTabs.addRelated(tab, \"knowledgeRequirements\", markedDoc);\n                                    }\n                                    else {\n                                        repo.courseTabs.removeRelated(tab, \"knowledgeRequirements\", markedDoc);\n                                    }\n                                } });\n                        }))),\n                    React.createElement(LazyContent, null, repo.abilities.hasEdgesFrom([tab.id]).idsOnly().toValue().map(function (tabAbilities) {\n                        return React.createElement(SelectRelatedDocs, { options: abilities, title: L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"L\\u00E5s flikens f\\u00F6rm\\u00E5gor\"], [\"L\\u00E5s flikens f\\u00F6rm\\u00E5gor\"]))), markedIds: tabAbilities.map(function (_a) {\n                                var id = _a.id;\n                                return id;\n                            }), markMode: true, \n                            //migratedIds={task && task.migratedTexts && task.migratedTexts.abilities}\n                            onMarkChanged: function (markedId, isMarked) {\n                                // Remove invalid abilities (those that are not part of the standard course)\n                                // Can happen after changing school year / course or subject.\n                                var invalidAbilities = tabAbilities.filter(function (a) { return !abilities.some(function (_a) {\n                                    var id = _a.id;\n                                    return a.id === id;\n                                }); });\n                                invalidAbilities.forEach(function (invalidAbility) {\n                                    repo.courseTabs.removeRelated(tab, \"abilities\", invalidAbility);\n                                });\n                                var markedDoc = abilities.filter(function (_a) {\n                                    var id = _a.id;\n                                    return id === markedId;\n                                })[0];\n                                if (isMarked) {\n                                    repo.courseTabs.addRelated(tab, \"abilities\", markedDoc);\n                                }\n                                else {\n                                    repo.courseTabs.removeRelated(tab, \"abilities\", markedDoc);\n                                }\n                            } });\n                    })),\n                    React.createElement(LazyContent, null, repo[\"central-content\"].hasEdgesFrom([tab.id]).idsOnly().toValue().map(function (tabsCCs) {\n                        return React.createElement(SelectRelatedDocs, { options: centralContent, title: L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"L\\u00E5s flikens centrala inneh\\u00E5ll\"], [\"L\\u00E5s flikens centrala inneh\\u00E5ll\"]))), markedIds: tabsCCs.map(function (cc) { return cc.id; }), markMode: true, \n                            //migratedIds={task && task.migratedTexts && task.migratedTexts.centralContent}\n                            onMarkChanged: function (markedId, isMarked) {\n                                // Remove invalid central contents (those that are not part of the standard course)\n                                // Can happen after changing school year / course or subject.\n                                var invalidCentralContents = tabsCCs.filter(function (cc) { return !centralContent.some(function (_a) {\n                                    var id = _a.id;\n                                    return cc.id === id;\n                                }); });\n                                invalidCentralContents.forEach(function (invalidCC) {\n                                    repo.courseTabs.removeRelated(tab, \"centralContent\", invalidCC);\n                                });\n                                var markedDoc = centralContent.filter(function (_a) {\n                                    var id = _a.id;\n                                    return id === markedId;\n                                })[0];\n                                if (isMarked) {\n                                    repo.courseTabs.addRelated(tab, \"centralContent\", markedDoc);\n                                }\n                                else {\n                                    repo.courseTabs.removeRelated(tab, \"centralContent\", markedDoc);\n                                }\n                            } });\n                    })));\n            })); }));\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { AlignHorizontal } from '../../utility-components/align-horizontal';\nimport { HorizontalItem } from '../../utility-components/horizontal-item';\nimport { CourseTabClasses, TabTypesPerCourseType } from './course-tab/tab-classes';\nimport { L } from '../../../utils/utils';\nimport { getSchoolYears, computeCourseInstanceTags } from '../logic/course-instance-tags';\nimport { TextInput } from '../../utility-components/form-field-text-input';\nexport var TabSettings = function (_a) {\n    var tab = _a.tab, repo = _a.repo, course = _a.course;\n    var _b = tab.subject ?\n        tab.subject :\n        course.type === 'theme-course' && course.subjects && course.subjects.length > 0 ?\n            { subjectCode: course.subjects[0].code, subjectName: course.subjects[0].name } :\n            { subjectCode: '', subjectName: '' }, subjectCode = _b.subjectCode, subjectName = _b.subjectName;\n    var courseSchoolYears = getSchoolYears(course.tags);\n    var schoolYear = getSchoolYears(tab.tags)[0] || courseSchoolYears[0] || null;\n    return (\n    //\n    // Edit \"standard\" school: Choose tab type\n    //\n    React.createElement(\"div\", { className: \"ked_boxed\" },\n        React.createElement(\"p\", { className: \"box-mini-label\" }, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Inst\\u00E4llningar f\\u00F6r fliken \", \"\"], [\"Inst\\u00E4llningar f\\u00F6r fliken \", \"\"])), tab.name || tab.tabTitle)),\n        React.createElement(AlignHorizontal, null,\n            React.createElement(HorizontalItem, null,\n                React.createElement(\"label\", { className: \"kclabel\" }, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Flikens typ\"], [\"Flikens typ\"]))))),\n            React.createElement(HorizontalItem, null,\n                React.createElement(\"select\", { value: tab.tabClass, onChange: function (ev) {\n                        return repo.courseTabs.update(tab, ev.target.value === 'subject-tab' ? {\n                            tabClass: ev.target.value,\n                            subject: { subjectCode: subjectCode, subjectName: subjectName },\n                            tags: computeCourseInstanceTags(tab.tags, [subjectCode], [schoolYear])\n                        } : {\n                            tabClass: ev.target.value,\n                        });\n                    } }, TabTypesPerCourseType[course.type].map(function (tabClass) {\n                    return React.createElement(\"option\", { key: tabClass, value: tabClass }, CourseTabClasses[tabClass]);\n                })))),\n        React.createElement(TextInput, { label: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Flikens namn\"], [\"Flikens namn\"]))), id: \"TabSettings:name\", value: tab.name || tab.tabTitle, onChange: function (name) {\n                return repo.courseTabs.update(tab, {\n                    name: name,\n                    tabTitle: name // Deprecated. Todo: remove.\n                });\n            } })));\n};\nvar templateObject_1, templateObject_2, templateObject_3;\n","import { __assign, __makeTemplateObject, __read, __spread } from \"tslib\";\nimport React, { useState } from 'react';\nimport { KnowledgeMatrix } from '../../../../course-builder/sub-components/knowledge-matrix';\nimport { LazyContent } from '../../../../utility-components/lazy-content';\nimport { L, flatten } from '../../../../../utils/utils';\nimport { resolveRequirementOrder } from '../../../logic/ordered-requirements';\nimport { SelectRelatedDocs } from '../../../../course-builder/sub-components/select-related-docs';\nimport { Checklist } from '../../../../utility-components/checklist';\nimport { OpenCloseBox } from '../../../../utility-components/open-close-box';\nimport { futureAbilities } from '../../../../../contracts/ked-models';\nimport { features } from '../../../../../features';\nexport var EditRequirements = function (_a) {\n    var repo = _a.repo, task = _a.task, tabIds = _a.tabIds, blockId = _a.blockId, themeCoveredSentences = _a.themeCoveredSentences, tabContentIds = _a.tabContentIds;\n    return React.createElement(LazyContent, null, blockId ?\n        repo.courseBlocks\n            .include(\"tabs\", \"abilities\", \"centralContent\", \"knowledgeRequirements\")\n            .id(blockId)\n            .combineLatest(repo.tasks.hasEdgesFrom(tabContentIds).include(\"knowledgeRequirements\").includeIdsOnly())\n            .switchMap(function (_a) {\n            var _b = __read(_a, 2), block = _b[0], tasks = _b[1];\n            //for step subjects we take into account all tasks from all the steps from the current block\n            var blockCoveredSentences = tasks && flatten(tasks.filter(function (req) { return req.partialRequirments != null; }).map(function (_a) {\n                var partialRequirments = _a.partialRequirments;\n                return partialRequirments;\n            }));\n            return React.createElement(\"div\", null,\n                React.createElement(EditRequirementsInner, __assign({}, { repo: repo, task: task, tabOrBlock: block, allCoveredSentences: blockCoveredSentences })));\n        }) :\n        repo.courseTabs\n            .include(\"abilities\", \"centralContent\", \"knowledgeRequirements\")\n            .ids(tabIds)\n            .toValue()\n            .map(function (tabs) { return React.createElement(\"div\", null, tabs.length === 1 ?\n            React.createElement(EditRequirementsInner, __assign({}, { repo: repo, task: task, tabOrBlock: tabs[0], allCoveredSentences: themeCoveredSentences })) :\n            tabs.map(function (tab) { return React.createElement(OpenCloseBox, { key: tab.id, title: React.createElement(\"h4\", null,\n                    tab.name || tab.tabTitle,\n                    tab.subject && tab.subject.subjectName && tab.subject.subjectName !== (tab.name || tab.tabTitle) ?\n                        \" (\" + tab.subject.subjectName + \")\" : '') },\n                React.createElement(EditRequirementsInner, __assign({}, { repo: repo, task: task, tabOrBlock: tab, hasMultipleSubjects: true, allCoveredSentences: themeCoveredSentences }))); })); }));\n};\nexport var EditRequirementsInner = function (_a) {\n    var tabOrBlock = _a.tabOrBlock, repo = _a.repo, task = _a.task, hasMultipleSubjects = _a.hasMultipleSubjects, allCoveredSentences = _a.allCoveredSentences;\n    var _b = __read(useState(false), 2), markBySentenceViewActive = _b[0], setActive = _b[1];\n    var markPartialKRs = features.markPartialKRs;\n    return React.createElement(LazyContent, null, resolveRequirementOrder(tabOrBlock).map(function (tab) {\n        var subjectName = 'type' in tab && tab.subject && tab.subject.subjectName;\n        return React.createElement(React.Fragment, null,\n            task.taskType !== 'exercise' && React.createElement(\"div\", { className: \"ked_boxed\" },\n                React.createElement(\"h3\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"V\\u00E4lj kunskapskrav\"], [\"V\\u00E4lj kunskapskrav\"])))),\n                React.createElement(\"div\", { className: \"matrix-knowledge-title\" },\n                    React.createElement(\"p\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Markera de kunskapskrav som din uppgift t\\u00E4cker.\"], [\"Markera de kunskapskrav som din uppgift t\\u00E4cker.\"])))),\n                    markPartialKRs && React.createElement(\"p\", null,\n                        React.createElement(\"i\", { className: \"fab fa-creative-commons-nd \" + (markBySentenceViewActive ? \"activePartialView\" : \"\"), onClick: function () { return setActive(!markBySentenceViewActive); } }))),\n                React.createElement(KnowledgeMatrix, { knowledgeRequirements: tab.knowledgeRequirements, markedIds: task.knowledgeRequirements.map(function (req) { return req.id; }), explainedRequirements: task.explainedRequirements || {}, \n                    //idsToMarkNotOk={uncoveredIds}\n                    markMode: true, markBySentenceView: markBySentenceViewActive, migratedIds: task && task.migratedTexts && task.migratedTexts.knowledgeRequirements, partialRequirments: task.partialRequirments || {}, coveredPartialRequirments: allCoveredSentences, markPartialFeatureEnabled: markPartialKRs, onExplainedRequirementsChanged: function (requirementId, text) {\n                        var _a;\n                        return repo.tasks.update(task, {\n                            explainedRequirements: __assign(__assign({}, task.explainedRequirements), (_a = {}, _a[requirementId] = text, _a))\n                        });\n                    }, onUpdatePartialKnowledge: function (requirementId, partialContents) {\n                        //it might be the case that the feature flag is active, the requirment is set as marked and no partial data is saved\n                        //when unselecting the requirment, we should do nothing as no partial data is saved\n                        var _a;\n                        // var result = shouldRemove && task.partialRequirments.filter(pr => partialContents.filter(pc => !pr[requirementId].includes(pc)));\n                        //var existingRequirements = task.partialRequirments[requirementId] || [];\n                        repo.tasks.update(task, {\n                            partialRequirments: __assign(__assign({}, task.partialRequirments), (_a = {}, _a[requirementId] = __spread(partialContents), _a))\n                        });\n                        var markedDoc = tab.knowledgeRequirements.filter(function (_a) {\n                            var id = _a.id;\n                            return id === requirementId;\n                        })[0];\n                        if (partialContents.length === 0) {\n                            repo.tasks.removeRelated(task, \"knowledgeRequirements\", markedDoc);\n                        }\n                        else if (!task.partialRequirments || !task.partialRequirments[requirementId] || task.partialRequirments[requirementId].length === 0) {\n                            repo.tasks.addRelated(task, \"knowledgeRequirements\", markedDoc);\n                        }\n                    }, onMarkChanged: function (markedId, isMarked) {\n                        var _a, _b;\n                        var markedDoc = tab.knowledgeRequirements.filter(function (_a) {\n                            var id = _a.id;\n                            return id === markedId;\n                        })[0];\n                        if (isMarked) {\n                            if (hasMultipleSubjects) {\n                                // Mission tabs needs to store the subject name connected to each knowledge requirement:\n                                repo.tasks.update(task, { idsToSubjectMap: __assign(__assign({}, task.idsToSubjectMap), (_a = {}, _a[markedId] = subjectName, _a)) });\n                            }\n                            else {\n                                repo.tasks.update(task, { idsToSubjectMap: undefined });\n                            }\n                            repo.tasks.addRelated(task, \"knowledgeRequirements\", markedDoc);\n                        }\n                        else {\n                            if (hasMultipleSubjects) {\n                                // Mission tabs needs to delete the subject name connected to each knowledge requirement:\n                                repo.tasks.update(task, { idsToSubjectMap: __assign(__assign({}, task.idsToSubjectMap), (_b = {}, _b[markedId] = undefined, _b)) });\n                            }\n                            else {\n                                repo.tasks.update(task, { idsToSubjectMap: undefined });\n                            }\n                            repo.tasks.removeRelated(task, \"knowledgeRequirements\", markedDoc);\n                        }\n                    } })),\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(SelectRelatedDocs, { title: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"V\\u00E4lj f\\u00F6rm\\u00E5gor\"], [\"V\\u00E4lj f\\u00F6rm\\u00E5gor\"]))), options: tab.abilities, markedIds: task.abilities.map(function (a) { return a.id; }), markMode: true, migratedIds: task && task.migratedTexts && task.migratedTexts.abilities, onMarkChanged: function (markedId, isMarked) {\n                        var markedDoc = tab.abilities.filter(function (a) { return a.id === markedId; })[0];\n                        if (isMarked) {\n                            repo.tasks.addRelated(task, \"abilities\", markedDoc);\n                        }\n                        else {\n                            repo.tasks.removeRelated(task, \"abilities\", markedDoc);\n                        }\n                    } })),\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(SelectRelatedDocs, { title: L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"V\\u00E4lj centralt inneh\\u00E5ll\"], [\"V\\u00E4lj centralt inneh\\u00E5ll\"]))), options: tab.centralContent, markedIds: task.centralContent.map(function (cc) { return cc.id; }), markMode: true, migratedIds: task && task.migratedTexts && task.migratedTexts.centralContent, onMarkChanged: function (markedId, isMarked) {\n                        var markedDoc = tab.centralContent.filter(function (a) { return a.id === markedId; })[0];\n                        if (isMarked) {\n                            repo.tasks.addRelated(task, \"centralContent\", markedDoc);\n                        }\n                        else {\n                            repo.tasks.removeRelated(task, \"centralContent\", markedDoc);\n                        }\n                    } })),\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(OpenCloseBox, { className: \"larger\", title: React.createElement(\"p\", null, L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"V\\u00E4lj framtidsf\\u00F6rm\\u00E5gor\"], [\"V\\u00E4lj framtidsf\\u00F6rm\\u00E5gor\"])))) },\n                    React.createElement(\"br\", null),\n                    React.createElement(Checklist, { available: futureAbilities.map(function (fa) { return ({ name: fa, key: fa }); }), selected: task.futureAbilities, onChange: function (selectedFas) { return repo.tasks.update(task, { futureAbilities: selectedFas }); } }))));\n    }));\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { TaskMigrationBox } from '../../../../course-builder/modal-pages/edit-task/task-migration-box';\nimport ReactDatePicker from 'react-datepicker';\nimport moment from 'moment';\nimport { L } from '../../../../../utils/utils';\nimport { Checklist } from '../../../../utility-components/checklist';\nimport { LazyContent } from '../../../../utility-components/lazy-content';\nimport { FieldLimits } from '../../../common/field-limits';\nexport var BasicEditableTaskFields = function (_a) {\n    var task = _a.task, writeAccess = _a.writeAccess, repo = _a.repo, contentId = _a.contentId, tab = _a.tab;\n    var tabClass = tab ? tab.tabClass : null; // tab is undefined on step courses. But there are no mission tabs on step courses.\n    return React.createElement(\"div\", null,\n        React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                React.createElement(\"p\", null, tabClass === 'mission-tab' ? L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Uppdragets namn:\"], [\"Uppdragets namn:\"]))) : L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Uppgiftens namn:\"], [\"Uppgiftens namn:\"]))))),\n            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                React.createElement(\"input\", { autoFocus: true, type: \"text\", size: 35, value: task.name, disabled: !writeAccess, readOnly: !writeAccess, onChange: function (ev) {\n                        repo.tasks.update(task, { name: ev.target.value.substr(0, FieldLimits.MAX_CHARS_TASK_NAMES) });\n                    } }))),\n        task.migratedTexts && writeAccess && React.createElement(TaskMigrationBox, { task: task, course: null, updateLink: function (id, linkOrUnlink) { throw new Error(\"Not implemented yet\"); } }),\n        tabClass !== 'mission-tab' && React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                React.createElement(\"p\", null, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"L\\u00E4randem\\u00E5l:\"], [\"L\\u00E4randem\\u00E5l:\"]))))),\n            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                React.createElement(LazyContent, null, repo.courseContents.id(contentId).map(function (content) {\n                    if (content.type !== 'learning-goals')\n                        return React.createElement(\"p\", null, L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Ej valbart\"], [\"Ej valbart\"]))));\n                    var hasCommonLearningGoals = content.hasCommonLearningGoals;\n                    var learningGoals = content.commonLearningGoals;\n                    var availableGoals = learningGoals.map(function (lg) { return lg.trim(); }).filter(function (lg) { return lg; })\n                        .map(function (lg) { return ({\n                        name: lg,\n                        key: lg\n                    }); });\n                    return React.createElement(Checklist, { available: availableGoals, selected: task.learningGoal.length > 0 ? task.learningGoal.split('\\n') : [], onChange: function (goals, goal) {\n                            if (hasCommonLearningGoals) {\n                                repo.tasks.update(task, { learningGoal: goals.join('\\n') });\n                            }\n                            else {\n                                repo.tasks.update(task, { learningGoal: goal });\n                            }\n                        } });\n                })))),\n        React.createElement(React.Fragment, null,\n            React.createElement(\"h2\", null, tabClass === 'mission-tab' ? L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Uppdragstyp\"], [\"Uppdragstyp\"]))) : L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Uppgiftstyp\"], [\"Uppgiftstyp\"])))),\n            React.createElement(Checklist, { available: [\n                    tabClass !== 'mission-tab' && { name: L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"\\u00D6vningsuppgift\"], [\"\\u00D6vningsuppgift\"]))), key: 'exercise' },\n                    { name: L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"Uppgift\"], [\"Uppgift\"]))), key: \"task\" },\n                    { name: L(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"Inl\\u00E4mningsuppgift\"], [\"Inl\\u00E4mningsuppgift\"]))), key: 'assignment' },\n                ].filter(function (x) { return x; }), selected: [task.taskType], onChange: function (_, clickedKey) { return repo.tasks.update(task, { taskType: clickedKey }); } }),\n            task.taskType === 'assignment' && React.createElement(React.Fragment, null,\n                React.createElement(\"p\", null, \"Inl\\u00E4mningsdatum\"),\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(ReactDatePicker, { nextMonthButtonLabel: \"\", showWeekNumbers: true, previousMonthButtonLabel: \"\", selected: task.deadline && moment(task.deadline).toDate(), dateFormat: \"yyyy-MM-dd\", locale: \"sv\", popperPlacement: \"bottom-start\", onChange: function (value) {\n                                repo.tasks.update(task, { deadline: moment(value).format(\"YYYY-MM-DD\") });\n                            } })),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" }, task.deadline && React.createElement(\"a\", { className: \"deleteDate\", href: \"#\", title: \"Ta bort inl\\u00E4mningsdatum\", onClick: function (ev) {\n                            ev.preventDefault();\n                            repo.tasks.update(task, { deadline: null });\n                        } }))),\n                React.createElement(\"div\", { className: \"taskContainer\" },\n                    React.createElement(\"div\", { className: \"align-horizontal\" },\n                        React.createElement(\"div\", { className: \"horizontalItem top\", onClick: function () {\n                                return repo.tasks.update(task, { sendToUrkund: task.sendToUrkund == null ? false : !task.sendToUrkund });\n                            } },\n                            React.createElement(\"div\", { className: \"checkBox\" + ((task.sendToUrkund == null ? true : task.sendToUrkund) ? \" checked\" : \"\") })),\n                        React.createElement(\"div\", { className: \"horizontalItem top\" }, \"Verify assignments with Urkund\"))))));\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9;\n","import React from 'react';\nimport { BasicEditableTaskFields } from './basic-editable-task-fields';\nimport { TaskFooterButtons } from './task-footer-buttons';\nimport { IntroductionTextEditor } from './introduction-text-editor';\nimport { TaskDescriptionEditor } from './task-description-editor';\nimport { TaskWorkingProcedureEditor } from './task-working-procedure-editor';\nimport { TaskEmbeddedHTMLEditor } from './task-embedded-html-editor';\nexport var EditTaskForm = function (_a) {\n    var repo = _a.repo, course = _a.course, draftId = _a.draftId, tabId = _a.tabId, tab = _a.tab, contentId = _a.contentId, writeAccess = _a.writeAccess, task = _a.task, school = _a.school;\n    return React.createElement(React.Fragment, null,\n        React.createElement(BasicEditableTaskFields, { repo: repo, task: task, writeAccess: writeAccess, contentId: contentId, tab: tab }),\n        React.createElement(IntroductionTextEditor, { repo: repo, task: task, writeAccess: writeAccess }),\n        React.createElement(TaskDescriptionEditor, { writeAccess: writeAccess, task: task, repo: repo }),\n        React.createElement(TaskWorkingProcedureEditor, { writeAccess: writeAccess, task: task, repo: repo, step: tab && tab.type === 'step-course-tab' && tab.stepNo }),\n        React.createElement(TaskEmbeddedHTMLEditor, { writeAccess: writeAccess, task: task, repo: repo }),\n        React.createElement(TaskFooterButtons, { repo: repo, task: task, courseId: course.id, draftId: draftId, tabId: tabId, contentId: contentId, school: school }));\n};\n/*\n\n  * Inte kunna ändra ordning på låsta rutor om inte isKedStaff().\n  * Ingen lägg till uppgifts-knapp om inte editMode.\n  *\n  * Redigera uppgiftsinnehåll\n  * Lås lärandemålen till admin alltid\n  * Kunna klicka in sig på uppgiften\n  * Kunna ta bort uppgift\n  * Kunna nollställa ändringar för skolan\n\n*/ \n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { L } from '../../../../../utils/utils';\nimport { Wysiwyg } from '../../../../utility-components/wysiwyg';\nimport actions_swedish from '../../../../utility-components/wysiwyg/actions-sv';\nexport var IntroductionTextEditor = function (_a) {\n    var repo = _a.repo, task = _a.task, writeAccess = _a.writeAccess;\n    return React.createElement(React.Fragment, null,\n        React.createElement(\"h4\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Introtext\"], [\"Introtext\"])))),\n        React.createElement(\"p\", { className: \"subHeader\" }, \"(Skriv en introduktion till uppgiften)\"),\n        React.createElement(Wysiwyg, { actions: [\n                \"bold\",\n                \"italic\",\n                \"underline\",\n                \"link\",\n                \"image\",\n                \"clear\"\n            ], defaultActions: actions_swedish, readOnly: !writeAccess, html: task.content || \"\", onChange: function (html) { return repo.tasks.update(task, { content: html }); } }));\n};\nvar templateObject_1;\n","import { __makeTemplateObject, __read } from \"tslib\";\nimport * as React from 'react';\nimport { Wysiwyg } from '../../../../utility-components/wysiwyg';\nimport actions_swedish from '../../../../utility-components/wysiwyg/actions-sv';\nimport { L } from '../../../../../utils/utils';\nimport { taskTypeHeadings } from '../texts';\nimport { FieldLimits } from '../../../common/field-limits';\nimport { useState } from 'react';\nexport function TaskDescriptionEditor(_a) {\n    var writeAccess = _a.writeAccess, task = _a.task, repo = _a.repo;\n    var _b = __read(useState(0), 2), numChars = _b[0], setNumChars = _b[1];\n    return React.createElement(React.Fragment, null,\n        React.createElement(\"h4\", null, taskTypeHeadings[task.taskType] || L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Uppgift\"], [\"Uppgift\"])))),\n        React.createElement(\"p\", { className: \"subHeader\" }, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"(Skriv in en kort f\\u00F6rklaring, max \", \" tecken, vad uppgiften g\\u00E5r ut p\\u00E5.)\"], [\"(Skriv in en kort f\\u00F6rklaring, max \", \" tecken, vad uppgiften g\\u00E5r ut p\\u00E5.)\"])), FieldLimits.MAX_CHARS_TASK_INTRO_TEXT)),\n        React.createElement(Wysiwyg, { actions: [\n                \"bold\", \"clear\"\n            ], defaultActions: actions_swedish, readOnly: !writeAccess, html: task.description || \"\", maxChars: FieldLimits.MAX_CHARS_TASK_INTRO_TEXT, reportNumChars: function (numChars) { return setNumChars(numChars); }, onChange: function (html) {\n                repo.tasks.update(task, { description: html });\n            } }),\n        React.createElement(\"div\", { style: { textAlign: 'right', opacity: 0.7, fontSize: '8pt' } }, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"\", \" av \", \"\"], [\"\", \" av \", \"\"])), numChars, FieldLimits.MAX_CHARS_TASK_INTRO_TEXT)));\n}\nvar templateObject_1, templateObject_2, templateObject_3;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { isKedStaff } from '../../../logic/is-ked-staff';\nimport { L } from '../../../../../utils/utils';\nexport var TaskEmbeddedHTMLEditor = function (_a) {\n    var task = _a.task, repo = _a.repo;\n    return isKedStaff() ? task.embeddedHtml ? React.createElement(\"div\", null,\n        React.createElement(\"h4\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Inb\\u00E4ddat material\"], [\"Inb\\u00E4ddat material\"])))),\n        React.createElement(\"p\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Klipp in HTML kod nedan\"], [\"Klipp in HTML kod nedan\"])))),\n        React.createElement(\"textarea\", { style: { width: \"100%\", height: \"100px\" }, value: task.embeddedHtml, onChange: function (ev) { return repo.tasks.update(task, { embeddedHtml: ev.target.value }); } })) :\n        React.createElement(\"div\", null,\n            React.createElement(\"button\", { className: \"btn\", onClick: function () { return repo.tasks.update(task, { embeddedHtml: \" \" }); } },\n                React.createElement(\"i\", { className: \"fas fa-code\", \"aria-hidden\": true }),\n                \"\\u00A0\", L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"L\\u00E4gg till inb\\u00E4ddat material\"], [\"L\\u00E4gg till inb\\u00E4ddat material\"])))),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null)) :\n        React.createElement(\"div\", null);\n};\nvar templateObject_1, templateObject_2, templateObject_3;\n","import { __awaiter, __generator, __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { L } from '../../../../../utils/utils';\nimport { withRouter } from 'react-router';\nimport { db } from '../../../../../globals/db';\nimport { HorizontalItem } from '../../../../utility-components/horizontal-item';\nimport { AlignHorizontal } from '../../../../utility-components/align-horizontal';\nexport var TaskFooterButtons = withRouter(function (_a) {\n    var school = _a.school, courseId = _a.courseId, tabId = _a.tabId, contentId = _a.contentId, draftId = _a.draftId, task = _a.task, repo = _a.repo, history = _a.history;\n    return React.createElement(React.Fragment, null,\n        React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"btn btn-warning pull-right\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                // Here we don't supply the tags from the courseContents.\n                                // Would only affect optimistic updates but since the relatedDoc\n                                // (the task) has the tags, the delta viewer will still be able\n                                // to categorize it within the correct view.\n                                repo.courseContents.removeRelated({ id: contentId }, \"tasks\", task);\n                                return [4 /*yield*/, db.saveNow()];\n                            case 1:\n                                _a.sent();\n                                history.push(\"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + tabId + \"/drafts/\" + draftId + \"/edit\");\n                                return [2 /*return*/];\n                        }\n                    });\n                }); } },\n                React.createElement(\"i\", { className: \"fas fa-trash-alt\", \"aria-hidden\": true }),\n                \"\\u00A0\",\n                school === 'standard' ? L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Ta bort uppgiften\"], [\"Ta bort uppgiften\"]))) : 'Dölj uppgiften'),\n            React.createElement(AlignHorizontal, null,\n                React.createElement(HorizontalItem, null,\n                    React.createElement(\"button\", { className: \"btn\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, repo.saveNow()];\n                                    case 1:\n                                        _a.sent();\n                                        history.push(\"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tabId || '$') + \"/contents/\" + contentId + \"/tasks/\" + task.id + \"/drafts/\" + draftId);\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); } },\n                        React.createElement(\"i\", { className: \"fas fa-eye\", \"aria-hidden\": true }),\n                        \"\\u00A0\", L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"F\\u00F6rhandsgranska\"], [\"F\\u00F6rhandsgranska\"]))))),\n                React.createElement(HorizontalItem, null,\n                    React.createElement(\"button\", { className: \"btn\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                history.push(\"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + (tabId || '$') + \"/drafts/\" + draftId + \"/edit\");\n                                return [2 /*return*/];\n                            });\n                        }); } },\n                        React.createElement(\"i\", { className: \"fas fa-arrow-left\", \"aria-hidden\": true }),\n                        \"\\u00A0\", L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"\\u00C5terg\\u00E5 till fliken\"], [\"\\u00C5terg\\u00E5 till fliken\"]))))))),\n        React.createElement(\"br\", null));\n});\nvar templateObject_1, templateObject_2, templateObject_3;\n","import { __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { useContext } from 'react';\nimport { Wysiwyg } from '../../../../utility-components/wysiwyg';\nimport actions_swedish from '../../../../utility-components/wysiwyg/actions-sv';\nimport { L, showError } from '../../../../../utils/utils';\nimport { DialogsContext } from '../../../common/dialog-context';\nimport { isKedStaff } from '../../../logic/is-ked-staff';\nimport { SelectWordBank } from '../../../common/select-word-bank';\nimport { saveSelection, restoreSelection } from '../../../../utility-components/wysiwyg/restore-selection';\nimport { cfg } from '../../../../../globals/KED.cfg';\nexport function TaskWorkingProcedureEditor(_a) {\n    var writeAccess = _a.writeAccess, task = _a.task, repo = _a.repo, step = _a.step;\n    var dialogCtx = useContext(DialogsContext);\n    var actions = [\n        \"bold\",\n        \"italic\",\n        \"underline\",\n        \"olist\",\n        \"outdent\",\n        \"indent\",\n        \"link\",\n        \"image\",\n        \"clear\"\n    ];\n    if (writeAccess) {\n        if (step) {\n            // This task is put on a step. We could link to a word bank:\n            actions.push({\n                name: \"listWordBank\",\n                icon: '<i class=\"fas fa-book\" aria-hidden=\"true\"></i>',\n                title: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"L\\u00E4nka till ordbank\"], [\"L\\u00E4nka till ordbank\"]))),\n                result: function (ev, wysiwyg) {\n                    var selection = saveSelection();\n                    dialogCtx.openDialog(React.createElement(SelectWordBank, { subject: task.subject, step: step, onSelect: function (_a) {\n                            var name = _a.name, url = _a.url;\n                            dialogCtx.closeDialog();\n                            restoreSelection(selection);\n                            var elem = document.createElement('a');\n                            elem.href = url;\n                            elem.target = \"_blank\";\n                            elem.appendChild(document.createTextNode(name));\n                            document.execCommand('insertHTML', false, elem.outerHTML);\n                        } }));\n                }\n            });\n        }\n        if (isKedStaff()) {\n            actions.push({\n                icon: '<i class=\"fas fa-link\" style=\"color:var(--col-accent)\" aria-hidden=\"true\"></i>',\n                title: 'Resurs länk',\n                result: function () {\n                    var url = window.prompt('Ange länkens URL för resursen');\n                    if (url) {\n                        //check that the entered URL is the same with the current one\n                        var urlObj = new URL('', url);\n                        if (urlObj.host !== window.location.host) {\n                            showError(\"Ogiltig resursadress\");\n                            return;\n                        }\n                        //match the resourceId\n                        var regex = new RegExp(\"([^\\.|/]+).([^\\.]+)(?=\\.html)\");\n                        var urlResults = regex.exec(urlObj.pathname);\n                        if (!cfg.KED_RESOURCES_URL) {\n                            showError(\"Resurser URL är inte konfigurerad\");\n                            return;\n                        }\n                        //replace cfg value with the one from the provided url\n                        var valueFromConfig = cfg.KED_RESOURCES_URL.replace(\"{value}\", urlResults[0]);\n                        var elem = document.createElement('a');\n                        var seletectedText = window.getSelection().toString();\n                        elem.href = valueFromConfig;\n                        elem.target = \"_blank\";\n                        elem.appendChild(document.createTextNode(seletectedText));\n                        valueFromConfig && seletectedText && document.execCommand('insertHTML', false, elem.outerHTML);\n                    }\n                }\n            });\n        }\n    }\n    return React.createElement(React.Fragment, null,\n        React.createElement(\"h4\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Arbetsprocess\"], [\"Arbetsprocess\"])))),\n        React.createElement(Wysiwyg, { actions: actions, defaultActions: actions_swedish, readOnly: !writeAccess, html: task.workingProcedure || \"\", onChange: function (html) {\n                repo.tasks.update(task, { workingProcedure: html });\n            } }));\n}\nvar templateObject_1, templateObject_2;\n","import { __read } from \"tslib\";\nimport React from 'react';\nimport { liveQueryView } from '../../../utility-components/live-query-view';\nimport { TwoColumnsPage } from '../../common/two-columns-page';\nimport { EditTaskForm } from './right-column/edit-task-form';\nimport { resolveRequirementOrder } from '../../logic/ordered-requirements';\nimport { EditRequirements } from './left-column/edit-requirements';\nimport { isEmployee } from '../../logic/is-employee';\nimport { getIdsNotCoveredByReqReferencingDocs } from '../../../course-builder/courses/business-logic';\nimport { flatten } from '../../../../utils/utils';\nexport var TaskEditor = liveQueryView(function (_a) {\n    var school = _a.school, course = _a.course, activeTab = _a.activeTab, draftId = _a.draftId, branch = _a.branch, contentId = _a.contentId, taskId = _a.taskId, blockId = _a.blockId, tabs = _a.tabs;\n    var themeCourseTab = course.tabs.find(function (t) { return t.id === activeTab; });\n    var involvedTabIds = (themeCourseTab && themeCourseTab.tabClass === 'mission-tab') ?\n        course.tabs.filter(function (tab) { return tab.tabClass === 'subject-tab'; }).map(function (tab) { return tab.id; }) :\n        themeCourseTab ? [activeTab] : tabs.map(function (t) { return t.id; });\n    return branch.tasks\n        .include(\"abilities\", \"centralContent\", \"knowledgeRequirements\").includeIdsOnly()\n        //.debug()\n        .hasEdgesFrom([contentId])\n        .toValue()\n        .combineLatest(branch.courseTabs\n        .include(\"abilities\", \"contents\", \"centralContent\", \"knowledgeRequirements\")\n        .ids(involvedTabIds))\n        .switchMap(function (_a) {\n        var _b = __read(_a, 2), tasks = _b[0], involvedTabs = _b[1];\n        // on theme courses - missing-tabs compute not covered docs using the 'subject-class' tabs ids otherwise use the current active tab values\n        // the get getIdsNotCoveredByReqReferencingDocs function result is used only for abilities and central content, not knowledge requirements\n        var currentTabs = (themeCourseTab && themeCourseTab.tabClass === 'mission-tab') ? involvedTabs : involvedTabs.filter(function (tId) { return tId.id === activeTab; });\n        //the tabContentsIds is used in EditRequirements component for computing the covered requirements for tasks from all steps from current block \n        var tabContentIds = themeCourseTab ? [contentId] : flatten(involvedTabs.map(function (it) { return it.contents.filter(function (c) { return c.type === \"learning-goals\"; }).map(function (c) { return c.id; }); }));\n        var task = tasks.filter(function (t) { return t.id === taskId; })[0];\n        var uncoveredIds = getIdsNotCoveredByReqReferencingDocs(currentTabs, tasks);\n        //compute uncovered sentences\n        var allCoveredSentences = themeCourseTab && tasks && flatten(tasks.filter(function (req) { return req.partialRequirments != null; }).map(function (_a) {\n            var partialRequirments = _a.partialRequirments;\n            return partialRequirments;\n        }));\n        return resolveRequirementOrder(task).map(function (task) {\n            return React.createElement(TwoColumnsPage, { left: React.createElement(EditRequirements, { repo: branch, task: task, tabIds: involvedTabIds, blockId: blockId, tabContentIds: tabContentIds, themeCoveredSentences: allCoveredSentences }), right: React.createElement(EditTaskForm, { repo: branch, school: school, course: course, draftId: draftId, tabId: activeTab, tab: null, contentId: contentId, writeAccess: isEmployee(school), task: task }), rightWidth: 6 });\n        });\n    });\n});\n","import { __makeTemplateObject } from \"tslib\";\nimport { L } from '../../../../utils/utils';\nexport var taskTypeHeadings = {\n    exercise: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\u00D6vningsuppgift\"], [\"\\u00D6vningsuppgift\"]))),\n    task: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Uppgift\"], [\"Uppgift\"]))),\n    assignment: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Inl\\u00E4mningsuppgift\"], [\"Inl\\u00E4mningsuppgift\"])))\n};\nvar templateObject_1, templateObject_2, templateObject_3;\n","import { __assign, __makeTemplateObject, __read } from \"tslib\";\nimport React from 'react';\nimport { liveQueryView } from '../../../../utility-components/live-query-view';\nimport { TwoColumnsPage } from '../../../common/two-columns-page';\nimport { WeekPlanner } from '../../../../weekplanner/weekplanner';\nimport { TaskViewer } from './task-viewer';\nimport { LazyContent } from '../../../../utility-components/lazy-content';\nimport { resolveRequirementOrder } from '../../../logic/ordered-requirements';\nimport { L } from '../../../../../utils/utils';\nimport { withRouter } from 'react-router';\nimport env from '../../../../../globals/KED.env';\nimport cfg from '../../../../../globals/KED.cfg';\nexport var TaskViewerPage = liveQueryView(function (props) {\n    return props.lazyRepo.map(function (repo) { return React.createElement(TaskViewerPageInner, __assign({}, __assign(__assign({}, props), { repo: repo }))); });\n});\nexport var TaskViewerPageInner = withRouter(liveQueryView(function (_a) {\n    var school = _a.school, courseId = _a.courseId, activeTab = _a.activeTab, repo = _a.repo, taskId = _a.taskId, draftId = _a.draftId, contentId = _a.contentId, history = _a.history;\n    return (repo.tasks\n        .include(\"abilities\", \"centralContent\", \"knowledgeRequirements\")\n        .id(taskId)\n        .combineLatest(repo.courseInstances.id(courseId))\n        .map(function (_a) {\n        var _b = __read(_a, 2), task = _b[0], course = _b[1];\n        return React.createElement(TwoColumnsPage, { left: React.createElement(LazyContent, null, resolveRequirementOrder(task).map(function (task) { return React.createElement(React.Fragment, null,\n                React.createElement(TaskViewer, { school: school, task: task, courseType: course.type, courseId: course.id, abilities: task.abilities, centralContent: task.centralContent, requirements: task.knowledgeRequirements, futureAbilities: task.futureAbilities, contentId: contentId, lazyRepo: repo }),\n                draftId && contentId && React.createElement(React.Fragment, null,\n                    React.createElement(\"hr\", null),\n                    React.createElement(\"button\", { className: \"btn\", onClick: function () { return history.push(\"/\" + school + \"/courses/\" + courseId + \"/tabs/\" + activeTab + \"/contents/\" + contentId + \"/tasks/\" + taskId + \"/drafts/\" + draftId + \"/edit\"); } },\n                        React.createElement(\"i\", { className: \"fas fa-lg fa-pencil-alt\" }),\n                        \" \", L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Forts\\u00E4tt redigera\"], [\"Forts\\u00E4tt redigera\"])))))); })), right: React.createElement(WeekPlanner, { env: env, viewCourseUrl: cfg.KED_COURSE_VIEWER_URL }), rightWidth: 5 });\n    }));\n}));\nvar templateObject_1;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { isEmployee } from '../../../logic/is-employee';\nimport moment from 'moment';\nimport { TaskAssignments } from '../../../../course-viewer/course-page/task-assignments';\nimport { AbilitiesBox } from '../../../../course-viewer/subcomponents/abilities-box';\nimport { CentralContentBox } from '../../../../course-viewer/subcomponents/central-content-box';\nimport { KnowledgeRequirementsBox } from '../../../../course-viewer/subcomponents/knowledge-requirements-table';\nimport { L } from '../../../../../utils/utils';\nimport { taskTypeHeadings } from '../texts';\nimport { FutureAbilitiesBox } from '../../../common/future-abilities-box';\nimport { washHtml } from '../../../../utility-components/wysiwyg/wash-html';\nimport { LazyContent } from '../../../../utility-components/lazy-content';\nimport { ExtraPageButtons } from '../../../../utility-components/extra-page-buttons';\nimport { getSchoolNameFromBranchId } from '../../../../../utils/get-school-name-from-branch-id';\nexport var TaskViewer = function (_a) {\n    var school = _a.school, task = _a.task, courseId = _a.courseId, abilities = _a.abilities, centralContent = _a.centralContent, requirements = _a.requirements, futureAbilities = _a.futureAbilities, contentId = _a.contentId, lazyRepo = _a.lazyRepo, courseType = _a.courseType;\n    var deadlineTooLate = task.deadline && moment(task.deadline).endOf('day') < moment();\n    return React.createElement(\"div\", null,\n        React.createElement(\"div\", { className: \"sv-text-portlet sv-use-margins sv-skip-spacer\" },\n            React.createElement(ExtraPageButtons, null),\n            React.createElement(\"div\", { className: \"sv-text-portlet-content\" },\n                React.createElement(\"h1\", { className: \"h1\" }, task.name))),\n        React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" }, task.content && React.createElement(React.Fragment, null,\n            React.createElement(\"div\", { dangerouslySetInnerHTML: { __html: washHtml(task.content) } }))),\n        task.description && React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n            React.createElement(\"div\", { className: [\"ked_boxed\", \"taskBox\", task.taskType].join(' '), style: { clear: \"both\" } },\n                React.createElement(\"h2\", null, taskTypeHeadings[task.taskType] || L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Uppgift\"], [\"Uppgift\"])))),\n                React.createElement(\"div\", { dangerouslySetInnerHTML: { __html: washHtml(task.description) } }))),\n        task.workingProcedure && React.createElement(\"div\", null,\n            React.createElement(\"h3\", { className: \"h3\" }, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Arbetsprocess\"], [\"Arbetsprocess\"])))),\n            React.createElement(\"div\", { className: \"rich-text-readonly\", dangerouslySetInnerHTML: { __html: washHtml(task.workingProcedure) } })),\n        courseType === \"theme-course\" && task.learningGoal && React.createElement(\"div\", null,\n            React.createElement(LazyContent, null, lazyRepo.courseContents.hasEdgesTo([task.id]).single().map(function (content) {\n                // Check that only the current content learning goals are displayed (in case that some of them are deleted)\n                // There was also a bug for theme courses, saving as a default value the subject name\n                // These are solved by filtering the saved values by the current course common learning goals\n                var hasCommonLearningGoals = content.hasCommonLearningGoals;\n                var contentlearningGoals = content.commonLearningGoals;\n                var currentLearningGoals = task.learningGoal.split('\\n').filter(function (lg) { return contentlearningGoals.includes(lg.trim()); });\n                return hasCommonLearningGoals && currentLearningGoals.length > 0 ? React.createElement(\"div\", null,\n                    React.createElement(\"h3\", { className: \"h3\" }, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"L\\u00E4randem\\u00E5l\"], [\"L\\u00E4randem\\u00E5l\"])))),\n                    React.createElement(\"ul\", null, currentLearningGoals.map(function (lg) { return React.createElement(\"li\", { key: lg }, lg); }))) : null;\n            }))),\n        React.createElement(\"br\", null),\n        task.embeddedHtml && React.createElement(\"div\", { dangerouslySetInnerHTML: { __html: task.embeddedHtml } }),\n        React.createElement(\"br\", null),\n        task.taskType === 'assignment' ? React.createElement(React.Fragment, null,\n            React.createElement(\"h2\", null, \"Inl\\u00E4mningsuppgift\"),\n            isEmployee(school) ?\n                React.createElement(\"p\", null, \"H\\u00E4r kan du som l\\u00E4rare se elevernas inl\\u00E4mnade arbeten.\") : isEmployee() ? React.createElement(\"p\", null, L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Detta \\u00E4r en inl\\u00E4mningsuppgift med inl\\u00E4mningsdatum \", \"\"], [\"Detta \\u00E4r en inl\\u00E4mningsuppgift med inl\\u00E4mningsdatum \", \"\"])), moment(task.deadline).format('YYYY-MM-DD'))) : React.createElement(React.Fragment, null,\n                React.createElement(\"p\", null, L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"L\\u00E4mna in ditt arbete som en pdf, doc eller odt fil genom att dra det till f\\u00E4ltet under.\"], [\"L\\u00E4mna in ditt arbete som en pdf, doc eller odt fil genom att dra det till f\\u00E4ltet under.\"])))),\n                task.deadline ? React.createElement(\"p\", null,\n                    React.createElement(\"b\", null,\n                        \"Den h\\u00E4r uppgiften \",\n                        deadlineTooLate ? 'skulle varit inlämnad ' : 'skall vara inlämnad ',\n                        moment(task.deadline).format('YYYY-MM-DD'))) : undefined),\n            React.createElement(TaskAssignments, { courseId: courseId, taskId: task.id, school: school, sendToUrkund: task.sendToUrkund }),\n            React.createElement(\"br\", null)) : undefined,\n        futureAbilities.length > 0 ? React.createElement(FutureAbilitiesBox, { title: L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"I den h\\u00E4r uppgiften behandlas f\\u00F6ljande framtidsf\\u00F6rm\\u00E5gor\"], [\"I den h\\u00E4r uppgiften behandlas f\\u00F6ljande framtidsf\\u00F6rm\\u00E5gor\"]))), selectedFAs: futureAbilities }) : null,\n        requirements.length > 0 && task.taskType !== 'exercise' ? React.createElement(KnowledgeRequirementsBox, { title: \"I den h\\u00E4r uppgiften bed\\u00F6ms f\\u00F6ljande kunskapskrav\", className: \"larger\", headerOpen: false, requirements: requirements, idsToSubjectMap: task.idsToSubjectMap, explainedRequirements: task.explainedRequirements, partialRequirments: task.partialRequirments }) : null,\n        React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n            abilities.length > 0 ? React.createElement(AbilitiesBox, { title: \"Den h\\u00E4r uppgiften behandlar f\\u00F6ljande f\\u00F6rm\\u00E5gor\", className: \"larger\", headerOpen: false, abilities: abilities }) : null,\n            centralContent.length > 0 ? React.createElement(CentralContentBox, { title: \"Den h\\u00E4r uppgiften behandlar f\\u00F6ljande centrala inneh\\u00E5ll\", className: \"larger\", headerOpen: false, centralContent: centralContent }) : null),\n        React.createElement(\"hr\", null),\n        React.createElement(\"hr\", null),\n        task.resources && task.resources.length > 0 && React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n            React.createElement(\"h2\", null, \"Resurser kopplade till uppgiften\"),\n            React.createElement(\"div\", { className: \"taskContainer\" }, task.resources.map(function (r, idx) {\n                return React.createElement(\"div\", { key: idx, className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"a\", { href: r.url }, r.name)));\n            })),\n            React.createElement(\"br\", null)),\n        React.createElement(\"br\", null),\n        React.createElement(LazyContent, null, getSchoolNameFromBranchId(task.$ownerBranch).map(function (x) { return React.createElement(\"p\", null, L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"Skapad av \", \"\"], [\"Skapad av \", \"\"])), x)); })),\n        task.$editBranch && React.createElement(LazyContent, null, getSchoolNameFromBranchId(task.$editBranch).map(function (x) { return React.createElement(\"p\", null, L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"Redigerad av \", \"\"], [\"Redigerad av \", \"\"])), x)); })));\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8;\n","import { __awaiter, __generator } from \"tslib\";\nimport React from \"react\";\nimport { DeltaDocBox } from \"./deltadoc-box\";\nimport { DeltaLinkBox } from \"./deltalink-box\";\nimport { undoDeltaDoc, undoDeltaRelation } from \"./delta-helper-funcs\";\nimport { db } from '../../../../globals/db';\nexport function DeltaBoxes(_a) {\n    var _this = this;\n    var deltas = _a.deltas, editable = _a.editable, branchId = _a.branchId;\n    return (React.createElement(React.Fragment, null,\n        React.createElement(\"div\", { className: \"taskContainer odd-even\" }, deltas.map(function (delta) {\n            var key = deltaKey(delta);\n            return delta.type === \"modify\" ? (React.createElement(DeltaDocBox, { delta: delta, editable: editable, key: key, onDelete: function () { return __awaiter(_this, void 0, void 0, function () {\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                // Undo DeltaDoc\n                                undoDeltaDoc(delta, branchId);\n                                return [4 /*yield*/, db.saveNow()];\n                            case 1:\n                                _a.sent();\n                                location.reload();\n                                return [2 /*return*/];\n                        }\n                    });\n                }); } })) : (React.createElement(DeltaLinkBox, { delta: delta, editable: editable, key: key, onDelete: function () { return __awaiter(_this, void 0, void 0, function () {\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                // Undo Link\n                                undoDeltaRelation(delta, branchId);\n                                return [4 /*yield*/, db.saveNow()];\n                            case 1:\n                                _a.sent();\n                                location.reload();\n                                return [2 /*return*/];\n                        }\n                    });\n                }); } }));\n        }))));\n}\nfunction deltaKey(delta) {\n    if (delta.type === \"modify\")\n        return delta.targetId;\n    return delta.sourceId + delta.label + delta.targetId;\n}\n","import { __values } from \"tslib\";\nimport { db } from '../../../../globals/db';\nexport function undoDeltas(deltas, branchId) {\n    var e_1, _a;\n    try {\n        for (var deltas_1 = __values(deltas), deltas_1_1 = deltas_1.next(); !deltas_1_1.done; deltas_1_1 = deltas_1.next()) {\n            var delta = deltas_1_1.value;\n            if (delta.type === \"modify\") {\n                undoDeltaDoc(delta, branchId);\n            }\n            else {\n                undoDeltaRelation(delta, branchId);\n            }\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (deltas_1_1 && !deltas_1_1.done && (_a = deltas_1.return)) _a.call(deltas_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n}\nexport function undoDeltaRelation(delta, branchId) {\n    db.branch(branchId)\n        .table(delta.sourceTable)\n        .undoLink(delta.sourceId, delta.label, delta.targetId);\n}\nexport function undoDeltaDoc(delta, branchId) {\n    var undoings = {};\n    Object.keys(delta.data).forEach(function (key) {\n        undoings[key] = { $unset: 0 };\n    });\n    db.branch(branchId)\n        .table(delta.table)\n        .update({\n        id: delta.targetId,\n        name: delta.targetName,\n        tags: delta.targetTags\n    }, undoings);\n}\n","import { __makeTemplateObject, __read } from \"tslib\";\nimport React from 'react';\nimport { maxLength, capitalizeFirst, L } from '../../../../utils/utils';\nimport { modelNames, deltaTypes } from './model-friendly-names';\nimport { shortDateFormat } from '../../../course-builder/utils';\nexport function DeltaDocBox(_a) {\n    var delta = _a.delta, editable = _a.editable, onDelete = _a.onDelete;\n    var entityName = delta.targetName && maxLength(delta.targetName, 80);\n    var classNames = [\"schoolCourse\"];\n    if (delta.$meta)\n        classNames.push(\"entitymeta-\" + delta.$meta);\n    var friendlyEntityType = capitalizeFirst(modelNames.entityTypes[delta.table] || delta.table);\n    var friendlyProps = Object.keys(delta.data).map(function (prop) {\n        return ({\n            propSpec: modelNames.propertyNames[prop],\n            prop: prop\n        });\n    });\n    var hasUnknownProps = friendlyProps.some(function (fp) { return !fp.propSpec; });\n    return React.createElement(\"div\", { className: classNames.join(' ') },\n        React.createElement(\"div\", { className: \"align-horizontal\" },\n            editable ? React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\n                React.createElement(\"a\", { className: \"undo\", onClick: onDelete },\n                    React.createElement(\"i\", { className: \"fas fa-undo\" }))) : null,\n            React.createElement(\"div\", { className: \"horizontalItem top\" }, entityName ?\n                React.createElement(\"a\", null,\n                    friendlyEntityType,\n                    \" \\\"\",\n                    entityName,\n                    \"\\\"\") :\n                React.createElement(\"a\", null, friendlyEntityType))),\n        friendlyProps.filter(function (_a) {\n            var propSpec = _a.propSpec;\n            return propSpec;\n        }).map(function (_a) {\n            var _b = __read(_a.propSpec, 2), type = _b[0], propName = _b[1], prop = _a.prop;\n            return React.createElement(\"div\", { key: prop }, type === deltaTypes.Obscure ?\n                React.createElement(\"p\", null, propName) :\n                type === deltaTypes.HiddenChange ? null :\n                    React.createElement(\"p\", null,\n                        propName,\n                        \": \",\n                        modelNames.getPropVal(delta.data[prop], type, prop)));\n        }),\n        hasUnknownProps ? React.createElement(\"div\", null,\n            React.createElement(\"p\", { title: JSON.stringify(delta.data, null, 4) }, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\u00C4ndringar i interna egenskaper\"], [\"\\u00C4ndringar i interna egenskaper\"]))))) : null,\n        React.createElement(\"div\", null,\n            React.createElement(\"p\", { className: \"small\" },\n                shortDateFormat(delta.dateTime),\n                \" \",\n                delta.contributors.join(', '))));\n}\nvar templateObject_1;\n","import React from 'react';\nimport { maxLength } from '../../../../utils/utils';\nimport { modelNames, removeHtmlTags } from './model-friendly-names';\nimport { shortDateFormat } from '../../../course-builder/utils';\nexport function DeltaLinkBox(_a) {\n    var delta = _a.delta, editable = _a.editable, onDelete = _a.onDelete;\n    var entityName = delta.targetName && maxLength(removeHtmlTags(delta.targetName), 80);\n    var classNames = [\"schoolCourse\"];\n    if (delta.$meta)\n        classNames.push(\"entitymeta-\" + delta.$meta);\n    var friendlyOperation = modelNames.getModifiedLinkHeading(delta, editable);\n    return React.createElement(\"div\", { className: classNames.join(' ') },\n        React.createElement(\"div\", { className: \"align-horizontal\" },\n            editable ? React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\n                React.createElement(\"a\", { className: \"undo\", onClick: onDelete },\n                    React.createElement(\"i\", { className: \"fas fa-undo\" }))) : null,\n            React.createElement(\"div\", { className: \"horizontalItem top\" }, entityName ?\n                React.createElement(\"a\", null,\n                    friendlyOperation,\n                    \" \\\"\",\n                    entityName,\n                    \"\\\"\") :\n                React.createElement(\"a\", null, friendlyOperation))),\n        React.createElement(\"div\", null,\n            React.createElement(\"p\", { className: \"small\" },\n                shortDateFormat(delta.dateTime),\n                \" \",\n                delta.contributor)));\n}\n","import { __makeTemplateObject } from \"tslib\";\nimport React from \"react\";\nimport { withObserve } from \"../../../utility-components/with-observe\";\nimport { db } from \"../../../../globals/db\";\nimport { L } from \"../../../../utils/utils\";\nimport { UndoDeltasButton } from \"./undo-deltas-button\";\nimport { DeltaBoxes } from \"./delta-boxes\";\nimport { features } from \"../../../../features\";\nexport var DraftDeltaView = withObserve(function (_a) {\n    var branchId = _a.branchId, allowCherryPick = _a.allowCherryPick, partTagPrefix = _a.partTagPrefix, partTag = _a.partTag, partLabel = _a.partLabel;\n    // Create a query for all deltas in given branchId:\n    var query = db.branch(branchId).deltas;\n    // Execute query using suspense-reading (will be observed also for changes so this component rerenders)\n    var deltas = query.toValue().read();\n    if (!features.KDT592) { // Remove this code after week 44!\n        return (React.createElement(\"div\", { className: \"ked_boxed\" },\n            React.createElement(\"h3\", null, \"Opublicerade \\u00E4ndringar\"),\n            deltas.length === 0 ? (React.createElement(\"div\", null,\n                React.createElement(\"p\", { style: { opacity: 0.5, fontStyle: \"italic\" } }, \"Det finns inga \\u00E4ndringar att publicera.\"))) : (React.createElement(React.Fragment, null,\n                React.createElement(\"div\", { className: \"taskContainer odd-even\" },\n                    React.createElement(DeltaBoxes, { branchId: branchId, deltas: deltas, editable: allowCherryPick })),\n                React.createElement(UndoDeltasButton, { label: \"Radera alla opublicerade \\u00E4ndringar\", confirmMsg: \"Åtgärden raderar samtliga ändringar som ännu inte är publicerade.\\n\\nVill du fortsätta?\", branchId: branchId, deltas: deltas })))));\n    }\n    // Certain changes bound to step / tab:\n    var taggedDeltas = deltas.filter(function (d) {\n        return getMergedDeltaTags(d).includes(partTag);\n    });\n    // Course-global changes (such as course name, course description or added/removed blocks):\n    var globalDeltas = deltas.filter(function (d) { return !getMergedDeltaTags(d).some(function (tag) { return tag.startsWith(partTagPrefix); }); });\n    return (React.createElement(React.Fragment, null,\n        globalDeltas.length > 0 && (React.createElement(\"div\", { className: \"ked_boxed\" },\n            React.createElement(\"h3\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Opublicerade kurs\\u00F6vergripande \\u00E4ndringar\"], [\"Opublicerade kurs\\u00F6vergripande \\u00E4ndringar\"])))),\n            React.createElement(DeltaBoxes, { branchId: branchId, deltas: globalDeltas, editable: allowCherryPick }),\n            React.createElement(UndoDeltasButton, { branchId: branchId, deltas: globalDeltas, label: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"\\u00C5ngra kurs\\u00F6vergripande inst\\u00E4llningar\"], [\"\\u00C5ngra kurs\\u00F6vergripande inst\\u00E4llningar\"]))) }))),\n        React.createElement(\"div\", { className: \"ked_boxed\" },\n            React.createElement(\"h3\", null, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Opublicerade \\u00E4ndringar i \", \"\"], [\"Opublicerade \\u00E4ndringar i \", \"\"])), partLabel)),\n            taggedDeltas.length > 0 ? (React.createElement(React.Fragment, null,\n                React.createElement(DeltaBoxes, { branchId: branchId, deltas: taggedDeltas, editable: allowCherryPick }),\n                React.createElement(UndoDeltasButton, { branchId: branchId, deltas: taggedDeltas, label: L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"\\u00C5ngra \\u00E4ndringarna i \", \"\"], [\"\\u00C5ngra \\u00E4ndringarna i \", \"\"])), partLabel) }))) : (React.createElement(\"div\", null,\n                React.createElement(\"p\", { style: { opacity: 0.5, fontStyle: \"italic\" } }, L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Det finns inga \\u00E4ndringar att publicera.\"], [\"Det finns inga \\u00E4ndringar att publicera.\"])))))))));\n});\n// Helper function that merges sourceTags and targetTags into a single array:\nfunction getMergedDeltaTags(delta) {\n    return (delta.targetTags ? delta.targetTags : []).concat(\"sourceTags\" in delta && delta.sourceTags ? delta.sourceTags : []);\n}\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5;\n","export * from \"./version-history-page\";\nexport * from \"./draft-delta-view\";\n","import { __makeTemplateObject } from \"tslib\";\nimport { L, maxLength } from '../../../../utils/utils';\nvar Text = Symbol(\"TypeText\");\nvar Checkbox = Symbol(\"TypeCheckbox\");\nvar Obscure = Symbol(\"TypeObsure\");\nvar HiddenChange = Symbol(\"TypeHiddenChange\");\nvar Html = Symbol(\"TypeHtml\");\nexport var deltaTypes = {\n    Text: Text,\n    Html: Html,\n    Checkbox: Checkbox,\n    Obscure: Obscure,\n    HiddenChange: HiddenChange\n};\nexport var modelNames = {\n    entityTypes: {\n        courseBlocks: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"kursblock\"], [\"kursblock\"]))),\n        courseContents: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"inneh\\u00E5llsruta\"], [\"inneh\\u00E5llsruta\"]))),\n        courseInstances: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"kurs\"], [\"kurs\"]))),\n        courseTabs: L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"flik\"], [\"flik\"]))),\n        schools: L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"skola\"], [\"skola\"]))),\n        tasks: L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"uppgift\"], [\"uppgift\"]))),\n    },\n    modifiedLinks: {\n        tabs: [L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"Tillagd flik\"], [\"Tillagd flik\"]))), L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"Borttagen flik\"], [\"Borttagen flik\"]))), L(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"Dold flik\"], [\"Dold flik\"])))],\n        blocks: [L(templateObject_10 || (templateObject_10 = __makeTemplateObject([\"Tillagt block\"], [\"Tillagt block\"]))), L(templateObject_11 || (templateObject_11 = __makeTemplateObject([\"Borttaget block\"], [\"Borttaget block\"]))), L(templateObject_12 || (templateObject_12 = __makeTemplateObject([\"Dold block\"], [\"Dold block\"])))],\n        abilities: [L(templateObject_13 || (templateObject_13 = __makeTemplateObject([\"Tillagd f\\u00F6rm\\u00E5ga\"], [\"Tillagd f\\u00F6rm\\u00E5ga\"]))), L(templateObject_14 || (templateObject_14 = __makeTemplateObject([\"Borttagen f\\u00F6rm\\u00E5ga\"], [\"Borttagen f\\u00F6rm\\u00E5ga\"]))), L(templateObject_15 || (templateObject_15 = __makeTemplateObject([\"Dold f\\u00F6rm\\u00E5ga\"], [\"Dold f\\u00F6rm\\u00E5ga\"])))],\n        centralContent: [L(templateObject_16 || (templateObject_16 = __makeTemplateObject([\"Tillagt centralt inneh\\u00E5ll\"], [\"Tillagt centralt inneh\\u00E5ll\"]))), L(templateObject_17 || (templateObject_17 = __makeTemplateObject([\"Borttaget centralt inneh\\u00E5ll\"], [\"Borttaget centralt inneh\\u00E5ll\"]))), L(templateObject_18 || (templateObject_18 = __makeTemplateObject([\"Dold centralt inneh\\u00E5ll\"], [\"Dold centralt inneh\\u00E5ll\"])))],\n        knowledgeRequirements: [L(templateObject_19 || (templateObject_19 = __makeTemplateObject([\"Tillagt kunskapskrav\"], [\"Tillagt kunskapskrav\"]))), L(templateObject_20 || (templateObject_20 = __makeTemplateObject([\"Borttaget kunskapskrav\"], [\"Borttaget kunskapskrav\"]))), L(templateObject_21 || (templateObject_21 = __makeTemplateObject([\"Dold kunskapskrav\"], [\"Dold kunskapskrav\"])))],\n        tasks: [L(templateObject_22 || (templateObject_22 = __makeTemplateObject([\"Tillagd uppgift\"], [\"Tillagd uppgift\"]))), L(templateObject_23 || (templateObject_23 = __makeTemplateObject([\"Borttagen uppgift\"], [\"Borttagen uppgift\"]))), L(templateObject_24 || (templateObject_24 = __makeTemplateObject([\"Dold uppgift\"], [\"Dold uppgift\"])))],\n        contents: [L(templateObject_25 || (templateObject_25 = __makeTemplateObject([\"Tillagd inneh\\u00E5llsruta\"], [\"Tillagd inneh\\u00E5llsruta\"]))), L(templateObject_26 || (templateObject_26 = __makeTemplateObject([\"Borttagen inneh\\u00E5llsruta\"], [\"Borttagen inneh\\u00E5llsruta\"]))), L(templateObject_27 || (templateObject_27 = __makeTemplateObject([\"Dold inneh\\u00E5llsruta\"], [\"Dold inneh\\u00E5llsruta\"])))]\n    },\n    propertyNames: {\n        allowAddTabs: [Checkbox, L(templateObject_28 || (templateObject_28 = __makeTemplateObject([\"\\u00C4ndrat om till\\u00E4gg av flik ska vara till\\u00E5tet\"], [\"\\u00C4ndrat om till\\u00E4gg av flik ska vara till\\u00E5tet\"])))],\n        allowRemoveTabs: [Checkbox, L(templateObject_29 || (templateObject_29 = __makeTemplateObject([\"\\u00C4ndrat om borttagning av flik ska vara till\\u00E5tet\"], [\"\\u00C4ndrat om borttagning av flik ska vara till\\u00E5tet\"])))],\n        allowReorderTabs: [Checkbox, L(templateObject_30 || (templateObject_30 = __makeTemplateObject([\"\\u00C4ndrat om det ska va till\\u00E5tet att \\u00E4ndra ordning p\\u00E5 flik\"], [\"\\u00C4ndrat om det ska va till\\u00E5tet att \\u00E4ndra ordning p\\u00E5 flik\"])))],\n        assignment: [Checkbox, L(templateObject_31 || (templateObject_31 = __makeTemplateObject([\"\\u00C4ndrad flagga f\\u00F6r inl\\u00E4mningsuppgift\"], [\"\\u00C4ndrad flagga f\\u00F6r inl\\u00E4mningsuppgift\"])))],\n        commonLearningGoals: [Text, L(templateObject_32 || (templateObject_32 = __makeTemplateObject([\"\\u00C4ndrade gemensamma l\\u00E4randem\\u00E5l\"], [\"\\u00C4ndrade gemensamma l\\u00E4randem\\u00E5l\"])))],\n        content: [Html, L(templateObject_33 || (templateObject_33 = __makeTemplateObject([\"\\u00C4ndrad inneh\\u00E5llstext\"], [\"\\u00C4ndrad inneh\\u00E5llstext\"])))],\n        createdBy: [HiddenChange, L(templateObject_34 || (templateObject_34 = __makeTemplateObject([\"Skapad av\"], [\"Skapad av\"])))],\n        createdDate: [HiddenChange, L(templateObject_35 || (templateObject_35 = __makeTemplateObject([\"Skapad datum\"], [\"Skapad datum\"])))],\n        dateTime: [Obscure, L(templateObject_36 || (templateObject_36 = __makeTemplateObject([\"\\u00C4ndat datum / tid\"], [\"\\u00C4ndat datum / tid\"])))],\n        deadline: [Text, L(templateObject_37 || (templateObject_37 = __makeTemplateObject([\"\\u00C4ndrat inl\\u00E4mningsdatum\"], [\"\\u00C4ndrat inl\\u00E4mningsdatum\"])))],\n        description: [Html, L(templateObject_38 || (templateObject_38 = __makeTemplateObject([\"\\u00C4ndrad beskrivning\"], [\"\\u00C4ndrad beskrivning\"])))],\n        embeddedHtml: [Obscure, L(templateObject_39 || (templateObject_39 = __makeTemplateObject([\"Lagt till inb\\u00E4ddad HTML\"], [\"Lagt till inb\\u00E4ddad HTML\"])))],\n        explainedRequirements: [Obscure, L(templateObject_40 || (templateObject_40 = __makeTemplateObject([\"Lagt till egna f\\u00F6rklaringar av kunskapskrav\"], [\"Lagt till egna f\\u00F6rklaringar av kunskapskrav\"])))],\n        futureAbilities: [Text, L(templateObject_41 || (templateObject_41 = __makeTemplateObject([\"\\u00C4ndrade framtidsf\\u00F6rm\\u00E5gor\"], [\"\\u00C4ndrade framtidsf\\u00F6rm\\u00E5gor\"])))],\n        hasCommonLearningGoals: [Checkbox, L(templateObject_42 || (templateObject_42 = __makeTemplateObject([\"\\u00C4ndrad inst\\u00E4llning f\\u00F6r gemensamma l\\u00E4randem\\u00E5l\"], [\"\\u00C4ndrad inst\\u00E4llning f\\u00F6r gemensamma l\\u00E4randem\\u00E5l\"])))],\n        hidden: [Checkbox, L(templateObject_43 || (templateObject_43 = __makeTemplateObject([\"\\u00C4ndrad flagga \\\"g\\u00F6md\\\"\"], [\"\\u00C4ndrad flagga \\\"g\\u00F6md\\\"\"])))],\n        hiddenTasks: [Obscure, L(templateObject_44 || (templateObject_44 = __makeTemplateObject([\"\\u00C4ndrat listan p\\u00E5 g\\u00F6mda uppgifter\"], [\"\\u00C4ndrat listan p\\u00E5 g\\u00F6mda uppgifter\"])))],\n        html: [Obscure, L(templateObject_45 || (templateObject_45 = __makeTemplateObject([\"\\u00C4ndrat inneh\\u00E5ll\"], [\"\\u00C4ndrat inneh\\u00E5ll\"])))],\n        learningGoal: [Text, L(templateObject_46 || (templateObject_46 = __makeTemplateObject([\"L\\u00E4randem\\u00E5l\"], [\"L\\u00E4randem\\u00E5l\"])))],\n        lockDelete: [Checkbox, L(templateObject_47 || (templateObject_47 = __makeTemplateObject([\"\\u00C4ndrat flagga: \\\"l\\u00E5s fr\\u00E5n borttagning\\\"\"], [\"\\u00C4ndrat flagga: \\\"l\\u00E5s fr\\u00E5n borttagning\\\"\"])))],\n        locked: [Checkbox, L(templateObject_48 || (templateObject_48 = __makeTemplateObject([\"\\u00C4ndrad flagga: \\\"f\\u00F6rbjud \\u00E4ndring av flikar\\\"\"], [\"\\u00C4ndrad flagga: \\\"f\\u00F6rbjud \\u00E4ndring av flikar\\\"\"])))],\n        migratedTexts: [Obscure, L(templateObject_49 || (templateObject_49 = __makeTemplateObject([\"\\u00C4ndringar i migrerade texter fr\\u00E5n skolverket\"], [\"\\u00C4ndringar i migrerade texter fr\\u00E5n skolverket\"])))],\n        modifiedBy: [HiddenChange, L(templateObject_50 || (templateObject_50 = __makeTemplateObject([\"\\u00C4ndrad av\"], [\"\\u00C4ndrad av\"])))],\n        modifiedDate: [HiddenChange, L(templateObject_51 || (templateObject_51 = __makeTemplateObject([\"\\u00C4ndringsdatum\"], [\"\\u00C4ndringsdatum\"])))],\n        taskOrder: [Obscure, L(templateObject_52 || (templateObject_52 = __makeTemplateObject([\"\\u00C4ndrad ordning p\\u00E5 uppgifter\"], [\"\\u00C4ndrad ordning p\\u00E5 uppgifter\"])))],\n        name: [Text, L(templateObject_53 || (templateObject_53 = __makeTemplateObject([\"\\u00C4ndrat namn\"], [\"\\u00C4ndrat namn\"])))],\n        order: [Obscure, L(templateObject_54 || (templateObject_54 = __makeTemplateObject([\"\\u00C4ndrad ordning\"], [\"\\u00C4ndrad ordning\"])))],\n        resources: [Obscure, L(templateObject_55 || (templateObject_55 = __makeTemplateObject([\"\\u00C4ndrade i resurser\"], [\"\\u00C4ndrade i resurser\"])))],\n        school: [Text, L(templateObject_56 || (templateObject_56 = __makeTemplateObject([\"Skola\"], [\"Skola\"])))],\n        stepNo: [Text, L(templateObject_57 || (templateObject_57 = __makeTemplateObject([\"Stegnummer\"], [\"Stegnummer\"])))],\n        stepNumbers: [Text, L(templateObject_58 || (templateObject_58 = __makeTemplateObject([\"Stegnummer\"], [\"Stegnummer\"])))],\n        subject: [Text, L(templateObject_59 || (templateObject_59 = __makeTemplateObject([\"\\u00C4mne\"], [\"\\u00C4mne\"])))],\n        subjects: [Obscure, L(templateObject_60 || (templateObject_60 = __makeTemplateObject([\"\\u00C4mnen\"], [\"\\u00C4mnen\"])))],\n        tabClass: [Text, L(templateObject_61 || (templateObject_61 = __makeTemplateObject([\"Typ av flik\"], [\"Typ av flik\"])))],\n        tabTitle: [HiddenChange, L(templateObject_62 || (templateObject_62 = __makeTemplateObject([\"Fliknamn\"], [\"Fliknamn\"])))],\n        taskType: [Text, L(templateObject_63 || (templateObject_63 = __makeTemplateObject([\"Uppgiftstyp\"], [\"Uppgiftstyp\"])))],\n        url: [Text, L(templateObject_64 || (templateObject_64 = __makeTemplateObject([\"Url\"], [\"Url\"])))],\n        workingProcedure: [Html, L(templateObject_65 || (templateObject_65 = __makeTemplateObject([\"Arbetsprocess\"], [\"Arbetsprocess\"])))],\n        youtubeId: [Obscure, L(templateObject_66 || (templateObject_66 = __makeTemplateObject([\"Youtube ID\"], [\"Youtube ID\"])))]\n    },\n    getModifiedLinkHeading: function (delta, notStandardSchool) {\n        var headingSpec = modelNames.modifiedLinks[delta.label];\n        // Problem: When delta.label == \"contents\", the headingSpec here is too\n        // generic: \"Tillagd innehållsruta\" (\"Added context box\") is not very expressive when a resource\n        // was added for example. What we could do (at a higher level) would be\n        // request the entity of the added ID (lazily/suspensish) and display more\n        // details about what was added.\n        if (!headingSpec) {\n            return delta.type === 'add' ? L(templateObject_67 || (templateObject_67 = __makeTemplateObject([\"Tillagt objekt\"], [\"Tillagt objekt\"]))) :\n                delta.type === 'remove' ? L(templateObject_68 || (templateObject_68 = __makeTemplateObject([\"Borttaget objekt\"], [\"Borttaget objekt\"]))) : L(templateObject_69 || (templateObject_69 = __makeTemplateObject([\"\\u00C5ngrad l\\u00E4nkning\"], [\"\\u00C5ngrad l\\u00E4nkning\"]))); // Should never be\n        }\n        return delta.type === 'add' ?\n            headingSpec[0] : delta.type === 'remove' ?\n            notStandardSchool ?\n                headingSpec[2] : headingSpec[1]\n            : L(templateObject_70 || (templateObject_70 = __makeTemplateObject([\"\\u00C5ngrad l\\u00E4nkning\"], [\"\\u00C5ngrad l\\u00E4nkning\"]))); // Should never be\n    },\n    getPropVal: function (p, type, prop) {\n        switch (p) {\n            case true: return L(templateObject_71 || (templateObject_71 = __makeTemplateObject([\"P\\u00E5slaget\"], [\"P\\u00E5slaget\"])));\n            case false: return L(templateObject_72 || (templateObject_72 = __makeTemplateObject([\"Avslaget\"], [\"Avslaget\"])));\n            case 'primary': return L(templateObject_73 || (templateObject_73 = __makeTemplateObject([\"Grundskola\"], [\"Grundskola\"])));\n            case 'gymnasium': return L(templateObject_74 || (templateObject_74 = __makeTemplateObject([\"Gymnasieskola\"], [\"Gymnasieskola\"])));\n            case 'exercise': return L(templateObject_75 || (templateObject_75 = __makeTemplateObject([\"\\u00D6vningsuppgift\"], [\"\\u00D6vningsuppgift\"])));\n            case 'task': return L(templateObject_76 || (templateObject_76 = __makeTemplateObject([\"Uppgift\"], [\"Uppgift\"])));\n            case 'assignment': return L(templateObject_77 || (templateObject_77 = __makeTemplateObject([\"Inl\\u00E4mningsuppgift\"], [\"Inl\\u00E4mningsuppgift\"])));\n            case 'theme-course': return L(templateObject_78 || (templateObject_78 = __makeTemplateObject([\"Temakurs\"], [\"Temakurs\"])));\n            case 'step-course': return L(templateObject_79 || (templateObject_79 = __makeTemplateObject([\"Stegkurs\"], [\"Stegkurs\"])));\n            case 'intro-tab': return L(templateObject_80 || (templateObject_80 = __makeTemplateObject([\"Introduktionsflik\"], [\"Introduktionsflik\"])));\n            case 'run-up-tab': return L(templateObject_81 || (templateObject_81 = __makeTemplateObject([\"Upptakt\"], [\"Upptakt\"])));\n            case 'subject-tab': return L(templateObject_82 || (templateObject_82 = __makeTemplateObject([\"\\u00C4mnesflik\"], [\"\\u00C4mnesflik\"])));\n            case 'mission-tab': return L(templateObject_83 || (templateObject_83 = __makeTemplateObject([\"Uppdragsflik\"], [\"Uppdragsflik\"])));\n            case 'content-tab': return L(templateObject_84 || (templateObject_84 = __makeTemplateObject([\"Inneh\\u00E5llsflik\"], [\"Inneh\\u00E5llsflik\"])));\n            case 'teacher-tab': return L(templateObject_85 || (templateObject_85 = __makeTemplateObject([\"L\\u00E4rarsida\"], [\"L\\u00E4rarsida\"])));\n            case 'word-bank-tab': return L(templateObject_86 || (templateObject_86 = __makeTemplateObject([\"Ordbank\"], [\"Ordbank\"])));\n            default: {\n                if (p == null)\n                    return L(templateObject_87 || (templateObject_87 = __makeTemplateObject([\"Nollst\\u00E4llt\"], [\"Nollst\\u00E4llt\"])));\n                if (p === \"\")\n                    return L(templateObject_88 || (templateObject_88 = __makeTemplateObject([\"(tomt)\"], [\"(tomt)\"])));\n                if (type === Html)\n                    return maxLength(removeHtmlTags(p), 300);\n                if (typeof p === 'string')\n                    return p;\n                if (p.subjectName)\n                    return p.subjectName;\n                return JSON.stringify(p, null, 2);\n            }\n        }\n    }\n};\nexport function removeHtmlTags(html) {\n    var div = document.createElement('div');\n    div.innerHTML = html;\n    return div.innerText;\n}\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10, templateObject_11, templateObject_12, templateObject_13, templateObject_14, templateObject_15, templateObject_16, templateObject_17, templateObject_18, templateObject_19, templateObject_20, templateObject_21, templateObject_22, templateObject_23, templateObject_24, templateObject_25, templateObject_26, templateObject_27, templateObject_28, templateObject_29, templateObject_30, templateObject_31, templateObject_32, templateObject_33, templateObject_34, templateObject_35, templateObject_36, templateObject_37, templateObject_38, templateObject_39, templateObject_40, templateObject_41, templateObject_42, templateObject_43, templateObject_44, templateObject_45, templateObject_46, templateObject_47, templateObject_48, templateObject_49, templateObject_50, templateObject_51, templateObject_52, templateObject_53, templateObject_54, templateObject_55, templateObject_56, templateObject_57, templateObject_58, templateObject_59, templateObject_60, templateObject_61, templateObject_62, templateObject_63, templateObject_64, templateObject_65, templateObject_66, templateObject_67, templateObject_68, templateObject_69, templateObject_70, templateObject_71, templateObject_72, templateObject_73, templateObject_74, templateObject_75, templateObject_76, templateObject_77, templateObject_78, templateObject_79, templateObject_80, templateObject_81, templateObject_82, templateObject_83, templateObject_84, templateObject_85, templateObject_86, templateObject_87, templateObject_88;\n","import { __awaiter, __generator, __makeTemplateObject } from \"tslib\";\nimport React from \"react\";\nimport { showInfo, L } from \"../../../../utils/utils\";\nimport { undoDeltas } from \"./delta-helper-funcs\";\nimport { db } from \"../../../../globals/db\";\nexport function ResetCourseButton(_a) {\n    var _this = this;\n    var courseId = _a.courseId, branchId = _a.branchId;\n    return (React.createElement(\"button\", { className: \"btn btn-large btn-warning\", onClick: function () { return __awaiter(_this, void 0, void 0, function () {\n            var deltas;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!confirm(L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\u00C5tg\\u00E4rden \\u00E5terst\\u00E4llet kursen till standard.\\n\\nVill du forts\\u00E4tta?\"], [\"\\u00C5tg\\u00E4rden \\u00E5terst\\u00E4llet kursen till standard.\\\\n\\\\nVill du forts\\u00E4tta?\"]))))) return [3 /*break*/, 3];\n                        showInfo(L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"\\u00C5terst\\u00E4ller kursen till orginal...\"], [\"\\u00C5terst\\u00E4ller kursen till orginal...\"]))));\n                        return [4 /*yield*/, db\n                                .branch(branchId)\n                                .deltas.tag(courseId)\n                                .toValue()\n                                .load()];\n                    case 1:\n                        deltas = _a.sent();\n                        undoDeltas(deltas, branchId);\n                        return [4 /*yield*/, db.saveNow()];\n                    case 2:\n                        _a.sent();\n                        showInfo(L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Kursen \\u00E4r \\u00E5terst\\u00E4lld. Sidan laddas nu om...\"], [\"Kursen \\u00E4r \\u00E5terst\\u00E4lld. Sidan laddas nu om...\"]))));\n                        location.reload();\n                        _a.label = 3;\n                    case 3: return [2 /*return*/];\n                }\n            });\n        }); } }, L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"\\u00C5terst\\u00E4ll till orginalet\"], [\"\\u00C5terst\\u00E4ll till orginalet\"])))));\n}\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4;\n","import { __awaiter, __generator } from \"tslib\";\nimport React from \"react\";\nimport { undoDeltas } from \"./delta-helper-funcs\";\nimport { db } from '../../../../globals/db';\nexport function UndoDeltasButton(_a) {\n    var _this = this;\n    var deltas = _a.deltas, label = _a.label, confirmMsg = _a.confirmMsg, branchId = _a.branchId;\n    return (React.createElement(\"button\", { className: \"btn btn-large btn-warning\", onClick: function () { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(!confirmMsg || confirm(confirmMsg))) return [3 /*break*/, 2];\n                        undoDeltas(deltas, branchId);\n                        return [4 /*yield*/, db.saveNow()];\n                    case 1:\n                        _a.sent();\n                        location.reload();\n                        _a.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        }); } }, label));\n}\n","import { __assign, __makeTemplateObject } from \"tslib\";\nimport React, { Suspense } from 'react';\nimport { db, CourseInstances } from '../../../../globals/db';\nimport { Banner } from '../../common/banner';\nimport { L } from '../../../../utils/utils';\nimport { Link } from 'react-router-dom';\nimport { VersionHistoryView } from './version-history-view';\nimport { withObserve } from '../../../utility-components/with-observe';\nimport { TimeoutEllipsisLoader } from '../../../course-builder/sub-components/ellipsis-loader';\nexport var VersionHistoryPage = function (props) { return React.createElement(Suspense, { fallback: React.createElement(TimeoutEllipsisLoader, null) },\n    React.createElement(VersionHistoryPage_, __assign({}, props))); };\nvar VersionHistoryPage_ = withObserve(function (_a) {\n    var school = _a.school, courseId = _a.courseId;\n    var schoolEntity = db.schools.cacheOptimized().name(school).single().read();\n    var draftId = CourseInstances.getBranchIdSuspense(schoolEntity, courseId);\n    var repo = db.branch(draftId);\n    var course = repo.courseInstances.id(courseId).read();\n    var bannerProps = {\n        title: course.name,\n        activeTab: \"versionhistory\",\n        tabs: [{ name: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Versionshistorik\"], [\"Versionshistorik\"]))), key: \"versionhistory\" }],\n        buttons: [React.createElement(Link, { to: \"/\" + school + \"/courses/\" + courseId, key: \"$settings\", title: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Visa kursen\"], [\"Visa kursen\"]))) },\n                React.createElement(\"i\", { className: \"fas fa-eye\", \"aria-hidden\": true }),\n                \"\\u00A0\")]\n    };\n    return React.createElement(React.Fragment, null,\n        React.createElement(Banner, __assign({}, bannerProps)),\n        React.createElement(VersionHistoryView, { allowCherryPick: true, branchId: schoolEntity.officialBranchId, courseId: courseId }));\n});\nvar templateObject_1, templateObject_2;\n","import { __makeTemplateObject } from \"tslib\";\nimport React from \"react\";\nimport { L } from \"../../../../utils/utils\";\nimport { DeltaBoxes } from \"./delta-boxes\";\nimport { withObserve } from \"../../../utility-components/with-observe\";\nimport { db } from \"../../../../globals/db\";\nimport { ResetCourseButton } from './reset-course-button';\nexport var VersionHistoryView = withObserve(function (_a) {\n    var courseId = _a.courseId, branchId = _a.branchId, allowCherryPick = _a.allowCherryPick;\n    var query = db.branch(branchId).deltas.tag(courseId);\n    // Suspense-read the query into array of deltas\n    var deltas = query.toValue().read();\n    if (deltas.length === 0)\n        return (React.createElement(\"div\", null,\n            React.createElement(\"p\", { style: { opacity: 0.5, fontStyle: \"italic\" } }, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Skolans version \\u00E4r identisk med orginalet\"], [\"Skolans version \\u00E4r identisk med orginalet\"]))))));\n    return (React.createElement(\"div\", null,\n        React.createElement(\"h2\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Skolans \\u00E4ndringar\"], [\"Skolans \\u00E4ndringar\"])))),\n        React.createElement(DeltaBoxes, { branchId: branchId, deltas: deltas, editable: allowCherryPick }),\n        React.createElement(ResetCourseButton, { courseId: courseId, branchId: branchId })));\n});\nvar templateObject_1, templateObject_2;\n","import { __makeTemplateObject, __read } from \"tslib\";\nimport { Emitter } from \"kedbackend/observable\";\nimport { db } from \"../globals/db\";\nimport { L } from \"./utils\";\nvar DEFAULT_SCHOOL = L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Kunskapsskolan i Sverige\"], [\"Kunskapsskolan i Sverige\"])));\nvar UNKNOWN_SCHOOL = L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Ok\\u00E4nd skola\"], [\"Ok\\u00E4nd skola\"])));\nexport function getSchoolNameFromBranchId(branchId, defaultGymn // false for subject planner. true for coursebuilder\n) {\n    if (!branchId)\n        return new Emitter(DEFAULT_SCHOOL);\n    return db.branches\n        .ids([branchId])\n        .toValue()\n        .switchMap(function (_a) {\n        var _b = __read(_a, 1), branch = _b[0];\n        return branch\n            ? branch.schoolId\n                ? db.schools\n                    .ids([branch.schoolId])\n                    .toValue()\n                    .map(function (_a) {\n                    var _b = __read(_a, 1), school = _b[0];\n                    return school\n                        ? school.name === \"standard\" ? DEFAULT_SCHOOL :\n                            defaultGymn\n                                ? // Most specific school name is in the EDS names\n                                    // Example: \"Kunskapsgymnasiet Uppsala\"\n                                    school.edsSchoolNameGymn ||\n                                        // Example: \"Kunskapsskolan Uppsala\"\n                                        school.edsSchoolNamePrim ||\n                                        // Fallback to displayName:\n                                        // displayName example: \"Uppsala\"\n                                        school.displayName ||\n                                        // name example: \"Uppsala\"\n                                        school.name\n                                : // If not defaultGymn, prefer the secondary school name in EDS\n                                    school.edsSchoolNamePrim ||\n                                        // ... fallback to gymn school\n                                        school.edsSchoolNameGymn ||\n                                        // ...fallback to displayName\n                                        school.displayName ||\n                                        // ...fallback to name\n                                        school.name\n                        : UNKNOWN_SCHOOL;\n                })\n                : new Emitter(DEFAULT_SCHOOL) // Branch did not have a schoolId. Must be the standard draft branch.\n            : new Emitter(UNKNOWN_SCHOOL);\n    } // Branch was not found. Maybe an old school that was deleted\n    );\n}\nvar templateObject_1, templateObject_2;\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9BA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACfA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpDA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxFA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7LA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1IA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1CA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}