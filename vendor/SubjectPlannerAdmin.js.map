{"version":3,"file":"SubjectPlannerAdmin.js","sources":["webpack://[name]/./src/components/course-builder-ks/admin/courses/create-standard-course.tsx","webpack://[name]/./src/components/course-builder-ks/admin/courses/delete-standard-course.tsx","webpack://[name]/./src/components/course-builder-ks/admin/courses/edit-course-block-requirements.tsx","webpack://[name]/./src/components/course-builder-ks/admin/courses/edit-standard-course-blocks.tsx","webpack://[name]/./src/components/course-builder-ks/admin/courses/edit-standard-course.tsx","webpack://[name]/./src/components/course-builder-ks/admin/index.tsx","webpack://[name]/./src/components/course-builder-ks/admin/routes.tsx","webpack://[name]/./src/components/course-builder-ks/common/side-list.tsx","webpack://[name]/./src/components/course-builder-ks/common/standard-course-instance-list.tsx","webpack://[name]/./src/components/utility-components/multiselect.tsx"],"sourcesContent":["import { __assign, __awaiter, __extends, __generator, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { createUUID } from 'kedbackend/client';\nimport { db, globalId, Schools } from '../../../../globals/db';\nimport { withRouter } from 'react-router';\nimport { L } from '../../../../utils/utils';\nimport { LazyContent } from '../../../utility-components/lazy-content';\nimport { computeTagsFromSubjectCodes } from '../../logic/course-instance-tags';\nvar _CreateStandardCourse = /** @class */ (function (_super) {\n    __extends(_CreateStandardCourse, _super);\n    function _CreateStandardCourse(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            courseName: \"\",\n            courseType: 'theme-course',\n            subject: { subjectName: '', subjectCode: '' }\n        };\n        return _this;\n    }\n    _CreateStandardCourse.prototype.createCourse = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, type, name, subject, courseId, _b, officialBranchId, schoolId, courseProperties;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = this.state, type = _a.courseType, name = _a.courseName, subject = _a.subject;\n                        courseId = createUUID();\n                        return [4 /*yield*/, Schools.standardSchool.load()];\n                    case 1:\n                        _b = _c.sent(), officialBranchId = _b.officialBranchId, schoolId = _b.id;\n                        db.branches.addRelated({ id: officialBranchId }, \"approvedChildren\", {\n                            id: createUUID(),\n                            name: 'draft',\n                            acl: [\n                                \"role:USER:R\",\n                                \"schoolRole:standard/EMPLOYEE:S\"\n                            ],\n                            schoolId: schoolId,\n                            treeParentId: officialBranchId,\n                            tags: [courseId] // Allow following queries:\n                            // List all draft for a certain school: {hasEdgesFrom=schoolBranchId&tags=courseId}\n                            // Get official draft for a certain school: {hasEdgesFrom=schoolBranchId&name=draft&tags=courseId}\n                        });\n                        courseProperties = {\n                            id: courseId,\n                            acl: [\n                                'schoolRole:standard/EMPLOYEE:S',\n                                'role:USER:R'\n                            ],\n                            name: name,\n                            //description: type === 'step-course' ? \"Stegkurs\" : \"Teamkurs\",\n                            tags: type === 'step-course' ?\n                                computeTagsFromSubjectCodes([], [subject.subjectCode]) :\n                                []\n                        };\n                        db.global.addRelated({ id: globalId, tags: [] }, \"courseInstances\", type === 'step-course' ? __assign(__assign({}, courseProperties), { type: type, description: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Stegkurs\"], [\"Stegkurs\"]))), subject: subject }) : __assign(__assign({}, courseProperties), { type: type, description: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Temakurs\"], [\"Temakurs\"]))), subjects: [] }));\n                        this.setState({\n                            courseName: ''\n                        });\n                        return [4 /*yield*/, db.saveNow()];\n                    case 2:\n                        _c.sent();\n                        this.props.history.push(\"/admin/courses/\" + courseId + \"/settings\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    _CreateStandardCourse.prototype.isValidState = function (giveMessage) {\n        var _a = this.state, courseName = _a.courseName, courseType = _a.courseType, subject = _a.subject;\n        var rv = courseName && courseType === 'theme-course' || subject.subjectCode;\n        if (!rv && giveMessage) {\n            if (!courseName)\n                return L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Kursens namn m\\u00E5ste fyllas i\"], [\"Kursens namn m\\u00E5ste fyllas i\"])));\n            if (!subject.subjectCode)\n                return L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"\\u00C4mne m\\u00E5ste v\\u00E4ljas f\\u00F6r stegkurser\"], [\"\\u00C4mne m\\u00E5ste v\\u00E4ljas f\\u00F6r stegkurser\"])));\n        }\n        return rv;\n    };\n    _CreateStandardCourse.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, courseName = _a.courseName, courseType = _a.courseType, subject = _a.subject;\n        return (React.createElement(\"div\", null,\n            React.createElement(\"h2\", null, \"Skapa ny standardkurs\"),\n            React.createElement(\"hr\", null),\n            React.createElement(\"div\", null,\n                \"Namn: \",\n                React.createElement(\"input\", { type: \"text\", value: courseName, onChange: function (ev) { return _this.setState({ courseName: ev.target.value }); } })),\n            React.createElement(\"br\", null),\n            React.createElement(\"div\", null,\n                React.createElement(\"input\", { type: \"radio\", name: \"course-type\", checked: courseType === 'step-course', onChange: function (ev) { return ev.target.checked && _this.setState({ courseType: 'step-course' }); } }),\n                \" Stegkurs\"),\n            React.createElement(\"br\", null),\n            React.createElement(\"div\", null,\n                React.createElement(\"input\", { type: \"radio\", name: \"course-type\", checked: courseType === 'theme-course', onChange: function (ev) { return ev.target.checked && _this.setState({ courseType: 'theme-course' }); } }),\n                \" Temakurs\"),\n            React.createElement(\"br\", null),\n            courseType === 'step-course' ? React.createElement(React.Fragment, null,\n                React.createElement(\"br\", null),\n                React.createElement(\"form\", null,\n                    React.createElement(\"label\", { className: \"kclabel\" }, L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"\\u00C4mne\"], [\"\\u00C4mne\"])))),\n                    React.createElement(LazyContent, null, db.subjects.tags(\"schoolType:primary\").toValue().map(function (subjects) {\n                        return React.createElement(\"select\", { value: subject.subjectCode, onChange: function (ev) { return _this.setState({\n                                subject: subjects.filter(function (s) { return s.code === ev.target.value; }).map(function (s) { return ({\n                                    subjectCode: s.code,\n                                    subjectName: s.name\n                                }); })[0]\n                            }); } },\n                            React.createElement(\"option\", { value: \"\" }, L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"V\\u00E4lj \\u00E4mne\"], [\"V\\u00E4lj \\u00E4mne\"])))),\n                            subjects.map(function (subject) { return React.createElement(\"option\", { key: subject.code, value: subject.code }, subject.name); }));\n                    })))) : null,\n            React.createElement(\"div\", null,\n                React.createElement(\"button\", { disabled: !this.isValidState(), className: [\"btn\", \"btn-large\", this.isValidState() ? \"\" : \"disabled\"].join(' '), onClick: function () { return _this.isValidState() ?\n                        _this.createCourse() : alert(_this.isValidState(true)); } }, \"Skapa\"))));\n    };\n    return _CreateStandardCourse;\n}(React.Component));\nexport var CreateStandardCourse = withRouter(_CreateStandardCourse);\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6;\n","import { __read, __spread } from \"tslib\";\nimport * as React from 'react';\nimport { liveQueryView } from '../../../utility-components/live-query-view';\nimport { db } from '../../../../globals/db';\nimport { withRouter } from 'react-router';\nimport { Link } from 'react-router-dom';\nimport { Spinner } from '../../../course-builder/sub-components/spinner';\nexport var DeleteStandardCourse = withRouter(liveQueryView(function (_a) {\n    var courseId = _a.courseId, history = _a.history;\n    return db.courseInstances.ids([courseId]).toValue()\n        .combineLatest(db.branches.tags(courseId).idsOnly().map(function (_a) {\n        var id = _a.id;\n        return id;\n    }))\n        .combineLatest(db.courseBlocks.tags(courseId).idsOnly().map(function (_a) {\n        var id = _a.id;\n        return id;\n    }))\n        .combineLatest(db.courseContents.tags(courseId).idsOnly().map(function (_a) {\n        var id = _a.id;\n        return id;\n    }))\n        .combineLatest(db.courseTabs.tags(courseId).idsOnly().map(function (_a) {\n        var id = _a.id;\n        return id;\n    }))\n        .combineLatest(db.tasks.tags(courseId).idsOnly().map(function (_a) {\n        var id = _a.id;\n        return id;\n    }))\n        .map(function (_a) {\n        var _b = __read(_a, 2), a = _b[0], b = _b[1];\n        return ({\n            courses: a[0][0][0][0],\n            branchIds: a[0][0][0][1],\n            courseBlockIds: a[0][0][1],\n            courseContentIds: a[0][1],\n            courseTabIds: a[1],\n            taskIds: b\n        });\n    })\n        .map(function (_a) {\n        var courses = _a.courses, branchIds = _a.branchIds, courseBlockIds = _a.courseBlockIds, courseContentIds = _a.courseContentIds, courseTabIds = _a.courseTabIds, taskIds = _a.taskIds;\n        if (courses.length === 0)\n            return React.createElement(\"div\", null,\n                React.createElement(\"p\", null, \"Kursen \\u00E4r nu borttagen\"),\n                React.createElement(Link, { className: \"btn btn-large\", to: \"/admin\" }, \"Till adminverktygets startsida\"));\n        var course = courses[0];\n        return React.createElement(\"div\", { className: [\"entitymeta-\" + course.$meta].join(' ') },\n            React.createElement(\"h2\", null,\n                \"Bekr\\u00E4fta borttagning av standardkursen \",\n                course.name,\n                \" \"),\n            React.createElement(\"p\", null, \"F\\u00F6ljande relaterade objekt kommer ocks\\u00E5 att tas bort\"),\n            React.createElement(\"p\", null,\n                \"Tempor\\u00E4ra utkast: \",\n                branchIds.length,\n                \" st\"),\n            React.createElement(\"p\", null,\n                \"Kursblock: \",\n                courseBlockIds.length,\n                \" st\"),\n            React.createElement(\"p\", null,\n                \"Inneh\\u00E5llsrutor (totalt inklusive skolors egna varianter): \",\n                courseContentIds.length,\n                \" st\"),\n            React.createElement(\"p\", null,\n                \"Flikar (totalt inklusive skolors egna varianter): \",\n                courseTabIds.length,\n                \" st\"),\n            React.createElement(\"p\", null,\n                \"Uppgifter (totalt inklusive skolors egna varianter): \",\n                taskIds.length,\n                \" st\"),\n            React.createElement(\"a\", { className: \"btn btn-large\", onClick: function () { return history.go(-1); } }, \"Avbryt\"),\n            React.createElement(\"div\", { className: \"btn btn-warning btn-large pull-right\", onClick: function () {\n                    var _a, _b, _c, _d, _e;\n                    // Delete all draft ids.\n                    (_a = db.branches).delete.apply(_a, __spread(branchIds));\n                    // Delete all descendant ids:\n                    (_b = db.courseBlocks).delete.apply(_b, __spread(courseBlockIds));\n                    (_c = db.courseContents).delete.apply(_c, __spread(courseContentIds));\n                    (_d = db.courseTabs).delete.apply(_d, __spread(courseTabIds));\n                    (_e = db.tasks).delete.apply(_e, __spread(taskIds));\n                    // Delete the course itself\n                    db.courseInstances.delete(course.id);\n                } }, \"Bekr\\u00E4fta borttagning av kurs\"));\n    });\n}, {\n    spinner: React.createElement(\"p\", null,\n        \"H\\u00E4mtar relaterade objekt... \",\n        React.createElement(Spinner, null))\n}));\n","import { __makeTemplateObject, __read, __spread } from \"tslib\";\nimport React from 'react';\nimport { KnowledgeMatrix } from '../../../course-builder/sub-components/knowledge-matrix';\nimport { LazyContent } from '../../../utility-components/lazy-content';\nimport { getCourseCodesFromTags } from '../../logic/get-course-codes-from-tags';\nimport { L } from '../../../../utils/utils';\nimport { getStandardCoursesWithOrderedRequirements } from '../../logic/get-standard-courses-with-ordered-requirements';\nimport { OpenCloseBox } from '../../../utility-components/open-close-box';\nimport { SelectRelatedDocs } from '../../../course-builder/sub-components/select-related-docs';\nimport { liveQueryView } from '../../../utility-components/live-query-view';\nimport { getIdsNotCoveredByReqReferencingDocs } from '../../../course-builder/courses/business-logic';\nexport var CourseBlockRequirements = liveQueryView(function (_a) {\n    var _b;\n    var repo = _a.repo, course = _a.course, block = _a.block;\n    var courseCodes = getCourseCodesFromTags(block.tags);\n    var courseCodeTags = courseCodes.map(function (code) { return \"course:\" + code; });\n    return getStandardCoursesWithOrderedRequirements(courseCodes)\n        .combineLatest((_b = repo.courseBlocks\n        .hasEdgesFrom([course.id])) // Same parent give me sibling blocks!\n    .tags.apply(_b, __spread(courseCodeTags)).include(\"abilities\", \"centralContent\", \"knowledgeRequirements\")\n        .includeIdsOnly()) // So we can detect non-covered requirements\n        .map(function (_a) {\n        var _b = __read(_a, 2), courseTemplates = _b[0], siblingBlocks = _b[1];\n        var uncoveredIds = getIdsNotCoveredByReqReferencingDocs(courseTemplates, siblingBlocks);\n        if (courseTemplates.length === 0)\n            return React.createElement(\"p\", null, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Blocket \\u00E4r inte kopplad till n\\u00E5gon \\u00E5rskurs\"], [\"Blocket \\u00E4r inte kopplad till n\\u00E5gon \\u00E5rskurs\"]))));\n        return React.createElement(\"div\", null, courseTemplates.map(function (_a) {\n            var id = _a.id, name = _a.name, abilities = _a.abilities, centralContent = _a.centralContent, knowledgeRequirements = _a.knowledgeRequirements;\n            return React.createElement(\"div\", { key: id },\n                courseTemplates.length === 1 ? undefined : React.createElement(\"h1\", null, name),\n                React.createElement(OpenCloseBox, { className: \"larger\", title: React.createElement(\"p\", null, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"V\\u00E4lj blockets kunskapskrav\"], [\"V\\u00E4lj blockets kunskapskrav\"])))) },\n                    React.createElement(\"p\", null, L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Markera de kunskapskrav som blocket ska t\\u00E4cka.\"], [\"Markera de kunskapskrav som blocket ska t\\u00E4cka.\"])))),\n                    React.createElement(LazyContent, null, repo[\"knowledge-requirements\"].hasEdgesFrom([block.id]).idsOnly().toValue().map(function (blockKrs) {\n                        return React.createElement(KnowledgeMatrix, { knowledgeRequirements: knowledgeRequirements, markedIds: blockKrs.map(function (_a) {\n                                var id = _a.id;\n                                return id;\n                            }), idsToMarkNotOk: uncoveredIds, markMode: true, onMarkChanged: function (markedId, isMarked) {\n                                // Remove invalid knowledge requirements (those that are not part of the standard course)\n                                // Can happen after changing school year / course or subject.\n                                var invalidKrs = blockKrs.filter(function (kr) { return !knowledgeRequirements.some(function (_a) {\n                                    var id = _a.id;\n                                    return kr.id === id;\n                                }); });\n                                invalidKrs.forEach(function (invalidKr) {\n                                    repo.courseBlocks.removeRelated(block, \"knowledgeRequirements\", invalidKr);\n                                });\n                                var markedDoc = knowledgeRequirements.filter(function (_a) {\n                                    var id = _a.id;\n                                    return id === markedId;\n                                })[0];\n                                if (isMarked) {\n                                    repo.courseBlocks.addRelated(block, \"knowledgeRequirements\", markedDoc);\n                                }\n                                else {\n                                    repo.courseBlocks.removeRelated(block, \"knowledgeRequirements\", markedDoc);\n                                }\n                            } });\n                    }))),\n                React.createElement(LazyContent, null, repo.abilities.hasEdgesFrom([block.id]).idsOnly().toValue().map(function (blockAbilities) {\n                    return React.createElement(SelectRelatedDocs, { options: abilities, title: L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"V\\u00E4lj blockets f\\u00F6rm\\u00E5gor\"], [\"V\\u00E4lj blockets f\\u00F6rm\\u00E5gor\"]))), markedIds: blockAbilities.map(function (_a) {\n                            var id = _a.id;\n                            return id;\n                        }), uncoveredIds: uncoveredIds, markMode: true, \n                        //migratedIds={task && task.migratedTexts && task.migratedTexts.abilities}\n                        onMarkChanged: function (markedId, isMarked) {\n                            // Remove invalid abilities (those that are not part of the standard course)\n                            // Can happen after changing school year / course or subject.\n                            var invalidAbilities = blockAbilities.filter(function (a) { return !abilities.some(function (_a) {\n                                var id = _a.id;\n                                return a.id === id;\n                            }); });\n                            invalidAbilities.forEach(function (invalidAbility) {\n                                repo.courseBlocks.removeRelated(block, \"abilities\", invalidAbility);\n                            });\n                            var markedDoc = abilities.filter(function (_a) {\n                                var id = _a.id;\n                                return id === markedId;\n                            })[0];\n                            if (isMarked) {\n                                repo.courseBlocks.addRelated(block, \"abilities\", markedDoc);\n                            }\n                            else {\n                                repo.courseBlocks.removeRelated(block, \"abilities\", markedDoc);\n                            }\n                        } });\n                })),\n                React.createElement(LazyContent, null, repo[\"central-content\"].hasEdgesFrom([block.id]).idsOnly().toValue().map(function (blockCCs) {\n                    return React.createElement(SelectRelatedDocs, { options: centralContent, title: L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"V\\u00E4lj blockets centrala inneh\\u00E5ll\"], [\"V\\u00E4lj blockets centrala inneh\\u00E5ll\"]))), markedIds: blockCCs.map(function (cc) { return cc.id; }), uncoveredIds: uncoveredIds, markMode: true, \n                        //migratedIds={task && task.migratedTexts && task.migratedTexts.centralContent}\n                        onMarkChanged: function (markedId, isMarked) {\n                            // Remove invalid central contents (those that are not part of the standard course)\n                            // Can happen after changing school year / course or subject.\n                            var invalidCentralContents = blockCCs.filter(function (cc) { return !centralContent.some(function (_a) {\n                                var id = _a.id;\n                                return cc.id === id;\n                            }); });\n                            invalidCentralContents.forEach(function (invalidCC) {\n                                repo.courseBlocks.removeRelated(block, \"centralContent\", invalidCC);\n                            });\n                            var markedDoc = centralContent.filter(function (_a) {\n                                var id = _a.id;\n                                return id === markedId;\n                            })[0];\n                            if (isMarked) {\n                                repo.courseBlocks.addRelated(block, \"centralContent\", markedDoc);\n                            }\n                            else {\n                                repo.courseBlocks.removeRelated(block, \"centralContent\", markedDoc);\n                            }\n                        } });\n                })));\n        }));\n    });\n});\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5;\n","import { __makeTemplateObject, __read, __spread } from \"tslib\";\nimport React from 'react';\nimport { compareProp, L } from '../../../../utils/utils';\nimport { createUUID } from 'kedbackend/client';\nimport { RemoveItem } from '../../../course-builder/sub-components/remove-item';\nimport { getSchoolYears, computeTagsFromSchoolYears } from '../../logic/course-instance-tags';\nimport { CourseBlockRequirements } from './edit-course-block-requirements';\nexport var EditStandardCourseBlocks = function (_a) {\n    var repo = _a.repo, course = _a.course;\n    return React.createElement(\"div\", null,\n        React.createElement(\"label\", { className: \"kclabel\" }, L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Kursblock\"], [\"Kursblock\"])))),\n        course.blocks.sort(compareProp(\"blockNo\")).map(function (block, idx) {\n            return React.createElement(CourseBlockSettings, { key: block.id, block: block, course: course, repo: repo, isLastBlock: idx === course.blocks.length - 1 });\n        }),\n        React.createElement(\"button\", { className: \"btn\", onClick: function () { return addCourseBlock(repo, course); } },\n            React.createElement(\"i\", { className: \"fas fa-plus\", \"aria-hidden\": \"true\" }),\n            \" \", L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"L\\u00E4gg till block\"], [\"L\\u00E4gg till block\"])))),\n        React.createElement(\"br\", null));\n};\nexport var CourseBlockSettings = function (_a) {\n    var block = _a.block, course = _a.course, repo = _a.repo, isLastBlock = _a.isLastBlock;\n    return React.createElement(React.Fragment, null,\n        React.createElement(\"div\", { className: \"ked_boxed\", style: { position: \"relative\" } },\n            React.createElement(\"h4\", null,\n                \"Block \",\n                block.blockNo), L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Steg\"], [\"Steg\"]))),\n            \" \",\n            React.createElement(\"div\", { className: \"btn-group\" }, block.stepNumbers.map(function (stepNo) {\n                return React.createElement(\"a\", { key: stepNo, className: \"btn btn-small step-button\" }, stepNo);\n            })),\n            React.createElement(\"form\", null,\n                React.createElement(\"label\", { className: \"kclabel\" }, L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"\\u00C5rskurs\"], [\"\\u00C5rskurs\"])))),\n                React.createElement(\"select\", { value: getSchoolYears(block.tags)[0] || \"\", onChange: function (ev) { return repo.courseBlocks.update(block, {\n                        tags: computeTagsFromSchoolYears(block.tags, [ev.target.value].filter(function (x) { return !!x; }))\n                    }); } },\n                    React.createElement(\"option\", { value: \"\" }, L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"V\\u00E4lj \\u00E5rskurser\"], [\"V\\u00E4lj \\u00E5rskurser\"])))),\n                    React.createElement(\"option\", { value: \"1-3\" }, L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"\\u00C5rskurs 1-3\"], [\"\\u00C5rskurs 1-3\"])))),\n                    React.createElement(\"option\", { value: \"4-6\" }, L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"\\u00C5rskurs 4-6\"], [\"\\u00C5rskurs 4-6\"])))),\n                    React.createElement(\"option\", { value: \"7-9\" }, L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"\\u00C5rskurs 7-9\"], [\"\\u00C5rskurs 7-9\"])))))),\n            React.createElement(\"br\", null),\n            getSchoolYears(block.tags).length > 0 ?\n                React.createElement(CourseBlockRequirements, { block: block, course: course, repo: repo }) :\n                undefined,\n            isLastBlock ? React.createElement(RemoveItem, { title: \"Ta bort blocket\", style: { display: 'inline-block', position: \"absolute\", top: 0, right: 0 }, onClick: function () { return confirm(L(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"Ta bort blocket?\"], [\"Ta bort blocket?\"])))) &&\n                    repo.courseInstances.removeRelated(course, \"blocks\", block); } })\n                : null),\n        React.createElement(\"hr\", null));\n};\nfunction addCourseBlock(repo, course) {\n    var lastBlock = course.blocks.sort(compareProp(\"blockNo\")).slice().pop();\n    var blockNo = lastBlock ? lastBlock.blockNo + 1 : 1;\n    var firstStepNo = lastBlock ?\n        lastBlock.stepNumbers[lastBlock.stepNumbers.length - 1] + 1 :\n        1;\n    var newBlock = {\n        id: createUUID(),\n        acl: [\n            'schoolRole:standard/EMPLOYEE:S',\n            'role:USER:R'\n        ],\n        blockNo: blockNo,\n        locked: true,\n        name: \"Block \" + blockNo,\n        tags: __spread([course.id], course.tags.filter(function (tag) { return tag.startsWith(\"course:\") || tag.startsWith(\"sub:\"); })),\n        stepNumbers: [firstStepNo, firstStepNo + 1, firstStepNo + 2, firstStepNo + 3, firstStepNo + 4]\n    };\n    repo.courseInstances.addRelated(course, \"blocks\", newBlock);\n    newBlock.stepNumbers.forEach(function (stepNo) {\n        var introductionTab = {\n            id: createUUID(),\n            type: 'step-course-tab',\n            tabClass: 'intro-tab',\n            tabTitle: L(templateObject_10 || (templateObject_10 = __makeTemplateObject([\"Introduktion\"], [\"Introduktion\"]))),\n            name: L(templateObject_11 || (templateObject_11 = __makeTemplateObject([\"Introduktion\"], [\"Introduktion\"]))),\n            locked: true,\n            acl: [\n                'schoolRole:standard/EMPLOYEE:S',\n                'role:USER:R'\n            ],\n            stepNo: stepNo,\n            order: 0,\n            tags: __spread([\n                course.id,\n                \"blockStep:\" + newBlock.id + \":\" + stepNo\n            ], course.tags.filter(function (tag) { return tag.startsWith(\"course:\") || tag.startsWith(\"sub:\"); }))\n        };\n        repo.courseBlocks.addRelated(newBlock, \"tabs\", introductionTab);\n    });\n}\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10, templateObject_11;\n","import { __awaiter, __generator, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { db, CourseInstances, Schools } from '../../../../globals/db';\nimport { TextInput } from '../../../utility-components/form-field-text-input';\nimport { TextAreaFormField } from '../../../utility-components/form-field-textarea';\nimport { FormField } from '../../../utility-components/form-field';\nimport { L } from '../../../../utils/utils';\nimport { Link, withRouter } from 'react-router-dom';\nimport { liveQueryView } from '../../../utility-components/live-query-view';\nimport { publishEntireCourse } from '../../logic/publish-course';\nimport { Multiselect } from '../../../utility-components/multiselect';\nimport { Checklist } from '../../../utility-components/checklist';\nimport { getSubjectCodes, computeTagsFromSubjectCodes, getSchoolYears, computeTagsFromSchoolYears, computeTagsFromActiveState } from '../../logic/course-instance-tags';\nimport { EditStandardCourseBlocks } from './edit-standard-course-blocks';\nimport cfg from '../../../../globals/KED.cfg';\nimport { preserveImpersonationQuery } from '../../../../access-control';\nexport var EditStandardCourse = withRouter(liveQueryView(function (_a) {\n    var courseId = _a.courseId, history = _a.history;\n    return CourseInstances.getOrCreateBranchId(Schools.standardSchool, courseId)\n        .map(function (branchId) { return db.branch(branchId); })\n        .switchMap(function (branch) {\n        return branch.courseInstances.include(\"blocks\").id(courseId).map(function (course) { return React.createElement(React.Fragment, null,\n            React.createElement(TextInput, { autoFocus: true, label: \"Namn\", id: \"CourseInstance:name\", placeholder: \"\", value: course.name, onChange: function (name) { return branch.courseInstances.update(course, { name: name }); } }),\n            React.createElement(TextAreaFormField, { label: \"Beskrivning\", id: \"CourseInstance:description\", rows: 7, placeholder: \"\", value: course.description, onChange: function (description) {\n                    branch.courseInstances.update(course, { description: description });\n                } }),\n            React.createElement(FormField, { label: \"Typ\", id: \"CourseInstance:type\" },\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"input\", { disabled: true, type: \"radio\", name: \"course-type\", checked: course.type === 'step-course', id: \"CourseInstance:type\", onChange: function (ev) { return ev.target.checked && branch.courseInstances.update(course, { type: 'step-course' }); } }),\n                        \" Stegkurs\")),\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem\" },\n                        React.createElement(\"input\", { disabled: true, type: \"radio\", name: \"course-type\", checked: course.type === 'theme-course', id: \"CourseInstance:type\", onChange: function (ev) { return ev.target.checked && branch.courseInstances.update(course, { type: 'theme-course' }); } }),\n                        \" Temakurs\"))),\n            course.type === 'step-course' ? React.createElement(React.Fragment, null,\n                React.createElement(\"br\", null),\n                React.createElement(FormField, { label: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\u00C4mne\"], [\"\\u00C4mne\"]))), id: \"CourseInstance:subject\" },\n                    React.createElement(\"p\", { id: \"CourseInstance:subject\" }, course.subject.subjectName))) : null,\n            React.createElement(\"br\", null),\n            React.createElement(\"form\", null,\n                React.createElement(\"label\", { className: \"kclabel\" }, L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"\\u00C4ndringspolicy\"], [\"\\u00C4ndringspolicy\"])))),\n                React.createElement(Checklist, { available: [\n                        { name: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"Till\\u00E5t skolor skapa egna flikar\"], [\"Till\\u00E5t skolor skapa egna flikar\"]))), key: \"allowAddTabs\" },\n                        { name: L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Till\\u00E5t skolor d\\u00F6lja standardflikar\"], [\"Till\\u00E5t skolor d\\u00F6lja standardflikar\"]))), key: \"allowRemoveTabs\" },\n                        { name: L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"Till\\u00E5t skolor \\u00E4ndra ordningen mellan standardflikar\"], [\"Till\\u00E5t skolor \\u00E4ndra ordningen mellan standardflikar\"]))), key: \"allowReorderTabs\" },\n                    ], selected: [\n                        course.allowAddTabs && \"allowAddTabs\",\n                        course.allowRemoveTabs && \"allowRemoveTabs\",\n                        course.allowReorderTabs && \"allowReorderTabs\"\n                    ].filter(function (x) { return !!x; }), onChange: function (selectedPolicy) { return branch.courseInstances.update(course, {\n                        allowAddTabs: selectedPolicy.includes(\"allowAddTabs\"),\n                        allowRemoveTabs: selectedPolicy.includes(\"allowRemoveTabs\"),\n                        allowReorderTabs: selectedPolicy.includes(\"allowReorderTabs\"),\n                    }); } })),\n            course.type === 'step-course' ? React.createElement(React.Fragment, null, getSubjectCodes(course.tags).length > 0 ? React.createElement(EditStandardCourseBlocks, { repo: branch, course: course }) : undefined) : undefined,\n            course.type === 'theme-course' ? React.createElement(React.Fragment, null,\n                React.createElement(\"br\", null),\n                React.createElement(\"form\", null,\n                    React.createElement(\"label\", { className: \"kclabel\" }, L(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"Kopplade \\u00E4mnen\"], [\"Kopplade \\u00E4mnen\"])))),\n                    React.createElement(Multiselect, { selected: (course.subjects || []).map(function (_a) {\n                            var name = _a.name, code = _a.code;\n                            return ({ name: name, key: code });\n                        }), getOptions: function () { return db.subjects.tags('schoolType:primary').map(function (s) { return ({ name: s.name, key: s.code }); }).toValue().load(); }, onChange: function (selectedOptions) { return branch.courseInstances.update(course, {\n                            tags: computeTagsFromSubjectCodes(course.tags, selectedOptions.map(function (o) { return o.key; })),\n                            subjects: selectedOptions.map(function (option) { return ({ name: option.name, code: option.key }); })\n                        }); } })),\n                React.createElement(\"br\", null),\n                React.createElement(\"form\", null,\n                    React.createElement(\"label\", { className: \"kclabel\" }, L(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"\\u00C5rskurser som ska ing\\u00E5\"], [\"\\u00C5rskurser som ska ing\\u00E5\"])))),\n                    React.createElement(Checklist, { available: [\n                            { name: L(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"\\u00C5rskurs 1-3\"], [\"\\u00C5rskurs 1-3\"]))), key: \"1-3\" },\n                            { name: L(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"\\u00C5rskurs 4-6\"], [\"\\u00C5rskurs 4-6\"]))), key: \"4-6\" },\n                            { name: L(templateObject_10 || (templateObject_10 = __makeTemplateObject([\"\\u00C5rskurs 7-9\"], [\"\\u00C5rskurs 7-9\"]))), key: \"7-9\" }\n                        ], selected: getSchoolYears(course.tags), onChange: function (selectedSchoolYears) { return branch.courseInstances.update(course, {\n                            tags: computeTagsFromSchoolYears(course.tags, selectedSchoolYears)\n                        }); } }))) : undefined,\n            React.createElement(\"br\", null),\n            course.tags.includes('active') ?\n                React.createElement(\"div\", { className: \"btn btn-large pull-right\", onClick: function () {\n                        var newTags = computeTagsFromActiveState(course.tags, false);\n                        branch.courseInstances.update(course, { tags: newTags });\n                    } }, \"Inaktivera\") :\n                React.createElement(\"div\", { className: \"btn btn-large pull-right\", onClick: function () {\n                        var newTags = computeTagsFromActiveState(course.tags, true);\n                        branch.courseInstances.update(course, { tags: newTags });\n                    } }, \"Aktivera\"),\n            React.createElement(Link, { className: \"btn btn-warning btn-large pull-right\", to: \"/admin/courses/\" + courseId + \"/confirm-delete\" }, L(templateObject_11 || (templateObject_11 = __makeTemplateObject([\"Radera ...\"], [\"Radera ...\"])))),\n            React.createElement(\"div\", { className: \"btn btn-large btn-warning\", onClick: function () { return __awaiter(void 0, void 0, void 0, function () {\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0: return [4 /*yield*/, publishEntireCourse({ school: \"standard\", draftRepo: branch, course: course })];\n                            case 1:\n                                _a.sent();\n                                return [4 /*yield*/, db.saveNow()];\n                            case 2:\n                                _a.sent();\n                                location.href = preserveImpersonationQuery(cfg.KED_SUBJECT_PLANNER_URL + \"#/standard/courses/\" + courseId, {});\n                                return [2 /*return*/];\n                        }\n                    });\n                }); } }, \"Publicera\")); });\n    });\n}));\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10, templateObject_11;\n/*async function deleteCourse(course: CourseInstance) {\n  try {\n    // Get course's drafts on all schools\n    // Get ids of all related entities (search by entities tags with course id)\n    const [\n      draftBranchIds,\n      courseBlockIds,\n      courseContentIds,\n      couresTabsIds,\n      tasksIds] = await Promise.all([\n        db.branches.tags(course.id).load(),\n        db.courseBlocks.tags(course.id).load(),\n        db.courseContents.tags(course.id).load(),\n        db.courseTabs.tags(course.id).load(),\n        db.tasks.tags(course.id).load()\n      ]);\n\n    // Delete all draft ids.\n    db.branches.delete(...draftBranchIds);\n    // Delete all descendant ids:\n    db.courseBlocks.delete(...courseBlockIds);\n    db.courseContents.delete(...courseContentIds);\n    db.courseTabs.delete(...couresTabsIds);\n    db.tasks.delete(...tasksIds);\n\n    // Delete the course itself\n    db.courseInstances.delete(course.id);\n\n  } catch (error) {\n    showError(error);\n  }\n}*/\n","import * as React from 'react';\nimport { HashRouter as Router, Route } from 'react-router-dom';\nimport { ErrorSuccessFeedback } from '../../../utils/error-success-feedback';\nimport { ROUTES, TABS_ARRAY } from './routes';\nimport { Banner } from '../common/banner';\nexport var SubjectPlannerAdminApp = function () {\n    return React.createElement(Router, null,\n        React.createElement(React.Fragment, null,\n            ROUTES.map(function (_a, index) {\n                var exact = _a.exact, path = _a.path, tabId = _a.tabId, title = _a.title, content = _a.content;\n                return React.createElement(Route, { key: index, path: path, exact: exact, component: function (routeProps) { return React.createElement(React.Fragment, null,\n                        React.createElement(Banner, { activeTab: tabId || \"$\", tabs: TABS_ARRAY, title: title || \"\", backgroundImage: \"https://ks.kunskapsporten.se/images/18.6323bc4d15f4831f9c82dedf/theme.jpg\" }),\n                        content(routeProps)); } });\n            }),\n            React.createElement(ErrorSuccessFeedback, null)));\n};\n","import { __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { CreateStandardCourse } from './courses/create-standard-course';\nimport { TwoColumnsPage } from '../common/two-columns-page';\nimport { StandardCourseInstanceList } from '../common/standard-course-instance-list';\nimport { Redirect } from 'react-router-dom';\nimport env from '../../../globals/KED.env';\nimport cfg from '../../../globals/KED.cfg';\nimport { EditStandardCourse } from './courses/edit-standard-course';\nimport { DeleteStandardCourse } from './courses/delete-standard-course';\nimport { SubjectsInner } from '../../course-builder/subjects/subjects-inner';\nimport { ShowSubjectInner } from '../../course-builder/subjects/show-subject-inner';\nimport { L } from '../../../utils/utils';\nimport { SchoolsWithoutBanner } from '../../course-builder/schools';\nimport { EditSchoolNoBanner } from '../../course-builder/schools/edit-school';\nimport { isTeacherAtSchool, preserveImpersonationQuery } from '../../../access-control';\nvar RedirectFromRoot = function () {\n    var _a = env.currentUser, roles = _a.roles, school = _a.school;\n    if (roles.includes(\"ADMIN\") || isTeacherAtSchool(env.currentUser, \"standard\"))\n        return React.createElement(Redirect, { to: \"/admin\" });\n    location.href = preserveImpersonationQuery(cfg.KED_SUBJECT_PLANNER_URL, {});\n    return React.createElement(\"div\", null);\n    /*return roles.includes(\"ADMIN\") ?\n      <Redirect to=\"/admin\" /> :\n    //roles.includes(\"EMPLOYEE\") ?\n    //<Redirect to={`/${school}/courses/edit`} /> :\n      <Redirect to={`/admin/courses`} />;*/\n};\nexport var TABS = {\n    $: ['/admin', React.createElement(React.Fragment, null, \"Start\")],\n    //courses: ['/admin/courses', <>Kurser</>],\n    schools: [\"/schools\", React.createElement(React.Fragment, null, \"Skolor\")],\n    import: ['/admin/import', React.createElement(React.Fragment, null, \"Import\")],\n};\nexport var ROUTES = [\n    {\n        path: \"/\",\n        exact: true,\n        content: function () { return React.createElement(RedirectFromRoot, null); }\n    },\n    {\n        path: \"/admin\",\n        exact: true,\n        tabId: \"$\",\n        title: \"Ämnesplaneraren Admin\",\n        content: function () { return React.createElement(Redirect, { to: \"/admin/courses/create\" }); }\n    },\n    {\n        path: \"/admin/courses/create\",\n        exact: true,\n        tabId: \"$\",\n        title: \"Skapa standardkurs\",\n        content: function () {\n            return React.createElement(TwoColumnsPage, { left: React.createElement(CreateStandardCourse, null), right: React.createElement(StandardCourseInstanceList, null), rightWidth: 5 });\n        }\n    }, {\n        path: \"/admin/courses/:courseId/settings\",\n        exact: true,\n        tabId: \"$\",\n        title: \"Ämnesplaneraren Admin\",\n        content: function (_a) {\n            var match = _a.match;\n            return React.createElement(TwoColumnsPage, { left: React.createElement(EditStandardCourse, { courseId: match.params.courseId }), right: React.createElement(StandardCourseInstanceList, null), rightWidth: 5 });\n        }\n    }, {\n        path: \"/admin/courses/:courseId/confirm-delete\",\n        exact: true,\n        tabId: \"$\",\n        title: \"Bekräfta radering av standardkurs\",\n        content: function (_a) {\n            var match = _a.match;\n            return React.createElement(TwoColumnsPage, { left: React.createElement(DeleteStandardCourse, { courseId: match.params.courseId }), right: React.createElement(StandardCourseInstanceList, null), rightWidth: 5 });\n        }\n    }, {\n        path: \"/admin/import\",\n        exact: true,\n        tabId: 'import',\n        title: \"Import från Skolverket\",\n        content: function () { return React.createElement(SubjectsInner, { linkPrefix: \"/admin/import/\" }); }\n    }, {\n        path: \"/admin/import/:subjectId\",\n        exact: false,\n        tabId: \"import\",\n        title: \"Import från skolverket\",\n        content: function (_a) {\n            var match = _a.match;\n            return React.createElement(ShowSubjectInner, { id: match.params.subjectId });\n        }\n    }, {\n        path: \"/schools\",\n        exact: true,\n        tabId: \"schools\",\n        title: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Skolor\"], [\"Skolor\"]))),\n        content: function () { return React.createElement(SchoolsWithoutBanner, { viewCourseUrl: cfg.KED_SUBJECT_PLANNER_URL }); }\n    }, {\n        path: \"/schools/:schoolId/edit\",\n        tabId: \"schools\",\n        title: \"Skolor\",\n        content: function (_a) {\n            var match = _a.match;\n            return React.createElement(EditSchoolNoBanner, { title: L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Redigera skola\"], [\"Redigera skola\"]))), id: match.params.schoolId });\n        }\n    }, {\n        path: \"/schools/new/gymnasium\",\n        tabId: \"schools\",\n        title: \"Skolor\",\n        content: function (_a) {\n            var match = _a.match;\n            return React.createElement(EditSchoolNoBanner, { title: L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"L\\u00E4gg till skola\"], [\"L\\u00E4gg till skola\"]))), type: \"gymnasium\" });\n        }\n    }, {\n        path: \"/schools/new/primary\",\n        tabId: \"schools\",\n        title: \"Skolor\",\n        content: function (_a) {\n            var match = _a.match;\n            return React.createElement(EditSchoolNoBanner, { title: L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"L\\u00E4gg till skola\"], [\"L\\u00E4gg till skola\"]))), type: \"primary\" });\n        }\n    }\n];\nexport var TABS_ARRAY = Object.keys(TABS).map(function (key) { return ({\n    key: key,\n    name: TABS[key][1],\n    link: TABS[key][0]\n}); });\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4;\n","import * as React from 'react';\nimport { Link } from 'react-router-dom';\nexport var SideList = function (_a) {\n    var items = _a.items, caption = _a.caption;\n    return (React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n        React.createElement(\"div\", { className: \"ked_boxed\" },\n            React.createElement(\"h3\", null, caption),\n            React.createElement(\"div\", { className: \"taskContainer odd-even\" }, items.map(function (item) { return React.createElement(\"div\", { className: \"schoolCourse\", key: item.id },\n                React.createElement(\"div\", { className: [\"align-horizontal\", item.$meta && \"entitymeta-\" + item.$meta].join(' ') },\n                    React.createElement(\"div\", { className: \"horizontalItem top pull-right\" }, item.editLink.startsWith(':') ?\n                        React.createElement(\"a\", { href: item.editLink.substr(1), className: \"editItem\" }) :\n                        React.createElement(Link, { to: item.editLink, className: \"editItem\" })),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" }, item.viewLink.startsWith(':') ?\n                        React.createElement(\"a\", { href: item.viewLink.substr(1) }, item.name) :\n                        React.createElement(Link, { to: item.viewLink }, item.name)),\n                    item.pills.map(function (pill, idx) {\n                        return React.createElement(\"div\", { key: idx, className: \"horizontalItem top\" },\n                            React.createElement(\"div\", { className: [\"pill\"].concat(pill.className).join(' ') }, pill.name));\n                    })),\n                React.createElement(\"div\", { className: \"horizontalItem top\" },\n                    React.createElement(\"p\", null, item.description)),\n                React.createElement(\"div\", { className: \"horizontalItem top\" },\n                    React.createElement(\"p\", { className: \"small\" }, item.smallText))); })))));\n};\n","import { __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { SideList } from './side-list';\nimport { L } from '../../../utils/utils';\nimport { liveQueryView } from '../../utility-components/live-query-view';\nimport cfg from '../../../globals/KED.cfg';\nimport { preserveImpersonationQuery } from '../../../access-control';\nimport { shortDateFormat } from '../../course-builder/utils';\nimport { listCourseInstances } from '../logic/list-course-instances';\nexport var StandardCourseInstanceList = liveQueryView(function () {\n    /*{\n      loading: ()=><Spinner />,\n      error: error => <p>Ojsan hoppsan fel: {error.message}</p>\n    },*/\n    return listCourseInstances()\n        .orderBy(\"name\")\n        .map(function (_a) {\n        var id = _a.id, $meta = _a.$meta, name = _a.name, description = _a.description, tags = _a.tags, type = _a.type, modifiedBy = _a.modifiedBy, modifiedDate = _a.modifiedDate;\n        return ({\n            id: id,\n            type: type,\n            $meta: $meta,\n            name: name,\n            description: description,\n            viewLink: \":\" + preserveImpersonationQuery(cfg.KED_SUBJECT_PLANNER_URL, {}) + \"#/standard/courses/\" + id,\n            editLink: \"/admin/courses/\" + id + \"/settings\",\n            pills: tags.filter(function (tag) { return tag === \"active\"; })\n                .map(function (tag) { return ({\n                className: \"active\",\n                name: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Aktiv\"], [\"Aktiv\"])))\n            }); }),\n            smallText: modifiedBy && modifiedDate && L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Senast redigerad av \", \" / \", \"\"], [\"Senast redigerad av \", \" / \", \"\"])), modifiedBy.name, shortDateFormat(modifiedDate))\n        });\n    })\n        .toValue()\n        .map(function (courseItems) {\n        var stepCourseItems = courseItems.filter(function (course) { return course.type === 'step-course'; });\n        var themeCourseItems = courseItems.filter(function (course) { return course.type === 'theme-course'; });\n        return React.createElement(React.Fragment, null,\n            React.createElement(SideList, { caption: \"Stegkurser\", items: stepCourseItems }),\n            React.createElement(SideList, { caption: \"Temakurser\", items: themeCourseItems }));\n    });\n});\nvar templateObject_1, templateObject_2;\n","import { __awaiter, __extends, __generator, __makeTemplateObject } from \"tslib\";\nimport React from 'react';\nimport { Spinner } from '../course-builder/sub-components/spinner';\nimport { L } from '../../utils/utils';\nvar Multiselect = /** @class */ (function (_super) {\n    __extends(Multiselect, _super);\n    function Multiselect(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            optionsVisible: false\n        };\n        return _this;\n    }\n    Multiselect.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, selected = _a.selected, onChange = _a.onChange, getOptions = _a.getOptions;\n        var _b = this.state, optionsVisible = _b.optionsVisible, options = _b.options;\n        var filteredOptions = options && options.filter(function (o) { return !selected.some(function (s) { return s.key === o.key; }); });\n        return React.createElement(React.Fragment, null,\n            React.createElement(\"div\", { className: \"taskContainer\" }, selected.map(function (_a) {\n                var key = _a.key, name = _a.name;\n                //const checked = selected.includes(key);\n                return React.createElement(\"div\", { key: key, className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"i\", { className: \"fas fa-times hoverable\", onClick: function () { return onChange(selected.filter(function (option) { return option.key !== key; })); } }),\n                        name));\n            })),\n            React.createElement(\"span\", { style: { outline: 'none' }, tabIndex: 0, onBlur: function (ev) { return setTimeout(function () { return _this.setState({ optionsVisible: false }); }, 100); } },\n                React.createElement(\"a\", { className: \"btn\", onClick: function () { return __awaiter(_this, void 0, void 0, function () {\n                        var options_1, err_1;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (optionsVisible)\n                                        return [2 /*return*/, this.setState({ optionsVisible: false })];\n                                    this.setState({ optionsVisible: true });\n                                    if (!!this.state.options) return [3 /*break*/, 4];\n                                    _a.label = 1;\n                                case 1:\n                                    _a.trys.push([1, 3, , 4]);\n                                    return [4 /*yield*/, getOptions()];\n                                case 2:\n                                    options_1 = _a.sent();\n                                    this.setState({ options: options_1 });\n                                    return [3 /*break*/, 4];\n                                case 3:\n                                    err_1 = _a.sent();\n                                    this.setState({ options: [{ key: null, name: L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Ett fel har intr\\u00E4ffat\"], [\"Ett fel har intr\\u00E4ffat\"]))) }] });\n                                    return [3 /*break*/, 4];\n                                case 4: return [2 /*return*/];\n                            }\n                        });\n                    }); } },\n                    React.createElement(\"i\", { className: \"fas fa-plus\", \"aria-hidden\": true }),\n                    \" \", L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"L\\u00E4gg till\"], [\"L\\u00E4gg till\"])))),\n                optionsVisible ? React.createElement(React.Fragment, null,\n                    React.createElement(\"br\", null),\n                    filteredOptions ?\n                        React.createElement(\"select\", { size: filteredOptions.length === 1 ? 2 : filteredOptions.length, defaultValue: '', onChange: function (ev) {\n                                var selectedKey = ev.target.value;\n                                onChange(selected.concat({ key: selectedKey, name: options.filter(function (o) { return o.key === selectedKey; }).map(function (o) { return o.name; })[0] }));\n                                _this.setState({ optionsVisible: false });\n                            } },\n                            React.createElement(\"option\", { style: { display: 'none' }, disabled: true, key: '', value: '' }),\n                            filteredOptions.map(function (_a) {\n                                var key = _a.key, name = _a.name;\n                                return React.createElement(\"option\", { key: key, value: key }, name);\n                            })) :\n                        React.createElement(Spinner, null)) :\n                    undefined));\n    };\n    return Multiselect;\n}(React.Component));\nexport { Multiselect };\nvar templateObject_1, templateObject_2;\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}