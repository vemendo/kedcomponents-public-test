{"version":3,"file":"kedappcourseviewer.js","sources":["webpack://[name]/webpack/bootstrap","webpack://[name]/./kedbackend/client.js","webpack://[name]/./kedbackend/clientweb.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client-web/bearer-storage-sessionstorage.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client-web/hash-restorer.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client-web/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/access-control.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/http-error.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/ked-bearer-provider.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/restclient.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/utils.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/cache-bust.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-collection/apply-mutations-on-deltas.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-collection/delta-cache.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-collection/delta-collection.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-merge.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-collection.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-query.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-repo.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-subscription.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-writer.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/mutation-queue.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/query-set.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/utils.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/migrate-course.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/migrate-task.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/migrate.js","webpack://[name]/./kedbackend/js/dist/js/observable/collection.js","webpack://[name]/./kedbackend/js/dist/js/observable/emitter.js","webpack://[name]/./kedbackend/js/dist/js/observable/fiber-context.js","webpack://[name]/./kedbackend/js/dist/js/observable/index.js","webpack://[name]/./kedbackend/js/dist/js/observable/map.js","webpack://[name]/./kedbackend/js/dist/js/observable/mixin.js","webpack://[name]/./kedbackend/js/dist/js/observable/observable.js","webpack://[name]/./kedbackend/js/dist/js/observable/value.js","webpack://[name]/./kedbackend/repo.js","webpack://[name]/./src/access-control/get-user-claims.ts","webpack://[name]/./src/access-control/index.ts","webpack://[name]/./src/apis/buttons.tsx","webpack://[name]/./src/apis/configs.ts","webpack://[name]/./src/apis/edsclient.ts","webpack://[name]/./src/apis/google-classroom.ts","webpack://[name]/./src/apis/google-client.ts","webpack://[name]/./src/apis/google-drive.ts","webpack://[name]/./src/apis/google-picker.ts","webpack://[name]/./src/apis/google-webclient.ts","webpack://[name]/./src/apis/mock/mock-classroom-data.ts","webpack://[name]/./src/components/calendar/course-name-to-css-class.ts","webpack://[name]/./src/components/charts/charts-utils.ts","webpack://[name]/./src/components/charts/goal-progress.tsx","webpack://[name]/./src/components/charts/progress.tsx","webpack://[name]/./src/components/course-builder-ks/logic/is-employee.ts","webpack://[name]/./src/components/course-builder/sub-components/remove-item.tsx","webpack://[name]/./src/components/course-builder/sub-components/spinner.tsx","webpack://[name]/./src/components/course-builder/utils.ts","webpack://[name]/./src/components/course-viewer/course-page/classroom-assignments.tsx","webpack://[name]/./src/components/course-viewer/course-page/course-banner.tsx","webpack://[name]/./src/components/course-viewer/course-page/course-module-page.tsx","webpack://[name]/./src/components/course-viewer/course-page/get-customized-task.ts","webpack://[name]/./src/components/course-viewer/course-page/index.tsx","webpack://[name]/./src/components/course-viewer/course-page/run-up-page.tsx","webpack://[name]/./src/components/course-viewer/course-page/task-assignments-table.tsx","webpack://[name]/./src/components/course-viewer/course-page/task-assignments-utils.tsx","webpack://[name]/./src/components/course-viewer/course-page/task-assignments.tsx","webpack://[name]/./src/components/course-viewer/course-page/task-page.tsx","webpack://[name]/./src/components/course-viewer/course-page/urkund-utils.ts","webpack://[name]/./src/components/course-viewer/index.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/abilities-box.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/central-content-box.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/classroom-assignments-listing.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/confirmation.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/knowledge-requirements-table.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/learning-goals-list.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/resource-list.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/task-fileview.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/task-list.tsx","webpack://[name]/./src/components/course-viewer/utils/get-included-ids.ts","webpack://[name]/./src/components/course-viewer/utils/manual-scroll-restoration.ts","webpack://[name]/./src/components/list-courses/list-courses-page.tsx","webpack://[name]/./src/components/list-courses/list-courses.tsx","webpack://[name]/./src/components/utility-components/LanguageContext.tsx","webpack://[name]/./src/components/utility-components/SetupLanguageIntl.tsx","webpack://[name]/./src/components/utility-components/checkbox.tsx","webpack://[name]/./src/components/utility-components/dialogs.tsx","webpack://[name]/./src/components/utility-components/form-field-text-input.tsx","webpack://[name]/./src/components/utility-components/form-field-textarea.tsx","webpack://[name]/./src/components/utility-components/form-field.tsx","webpack://[name]/./src/components/utility-components/open-close-box.tsx","webpack://[name]/./src/components/weekplanner/add-custom-goal.tsx","webpack://[name]/./src/components/weekplanner/add-custom-task.tsx","webpack://[name]/./src/components/weekplanner/add-or-edit-sub-task.tsx","webpack://[name]/./src/components/weekplanner/edit-user-task.tsx","webpack://[name]/./src/components/weekplanner/get-task-type.ts","webpack://[name]/./src/components/weekplanner/index.ts","webpack://[name]/./src/components/weekplanner/refiner.ts","webpack://[name]/./src/components/weekplanner/user-tasks-box.tsx","webpack://[name]/./src/components/weekplanner/weekplanner-persisted-state.ts","webpack://[name]/./src/components/weekplanner/weekplanner.tsx","webpack://[name]/./src/elements/KEDAppCourseViewer/app.courseviewer.client.tsx","webpack://[name]/./src/elements/KEDAppCourseViewer/webpack-entry.ts","webpack://[name]/./src/features/features.ts","webpack://[name]/./src/features/index.ts","webpack://[name]/./src/global-setters/configure.ts","webpack://[name]/./src/global-setters/set-all.ts","webpack://[name]/./src/global-setters/set-bearer-providers.ts","webpack://[name]/./src/global-setters/set-eds-client.ts","webpack://[name]/./src/global-setters/set-ked-backend-client.ts","webpack://[name]/./src/globals/KED.cfg.ts","webpack://[name]/./src/globals/KED.env.ts","webpack://[name]/./src/globals/KED.ts","webpack://[name]/./src/globals/db.ts","webpack://[name]/./src/globals/ked.ts","webpack://[name]/./src/globals/moment-sv-locale.ts","webpack://[name]/./src/repos/hidden-courses-repo.ts","webpack://[name]/./src/repos/ked-repo.ts","webpack://[name]/./src/repos/repo.ts","webpack://[name]/./src/repos/user-tasks-repo.ts","webpack://[name]/./src/utils/error-success-feedback.tsx","webpack://[name]/./src/utils/make-suspense-api.ts","webpack://[name]/./src/utils/pending-job.ts","webpack://[name]/./src/utils/query-string.ts","webpack://[name]/./src/utils/school-moment.ts","webpack://[name]/./src/utils/school-term.ts","webpack://[name]/./src/utils/utils.ts","webpack://[name]/./src/utils/weekutil.ts"],"sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"kedappcourseviewer\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp_name_\"] = window[\"webpackJsonp_name_\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"./src/elements/KEDAppCourseViewer/webpack-entry.ts\",\"vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from './js/dist/js/ked-backend-client';","export * from './js/dist/js/ked-backend-client-web';","var BearerStorageSessionStorage = /** @class */ (function () {\n    function BearerStorageSessionStorage() {\n    }\n    BearerStorageSessionStorage.prototype.save = function (id, tokenInfo) {\n        sessionStorage.setItem(\"bearer-\" + id, JSON.stringify(tokenInfo));\n    };\n    BearerStorageSessionStorage.prototype.load = function (id) {\n        try {\n            var json = sessionStorage.getItem(\"bearer-\" + id);\n            return Promise.resolve(json ? JSON.parse(json) : { token: null, expires: 0 });\n        }\n        catch (ex) {\n            return Promise.resolve({ token: null, expires: 0 });\n        }\n    };\n    return BearerStorageSessionStorage;\n}());\nexport { BearerStorageSessionStorage };\n//# sourceMappingURL=bearer-storage-sessionstorage.js.map","var redirHash = sessionStorage.getItem(\"redir-hash\");\nif (redirHash)\n    try {\n        var _a = JSON.parse(redirHash), time = _a.time, hash = _a.hash;\n        if (time && time > Date.now() - 60000) {\n            sessionStorage.removeItem(\"redir-hash\");\n            location.hash = hash;\n        }\n    }\n    catch (_) { }\nexport function rememberHashLocation() {\n    sessionStorage.setItem(\"redir-hash\", JSON.stringify({ time: Date.now(), hash: location.hash }));\n}\n//# sourceMappingURL=hash-restorer.js.map","import * as tslib_1 from \"tslib\";\nimport { KedBackendClient, HttpError } from '../ked-backend-client';\nimport { BearerStorageSessionStorage } from \"./bearer-storage-sessionstorage\";\nimport { avoidSimultanousCalls } from '../ked-backend-client/utils';\nimport { KedModelMigratorMixin } from '../ked-model-migrator';\nimport './hash-restorer';\nimport { rememberHashLocation } from './hash-restorer';\nKedModelMigratorMixin(KedBackendClient.prototype);\nexport var storage = new BearerStorageSessionStorage();\nvar timeOfPageLoad = Date.now();\nvar WebServerBearerProvider = /** @class */ (function () {\n    function WebServerBearerProvider(tokenPath, tokenResponseMapper, tokenId) {\n        this.tokenPath = tokenPath;\n        this.tokenResponseMapper = tokenResponseMapper;\n        this.tokenId = tokenId;\n        this.tokenInfo = { token: null, expires: 0 };\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\n    }\n    WebServerBearerProvider.prototype.getBearer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!!this.tokenInfo.token) return [3 /*break*/, 2];\n                        if (!this.tokenId) return [3 /*break*/, 2];\n                        _a = this;\n                        return [4 /*yield*/, storage.load(this.tokenId)];\n                    case 1:\n                        _a.tokenInfo = _b.sent();\n                        _b.label = 2;\n                    case 2:\n                        if (!(this.tokenInfo.expires < Date.now())) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.refreshBearer()];\n                    case 3:\n                        _b.sent();\n                        _b.label = 4;\n                    case 4: return [2 /*return*/, this.tokenInfo];\n                }\n            });\n        });\n    };\n    WebServerBearerProvider.prototype.refreshBearer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, _c, _d;\n            return tslib_1.__generator(this, function (_e) {\n                switch (_e.label) {\n                    case 0: return [4 /*yield*/, fetch(this.tokenPath, {\n                            headers: { Accept: \"text/plain; application/json\" },\n                            redirect: 'manual',\n                            cache: 'no-cache',\n                            credentials: \"same-origin\"\n                        })];\n                    case 1:\n                        res = _e.sent();\n                        if (res.status === 302 || (!res.status && res.type === \"opaqueredirect\")) {\n                            // User session timed out and server wants to redirect entire page to login page\n                            // Time to reload current page to force a redirect of the entire page instead for\n                            // just redirecting to /api/token or whatever.\n                            if (Date.now() - timeOfPageLoad > 60000) { // prohibit endless loop of reloading self.\n                                this.wantsRedirect = true; // So that listeners to onbeforeunload could show alternate message.\n                                console.log(\"Redirect wanted. Reload page.\");\n                                rememberHashLocation();\n                                window.location.reload(true);\n                                throw new HttpError(302, \"Redirected\");\n                            }\n                        }\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = Error.bind;\n                        _b = \"HTTP\" + res.status + \" \";\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(Error, [void 0, _b + (_e.sent())]))();\n                    case 3:\n                        _c = this;\n                        _d = this.tokenResponseMapper;\n                        return [4 /*yield*/, res.text()];\n                    case 4:\n                        _c.tokenInfo = _d.apply(this, [_e.sent()]);\n                        storage.save(this.tokenId, this.tokenInfo);\n                        return [2 /*return*/, this.tokenInfo];\n                }\n            });\n        });\n    };\n    return WebServerBearerProvider;\n}());\nexport { WebServerBearerProvider };\nexport var isomorphic = { fetch: fetch.bind(self), btoa: btoa.bind(self) };\nvar KedBackendClientWeb = /** @class */ (function (_super) {\n    tslib_1.__extends(KedBackendClientWeb, _super);\n    function KedBackendClientWeb(apiBaseUrl, providerOrTokenPath, options) {\n        var _this = this;\n        var bearerProvider = typeof providerOrTokenPath !== 'string' ?\n            providerOrTokenPath :\n            new WebServerBearerProvider(providerOrTokenPath, (options && options.tokenResponseMapper) || (function (x) { return ({ token: x, expires: Date.now() + 59 * 60 * 60 }); }), options && options.tokenId);\n        _this = _super.call(this, isomorphic, bearerProvider, apiBaseUrl) || this;\n        return _this;\n    }\n    return KedBackendClientWeb;\n}(KedBackendClient));\nexport { KedBackendClientWeb };\n//# sourceMappingURL=index.js.map","var DocumentAccess = /** @class */ (function () {\n    function DocumentAccess(accessClaimType, accessClaimValue, right) {\n        this.accessClaimType = accessClaimType;\n        this.accessClaimValue = accessClaimValue;\n        this.right = right;\n    }\n    DocumentAccess.fromString = function (ac) {\n        if (!ac)\n            return null;\n        var split = ac.split(':');\n        if (split.length < 3)\n            throw new Error(\"Invalid access string: \" + ac);\n        var claimType = DocumentAccess.unescape(split[0]);\n        var claimValue = DocumentAccess.unescape(split[1]);\n        var right = split[2];\n        if (right !== 'R' && right !== 'W' && right !== 'S')\n            throw new Error(\"Invalid access string: \" + ac);\n        return new DocumentAccess(claimType, claimValue, right);\n    };\n    DocumentAccess.escape = function (accessComponent) {\n        return accessComponent.replace(/\\%/g, \"%25\").replace(/\\:/g, \"%3A\");\n    };\n    DocumentAccess.unescape = function (accessComponent) {\n        return accessComponent.replace(/\\%3A/g, \":\").replace(/\\%25/g, \"%\");\n    };\n    DocumentAccess.prototype.toString = function () {\n        return DocumentAccess.escape(this.accessClaimType) + \":\" +\n            DocumentAccess.escape(this.accessClaimValue) + \":\" +\n            this.right;\n    };\n    DocumentAccess.fromStringArray = function (acl) {\n        return acl\n            .map(function (ac) { return DocumentAccess.fromString(ac); })\n            .filter(function (ac) { return ac; });\n    };\n    DocumentAccess.toStringArray = function (acl) {\n        return acl.map(function (ac) { return ac.toString(); });\n    };\n    return DocumentAccess;\n}());\nexport { DocumentAccess };\nexport function hasAccess(acl, userClaims, requestedRight) {\n    if (userClaims.some(function (claim) { return claim.type === 'role' && claim.value === \"ADMIN\"; }))\n        return true;\n    return acl.some(function (a) {\n        return userClaims.some(function (c) {\n            return a.accessClaimType === c.type &&\n                a.accessClaimValue === c.value && ((a.right === 'R' && requestedRight === 'R') ||\n                (a.right === 'W' && ['R', 'W'].indexOf(requestedRight) >= 0) ||\n                (a.right === 'S'));\n        });\n    });\n}\n//# sourceMappingURL=access-control.js.map","import * as tslib_1 from \"tslib\";\nvar HttpError = /** @class */ (function (_super) {\n    tslib_1.__extends(HttpError, _super);\n    function HttpError(code, message) {\n        var _this = _super.call(this, \"HTTP\" + code + \" \" + message) || this;\n        _this.code = code;\n        _this.message = message;\n        _this.name = \"http\" + code;\n        _this.message = \"HTTP\" + code + \" \" + message;\n        return _this;\n    }\n    return HttpError;\n}(Error));\nexport { HttpError };\n//# sourceMappingURL=http-error.js.map","import * as tslib_1 from \"tslib\";\nimport { RestClient } from './restclient';\nexport * from './utils';\nexport { KedBearerProvider } from './ked-bearer-provider';\nexport * from './access-control';\nexport { RestClient };\nimport { HttpError } from './http-error';\nexport { HttpError };\nexport * from './restclient';\n;\n// | 'otherFlag' | 'thirdFlag';...\nvar KedBackendClient = /** @class */ (function () {\n    function KedBackendClient(isomorphic, bearerProvider, baseUrl) {\n        this.http = new RestClient(isomorphic, baseUrl, { bearerProvider: bearerProvider });\n    }\n    KedBackendClient.prototype.getMyClaims = function (table, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"me/claims/\" + (table || \"\"), null, fetchOptions)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.get = function (table, id, options, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(table + \"/\" + id, options, fetchOptions)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.list = function (table, options, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var query, res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        query = tslib_1.__assign({}, options);\n                        if (typeof location === 'undefined' || !location.search.includes('dontUseSP')) {\n                            if (!query.from &&\n                                !query.to &&\n                                (!query.include || !query.include.includes(\"acl\")) &&\n                                !query.role &&\n                                !query.name &&\n                                [query.hasEdgesFrom, query.hasEdgesTo, query.ids, query.tags].filter(function (x) { return !!x; }).length === 1) {\n                                query.flags = (query.flags || []).concat(['useSP']);\n                            }\n                        }\n                        if (options && options.mutationsOnEmpty)\n                            query.mutationsOnEmpty = JSON.stringify(options.mutationsOnEmpty);\n                        return [4 /*yield*/, this.http.get(\"\" + table, query, fetchOptions)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.batch = function (reqs, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        // Reorder operations so that 'add's come first and 'delete's come last:\n                        reqs = reqs.slice().sort(function (req1, req2) {\n                            return req1.op === 'add' ? -1 : req2.op === 'add' ? 1 :\n                                req1.op === 'delete' ? 1 : req2.op === 'delete' ? -1 : 0;\n                        });\n                        return [4 /*yield*/, this.http.post(\"batch\", reqs, fetchOptions)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.do = function (scopeFn) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var runner;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        runner = new BatchRunner();\n                        scopeFn(runner);\n                        return [4 /*yield*/, this.batch(runner.mutationRequests)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.deleteRealm = function (realm) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.delete(\"realms/\" + realm)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.add = function (table, doc, branchId) {\n        return this.do(function (r) { return r.add(table, doc); });\n    };\n    KedBackendClient.prototype.put = function (table, doc) {\n        return this.do(function (r) { return r.put(table, doc); });\n    };\n    KedBackendClient.prototype.update = function (table, id, deltaDoc, branchId) {\n        return this.do(function (r) { return r.update(table, id, deltaDoc, branchId); });\n    };\n    KedBackendClient.prototype.merge = function (branchId, targetBranchId) {\n        return this.do(function (r) { return r.merge(branchId, targetBranchId); });\n    };\n    KedBackendClient.prototype.clearBranch = function (branchId) {\n        return this.do(function (r) { return r.clearBranch(branchId); });\n    };\n    KedBackendClient.prototype.delete = function (table, id) {\n        return this.do(function (r) { return r.delete(table, id); });\n    };\n    KedBackendClient.prototype.share = function (table, id, acl) {\n        return this.do(function (r) { return r.share(table, id, acl); });\n    };\n    KedBackendClient.prototype.unshare = function (table, id, acl) {\n        return this.do(function (r) { return r.unshare(table, id, acl); });\n    };\n    KedBackendClient.prototype.link = function (sourceTable, sourceId, targetTable, targetId, label) {\n        return this.do(function (r) { return r.link(sourceTable, sourceId, targetTable, targetId, label); });\n    };\n    KedBackendClient.prototype.link2 = function (sourceTable, sourceId, targetId, label, branchId) {\n        return this.do(function (r) { return r.link2(sourceTable, sourceId, label, targetId, branchId); });\n    };\n    KedBackendClient.prototype.unlink = function (sourceTable, sourceId, targetTable, targetId, label) {\n        return this.do(function (r) { return r.unlink(sourceTable, sourceId, targetTable, targetId, label); });\n    };\n    KedBackendClient.prototype.unlink2 = function (sourceTable, sourceId, targetId, label, branchId) {\n        return this.do(function (r) { return r.unlink2(sourceTable, sourceId, label, targetId, branchId); });\n    };\n    KedBackendClient.prototype.undoLink = function (sourceTable, sourceId, targetId, label, branchId) {\n        return this.do(function (r) { return r.undoLink(sourceTable, sourceId, label, targetId, branchId); });\n    };\n    return KedBackendClient;\n}());\nexport { KedBackendClient };\nvar BatchRunner = /** @class */ (function () {\n    function BatchRunner() {\n        this.mutationRequests = [];\n    }\n    BatchRunner.prototype.add = function (table, doc, branchId) {\n        this.mutationRequests.push({ op: 'add', table: table, doc: doc, branchId: branchId });\n        return this;\n    };\n    BatchRunner.prototype.put = function (table, doc) {\n        doc = tslib_1.__assign({}, doc);\n        delete doc.acl; // Forbidden to send acl with put() calls.\n        this.mutationRequests.push({ op: 'put', table: table, doc: doc });\n        return this;\n    };\n    BatchRunner.prototype.update = function (table, id, deltaDoc, branchId) {\n        deltaDoc = tslib_1.__assign({}, deltaDoc);\n        this.mutationRequests.push({ op: 'update', table: table, id: id, deltaDoc: deltaDoc, branchId: branchId });\n    };\n    BatchRunner.prototype.merge = function (branchId, targetBranchId) {\n        this.mutationRequests.push({ op: 'merge', branchId: branchId, targetBranchId: targetBranchId });\n    };\n    BatchRunner.prototype.clearBranch = function (branchId) {\n        this.mutationRequests.push({ op: 'clear-branch', branchId: branchId });\n    };\n    BatchRunner.prototype.delete = function (table, id) {\n        this.mutationRequests.push({ op: 'delete', table: table, id: id });\n        return this;\n    };\n    BatchRunner.prototype.share = function (table, id, acl) {\n        this.mutationRequests.push({ op: 'share', table: table, id: id, acl: acl });\n        return this;\n    };\n    BatchRunner.prototype.unshare = function (table, id, acl) {\n        this.mutationRequests.push({ op: 'unshare', table: table, id: id, acl: acl });\n        return this;\n    };\n    BatchRunner.prototype.link = function (sourceTable, sourceId, targetTable, targetId, label) {\n        this.mutationRequests.push({ op: 'link', sourceTable: sourceTable, sourceId: sourceId, targetTable: targetTable, targetId: targetId, label: label });\n        return this;\n    };\n    BatchRunner.prototype.link2 = function (sourceTable, sourceId, label, targetId, branchId) {\n        this.mutationRequests.push({ op: 'link', sourceTable: sourceTable, sourceId: sourceId, targetId: targetId, label: label, branchId: branchId });\n    };\n    BatchRunner.prototype.unlink = function (sourceTable, sourceId, targetTable, targetId, label) {\n        this.mutationRequests.push({ op: 'unlink', sourceTable: sourceTable, sourceId: sourceId, targetTable: targetTable, targetId: targetId, label: label });\n        return this;\n    };\n    BatchRunner.prototype.unlink2 = function (sourceTable, sourceId, label, targetId, branchId) {\n        this.mutationRequests.push({ op: 'unlink', sourceTable: sourceTable, sourceId: sourceId, targetId: targetId, label: label, branchId: branchId });\n        return this;\n    };\n    BatchRunner.prototype.undoLink = function (sourceTable, sourceId, label, targetId, branchId) {\n        this.mutationRequests.push({ op: 'undo-link', sourceTable: sourceTable, sourceId: sourceId, targetId: targetId, label: label, branchId: branchId });\n    };\n    return BatchRunner;\n}());\nexport { BatchRunner };\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\nimport { RestClient } from './restclient';\nimport { avoidSimultanousCalls } from './utils';\nvar KedBearerProvider = /** @class */ (function () {\n    function KedBearerProvider(isomorphic, storage, tokenId, clientId, clientSecret, tokenUrl, tokenQuery) {\n        this.isomorphic = isomorphic;\n        this.storage = storage;\n        this.tokenId = tokenId;\n        this.clientId = clientId;\n        this.clientSecret = clientSecret;\n        this.tokenUrl = tokenUrl;\n        this.tokenQuery = tokenQuery;\n        this.tokenInfo = { token: null, expires: 0 };\n        this.client = new RestClient(isomorphic, \"\", {\n            username: this.clientId,\n            password: this.clientSecret\n        });\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\n    }\n    KedBearerProvider.prototype.getBearer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, token, expires, _b, e_1;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = this.tokenInfo, token = _a.token, expires = _a.expires;\n                        if (token && expires >= Date.now())\n                            return [2 /*return*/, this.tokenInfo];\n                        _c.label = 1;\n                    case 1:\n                        _c.trys.push([1, 4, , 6]);\n                        _b = this;\n                        return [4 /*yield*/, this.storage.load(this.clientId + \"/\" + this.tokenId)];\n                    case 2:\n                        _b.tokenInfo = _c.sent();\n                        if (this.tokenInfo.token && this.tokenInfo.expires >= Date.now())\n                            return [2 /*return*/, this.tokenInfo];\n                        return [4 /*yield*/, this.refreshBearer()];\n                    case 3:\n                        _c.sent();\n                        return [2 /*return*/, this.tokenInfo];\n                    case 4:\n                        e_1 = _c.sent();\n                        return [4 /*yield*/, this.refreshBearer()];\n                    case 5:\n                        _c.sent();\n                        return [2 /*return*/, this.tokenInfo];\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBearerProvider.prototype.refreshBearer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, retries, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        retries = 0;\n                        _c.label = 1;\n                    case 1:\n                        if (!(retries < 6)) return [3 /*break*/, 5];\n                        console.log(\"Retrieving token for \" + this.tokenId);\n                        return [4 /*yield*/, this.client.get(this.tokenUrl, this.tokenQuery, { cache: 'reload' })];\n                    case 2:\n                        res = _c.sent();\n                        if (res.status !== 200) {\n                            console.warn(\"Got \" + res.status + \" \" + res.statusText);\n                            return [3 /*break*/, 4];\n                        }\n                        _a = this;\n                        _b = {};\n                        return [4 /*yield*/, res.text()];\n                    case 3:\n                        _a.tokenInfo = (_b.token = _c.sent(), _b.expires = Date.now() + 59 * 60 * 1000, _b);\n                        console.log(\"Got token for \" + this.tokenId + \": \" + JSON.stringify(this.tokenInfo));\n                        this.storage.save(this.clientId + \"/\" + this.tokenId, this.tokenInfo);\n                        return [2 /*return*/, this.tokenInfo];\n                    case 4:\n                        ++retries;\n                        return [3 /*break*/, 1];\n                    case 5: throw new Error(\"Failed to retrieve token for \" + JSON.stringify(this.tokenId));\n                }\n            });\n        });\n    };\n    return KedBearerProvider;\n}());\nexport { KedBearerProvider };\n//# sourceMappingURL=ked-bearer-provider.js.map","/*\ndeclare var Buffer; // node built-in\n\n\nfunction basicAuthHeader(username, password) {\n    return \"Basic \" + new Buffer(username + \":\" + password).toString(\"base64\");\n}\n*/\nimport * as tslib_1 from \"tslib\";\nimport { createUUID } from \"./utils\";\nimport { Emitter } from '../observable/emitter';\nvar RestClient = /** @class */ (function () {\n    function RestClient(isomorphic, baseUrl, options) {\n        this.isomorphic = isomorphic;\n        this.baseUrl = baseUrl;\n        this.options = options;\n        this.numOutstandingOperations = 0;\n        this.cache = {}; //, timeout: number}};\n        this._status = new Emitter(this);\n        this.fetchOptions = { mode: 'cors' };\n        this.authHeader = options.bearer ?\n            \"Bearer \" + options.bearer :\n            options.username ?\n                \"Basic \" + isomorphic.btoa(options.username + \":\" + (options.password || \"\")) :\n                null;\n        this.bearerProvider = options.bearerProvider || null;\n    }\n    Object.defineProperty(RestClient.prototype, \"status\", {\n        get: function () {\n            return this._status;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    RestClient.prototype.suspenseFetch = function (path, method, headers, query, fetchOptions) {\n        var _this = this;\n        var key = method + \" \" + path + \" \" + JSON.stringify(headers) + \" \" + JSON.stringify(query) + \" \" + JSON.stringify(fetchOptions);\n        var entry = this.cache[key];\n        if (entry) {\n            // Entry found. Is it still being fetched?\n            if ('promise' in entry)\n                throw entry.promise; // Still being fetched. Multiple parallell fetches should work on same promise!\n            // Promise has resolved. Return result.\n            return entry.result;\n        }\n        else {\n            // We are the first to do this request. Start doing it:\n            var promise = this.fetch(path, method, headers, query, fetchOptions).then(function (res) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var status, text;\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            status = res.status;\n                            return [4 /*yield*/, res.text()];\n                        case 1:\n                            text = _a.sent();\n                            this.cache[key] = {\n                                result: {\n                                    status: status,\n                                    text: function () { return text; },\n                                    json: function () { return JSON.parse(text); }\n                                }\n                            };\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n            // Immediately put the promise in the cache. Multiple parallell fetches should work on the same promise!\n            this.cache[key] = { promise: promise };\n            // Suspend until promise is resolved. At that time, the cache will contain an answer!\n            throw promise;\n        }\n    };\n    RestClient.prototype.fetch = function (path, method, headers, query, fetchOptions) {\n        var _this = this;\n        ++this.numOutstandingOperations;\n        this._status.dispatch(this);\n        return this._fetch(path, method, headers, query, fetchOptions)\n            .then(function (res) {\n            --_this.numOutstandingOperations;\n            _this._status.dispatch(_this);\n            return res;\n        }).catch(function (err) {\n            --_this.numOutstandingOperations;\n            _this._status.dispatch(_this);\n            return Promise.reject(err);\n        });\n    };\n    RestClient.prototype._fetch = function (path, method, headers, query, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var queryStr, _a, authHeader, tokenInfo, bearerProvider, _b, _c, url, res, wwwauth, _d;\n            return tslib_1.__generator(this, function (_e) {\n                switch (_e.label) {\n                    case 0:\n                        if (fetchOptions && fetchOptions.cache === 'no-cache') {\n                            // Workaround for back-button not respecting cache control in Chrome/Opera.\n                            // Append a query parameter to force a cache entry\n                            query = tslib_1.__assign({}, query, { nocache: createUUID() });\n                        }\n                        queryStr = query && Object.keys(query).filter(function (key) { return query[key] !== undefined; }).map(function (key) {\n                            return encodeURIComponent(key) +\n                                \"=\" +\n                                encodeURIComponent(query[key]);\n                        })\n                            .join('&');\n                        _a = this, authHeader = _a.authHeader, tokenInfo = _a.tokenInfo, bearerProvider = _a.bearerProvider;\n                        if (!(!authHeader && !tokenInfo && bearerProvider)) return [3 /*break*/, 2];\n                        _b = this;\n                        return [4 /*yield*/, bearerProvider.getBearer()];\n                    case 1:\n                        _b.tokenInfo = tokenInfo = _e.sent();\n                        _e.label = 2;\n                    case 2:\n                        if (!tokenInfo) return [3 /*break*/, 5];\n                        if (!(tokenInfo.expires < Date.now())) return [3 /*break*/, 4];\n                        console.log(\"Token expired. Refresh it:\");\n                        _c = this;\n                        return [4 /*yield*/, bearerProvider.refreshBearer()];\n                    case 3:\n                        _c.tokenInfo = tokenInfo = _e.sent();\n                        _e.label = 4;\n                    case 4:\n                        authHeader = \"Bearer \" + tokenInfo.token;\n                        _e.label = 5;\n                    case 5:\n                        // In one way or another, we've concluded an Authorization header to use:\n                        if (authHeader) {\n                            headers.Authorization = authHeader;\n                        }\n                        url = this.baseUrl + path + (queryStr ? \"?\" + queryStr : \"\");\n                        return [4 /*yield*/, this.isomorphic.fetch(url, tslib_1.__assign({}, this.fetchOptions, { headers: headers, method: method }, fetchOptions))];\n                    case 6:\n                        res = _e.sent();\n                        if (!(res.status == 401 && this.bearerProvider)) return [3 /*break*/, 9];\n                        wwwauth = res.headers.get(\"www-authenticate\");\n                        console.log(\"Got \" + res.status + \" from \" + (this.baseUrl + path));\n                        if (!(wwwauth && /Bearer/i.test(wwwauth))) return [3 /*break*/, 9];\n                        _d = this;\n                        return [4 /*yield*/, this.bearerProvider.refreshBearer()];\n                    case 7:\n                        _d.tokenInfo = _e.sent();\n                        headers.Authorization = \"Bearer \" + this.tokenInfo.token;\n                        return [4 /*yield*/, this.isomorphic.fetch(url, tslib_1.__assign({}, this.fetchOptions, { headers: headers, method: method }, fetchOptions))];\n                    case 8:\n                        res = _e.sent();\n                        _e.label = 9;\n                    case 9: return [2 /*return*/, res];\n                }\n            });\n        });\n    };\n    RestClient.prototype.get = function (path, query, fetchOptions) {\n        return this.fetch(path, \"GET\", { Accept: \"application/json; text/plain\" }, query, fetchOptions);\n    };\n    RestClient.prototype.suspenseGet = function (path, query, fetchOptions) {\n        return this.suspenseFetch(path, \"GET\", { Accept: \"application/json; text/plain\" }, query, fetchOptions);\n    };\n    RestClient.prototype.post = function (path, data, fetchOptions) {\n        return this.fetch(path, \"POST\", {\n            \"Content-Type\": \"application/json\",\n            \"Accept\": \"application/json\"\n        }, null, tslib_1.__assign({}, fetchOptions, { body: JSON.stringify(data) }));\n    };\n    RestClient.prototype.delete = function (path, query, body, fetchOptions) {\n        return this.fetch(path, \"DELETE\", { Accept: \"application/json; text/plain\" }, query, tslib_1.__assign({}, fetchOptions, { body: body }));\n    };\n    return RestClient;\n}());\nexport { RestClient };\n//# sourceMappingURL=restclient.js.map","import * as tslib_1 from \"tslib\";\nexport function createUUID() {\n    // Decent solution from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n    var d = Date.now();\n    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        var r = (d + Math.random() * 16) % 16 | 0;\n        d = Math.floor(d / 16);\n        return (c === 'x' ? r : (r & 0x7 | 0x8)).toString(16);\n    });\n    return uuid;\n}\nexport function avoidSimultanousCalls(method) {\n    var ongoingPromise = null;\n    return function () {\n        if (!ongoingPromise) {\n            ongoingPromise = method.apply(this, arguments).then(function (result) {\n                ongoingPromise = null;\n                return result;\n            });\n        }\n        return ongoingPromise;\n    };\n}\nexport function getGlobalId(realm) {\n    var prefix = 'ec96b3be-45fc-41d3-b69e-';\n    var pad = ['50', '08', 'e1', '40', 'e4', 'e7'];\n    if (realm.length > 6)\n        throw new Error(\"Too long realm\");\n    for (var i = 0; i < realm.length; ++i) {\n        var hex = realm.charCodeAt(i).toString(16);\n        pad[i] = hex.length === 2 ?\n            hex :\n            '0' + hex;\n    }\n    return prefix + pad.join('');\n}\nexport function computePredestinatedId(input) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n        var encoder, data, digest, _a, i;\n        return tslib_1.__generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    encoder = new TextEncoder();\n                    data = encoder.encode(input);\n                    _a = Uint8Array.bind;\n                    return [4 /*yield*/, crypto.subtle.digest('SHA-256', data)];\n                case 1:\n                    digest = new (_a.apply(Uint8Array, [void 0, _b.sent()]))();\n                    i = 0;\n                    return [2 /*return*/, 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n                            var nibble = digest[i++] % 16 | 0;\n                            var washedNibble = c === 'x' ?\n                                nibble :\n                                nibble & 0x7 | 0x8;\n                            return washedNibble.toString(16);\n                        })];\n            }\n        });\n    });\n}\nexport function simpleDigest(input) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n        var encoder, inputBytes, digestBytes, _a;\n        return tslib_1.__generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    encoder = new TextEncoder();\n                    inputBytes = encoder.encode(input);\n                    _a = Uint8Array.bind;\n                    return [4 /*yield*/, crypto.subtle.digest('SHA-256', inputBytes)];\n                case 1:\n                    digestBytes = new (_a.apply(Uint8Array, [void 0, _b.sent(), 0, 16]))();\n                    return [2 /*return*/, buf2hex(digestBytes)];\n            }\n        });\n    });\n}\nvar simpleDigestCache = {};\nexport function simpleDigestSuspense(inputs) {\n    var results = inputs.map(function (input) { return simpleDigestCache[input]; });\n    var unresolvedInputs = [];\n    results.forEach(function (result, index) {\n        if (!result)\n            unresolvedInputs.push(inputs[index]);\n    });\n    if (unresolvedInputs.length === 0)\n        return results;\n    throw Promise.all(unresolvedInputs.map(function (input) { return simpleDigest(input).then(function (result) { return simpleDigestCache[input] = result; }); }));\n}\nexport function buf2hex(buffer) {\n    return Array.prototype.map.call(buffer, function (x) { return ('00' + x.toString(16)).slice(-2); }).join('');\n}\nexport function updateArray(a, mapper) {\n    var retval = a;\n    for (var i = 0, l = a.length; i < l; ++i) {\n        var t = a[i];\n        var mapped = mapper(t);\n        if (mapped !== t) {\n            if (retval === a)\n                retval = a.slice();\n            retval[i] = mapped;\n        }\n    }\n    return retval;\n}\n/*\nexport function updateArray<T>(a: T[], mapper: (t: T) => T | false): T[] {\n  let retval = a;\n  let j = 0;\n  for (let i=0,l=a.length; i<l; ++i, ++j) {\n    const t = a[i];\n    const mapped = mapper(t);\n    if (mapped === false) {\n      // Mapper wants to delete this doc.\n      if (retval === a) retval = a.slice();\n      retval.splice(j, 1);\n      --j; // compensate for ++j\n    } else if (mapped !== t) {\n      if (retval === a) retval = a.slice();\n      retval[j] = mapped;\n    }\n  }\n  return retval;\n}\n*/ \n//# sourceMappingURL=utils.js.map","import * as JsonSchema from \"kedbackend-schema/schema.json\";\nimport { getTableFromLabel } from \"./utils\";\nvar CacheBust = /** @class */ (function () {\n    function CacheBust() {\n    }\n    CacheBust.getCacheBust = function (table, query, user, includes) {\n        var involvedItems = CacheBust.getInvolvedItems(table, query, includes);\n        return involvedItems\n            .map(function (item) { return localStorage.getItem(\"cache-bust-\" + user + \"-\" + item); })\n            .filter(function (value) { return !!value; })\n            .join('/') || 'static';\n    };\n    CacheBust.invalidateCache = function (reqs, user) {\n        for (var _i = 0, _a = CacheBust.getCacheInvalidations(reqs); _i < _a.length; _i++) {\n            var item = _a[_i];\n            localStorage.setItem(\"cache-bust-\" + user + \"-\" + item, '' + Date.now());\n        }\n    };\n    CacheBust.getInvolvedItems = function (table, query, includes) {\n        var hasEdgesFrom = query.hasEdgesFrom;\n        var relatedTables = includes\n            .map(function (label) { return JsonSchema.tables[table].relationships[label]; })\n            .filter(function (table) { return !!table; });\n        if (hasEdgesFrom)\n            relatedTables.push(\"hef\" + table);\n        return [table, 'master', query.branchId].filter(function (x) { return !!x; }).concat(relatedTables).sort();\n    };\n    CacheBust.getCacheInvalidations = function (reqs) {\n        var invalidationSet = {};\n        reqs.forEach(function (req) {\n            switch (req.op) {\n                case 'add':\n                case 'put':\n                case 'delete':\n                case 'update':\n                    invalidationSet[req.table] = true;\n                    break;\n                case 'link':\n                case 'unlink':\n                case 'undo-link':\n                    invalidationSet[req.sourceTable] = true;\n                    invalidationSet[\"hef-\" + getTableFromLabel(req.sourceTable, req.label)] = true;\n                    break;\n                case 'clear-branch':\n                    invalidationSet[req.branchId] = true;\n                    break;\n                case 'merge':\n                    invalidationSet[req.branchId] = true;\n                    invalidationSet[req.targetBranchId || \"master\"] = true;\n                    break;\n            }\n        });\n        return Object.keys(invalidationSet);\n    };\n    return CacheBust;\n}());\nexport { CacheBust };\n//# sourceMappingURL=cache-bust.js.map","import * as tslib_1 from \"tslib\";\nimport { mergeDeltas } from '../delta-merge';\nexport function applyMutationsOnDeltas(branchId, deltas, mutations, optimistic, userDisplayName, hasAdditionalFilter) {\n    var _loop_1 = function (m) {\n        switch (m.op) {\n            case 'add-related':\n                //\n                // AddRelated RepoMutation\n                //\n                if (!hasAdditionalFilter && m.branchId === branchId) {\n                    deltas = [{\n                            type: 'add',\n                            sourceId: m.id,\n                            targetId: m.relatedDoc.id,\n                            label: m.graphProp,\n                            sourceTable: m.table,\n                            $meta: optimistic ? 'adding' : 'persisted',\n                            dateTime: Date.now(),\n                            targetName: m.relatedDoc.name,\n                            contributor: userDisplayName\n                        }].concat(deltas);\n                }\n                break;\n            case 'clear-branch':\n                //\n                // ClearBranch RepoMutation\n                //\n                if (m.branchId === branchId) {\n                    deltas = [];\n                }\n                break;\n            case 'delete':\n                //\n                // Delete RepoMutation\n                //\n                // This type of mutation can not be performed onto branches. There's no branchId property on m.\n                break;\n            case 'merge':\n                //\n                // Merge RepoMutation\n                //\n                if (m.branchId === branchId) {\n                    deltas = [];\n                }\n                else if (m.targetBranchId === branchId) {\n                    // This change will append new deltas to our deltas array but we don't know what would come.\n                    // Need to refetch from server.\n                    if (!optimistic)\n                        return { value: null }; // Caller should check for null and re-fetch data from server.\n                }\n                break;\n            case 'remove-related':\n                //\n                // Remove-Related RepoMutation\n                //\n                if (hasAdditionalFilter || m.branchId !== branchId)\n                    return \"continue\";\n                deltas = [{\n                        type: 'remove',\n                        sourceId: m.id,\n                        targetId: m.relatedDoc.id,\n                        targetName: m.relatedDoc.name,\n                        label: m.graphProp,\n                        sourceTable: m.table,\n                        contributor: userDisplayName,\n                        dateTime: Date.now(),\n                        $meta: optimistic ? 'adding' : 'persisted'\n                    }].concat(deltas);\n                break;\n            case 'undo-link':\n                //\n                // Undo-Link RepoMutation\n                //\n                if (m.branchId !== branchId)\n                    return \"continue\";\n                {\n                    var idx = deltas.findIndex(function (d) {\n                        return (d.type === 'add' || d.type === 'remove' || d.type === 'undo-link') &&\n                            d.sourceId === m.id &&\n                            d.targetId === m.relatedId;\n                    });\n                    if (idx < 0)\n                        return \"continue\";\n                    // Found an \"add\" or \"remove\" delta to change:\n                    if (optimistic) {\n                        var deltaRelation = deltas[idx];\n                        // Mark the existing add/remove delta as currenlty being deleted\n                        deltas = deltas.slice(0, idx).concat([\n                            tslib_1.__assign({}, deltaRelation, { $meta: optimistic ? 'removing' : 'persisted' })\n                        ], deltas.slice(idx + 1));\n                    }\n                    else {\n                        // Persisted. Just remove it:\n                        deltas = deltas.slice(0, idx).concat(deltas.slice(idx + 1));\n                    }\n                }\n                break;\n            case 'update':\n                //\n                // Update RepoMutation\n                //\n                if (m.branchId !== branchId)\n                    return \"continue\";\n                {\n                    var idx = deltas.findIndex(function (delta) {\n                        return delta.type === 'modify' &&\n                            delta.targetId === m.id;\n                    });\n                    if (idx < 0 && !hasAdditionalFilter) {\n                        deltas = [{\n                                type: 'modify',\n                                table: m.table,\n                                targetId: m.id,\n                                targetName: m.targetName,\n                                data: m.deltaDoc,\n                                dateTime: Date.now(),\n                                contributors: [userDisplayName],\n                                $meta: optimistic ? 'adding' : 'persisted',\n                            }].concat(deltas);\n                    }\n                    else {\n                        var existingDeltaDoc = deltas[idx];\n                        var contributors = existingDeltaDoc.contributors.slice();\n                        if (!contributors.includes(userDisplayName)) {\n                            contributors.push(userDisplayName);\n                        }\n                        var newData = mergeDeltas(existingDeltaDoc.data, m.deltaDoc, { removeUnsetProps: true });\n                        if (!optimistic && Object.keys(newData).length === 0) {\n                            // Committed mutation that resets a deltaDoc. Remove the deltaDoc entirely:\n                            deltas = deltas.slice(0, idx).concat(deltas.slice(idx + 1));\n                        }\n                        else {\n                            // \n                            deltas = [\n                                {\n                                    type: 'modify',\n                                    table: m.table,\n                                    targetId: m.id,\n                                    targetName: m.targetName,\n                                    data: newData,\n                                    dateTime: Date.now(),\n                                    contributors: contributors,\n                                    $meta: optimistic ? 'updating' : 'persisted',\n                                }\n                            ].concat(deltas.slice(0, idx), deltas.slice(idx + 1));\n                        }\n                    }\n                }\n                break;\n        }\n    };\n    for (var _i = 0, mutations_1 = mutations; _i < mutations_1.length; _i++) {\n        var m = mutations_1[_i];\n        var state_1 = _loop_1(m);\n        if (typeof state_1 === \"object\")\n            return state_1.value;\n    }\n    return deltas;\n}\n//# sourceMappingURL=apply-mutations-on-deltas.js.map","import * as tslib_1 from \"tslib\";\nimport { HttpError } from '../../ked-backend-client';\nimport { applyMutationsOnDeltas } from './apply-mutations-on-deltas';\nvar DeltaCache = /** @class */ (function () {\n    function DeltaCache(getClient, getUser, getUserDisplayName) {\n        this.getClient = getClient;\n        this.getUser = getUser;\n        this.getUserDisplayName = getUserDisplayName;\n        this.lookup = {};\n    }\n    DeltaCache.prototype.applyMutations = function (mutations, _a) {\n        var optimistic = (_a === void 0 ? { optimistic: false } : _a).optimistic;\n        // Apply mutations locally onto the DeltaCache and notify their subscribers\n        for (var _i = 0, _b = Object.keys(this.lookup); _i < _b.length; _i++) {\n            var queryKey = _b[_i];\n            var cacheEntry = this.lookup[queryKey];\n            if (cacheEntry.value) {\n                // Instead here: Store the mutations on cacheEntry. No matter if it yet has value or not.\n                // Then apply mutation whenever subscribing! (Better handling of mutations that arrives before fetch() is done)\n                // (See how I handle this in query-set.ts)\n                var newValue = applyMutationsOnDeltas(cacheEntry.query.branchId, cacheEntry.value, mutations, optimistic, this.getUserDisplayName(), !!cacheEntry.query.tags);\n                if (newValue === null) {\n                    // The mutation requires cacheEntry to be refetched from server\n                    if (!optimistic) {\n                        // Caller has successfully performed the mutations and got success back from server.\n                        // It's ok to refetch the deltas from server now:\n                        cacheEntry.fetch();\n                        // After fetch completes, it will notify the subscribers.\n                    }\n                }\n                if (newValue !== cacheEntry.value) {\n                    cacheEntry.optimisticValue = newValue;\n                    if (!optimistic)\n                        cacheEntry.value = newValue;\n                    cacheEntry.notify(newValue);\n                }\n            }\n        }\n    };\n    DeltaCache.prototype.subscribe = function (query, observer) {\n        var _this = this;\n        var cacheEntry = this.lookup[query.branchId + query.tags];\n        if (!cacheEntry) {\n            cacheEntry = new DeltaCacheEntry(this.getClient(), query);\n            this.lookup[query.branchId + query.tags] = cacheEntry;\n        }\n        if (cacheEntry.cleanupTimer) {\n            clearTimeout(cacheEntry.cleanupTimer);\n            cacheEntry.cleanupTimer = null;\n        }\n        var subscription = {\n            unsubscribe: function () {\n                cacheEntry.subscribers = cacheEntry.subscribers.filter(function (_a) {\n                    var o = _a.observer;\n                    return o !== observer;\n                });\n                if (cacheEntry.subscribers.length === 0) {\n                    cacheEntry.cleanupTimer = setTimeout(function () {\n                        if (cacheEntry.subscribers.length === 0) {\n                            delete _this.lookup[query.branchId + query.tags];\n                        }\n                    }, 100);\n                }\n            }\n        };\n        cacheEntry.subscribers.push({ observer: observer, subscription: subscription });\n        if (cacheEntry.value) {\n            // Value has been successfully retrieved already. Pick from cache.\n            observer(cacheEntry.optimisticValue || cacheEntry.value, null, subscription);\n        }\n        else if (cacheEntry.isFetching) {\n            // A value is on its way. Sit back and relax. All registered\n            // observers (including this one) will be notified when data arrives\n            // or fails.\n        }\n        else if (cacheEntry.error) {\n            observer(null, cacheEntry.error, subscription);\n        }\n        else {\n            cacheEntry.fetch();\n        }\n        return subscription;\n    };\n    return DeltaCache;\n}());\nexport { DeltaCache };\nvar DeltaCacheEntry = /** @class */ (function () {\n    function DeltaCacheEntry(client, query) {\n        this.fetchOperationId = 0; // Makes sure a re-fetch will discard the result from any ongoing fetch.\n        this.client = client;\n        this.query = query;\n        this.value = null;\n        this.error = null;\n        this.optimisticValue = null;\n        this.subscribers = [];\n        this.isFetching = false;\n        this.cleanupTimer = null;\n    }\n    DeltaCacheEntry.prototype.fetch = function () {\n        var _this = this;\n        var fetchOperationId = ++this.fetchOperationId;\n        this.isFetching = true;\n        this.fetchFromServer().then(function (value) {\n            // Success\n            if (fetchOperationId === _this.fetchOperationId) {\n                _this.isFetching = false;\n                value.sort(function (a, b) { return b.dateTime - a.dateTime; }); // Latest first\n                _this.value = value;\n                _this.optimisticValue = value;\n                _this.notify(value);\n            }\n        }).catch(function (error) {\n            // Fail\n            if (fetchOperationId === _this.fetchOperationId) {\n                _this.isFetching = false;\n                _this.error = error;\n                _this.fail(error);\n            }\n        });\n    };\n    DeltaCacheEntry.prototype.fetchFromServer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (!this.query.branchId)\n                            throw new Error('Deltas only available on branches');\n                        return [4 /*yield*/, this.client.http.get('deltas', this.query)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status >= 300 || res.status < 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    DeltaCacheEntry.prototype.notify = function (value) {\n        for (var _i = 0, _a = this.subscribers; _i < _a.length; _i++) {\n            var _b = _a[_i], observer = _b.observer, subscription = _b.subscription;\n            observer(value, null, subscription);\n        }\n    };\n    DeltaCacheEntry.prototype.fail = function (error) {\n        var copy = this.subscribers.slice();\n        this.subscribers = [];\n        for (var _i = 0, copy_1 = copy; _i < copy_1.length; _i++) {\n            var _a = copy_1[_i], observer = _a.observer, subscription = _a.subscription;\n            observer(null, error, subscription);\n        }\n    };\n    return DeltaCacheEntry;\n}());\n//# sourceMappingURL=delta-cache.js.map","import * as tslib_1 from \"tslib\";\nimport { Collection } from '../../observable';\nvar DeltaCollection = /** @class */ (function (_super) {\n    tslib_1.__extends(DeltaCollection, _super);\n    function DeltaCollection(deltaCache, query) {\n        var _this = _super.call(this, function (observer) { return _this.deltaCache.subscribe(query, observer); }) || this;\n        _this.deltaCache = deltaCache;\n        _this.query = query;\n        return _this;\n    }\n    DeltaCollection.prototype.tags = function () {\n        var tags = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tags[_i] = arguments[_i];\n        }\n        return new DeltaCollection(this.deltaCache, tslib_1.__assign({}, this.query, { tags: tags }));\n    };\n    return DeltaCollection;\n}(Collection));\nexport { DeltaCollection };\n//# sourceMappingURL=delta-collection.js.map","import * as tslib_1 from \"tslib\";\nexport function applyDelta(doc, delta) {\n    var keys = Object.keys(delta);\n    var targetDoc = doc;\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n        var key = keys_1[_i];\n        if (targetDoc === doc)\n            targetDoc = tslib_1.__assign({}, doc);\n        var val = delta[key];\n        if (val && typeof val === 'object') {\n            var metaInstructions = Object.keys(val)\n                .filter(function (key) { return key.startsWith('$'); });\n            if (metaInstructions.length > 0) {\n                var _loop_1 = function (mi) {\n                    var miValue = val[mi];\n                    switch (mi) {\n                        case \"$unset\": {\n                            // Do nothing on target doc!\n                            targetDoc.$wasUnset = true; // Just mark it for re-retrieval after successful posting changes.\n                            break;\n                        }\n                        case \"$add\": {\n                            var valuesToAdd = miValue;\n                            if (!Array.isArray(valuesToAdd)) {\n                                throw new Error(\"$add instruction must contain array\");\n                            }\n                            var targetArray = targetDoc[key];\n                            if (!Array.isArray(targetArray)) {\n                                targetArray = [];\n                            }\n                            else {\n                                targetArray = targetArray.slice(); // On JS side, we must be immutable\n                            }\n                            targetDoc[key] = targetArray;\n                            for (var _i = 0, valuesToAdd_1 = valuesToAdd; _i < valuesToAdd_1.length; _i++) {\n                                var v = valuesToAdd_1[_i];\n                                if (!targetArray.includes(v)) { // avoid dups\n                                    targetArray.push(v);\n                                }\n                            }\n                            break;\n                        }\n                        case \"$remove\": {\n                            var valuesToRemove_1 = miValue;\n                            if (!Array.isArray(valuesToRemove_1)) {\n                                throw new Error(\"$remove instruction must contain array\");\n                            }\n                            var targetArray = targetDoc[key];\n                            if (!Array.isArray(targetArray)) {\n                                targetArray = [];\n                            }\n                            targetDoc[key] = targetArray.filter(function (t) { return !valuesToRemove_1.includes(t); });\n                            break;\n                        }\n                    }\n                };\n                for (var _a = 0, metaInstructions_1 = metaInstructions; _a < metaInstructions_1.length; _a++) {\n                    var mi = metaInstructions_1[_a];\n                    _loop_1(mi);\n                }\n                continue;\n            }\n        }\n        targetDoc[key] = val;\n    }\n    return targetDoc;\n}\n// {name: \"Ulla\"}, {name: {$unset:0}\n// {tags: {$add: \"hej\"}}, {tags: {$unset:0}\"}\nexport function mergeDeltas(delta1, delta2, _a) {\n    var removeUnsetProps = (_a === void 0 ? { removeUnsetProps: false } : _a).removeUnsetProps;\n    //return {...delta1, ...delta2};\n    var keys = Object.keys(delta2);\n    var targetDelta = tslib_1.__assign({}, delta1);\n    for (var _i = 0, keys_2 = keys; _i < keys_2.length; _i++) {\n        var key = keys_2[_i];\n        var val = delta2[key];\n        if (val && typeof val === 'object') {\n            var metaInstructions = Object.keys(val)\n                .filter(function (key) { return key.startsWith('$'); });\n            if (metaInstructions.length > 0) {\n                var _loop_2 = function (mi) {\n                    var miValue = val[mi];\n                    switch (mi) {\n                        case \"$unset\": {\n                            if (removeUnsetProps) {\n                                delete targetDelta[key];\n                            }\n                            else {\n                                // No matter if targetDelta is empty or has value. Set it to {$unset:0}\n                                // to make sure the very end result will have {$unset:0}\n                                targetDelta[key] = { $unset: 0 };\n                            }\n                            break;\n                        }\n                        case \"$add\": {\n                            var valuesToAdd_2 = miValue;\n                            if (!Array.isArray(valuesToAdd_2)) {\n                                throw new Error(\"$add instruction must contain array\");\n                            }\n                            var targetMetaProp = targetDelta[key];\n                            targetMetaProp = targetMetaProp ? tslib_1.__assign({}, targetMetaProp) : {};\n                            targetDelta[key] = targetMetaProp;\n                            // First, just check if target metaProp has {$remove: [...items]}\n                            // If so, remove any equal items from there before merging the {$add: [...]} arrays.\n                            var targetRemoveArray = targetMetaProp.$remove;\n                            if (Array.isArray(targetRemoveArray)) {\n                                targetMetaProp.$remove =\n                                    targetRemoveArray.filter(function (t) { return !valuesToAdd_2.includes(t); });\n                                if (targetMetaProp.$remove.length === 0) {\n                                    // If $remove array became emtpy. Remove the $remove prop.\n                                    delete targetMetaProp.$remove;\n                                }\n                            }\n                            // Now it's time to merge or create target $add array.\n                            var targetAddArray = targetMetaProp.$add;\n                            targetAddArray = targetAddArray ? targetAddArray.concat(valuesToAdd_2) : valuesToAdd_2.slice();\n                            targetMetaProp.$add = targetAddArray;\n                            break;\n                        }\n                        case \"$remove\": {\n                            var valuesToRemove_2 = miValue;\n                            if (!Array.isArray(valuesToRemove_2)) {\n                                throw new Error(\"$remove instruction must contain array\");\n                            }\n                            var targetMetaProp = targetDelta[key];\n                            targetMetaProp = targetMetaProp ? tslib_1.__assign({}, targetMetaProp) : {};\n                            targetDelta[key] = targetMetaProp;\n                            // First, just check if target metaProp has {$add: [...items]}\n                            // If so, remove any equal items from there before merging the {$remove: [...]} arrays.\n                            var targetAddArray = targetMetaProp.$remove;\n                            if (Array.isArray(targetAddArray)) {\n                                targetMetaProp.$add =\n                                    targetAddArray.filter(function (t) { return !valuesToRemove_2.includes(t); });\n                                if (targetMetaProp.$add.length === 0) {\n                                    // If $add array became emtpy. Remove the $add prop.\n                                    delete targetMetaProp.$add;\n                                }\n                            }\n                            // Now it's time to merge or create target $remove array.\n                            var targetRemoveArray = targetMetaProp.$remove;\n                            targetRemoveArray = targetRemoveArray ? targetRemoveArray.concat(valuesToRemove_2) : valuesToRemove_2.slice();\n                            targetMetaProp.$remove = targetRemoveArray;\n                            break;\n                        }\n                    }\n                };\n                for (var _b = 0, metaInstructions_2 = metaInstructions; _b < metaInstructions_2.length; _b++) {\n                    var mi = metaInstructions_2[_b];\n                    _loop_2(mi);\n                }\n                continue;\n            }\n        }\n        targetDelta[key] = val;\n    }\n    return targetDelta;\n}\n//# sourceMappingURL=delta-merge.js.map","export * from './kedbackend-collection';\nexport * from './kedbackend-query';\nexport * from './kedbackend-repo';\nexport * from './kedbackend-subscription';\nexport * from './kedbackend-writer';\nexport * from './mutation-queue';\nexport * from './query-set';\nexport * from '../observable/mixin';\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\nimport { BatchRunner } from '../ked-backend-client';\nimport { KedBackendSubscription } from \"./kedbackend-subscription\";\nimport { CacheBust } from './cache-bust';\nimport { KedBackendQuery } from './kedbackend-query';\nimport { Collection } from '../observable/collection';\n/**\n * Represents a \"live\" query against a table or filtered table.\n */\nvar KedBackendCollection = /** @class */ (function (_super) {\n    tslib_1.__extends(KedBackendCollection, _super);\n    function KedBackendCollection(repo, table, query) {\n        var _this = _super.call(this, function (observer) {\n            var subscription = new KedBackendSubscription(observer, _this);\n            _this.repo.querySet.subscribe(subscription);\n            return subscription;\n        }) || this;\n        _this.repo = repo;\n        _this.table = table;\n        _this.query = query;\n        return _this;\n    }\n    Object.defineProperty(KedBackendCollection.prototype, \"queryKey\", {\n        get: function () {\n            return KedBackendQuery.queryKey(this.table, this.query);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(KedBackendCollection.prototype, \"includes\", {\n        get: function () {\n            return this._includes || (this._includes = [].concat(this.query.include || []));\n        },\n        enumerable: true,\n        configurable: true\n    });\n    KedBackendCollection.prototype.applyQuery = function (query) {\n        return new KedBackendCollection(this.repo, this.table, tslib_1.__assign({}, this.query, query));\n    };\n    KedBackendCollection.prototype.addToQueryArrayProp = function (arrayProp, entries) {\n        var _a;\n        return this.applyQuery((_a = {}, _a[arrayProp] = (this.query[arrayProp] || []).concat(entries), _a));\n    };\n    KedBackendCollection.prototype.addFlags = function () {\n        var flags = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            flags[_i] = arguments[_i];\n        }\n        return this.addToQueryArrayProp(\"flags\", flags);\n    };\n    KedBackendCollection.prototype.debug = function () {\n        return this.applyQuery({ debug: true });\n    };\n    KedBackendCollection.prototype.idsOnly = function () {\n        return this.addFlags(\"idsOnly\");\n    };\n    KedBackendCollection.prototype.idsAndNamesOnly = function () {\n        return this.addFlags(\"idsAndNamesOnly\");\n    };\n    KedBackendCollection.prototype.includeIdsOnly = function () {\n        return this.addFlags(\"includeIdsOnly\");\n    };\n    KedBackendCollection.prototype.includeIdsAndNamesOnly = function () {\n        return this.addFlags(\"includeIdsAndNamesOnly\");\n    };\n    KedBackendCollection.prototype.between = function (from, to) {\n        return this.applyQuery({ from: from, to: to });\n    };\n    KedBackendCollection.prototype.role = function (role) {\n        return this.applyQuery({ role: role });\n    };\n    KedBackendCollection.prototype.hasEdgesFrom = function (ids) {\n        if (ids.length === 0 || ids.some(function (id) { return !id; }))\n            throw new Error(\"Invalid id list given to Collection.hasEdgesFrom(\" + JSON.stringify(ids) + \")\");\n        var hef = this.addToQueryArrayProp(\"hasEdgesFrom\", ids);\n        return hef;\n    };\n    KedBackendCollection.prototype.hasEdgesTo = function (ids) {\n        if (ids.length === 0 || ids.some(function (id) { return !id; }))\n            throw new Error(\"Invalid id list given to Collection.hasEdgesTo(\" + JSON.stringify(ids) + \")\");\n        var het = this.addToQueryArrayProp(\"hasEdgesTo\", ids);\n        return het;\n    };\n    KedBackendCollection.prototype.id = function (id) {\n        var _this = this;\n        return this.applyQuery({ ids: [id] }).single({\n            onZero: function () { throw new Error(\"Could not find entity in \" + _this.table + \" with id \" + id); },\n            onMany: function () { throw new Error(\"Multiple entries in \" + _this.table + \" with id \" + id); },\n        });\n    };\n    KedBackendCollection.prototype.ids = function (ids) {\n        return this.applyQuery({ ids: ids });\n    };\n    KedBackendCollection.prototype.name = function (name) {\n        return this.applyQuery({ name: name });\n    };\n    KedBackendCollection.prototype.tags = function () {\n        var tags = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tags[_i] = arguments[_i];\n        }\n        return this.applyQuery({ tags: tags });\n    };\n    KedBackendCollection.prototype.branchId = function (branchId) {\n        return this.applyQuery({ branchId: branchId });\n    };\n    KedBackendCollection.prototype.include = function () {\n        var graphs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            graphs[_i] = arguments[_i];\n        }\n        return this.addToQueryArrayProp(\"include\", graphs);\n    };\n    KedBackendCollection.prototype.cacheOptimized = function (onOrOff) {\n        return onOrOff === undefined || onOrOff === true ?\n            this.applyQuery({ cacheBust: CacheBust.getCacheBust(this.table, this.query, this.repo.getUser(), this.includes) }) :\n            this.applyQuery({ cacheBust: undefined });\n    };\n    KedBackendCollection.prototype.mutationsOnEmpty = function (mutationFactory) {\n        var tx = new BatchRunner();\n        mutationFactory(tx);\n        return this.applyQuery({ mutationsOnEmpty: tx.mutationRequests });\n    };\n    KedBackendCollection.prototype.single = function (throwers) {\n        var _this = this;\n        var _a = throwers || {}, onZero = _a.onZero, onMany = _a.onMany;\n        return this.toValue().map(function (items) {\n            if (items.length === 0) {\n                if (onZero)\n                    onZero();\n                else\n                    throw new Error(\"Single item of \" + _this.table + \" expected to be returned by query \" + JSON.stringify(_this.query) + \" but none was found.\");\n            }\n            if (items.length > 1) {\n                debugger;\n                if (onMany)\n                    onMany();\n                else\n                    console.log(\"Single item of \" + _this.table + \" expected to be returned by query \" + JSON.stringify(_this.query) + \" but \" + items.length + \" was found.\");\n            }\n            return items[0];\n        });\n    };\n    /*combineLatest<TOther>(other: QueryObservable<TOther>) {\n      return this.render(x => x).combineLatest(other);\n    }*/\n    KedBackendCollection.prototype.update = function (doc, changes, debounce) {\n        if (debounce === void 0) { debounce = 1000; }\n        this.repo.writer.mutate([{\n                op: 'update',\n                table: this.table,\n                branchId: this.query.branchId,\n                id: doc.id,\n                deltaDoc: changes,\n                targetName: doc.name\n            }], debounce);\n    };\n    KedBackendCollection.prototype.addRelated = function (id, label, relatedDoc) {\n        this.repo.writer.mutate([{\n                op: 'add-related',\n                table: this.table,\n                branchId: this.query.branchId,\n                id: id,\n                graphProp: label,\n                relatedDoc: relatedDoc\n            }], 0);\n    };\n    KedBackendCollection.prototype.add = function (doc) {\n        this.repo.writer.mutate([{\n                op: 'add',\n                id: doc.id,\n                table: this.table,\n                doc: doc\n            }], 0);\n    };\n    KedBackendCollection.prototype.removeRelated = function (id, label, relatedDoc) {\n        this.repo.writer.mutate([{\n                op: 'remove-related',\n                table: this.table,\n                branchId: this.query.branchId,\n                id: id,\n                graphProp: label,\n                relatedDoc: relatedDoc\n            }], 0);\n    };\n    KedBackendCollection.prototype.undoLink = function (id, label, relatedId) {\n        if (!this.query.branchId)\n            throw new Error(\"undo links can only be performed on branches\");\n        this.repo.writer.mutate([{\n                op: 'undo-link',\n                table: this.table,\n                branchId: this.query.branchId,\n                id: id,\n                graphProp: label,\n                relatedId: relatedId\n            }], 0);\n    };\n    KedBackendCollection.prototype.delete = function () {\n        var _this = this;\n        var ids = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            ids[_i] = arguments[_i];\n        }\n        this.repo.writer.mutate(ids.map(function (id) { return ({\n            op: 'delete',\n            table: _this.table,\n            id: id\n        }); }), 0);\n    };\n    KedBackendCollection.prototype.unsubscribe = function (subscription) {\n        this.repo.querySet.unsubscribe(subscription);\n    };\n    return KedBackendCollection;\n}(Collection));\nexport { KedBackendCollection };\n/*mixin(\n  KedBackendCollection.prototype,\n  MappedCollection.prototype,\n  \"map\", \"flat\", \"concat\", \"render\", \"load\");*/\n//# sourceMappingURL=kedbackend-collection.js.map","import * as tslib_1 from \"tslib\";\nimport { updateArray } from '../ked-backend-client/utils';\nimport { branchSensitive, getTableFromLabel } from './utils';\nimport { applyDelta } from './delta-merge';\nvar KedBackendQuery = /** @class */ (function () {\n    function KedBackendQuery(table, query, user, repo, mutationQueue) {\n        this.table = table;\n        this.query = query;\n        this.user = user;\n        this.repo = repo;\n        this.mutationQueue = mutationQueue;\n        this.subscriptions = [];\n        this.data = [];\n        this.gotInitialResponse = false;\n        this.invalid = false;\n        this.loadedVersion = 0;\n        this._loadPromise = null;\n        this.includes = query.include ?\n            typeof query.include === 'string' ?\n                [query.include] :\n                query.include :\n            [];\n    }\n    KedBackendQuery.queryKey = function (table, query) {\n        var mutationsOnEmpty = query.mutationsOnEmpty, comparableProps = tslib_1.__rest(query, [\"mutationsOnEmpty\"]);\n        return table + JSON.stringify(comparableProps);\n    };\n    Object.defineProperty(KedBackendQuery.prototype, \"queryKey\", {\n        get: function () {\n            return KedBackendQuery.queryKey(this.table, this.query);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    KedBackendQuery.prototype.subscribe = function (subscription) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var data, data;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.subscriptions.push(subscription);\n                        if (!(this.gotInitialResponse && !this.invalid)) return [3 /*break*/, 1];\n                        data = this.getDataWithMutationsApplied(this.mutationQueue.get(), true, this.data);\n                        subscription.notifySubscriber(data, this.error);\n                        return [3 /*break*/, 4];\n                    case 1:\n                        data = this.queryLocally();\n                        if (!data) return [3 /*break*/, 2];\n                        this.data = data;\n                        this.error = null;\n                        subscription.notifySubscriber(data, this.error);\n                        return [3 /*break*/, 4];\n                    case 2: return [4 /*yield*/, this.load()];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.load = function (version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var loadPromise;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.gotInitialResponse) {\n                            // mutationsOnEmpty should never be used twice.\n                            delete this.query.mutationsOnEmpty;\n                        }\n                        if (!(!version && this._loadPromise)) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this._loadPromise];\n                    case 1: \n                    // loading is ongoing, and caller does not require a recent refresh.\n                    // wait for the ongoing load to complete\n                    return [2 /*return*/, _a.sent()];\n                    case 2:\n                        version = version || this.repo.writer.persistedVersion.value;\n                        loadPromise = this._loadPromise = this._load(version).then(function (data) {\n                            if (_this._loadPromise === loadPromise) {\n                                _this.data = data;\n                                _this.loadedVersion = Math.max(_this.loadedVersion, version);\n                            }\n                        }).catch(function (error) {\n                            if (_this._loadPromise === loadPromise) {\n                                // Noone has refreshed our load. The error is the final result. Set it.\n                                _this.error = error;\n                            }\n                        }).then(function () {\n                            if (_this._loadPromise === loadPromise) {\n                                // Noone has refreshed our load. We're finished. Data or error is already set.\n                                // Mark gotInitialResponse to true and notify subscribers.\n                                _this._loadPromise = null;\n                                _this.gotInitialResponse = true;\n                                _this.notifySubscribers(_this.mutationQueue.get());\n                            }\n                            else {\n                                // A more recent call to load() is ongoing, OR was ongoing but responded\n                                // before us.\n                                // In any case return this._loadPromise. If it's ongoing we'll wait for it\n                                // to finish. If it's null, we'll be returning finally here without\n                                // any action, because the action was taken by the refresher.\n                                return _this._loadPromise; // Wait for the refreshed load to complete\n                            }\n                        });\n                        return [4 /*yield*/, loadPromise];\n                    case 3:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype._load = function (version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.mutationQueue.affectsQuery(this.table, this.query, this.includes)) return [3 /*break*/, 2];\n                        // There are outgoing mutations that affects this query.\n                        // Need to wait till they reach server and server responds with OK before querying\n                        // the server. Otherwise, we may get inaccurate data from server.\n                        return [4 /*yield*/, this.repo.writer.waitForVersionToPersist(version)];\n                    case 1:\n                        // There are outgoing mutations that affects this query.\n                        // Need to wait till they reach server and server responds with OK before querying\n                        // the server. Otherwise, we may get inaccurate data from server.\n                        _a.sent();\n                        _a.label = 2;\n                    case 2: return [4 /*yield*/, this.queryServer()];\n                    case 3: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.unsubscribe = function (subscription) {\n        this.subscriptions = this.subscriptions.filter(function (s) { return s !== subscription; });\n    };\n    KedBackendQuery.prototype.commitMutations = function (mutations, version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _i, mutations_1, m, data;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.data) return [3 /*break*/, 9];\n                        _i = 0, mutations_1 = mutations;\n                        _a.label = 1;\n                    case 1:\n                        if (!(_i < mutations_1.length)) return [3 /*break*/, 8];\n                        m = mutations_1[_i];\n                        if (!(m.op === 'clear-branch' && (m.branchId === this.query.branchId))) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.refreshOrInvalidate(version)];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 3:\n                        if (!(m.op === 'merge' && (!m.targetBranchId ||\n                            m.branchId === this.query.branchId ||\n                            m.targetBranchId === this.query.branchId))) return [3 /*break*/, 5];\n                        return [4 /*yield*/, this.refreshOrInvalidate(version)];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 5:\n                        if (!(m.op === 'update' && ((m.deltaDoc.tags && this.query.tags) ||\n                            (m.deltaDoc.name && this.query.name)))) return [3 /*break*/, 7];\n                        // A tag may have been added, or renamed, and\n                        // the query is dependent on the same property.\n                        // The query must be refreshed from server as we cannot\n                        // commit the mutations locally as we don't have all info.\n                        return [4 /*yield*/, this.refreshOrInvalidate(version)];\n                    case 6:\n                        // A tag may have been added, or renamed, and\n                        // the query is dependent on the same property.\n                        // The query must be refreshed from server as we cannot\n                        // commit the mutations locally as we don't have all info.\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 7:\n                        _i++;\n                        return [3 /*break*/, 1];\n                    case 8:\n                        data = this.getDataWithMutationsApplied(mutations, false, this.data);\n                        this.data = data;\n                        _a.label = 9;\n                    case 9: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.refreshOrInvalidate = function (version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(this.subscriptions.length === 0)) return [3 /*break*/, 1];\n                        this.invalid = true;\n                        return [3 /*break*/, 3];\n                    case 1: return [4 /*yield*/, this.load(version)];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.notifySubscribers = function (optimisticMutations) {\n        var _this = this;\n        if (this.data && this.gotInitialResponse) {\n            var data_1 = this.getDataWithMutationsApplied(optimisticMutations, true, this.data);\n            this.subscriptions.forEach(function (s) {\n                s.notifySubscriber(data_1, _this.error);\n            });\n        }\n    };\n    KedBackendQuery.prototype.queryLocally = function () {\n        return this.repo.querySet.queryLocally(this.table, this.query, this.includes);\n    };\n    KedBackendQuery.prototype.queryServer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var data;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.repo.getClient().list(this.table, tslib_1.__assign({}, this.query))];\n                    case 1:\n                        data = _a.sent();\n                        return [2 /*return*/, data];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.getDataWithMutationsApplied = function (mutations, optimistic, data) {\n        var _this = this;\n        mutations.forEach(function (mutation) {\n            data = _this.applyMutationsOnData(data, mutation, optimistic);\n        });\n        return data;\n    };\n    KedBackendQuery.prototype.applyMutationsOnData = function (data, m, optimistic) {\n        if (branchSensitive(m) && m.branchId != this.query.branchId)\n            return data;\n        var _a = this, table = _a.table, includes = _a.includes, listOptions = _a.query;\n        var sourceIds = listOptions.hasEdgesFrom ? [].concat(listOptions.hasEdgesFrom || []) : [];\n        var requestedTags = listOptions.tags ? [].concat(listOptions.tags || []) : [];\n        switch (m.op) {\n            case 'update': {\n                return updateArray(data, function (doc) {\n                    if (doc.id === m.id) {\n                        // Apply delta on updated document\n                        var updatedDoc = applyDelta(doc, m.deltaDoc);\n                        if (optimistic)\n                            updatedDoc.$meta = 'updating';\n                        return updatedDoc;\n                    }\n                    // If id does not apply to this doc, search in graphs the id is found\n                    // among graph included docs, and if so, update that one:\n                    includes.forEach(function (label) {\n                        var _a;\n                        var includedDocs = doc[label];\n                        if (includedDocs) {\n                            var updatedArray = updateArray(includedDocs, function (related) {\n                                if (related.id !== m.id)\n                                    return related;\n                                var updatedRelated = applyDelta(related, m.deltaDoc);\n                                if (optimistic)\n                                    updatedRelated.$meta = 'updating';\n                                return updatedRelated;\n                            });\n                            if (updatedArray !== includedDocs) {\n                                doc = tslib_1.__assign({}, doc, (_a = {}, _a[label] = updatedArray, _a));\n                            }\n                        }\n                    });\n                    return doc;\n                });\n            }\n            case 'add':\n                if (table === m.table) {\n                    if (listOptions.tags) {\n                        var queriedTags_1 = [].concat(listOptions.tags); // tag can be either string or string[]. Make is string[] always.\n                        if (m.doc.tags && m.doc.tags.some(function (tag) { return queriedTags_1.includes(tag); })) {\n                            return data.concat([m.doc]); // Make the added doc appear in the result (optimistic mutation)\n                        }\n                    }\n                    // Todo, apply also for other list options, like ids:\n                    // The above code for 'add' was only written to cover the use case of teachers-page notifications!\n                }\n                return data; // fallback case - query was not affected.\n            case 'add-related':\n                if (table === m.table && includes.indexOf(m.graphProp) !== -1) {\n                    // If expression is `db.courseBlocks....whatever.. .include(\"abilities\")`, detect: db.courseBlocks.addRelated(blockId, 'abilities', ...)\n                    // ...because table = 'courseBlocks' and includes has \"abilities\".\n                    return updateArray(data, function (doc) {\n                        var _a;\n                        if (doc.id !== m.id)\n                            return doc;\n                        var relatedDoc = tslib_1.__assign({}, m.relatedDoc);\n                        if (optimistic)\n                            relatedDoc.$meta = 'adding';\n                        return tslib_1.__assign({}, doc, (_a = {}, _a[m.graphProp] = doc[m.graphProp].concat([relatedDoc]), _a));\n                    });\n                }\n                if (listOptions.hasEdgesFrom) {\n                    if (sourceIds.includes(m.id)) {\n                        // If expression is:\n                        //   `db.courseBlocks.hasEdgesFrom([courseId])`  (meaning table='courseBlocks' and sourceIds includes courseId)\n                        // , detect: db.courseInstances.addRelated(courseId, 'courseBlocks', ....) // m.graphProp === 'blocks'--> getTableFromLabel --> 'courseBlocks'\n                        if (table === getTableFromLabel(m.table, m.graphProp)) {\n                            if (!listOptions.tags)\n                                return data.concat(this.setGraphProps(m.relatedDoc));\n                            if (m.relatedDoc.tags && requestedTags.some(function (tag) { return m.relatedDoc.tags.includes(tag); })) {\n                                return data.concat(this.setGraphProps(m.relatedDoc));\n                            }\n                        }\n                    }\n                }\n                if (listOptions.ids && listOptions.ids.some(function (id) { return id === m.relatedDoc.id; })) {\n                    // A certain ID is observed. A doc with this id is being added.\n                    // Add the doc to the result. Exactly this WILL happen in the following typical scenario:\n                    // 1. User adds a related document to a list.\n                    // 2. Document remains within the MutationQueue while batch-request is being processed by server.\n                    // 3. User clicks the added item to edit or view it (or our component redirects to its editor)\n                    // 4. A new query of that particular ID is subscribed to {ids=[theId]}\n                    //    KedBackendQuery.subscribe then does this:\n                    //      1. Call queryLocally() before querying server\n                    //      2. queryLocally() inspects mutations and finds a match, returning an empty list\n                    //         (assumes as we are adding it, it can't exist on the server anyway)\n                    //      3. KedBackendQUery applies mutations onto the empty list, and ends up here to add\n                    //         it optimistically.\n                    //      4. When server responds with 200 OK, calls us here again with optimistic=false\n                    //         to \"persist\" it in the query's data array.\n                    //      4B: If not 200 OK, mutation may be gone and the subscriber will se an error page\n                    //         \"Could not find entity with id X.\" along with a red error message on the screen\n                    //         about that it failed to save on server.\n                    return data.concat(this.setGraphProps(m.relatedDoc));\n                }\n                return data;\n            case 'remove-related':\n                if (table === m.table && includes.indexOf(m.graphProp) !== -1) {\n                    return updateArray(data, function (doc) {\n                        var _a;\n                        var includedDocs = doc[m.graphProp];\n                        if (!includedDocs)\n                            return doc;\n                        if (doc.id !== m.id)\n                            return doc;\n                        return tslib_1.__assign({}, doc, (_a = {}, _a[m.graphProp] = optimistic ?\n                            // Mark related-doc-to-remove with $meta: 'deleting'\n                            includedDocs.map(function (d) { return d.id !== m.relatedDoc.id ?\n                                d : tslib_1.__assign({}, d, { $meta: 'deleting' }); }) :\n                            // Delete related-doc-to-remove from doc[grapProp]:\n                            includedDocs.filter(function (d) { return d.id !== m.relatedDoc.id; }), _a));\n                    });\n                }\n                if (listOptions.hasEdgesFrom) {\n                    if (sourceIds.includes(m.id))\n                        return optimistic ?\n                            data.map(function (d) { return d.id === m.relatedDoc.id ? tslib_1.__assign({}, d, { $meta: 'deleting' }) : d; }) :\n                            data.filter(function (d) { return d.id !== m.relatedDoc.id; });\n                }\n                return data;\n            case 'delete':\n                if (table === m.table) {\n                    return data.filter(function (d) { return d.id !== m.id; });\n                }\n                else if (listOptions.include) {\n                    var includedTables = includes\n                        .map(function (label) { return ({ label: label, table: getTableFromLabel(table, label) }); });\n                    var labels_1 = includedTables.filter(function (_a) {\n                        var table = _a.table;\n                        return table === m.table;\n                    });\n                    if (labels_1.length > 0) {\n                        return updateArray(data, function (doc) {\n                            labels_1.forEach(function (_a) {\n                                var label = _a.label;\n                                var _b;\n                                var relatedDocs = doc[label];\n                                if (relatedDocs) {\n                                    doc = tslib_1.__assign({}, doc, (_b = {}, _b[label] = optimistic ?\n                                        relatedDocs.map(function (d) { return d.id === m.id ? tslib_1.__assign({}, d, { $meta: 'deleting' }) : d; }) :\n                                        relatedDocs.filter(function (_a) {\n                                            var id = _a.id;\n                                            return id !== m.id;\n                                        }), _b));\n                                }\n                            });\n                            return doc;\n                        });\n                    }\n                }\n                return data;\n            default:\n                return data;\n        }\n    };\n    KedBackendQuery.prototype.setGraphProps = function (doc) {\n        var copy = tslib_1.__assign({}, doc);\n        this.includes.forEach(function (label) { return copy[label] = copy[label] || []; });\n        return copy;\n    };\n    return KedBackendQuery;\n}());\nexport { KedBackendQuery };\n//# sourceMappingURL=kedbackend-query.js.map","import * as tslib_1 from \"tslib\";\nimport { tables } from 'kedbackend-schema/schema.json';\nimport { KedBackendCollection } from './kedbackend-collection';\nimport { QuerySet } from './query-set';\nimport { MutationQueue } from './mutation-queue';\nimport { KedBackendWriter } from './kedbackend-writer';\nimport { DeltaCollection } from './delta-collection/delta-collection';\nvar KedBackendRepo = /** @class */ (function () {\n    function KedBackendRepo(getClient, getUser, getUserDisplayName, defaultQueryOptions, mutationQueue, querySet, writer, cacheOptimized) {\n        var _this = this;\n        this.getClient = getClient;\n        this.getUser = getUser;\n        this.getUserDisplayName = getUserDisplayName;\n        this.defaultQueryOptions = defaultQueryOptions;\n        this.mutationQueue = mutationQueue;\n        this.querySet = querySet;\n        this.writer = writer;\n        this.cacheOptimized = cacheOptimized;\n        if (!defaultQueryOptions)\n            this.defaultQueryOptions = {};\n        if (!mutationQueue)\n            this.mutationQueue = new MutationQueue();\n        if (!querySet)\n            this.querySet = new QuerySet(this.mutationQueue);\n        if (!writer)\n            this.writer = new KedBackendWriter(this.mutationQueue, this.querySet, getClient, getUser, getUserDisplayName);\n        Object.keys(tables).forEach(function (table) {\n            var collection = new KedBackendCollection(_this, table, defaultQueryOptions || {});\n            if (cacheOptimized) {\n                collection = collection.cacheOptimized();\n            }\n            _this[table] = collection;\n        });\n        this.deltas = new DeltaCollection(this.writer.deltaCache, {\n            branchId: this.defaultQueryOptions.branchId // If branchId is undefined. DeltaCollection will respond with Error on subscribe()\n        });\n    }\n    KedBackendRepo.prototype.table = function (tableName) {\n        var collection = new KedBackendCollection(this, tableName, this.defaultQueryOptions);\n        if (this.cacheOptimized)\n            collection = collection.cacheOptimized();\n        return collection;\n    };\n    KedBackendRepo.prototype._clone = function (queryOptions, cacheOptimized) {\n        var clone = new KedBackendRepo(this.getClient, this.getUser, this.getUserDisplayName, tslib_1.__assign({}, this.defaultQueryOptions, queryOptions), this.mutationQueue, this.querySet, this.writer, cacheOptimized === undefined ? this.cacheOptimized : cacheOptimized);\n        return clone;\n    };\n    KedBackendRepo.prototype.branch = function (branchId) {\n        return this._clone({ branchId: branchId });\n    };\n    KedBackendRepo.prototype.role = function (role) {\n        return this._clone({ role: role });\n    };\n    KedBackendRepo.prototype.optimizeCache = function () {\n        return this._clone({}, true);\n    };\n    KedBackendRepo.prototype.clearBranch = function () {\n        if (!this.defaultQueryOptions.branchId)\n            throw new Error(\"Cannot clear master branch\");\n        this.writer.mutate([{ op: 'clear-branch', branchId: this.defaultQueryOptions.branchId }], 0);\n    };\n    KedBackendRepo.prototype.merge = function (targetBranchId) {\n        if (!this.defaultQueryOptions.branchId)\n            throw new Error(\"Cannot merge from master branch\");\n        this.writer.mutate([{ op: 'merge', branchId: this.defaultQueryOptions.branchId, targetBranchId: targetBranchId }], 0);\n    };\n    KedBackendRepo.prototype.saveNow = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.writer.waitForVersionToPersist(this.writer.currentVersion)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return KedBackendRepo;\n}());\nexport { KedBackendRepo };\n//# sourceMappingURL=kedbackend-repo.js.map","var KedBackendSubscription = /** @class */ (function () {\n    function KedBackendSubscription(subscriber, collection) {\n        this.subscriber = subscriber;\n        this.collection = collection;\n    }\n    KedBackendSubscription.prototype.notifySubscriber = function (data, error) {\n        try {\n            if (error)\n                this.subscriber([], error, this);\n            else if (data !== this.lastNotifiedData) { // Will in-fact be equal by reference if data is same as last notification (as we use an immutable approach on data)\n                this.lastNotifiedData = data;\n                this.subscriber(data, error, this);\n            }\n        }\n        catch (ex) {\n            try {\n                this.subscriber([], ex, this);\n            }\n            catch (ex2) {\n                console.error(\"Error while notifying KedBackendSubscriber:\", ex2, 'originally notified error:', ex);\n            }\n        }\n    };\n    KedBackendSubscription.prototype.unsubscribe = function () {\n        this.collection.unsubscribe(this);\n    };\n    return KedBackendSubscription;\n}());\nexport { KedBackendSubscription };\n//# sourceMappingURL=kedbackend-subscription.js.map","import * as tslib_1 from \"tslib\";\nimport { MutationQueue } from './mutation-queue';\nimport { BatchRunner } from '../ked-backend-client';\nimport { tables } from 'kedbackend-schema/schema.json';\nimport { CacheBust } from './cache-bust';\nimport { Emitter } from '../observable';\nimport { DeltaCache } from './delta-collection/delta-cache';\nvar KedBackendWriter = /** @class */ (function () {\n    function KedBackendWriter(mutationQueue, querySet, getClient, getUser, getUserDisplayName) {\n        this.mutationQueue = mutationQueue;\n        this.querySet = querySet;\n        this.getClient = getClient;\n        this.getUser = getUser;\n        this.getUserDisplayName = getUserDisplayName;\n        this._timeoutId = null;\n        this._isSavingPromise = null;\n        this.currentVersion = 0;\n        this.persistedVersion = new Emitter(0);\n        this.errorSubscribers = [];\n        this.stateSubscribers = [];\n        this.deltaCache = new DeltaCache(getClient, getUser, getUserDisplayName);\n    }\n    Object.defineProperty(KedBackendWriter.prototype, \"isSaving\", {\n        get: function () { return !!this._isSavingPromise; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(KedBackendWriter.prototype, \"isEdited\", {\n        get: function () { return this.mutationQueue.get().length > 0; },\n        enumerable: true,\n        configurable: true\n    });\n    KedBackendWriter.prototype.onError = function (callback) {\n        this.errorSubscribers.push(callback);\n    };\n    KedBackendWriter.prototype.onStateChange = function (callback) {\n        this.stateSubscribers.push(callback);\n    };\n    KedBackendWriter.prototype.off = function (callback) {\n        this.errorSubscribers = this.errorSubscribers.filter(function (s) { return s !== callback; });\n        this.stateSubscribers = this.stateSubscribers.filter(function (s) { return s !== callback; });\n    };\n    KedBackendWriter.prototype.dispatchError = function (error, retryable) {\n        var _this = this;\n        this.errorSubscribers.forEach(function (callback) {\n            try {\n                callback(error, retryable, _this);\n            }\n            catch (_) { }\n        });\n    };\n    KedBackendWriter.prototype.dispatchStateChange = function () {\n        var _this = this;\n        this.stateSubscribers.forEach(function (callback) {\n            try {\n                callback(_this);\n            }\n            catch (_) { }\n        });\n    };\n    KedBackendWriter.prototype.mutate = function (mutations, debounce) {\n        this.mutationQueue.add(mutations);\n        ++this.currentVersion;\n        this.dispatchStateChange();\n        this.querySet.notifySubscribers();\n        this.deltaCache.applyMutations(this.mutationQueue.get(), { optimistic: true });\n        if (!this._isSavingPromise) {\n            if (this._timeoutId)\n                clearTimeout(this._timeoutId);\n            this._timeoutId = setTimeout(this.save.bind(this), debounce);\n        }\n        // If isSaving, we don't need to do anything, becase it will re-check if additional\n        // mutations have come, when saving is done.\n    };\n    KedBackendWriter.prototype.retrySave = function () {\n        return this.save();\n    };\n    KedBackendWriter.prototype.waitForVersionToPersist = function (version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var persistedVersion;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.persistedVersion.load()];\n                    case 1:\n                        persistedVersion = _a.sent();\n                        if (!(persistedVersion < version)) return [3 /*break*/, 3];\n                        this.save(); // Be more eager to save\n                        return [4 /*yield*/, this.persistedVersion.filter(function (persistedVersion) { return persistedVersion >= version; }).load()];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendWriter.prototype.save = function () {\n        var _this = this;\n        if (this._timeoutId)\n            clearTimeout(this._timeoutId);\n        if (this._isSavingPromise)\n            return this._isSavingPromise;\n        if (!this.isEdited)\n            return Promise.resolve();\n        this._timeoutId = null;\n        this._isSavingPromise = this._save();\n        this._isSavingPromise.catch(function () { }).then(function () { return _this._isSavingPromise = null; });\n        return this._isSavingPromise;\n    };\n    KedBackendWriter.prototype._save = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var mutations, version, mutationRequests, res_1, etagMutations, error_1;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.dispatchStateChange();\n                        mutations = this.mutationQueue.get();\n                        version = this.currentVersion;\n                        this.mutationQueue.moveToSavingQueue();\n                        mutationRequests = this.mapMutations(mutations);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 6, 11, 12]);\n                        return [4 /*yield*/, this.getClient().batch(mutationRequests)];\n                    case 2:\n                        res_1 = _a.sent();\n                        etagMutations = Object.keys(res_1.newEtags).map(function (id) { return ({\n                            op: 'update',\n                            table: null,\n                            id: id,\n                            deltaDoc: { $etag: res_1.newEtags[id] },\n                            targetName: null // We don't have the target name. But this mutation won't be visible in a DeltaCollection anyway, so it wont be used.\n                        }); });\n                        // Invalidate cache\n                        CacheBust.invalidateCache(mutationRequests, this.getUser());\n                        // Commmit mutations along with etagMutations into queries cached data\n                        this.persistedVersion.dispatch(version);\n                        this.deltaCache.applyMutations(mutations, { optimistic: false });\n                        return [4 /*yield*/, this.querySet.commitMutations(MutationQueue.merge(mutations, etagMutations), version)];\n                    case 3:\n                        _a.sent();\n                        // On success, clear saving queue as the mutations will now be committed to all query's data instead.\n                        this.mutationQueue.clearSavingQueue();\n                        this.dispatchStateChange(); // isEdited may have turned to false\n                        // Finally, notify subscribers so that views get updated with committed results\n                        this.querySet.notifySubscribers();\n                        if (!(this.mutationQueue.get().length > 0)) return [3 /*break*/, 5];\n                        // Additional mutations happend while we were saving. Handle them as well.\n                        return [4 /*yield*/, this._save()];\n                    case 4:\n                        // Additional mutations happend while we were saving. Handle them as well.\n                        _a.sent();\n                        _a.label = 5;\n                    case 5: return [3 /*break*/, 12];\n                    case 6:\n                        error_1 = _a.sent();\n                        this.persistedVersion.dispatchError(error_1);\n                        if (!(error_1 && error_1.name && error_1.name.startsWith(\"http4\"))) return [3 /*break*/, 9];\n                        // Access Control denied, bad request or similar. Throw mutations away.\n                        this.dispatchError(error_1, false);\n                        this.mutationQueue.clearSavingQueue();\n                        this.dispatchStateChange(); // isEdited may have turned to false\n                        this.querySet.notifySubscribers();\n                        if (!(this.mutationQueue.get().length > 0)) return [3 /*break*/, 8];\n                        // Ho ho! Additional mutations happend while we were saving. Handle them alone. THey might be more lucky.\n                        return [4 /*yield*/, this._save()];\n                    case 7:\n                        // Ho ho! Additional mutations happend while we were saving. Handle them alone. THey might be more lucky.\n                        _a.sent();\n                        _a.label = 8;\n                    case 8: return [3 /*break*/, 10];\n                    case 9:\n                        this.dispatchError(error_1, true);\n                        _a.label = 10;\n                    case 10: return [3 /*break*/, 12];\n                    case 11:\n                        this.dispatchStateChange();\n                        return [7 /*endfinally*/];\n                    case 12: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendWriter.prototype.mapMutations = function (mutations) {\n        var br = new BatchRunner();\n        mutations.forEach(function (m) {\n            switch (m.op) {\n                case 'update':\n                    br.update(m.table, m.id, m.deltaDoc, m.branchId);\n                    break;\n                case 'add':\n                    br.add(m.table, m.doc);\n                    break;\n                case 'add-related':\n                    if (!m.relatedDoc.$etag) {\n                        // No $etag means this is a new document. Add it before linking to it:\n                        br.add(tables[m.table].relationships[m.graphProp], m.relatedDoc, m.branchId);\n                    }\n                    br.link2(m.table, m.id, m.graphProp, m.relatedDoc.id, m.branchId);\n                    break;\n                case 'remove-related':\n                    br.unlink2(m.table, m.id, m.graphProp, m.relatedDoc.id, m.branchId);\n                    break;\n                case 'undo-link':\n                    br.undoLink(m.table, m.id, m.graphProp, m.relatedId, m.branchId);\n                    break;\n                case 'delete':\n                    br.delete(m.table, m.id);\n                    break;\n                case 'clear-branch':\n                    br.clearBranch(m.branchId);\n                    break;\n                case 'merge':\n                    br.merge(m.branchId, m.targetBranchId);\n                    break;\n            }\n        });\n        return br.mutationRequests;\n    };\n    return KedBackendWriter;\n}());\nexport { KedBackendWriter };\n//# sourceMappingURL=kedbackend-writer.js.map","import * as tslib_1 from \"tslib\";\nimport { getTableFromLabel, branchSensitive, globalOp } from './utils';\nimport { mergeDeltas } from './delta-merge';\nvar MutationQueue = /** @class */ (function () {\n    function MutationQueue() {\n        this.queue = [];\n        this.savingQueue = [];\n    }\n    MutationQueue.prototype.add = function (mutations) {\n        this.queue = MutationQueue.merge(this.queue, mutations);\n    };\n    MutationQueue.prototype.moveToSavingQueue = function () {\n        this.savingQueue = MutationQueue.merge(this.savingQueue, this.queue);\n        this.queue = [];\n    };\n    MutationQueue.prototype.clearSavingQueue = function () {\n        this.savingQueue = [];\n    };\n    MutationQueue.prototype.get = function () {\n        return this.savingQueue.concat(this.queue);\n    };\n    MutationQueue.prototype.affectsQuery = function (table, query, includes) {\n        var mutations = this.get();\n        if (mutations.some(function (m) { return m.op === 'merge' || m.op === 'clear-branch'; }))\n            return true;\n        if (query.ids) {\n            // A query with \"ids\" filter will be easy to detect a no-match on:\n            return mutations.some(function (m) { return globalOp(m) || (!branchSensitive(m) || m.branchId === query.branchId) &&\n                query.ids.includes(m.id); });\n        }\n        // Otherwise, check if mutations affect same branch and table. Could be done more fine grained,\n        // but that would only be a suboptimization.\n        return mutations.some(function (m) {\n            return m.op === 'add' ?\n                m.table === table :\n                m.op === 'delete' ?\n                    m.table === table || (includes.some(function (label) { return getTableFromLabel(table, label) === m.table; })) :\n                    globalOp(m) ? true :\n                        m.branchId == query.branchId &&\n                            (m.table === table || (m.op !== 'update' && ([table].concat(includes.map(function (label) { return getTableFromLabel(table, label); })).some(function (table) { return getTableFromLabel(m.table, m.graphProp) === table; }))));\n        });\n    };\n    MutationQueue.merge = function (queue1, queue2) {\n        var mutableQueue1 = queue1.slice();\n        var mutableQueue2 = queue2.slice();\n        //if (mutableQueue1.length > 0) debugger;\n        var len = queue1.length;\n        var _loop_1 = function (i) {\n            var m = queue1[i];\n            if (m.op === 'update') {\n                var overlappingIdOpIdx = mutableQueue2.findIndex(function (newMut) {\n                    return newMut.op === 'update' &&\n                        newMut.branchId === m.branchId &&\n                        newMut.id === m.id;\n                });\n                if (overlappingIdOpIdx >= 0) {\n                    mutableQueue1[i] = tslib_1.__assign({}, m, { deltaDoc: mergeDeltas(m.deltaDoc, mutableQueue2[overlappingIdOpIdx].deltaDoc) });\n                    mutableQueue2.splice(overlappingIdOpIdx, 1);\n                }\n            }\n        };\n        for (var i = 0; i < len; ++i) {\n            _loop_1(i);\n        }\n        return mutableQueue1.concat(mutableQueue2);\n    };\n    return MutationQueue;\n}());\nexport { MutationQueue };\n//# sourceMappingURL=mutation-queue.js.map","import * as tslib_1 from \"tslib\";\nimport { KedBackendQuery } from './kedbackend-query';\nimport * as JsonSchema from 'kedbackend-schema/schema.json';\nimport { queryArray } from './utils';\nvar QuerySet = /** @class */ (function () {\n    function QuerySet(mutationQueue) {\n        this.mutationQueue = mutationQueue;\n        this.queries = [];\n    }\n    QuerySet.prototype.commitMutations = function (mutations, version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, Promise.all(this.queries.map(function (q) { return q.commitMutations(mutations, version); }))];\n                    case 1:\n                        _a.sent();\n                        this.cleanupInvalidQueries();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    QuerySet.prototype.cleanupInvalidQueries = function () {\n        this.queries = this.queries.filter(function (q) {\n            if (q.invalid) {\n                if (q.timeoutHandle) {\n                    clearTimeout(q.timeoutHandle);\n                    q.timeoutHandle = null;\n                }\n                return false;\n            }\n            return true;\n        });\n    };\n    QuerySet.prototype.notifySubscribers = function () {\n        var optimisticMutations = this.mutationQueue.get();\n        this.queries.forEach(function (q) {\n            q.notifySubscribers(optimisticMutations);\n        });\n    };\n    QuerySet.prototype.findQuery = function (table, query) {\n        return this.queries.find(function (q) { return q.queryKey === KedBackendQuery.queryKey(table, query); });\n    };\n    QuerySet.prototype.queryLocally = function (table, query, includes) {\n        // For now, only handle this very common and special case (which\n        // will save a lot of unnescessary network traffic if I am thinking right...)\n        var mutations = this.mutationQueue.get();\n        // Check if the query wants to get a single entity by its ID:\n        if (query.ids && query.ids.length === 1) {\n            // And if so, if we have an outgoing mutation to create that entity:\n            if (mutations.some(function (m) { return m.op === 'add-related' && m.relatedDoc.id === query.ids[0]; })) {\n                // Then return an EMPTY response, signalling that we can resolve this locally,\n                // but let the optistic feature of KedBackendQuery apply the mutation before\n                // notifying subscribers (we don't want it to be persistent before the server\n                // has accepted the mutation)\n                return [];\n            }\n        }\n        // OK, another quite common case is when we ask for a certain ID and that ID replies\n        // within another query\n        if (query.hasEdgesFrom || query.hasEdgesTo)\n            return null; // Not possible to handle\n        if (!query.ids)\n            return null; // For now, just take hight for this particular and most common case!\n        var _loop_1 = function (q) {\n            if (!q.gotInitialResponse)\n                return \"continue\";\n            if (q.query.branchId !== query.branchId)\n                return \"continue\";\n            if (q.query.flags)\n                return \"continue\"; // It would be complex to support various flags. Query's data may include ids only. Can't rely on the query.\n            var qIncludes = q.includes;\n            if (qIncludes.length > 0 && (!query.include || query.include.length === 0)) {\n                // We don't include, but this query does. Check if we can find our result within it.\n                var label = qIncludes.find(function (l) { return JsonSchema.tables[q.table][\"relationships\"][l] === table; });\n                if (label) {\n                    var res_1 = {};\n                    for (var _i = 0, _a = q.data; _i < _a.length; _i++) {\n                        var entity = _a[_i];\n                        var subData = queryArray(query, entity[label]);\n                        subData.forEach(function (r) { return res_1[r.id] = r; });\n                    }\n                    var result_1 = Object.keys(res_1).map(function (id) { return res_1[id]; });\n                    // Only return result if we could look up every requested ID:\n                    if (!query.ids.every(function (id) { return result_1.some(function (x) { return x.id === id; }); }))\n                        return \"continue\";\n                    return { value: result_1 };\n                }\n            }\n            if (!includes.every(function (label) { return qIncludes.includes(label); }))\n                return \"continue\";\n            // Lastly, if the query includes all graphs that we do, pick the subset from that query.\n            // Concrete example: We observe a certain Task by ID and want its knowledgeRequirements along with it,\n            // and there's another query of all tasks that also includes knowledgeRequirements. Use it. \n            if (q.table === table) {\n                var result_2 = queryArray(query, q.data);\n                // Only return result if we could look up every requested ID:\n                if (!query.ids.every(function (id) { return result_2.some(function (x) { return x.id === id; }); }))\n                    return \"continue\";\n                return { value: result_2 };\n            }\n        };\n        for (var _i = 0, _a = this.queries; _i < _a.length; _i++) {\n            var q = _a[_i];\n            var state_1 = _loop_1(q);\n            if (typeof state_1 === \"object\")\n                return state_1.value;\n        }\n    };\n    QuerySet.prototype.subscribe = function (subscription) {\n        var _a = subscription.collection, table = _a.table, query = _a.query, repo = _a.repo;\n        var kbQuery = this.findQuery(table, query);\n        if (!kbQuery) {\n            kbQuery = new KedBackendQuery(table, query, repo.getUser(), repo, this.mutationQueue);\n            this.queries.push(kbQuery);\n        }\n        else {\n            if (kbQuery.timeoutHandle) {\n                clearTimeout(kbQuery.timeoutHandle);\n                kbQuery.timeoutHandle = null;\n            }\n        }\n        kbQuery.subscribe(subscription);\n    };\n    QuerySet.prototype.unsubscribe = function (subscription) {\n        var _this = this;\n        var _a = subscription.collection, table = _a.table, query = _a.query, repo = _a.repo;\n        var kbQuery = this.findQuery(table, query);\n        if (kbQuery) {\n            // Prohibit further notifications to this subscription:\n            kbQuery.unsubscribe(subscription);\n            // Release unnescessary memory when there are no more subscriptions of this query, by removing the query itself\n            // To that in a delayed manner, so that an unsubscribe() followed by an immediate subscribe() don't have to re-query the server:\n            if (kbQuery.subscriptions.length === 0) {\n                // Schedule for garbage collection in 5 minutes:\n                kbQuery.timeoutHandle = setTimeout(function () {\n                    // Check if kbQuery still has no subscriptions (not certain! A new subscriber may have come along...)\n                    if (kbQuery.subscriptions.length === 0) {\n                        // Still no subscriptions on it, time to release some memory and forget the in-memory cache of the query result\n                        _this.queries = _this.queries.filter(function (q) { return q !== kbQuery; });\n                    }\n                }, this.queries.length > 50 ?\n                    500 : // Don't host too many queries. Garbage collect this within 500 ms\n                    5 * 60000); // Allow query in memory for another 5 minutes\n            }\n        }\n    };\n    return QuerySet;\n}());\nexport { QuerySet };\n//# sourceMappingURL=query-set.js.map","import { tables } from 'kedbackend-schema/schema.json';\nexport function getTableFromLabel(table, label) {\n    return tables[table].relationships[label];\n}\nexport function queryArray(query, data) {\n    var filter = getFilterFromQuery(query);\n    return data.filter(filter);\n}\nexport function AND(filter1, filter2) {\n    return function (x) { return filter1(x) && filter2(x); };\n}\nexport function getFilterFromQuery(query) {\n    var filter = function (x) { return true; };\n    if (query.from)\n        return AND(filter, function (x) { return x.dateTime >= query.from; });\n    if (query.to)\n        return AND(filter, function (x) { return x.dateTime < query.to; });\n    if (query.ids)\n        return AND(filter, function (x) { return query.ids.includes(x.id); });\n    if (query.name)\n        return AND(filter, function (x) { return x.name === query.name; });\n    if (query.tags)\n        return AND(filter, function (x) { return x.tags && [].concat(query.tags || []).some(function (tag) { return x.tags.includes(tag); }); });\n    // query.hasEdgesFrom and query.hasEdgesTo cannot by filtered here\n    return filter;\n}\nexport function branchSensitive(m) {\n    return m.op !== 'delete';\n}\nexport function globalOp(m) {\n    return m.op === 'clear-branch' || m.op === 'merge';\n}\n//# sourceMappingURL=utils.js.map","import migrate from './migrate';\nexport var KedModelMigratorMixin = function (client) {\n    if (client.__migrator_mixed_in)\n        return;\n    client.__migrator_mixed_in = true;\n    var get = client.get;\n    var list = client.list;\n    client.get = function (table, id, options) {\n        var include = options && options.include;\n        return get.apply(this, arguments).then(function (result) {\n            migrate(result, table, include && include.toString().split(','));\n            return result;\n        });\n    };\n    client.list = function (table, options) {\n        var include = options && options.include;\n        return list.apply(this, arguments).then(function (result) {\n            result.forEach(function (doc) { return migrate(doc, table, include && include.toString().split(',')); });\n            return result;\n        });\n    };\n    return client;\n};\n//# sourceMappingURL=index.js.map","import migrateTask from './migrate-task';\nexport default function migrateCourse(course, graphs) {\n    if (!course.modules)\n        course.modules = [];\n    course.modules.forEach(function (module) {\n        if (!module.resources) {\n            module.resources = [];\n        }\n        if (!module.taskIds) {\n            module.taskIds = [];\n        }\n    });\n    if (!course.responsibleTeachers) {\n        course.responsibleTeachers = [];\n    }\n    // Earlier wrong spelling of resources\n    if ('resourses' in course && !('resources' in course)) {\n        course.resources = course.resourses;\n        delete course.resourses;\n    }\n    if (!course.resources) {\n        course.resources = [];\n    }\n    if (graphs) {\n        graphs.forEach(function (label) {\n            switch (label) {\n                case 'tasks':\n                    course.tasks.forEach(function (task) { return migrateTask(task); });\n                    break;\n            }\n        });\n    }\n}\n//# sourceMappingURL=migrate-course.js.map","export default function migrateTask(task) {\n    if (!task.resources)\n        task.resources = [];\n}\n//# sourceMappingURL=migrate-task.js.map","import migrateCourse from './migrate-course';\nimport migrateTask from './migrate-task';\nexport default function migrate(doc, table, graphs) {\n    switch (table) {\n        case \"courses\":\n            migrateCourse(doc, graphs);\n            break;\n        case \"tasks\":\n            migrateTask(doc);\n            break;\n    }\n}\n//# sourceMappingURL=migrate.js.map","import * as tslib_1 from \"tslib\";\nimport { Observable } from \"./observable\";\nimport { initMapMethod } from \"./map\";\nimport { Value } from \"./value\";\nimport { Emitter } from \"./emitter\";\nvar Collection = /** @class */ (function (_super) {\n    tslib_1.__extends(Collection, _super);\n    function Collection(subscribe) {\n        return _super.call(this, subscribe) || this;\n    }\n    Collection.prototype._map = function (mapper) {\n        throw \"mixedin\";\n    };\n    Collection.from = function (x) {\n        if (x.subscribe)\n            return new Collection(function (s) { return x.subscribe(s); });\n        if (Array.isArray(x)) {\n            var emitter_1 = new Emitter(x);\n            return new Collection(function (s) { return emitter_1.subscribe(s); });\n        }\n        throw new Error(\"ObservableCollection.from() can only take arrays or observables\");\n    };\n    Collection.prototype.map = function (mapper) {\n        return this._map(function (items) { return items.map(function (item) { return mapper(item); }); });\n    };\n    Collection.prototype.flat = function () {\n        return this._map(function (items) { return [].concat.apply([], items); });\n    };\n    Collection.prototype.filter = function (filter) {\n        return this._map(function (items) { return items.filter(filter); });\n    };\n    Collection.prototype.concat = function (other) {\n        return Collection.from(this.toValue().combineLatest(other).map(function (_a) {\n            var me = _a[0], other = _a[1];\n            return me.concat(other);\n        }));\n    };\n    Collection.prototype.orderBy = function (prop) {\n        return this.toValue().map(function (array) { return array.slice().sort(function (a, b) {\n            var aProp = a && a[prop];\n            var bProp = b && b[prop];\n            return aProp > bProp ? 1 : aProp < bProp ? -1 : 0;\n        }); }).toCollection(function (x) { return x; });\n    };\n    Collection.prototype.toValue = function () {\n        var _this = this;\n        return new Value(function (s) { return _this.subscribe(s); });\n    };\n    Collection.prototype.groupBy = function (prop) {\n        return this.toValue().map(function (items) {\n            var rv = {};\n            items.forEach(function (item) {\n                var list = rv[item[prop]] || (rv[item[prop]] = []);\n                list.push(item);\n            });\n            return rv;\n        });\n    };\n    Collection.prototype.first = function () {\n        return this.toValue().map(function (arr) { return arr[0]; });\n    };\n    return Collection;\n}(Observable));\nexport { Collection };\nCollection.prototype._map = initMapMethod(Collection);\n//# sourceMappingURL=collection.js.map","import * as tslib_1 from \"tslib\";\nimport { Value } from \"./value\";\nvar Emitter = /** @class */ (function (_super) {\n    tslib_1.__extends(Emitter, _super);\n    function Emitter(initialValue) {\n        var _this = _super.call(this, function (observer) {\n            var subscription = {\n                unsubscribe: function () { return _this.subscribers = _this.subscribers.filter(function (_a) {\n                    var s = _a[0];\n                    return s !== observer;\n                }); },\n            };\n            _this.subscribers.push([observer, subscription]);\n            if (_this.error)\n                observer(null, _this.error, subscription);\n            else\n                observer(_this.value, undefined, subscription);\n            return subscription;\n        }) || this;\n        _this.subscribers = [];\n        _this.value = initialValue;\n        return _this;\n    }\n    Emitter.prototype.dispatch = function (value) {\n        this.value = value;\n        this.error = undefined;\n        this._dispatch();\n    };\n    Emitter.prototype.dispatchError = function (error) {\n        this.error = error;\n        this._dispatch();\n    };\n    Emitter.prototype._dispatch = function () {\n        var _this = this;\n        this.subscribers.forEach(function (_a) {\n            var observer = _a[0], subscription = _a[1];\n            try {\n                observer(_this.value, _this.error, subscription);\n            }\n            catch (err) {\n                observer(null, err, subscription);\n            }\n        });\n    };\n    return Emitter;\n}(Value));\nexport { Emitter };\n//# sourceMappingURL=emitter.js.map","var stack = [];\nvar currentFiber = null;\nvar providers = [function () { return currentFiber; }];\nfunction pushFiber(fiber) {\n    stack.push(currentFiber);\n    currentFiber = fiber;\n}\nfunction popFiber() {\n    currentFiber = stack.pop();\n}\nvar _FiberContext = {\n    get current() { return currentFiber; },\n    /*run: function rerun<R>(fiber: Fiber, fn: ()=>R): R | Promise<R> {\n      pushFiber(fiber);\n      try {\n        return Promise.resolve(fn());\n      } catch (p) {\n        if (p && typeof p.then === 'function') {\n          return p.then(()=>rerun(fiber, fn));\n        } else {\n          return Promise.reject(p);\n        }\n      } finally {\n        popFiber();\n      }\n    },*/\n    addProvider: function (getCurrentFiber) {\n        providers.push(getCurrentFiber);\n        setCurrentGetterFromProviders();\n    },\n    removeProvider: function (getCurrentFiber) {\n        providers = providers.filter(function (p) { return p !== getCurrentFiber; });\n        setCurrentGetterFromProviders();\n    }\n};\nfunction setCurrentGetterFromProviders() {\n    Object.defineProperty(_FiberContext, \"current\", {\n        get: providers.reduce(function (p, c) { return function () { return p() || c(); }; }),\n        set: function () { throw new Error(\"Use FiberContext.push() to change current fiber\"); }\n    });\n}\nvar _global = (typeof self === 'undefined' ? global : self);\nif (!_global[\"KEDFiberContext\"]) {\n    _global[\"KEDFiberContext\"] = _FiberContext;\n}\nexport var FiberContext = _global[\"KEDFiberContext\"];\n//# sourceMappingURL=fiber-context.js.map","export * from './observable';\nexport * from './value';\nexport * from './collection';\nexport * from './emitter';\nexport * from './fiber-context';\n//# sourceMappingURL=index.js.map","export function initMapMethod(ctor) {\n    return function (mapper) {\n        var _this = this;\n        return new ctor(function (observer) { return _this.subscribe(function (value, error, subscription) {\n            if (error)\n                observer(null, error, subscription);\n            else\n                try {\n                    observer(mapper(value), error, subscription);\n                }\n                catch (err) {\n                    observer(null, err, subscription);\n                }\n        }); });\n    };\n}\n//# sourceMappingURL=map.js.map","export function mixin(targetProto, mixinProto) {\n    var props = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        props[_i - 2] = arguments[_i];\n    }\n    props.forEach(function (prop) { return targetProto[prop] = mixinProto[prop]; });\n}\n//# sourceMappingURL=mixin.js.map","var Observable = /** @class */ (function () {\n    //static get [Symbol.species]() { return this; }\n    function Observable(_subscribe) {\n        this._subscribe = _subscribe;\n    }\n    Observable.prototype.subscribe = function (observer) {\n        try {\n            return this._subscribe(function (items, error, subscription) {\n                try {\n                    observer(items, error, subscription);\n                }\n                catch (err) {\n                    observer(null, err, subscription);\n                }\n            });\n        }\n        catch (error) {\n            observer(null, error, { unsubscribe: function () { } });\n        }\n    };\n    return Observable;\n}());\nexport { Observable };\n//# sourceMappingURL=observable.js.map","import * as tslib_1 from \"tslib\";\nimport { Observable } from \"./observable\";\nimport { initMapMethod } from \"./map\";\nimport { Collection } from \"./collection\";\nimport { FiberContext } from './fiber-context';\nvar Value = /** @class */ (function (_super) {\n    tslib_1.__extends(Value, _super);\n    function Value(subscribe) {\n        return _super.call(this, subscribe) || this;\n    }\n    Value.from = function (x) {\n        if (x.subscribe)\n            return new Value(function (s) { return x.subscribe(s); });\n        throw new Error(\"Value.from() can only take observables\");\n    };\n    Value.prototype.read = function () {\n        var resolved = false, result, err, notify;\n        var subscription = this.subscribe(function (value, error, subsciption) {\n            resolved = true;\n            result = value;\n            err = error;\n            if (error && notify)\n                notify(null, error, subsciption);\n            else if (notify)\n                notify(value, null, subsciption);\n        });\n        if (resolved) {\n            var currentFiber = FiberContext.current;\n            if (!currentFiber) {\n                subscription.unsubscribe();\n                throw new Error(\"Invalid Fiber Context\");\n            }\n            if (err) {\n                subscription.unsubscribe();\n                throw err;\n            }\n            var subscriptions = currentFiber.subscriptions, observer = currentFiber.observer;\n            subscriptions.push(subscription);\n            notify = observer;\n            return result;\n        }\n        throw new Promise(function (resolve, reject) {\n            notify = function (value, error, subscription) {\n                subscription.unsubscribe();\n                if (error)\n                    reject(error);\n                else\n                    resolve(value);\n            };\n        });\n    };\n    Value.prototype.load = function () {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _this.subscribe(function (value, error, subsciption) {\n                if (error)\n                    reject(error);\n                else\n                    resolve(value);\n                subsciption.unsubscribe();\n            });\n        });\n    };\n    Value.prototype.filter = function (fn) {\n        var _this = this;\n        return new Value(function (observer) { return _this.subscribe(function (value, error, subscription) {\n            if (error)\n                observer(null, error, subscription);\n            else if (fn(value))\n                observer(value, error, subscription);\n        }); });\n    };\n    Value.prototype.log = function (prefix) {\n        return this.map(function (x) {\n            console.log(prefix, x);\n            return x;\n        });\n    };\n    Value.prototype.toCollection = function (mapper) {\n        var _this = this;\n        return new Collection(function (s) { return _this.map(mapper).subscribe(s); });\n    };\n    Value.prototype.combineLatest = function (other) {\n        var _this = this;\n        return new Value(function (observer) {\n            var values = [null, null];\n            var mySubscription, otherSubscription;\n            var subscription = {\n                unsubscribe: function () {\n                    mySubscription.unsubscribe();\n                    otherSubscription.unsubscribe();\n                }\n            };\n            mySubscription = _this.subscribe(function (items, error, s) {\n                if (error) {\n                    s.unsubscribe();\n                    observer(null, error, subscription);\n                }\n                values[0] = items;\n                if (values[1] !== null)\n                    observer(values, null, subscription);\n            });\n            otherSubscription = other.subscribe(function (value, error, s) {\n                if (error) {\n                    s.unsubscribe();\n                    observer(null, error, subscription);\n                }\n                values[1] = value;\n                if (values[0] !== null)\n                    observer(values, null, subscription);\n            });\n            return subscription;\n        });\n    };\n    Value.prototype.switchMap = function (mapper) {\n        var _this = this;\n        return new Value(function (observer) {\n            var mappedSubscription = null;\n            var subscription = null;\n            var returnedSubscription = {\n                unsubscribe: function () {\n                    subscription.unsubscribe();\n                    if (mappedSubscription) {\n                        mappedSubscription.unsubscribe();\n                        mappedSubscription = null;\n                    }\n                }\n            };\n            subscription = _this.subscribe(function (item, error, s) {\n                subscription = s;\n                if (mappedSubscription) {\n                    mappedSubscription.unsubscribe();\n                    mappedSubscription = null;\n                }\n                if (error)\n                    observer(null, error, returnedSubscription);\n                else {\n                    try {\n                        var observableOrValue = mapper(item);\n                        if (observableOrValue && typeof observableOrValue.subscribe === 'function') {\n                            mappedSubscription = observableOrValue.subscribe(function (value, error, s) {\n                                mappedSubscription = s;\n                                observer(value, error, returnedSubscription);\n                            });\n                        }\n                        else {\n                            observer(observableOrValue, null, subscription);\n                        }\n                    }\n                    catch (error) {\n                        observer(null, error, subscription);\n                    }\n                }\n            });\n            return returnedSubscription;\n        });\n    };\n    return Value;\n}(Observable));\nexport { Value };\nValue.prototype.map = initMapMethod(Value);\n//# sourceMappingURL=value.js.map","export * from './js/dist/js/ked-backend-repo';\n","export default function getUserClaims(user) {\n    return [{\n            type: \"email\",\n            value: user.mail\n        }, {\n            type: \"school\",\n            value: user.school\n        }].concat(user.roles.map(function (role) { return ({\n        type: \"role\",\n        value: role\n    }); })).concat(user.roles.map(function (role) { return ({\n        type: \"schoolRole\",\n        value: user.school + \"/\" + role\n    }); }));\n}\n","import * as tslib_1 from \"tslib\";\nimport { DocumentAccess, hasAccess as _hasAccess } from 'kedbackend/client';\nimport getUserClaims from './get-user-claims';\nimport { parseQueryString, generateQueryString } from \"../utils/query-string\";\nexport { getUserClaims };\nexport var IMPERSONATION_QUERY_PARAMS = [\n    \"user\",\n    \"role\",\n    \"school\",\n    \"debug\",\n    \"testVersion\",\n    \"testversion\",\n    \"features\",\n    \"schoolGrade\",\n    \"schoolgrade\",\n    \"schoolType\",\n    \"schooltype\"\n];\nexport function hasAccess(user, doc, requestedRight) {\n    var claims = getUserClaims(user);\n    if (requestedRight !== 'R' && user.tutorFor) {\n        claims = claims.filter(function (claim) { return claim.type !== 'email'; });\n    }\n    var result = _hasAccess(DocumentAccess.fromStringArray(doc.acl || []), claims, requestedRight);\n    //console.log(`Has ${requestedRight} access to ${doc.name}/${doc.id}: ${result}`);\n    return result;\n}\nexport function hasReadAccess(user, doc) {\n    return hasAccess(user, doc, 'R');\n}\nexport function hasWriteAccess(user, doc) {\n    return hasAccess(user, doc, 'W');\n}\nexport function hasShareAccess(user, doc) {\n    return hasAccess(user, doc, 'S');\n}\nexport function isTeacherAtSchool(user, school) {\n    var isTeacher = user.roles.some(function (role) { return role === 'EMPLOYEE' || role === 'ADMIN'; });\n    var belongsToSchool = (school || \"\").toLowerCase() === user.school.toLowerCase();\n    return (isTeacher && belongsToSchool);\n}\nexport function isAdminOrTeacherAtSchool(user, school) {\n    return user.roles.includes(\"ADMIN\") || isTeacherAtSchool(user, school);\n}\nexport var impersonationEnv = {\n    actAs: function (options) {\n        var role = options.role, school = options.school, url = options.url;\n        var currentQuery = parseQueryString(location.search);\n        var newQuery = tslib_1.__assign({}, currentQuery, { role: role, school: school });\n        var newQueryString = generateQueryString(newQuery);\n        if (url) {\n            location.href = \"\" + url + newQueryString;\n        }\n        else {\n            location.hash = \"#\";\n            location.search = newQueryString;\n        }\n    }\n};\nexport function actAs(options) {\n    impersonationEnv.actAs(options);\n}\nexport function preserveImpersonationQuery(url, query) {\n    var e_1, _a;\n    var currentQuery = parseQueryString(location.search);\n    var preservedQuery = {};\n    try {\n        for (var IMPERSONATION_QUERY_PARAMS_1 = tslib_1.__values(IMPERSONATION_QUERY_PARAMS), IMPERSONATION_QUERY_PARAMS_1_1 = IMPERSONATION_QUERY_PARAMS_1.next(); !IMPERSONATION_QUERY_PARAMS_1_1.done; IMPERSONATION_QUERY_PARAMS_1_1 = IMPERSONATION_QUERY_PARAMS_1.next()) {\n            var param = IMPERSONATION_QUERY_PARAMS_1_1.value;\n            if (currentQuery[param])\n                preservedQuery[param] = currentQuery[param];\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (IMPERSONATION_QUERY_PARAMS_1_1 && !IMPERSONATION_QUERY_PARAMS_1_1.done && (_a = IMPERSONATION_QUERY_PARAMS_1.return)) _a.call(IMPERSONATION_QUERY_PARAMS_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    var newQueryString = generateQueryString(tslib_1.__assign({}, preservedQuery, query));\n    var pHash = url.indexOf('#');\n    return pHash >= 0 ?\n        \"\" + url.substr(0, pHash) + newQueryString + url.substr(pHash) :\n        \"\" + url + newQueryString;\n}\n","import React from \"react\";\nexport var Button = function (_a) {\n    var label = _a.label, addClass = _a.addClass, faIcon = _a.faIcon, action = _a.action, url = _a.url;\n    var className = addClass ? \"btn \" + addClass : 'btn';\n    if (!!url && !action)\n        return React.createElement(\"a\", { className: className, href: url, target: \"_blank\" },\n            faIcon && React.createElement(\"i\", { className: faIcon }),\n            \" \",\n            label);\n    return React.createElement(\"a\", { className: className, onClick: action },\n        faIcon && React.createElement(\"i\", { className: faIcon }),\n        \" \",\n        label);\n};\nexport var DriveButton = function (_a) {\n    var _b = _a.label, label = _b === void 0 ? 'Google Drive' : _b, action = _a.action;\n    return React.createElement(Button, { label: label, faIcon: \"fab fa-google-drive\", action: action });\n};\n","// Client id for GoogleWebClient\nexport var WebClientId = \"421572262269-u68v5lf5o8ss5t68l8gkq3pfarh6dbkv.apps.googleusercontent.com\";\n// Google Drive File Id to json file with Tamplates for Course Builder (Classroom)\nexport var TemplatesFileId = 'https://docs.google.com/document/d/1V7exG6vN83Sq8kb6uz1B6DaZDVO9eLcJbP7XF0vL4dY/export?format=txt';\n","import * as tslib_1 from \"tslib\";\nimport { RestClient } from 'kedbackend/client';\nimport { HttpError } from 'kedbackend/client';\nimport { getTermStarEndDate } from '../utils/school-moment';\nimport { SchoolTerm } from '../utils/school-term';\nimport { dateTimeReviver, L } from '../utils/utils';\nimport mockJsonFile from './mock/mock-eds-data.json';\nimport moment from 'moment';\nimport { makeSuspenseApi } from '../utils/make-suspense-api';\nvar EdsClient = /** @class */ (function () {\n    function EdsClient(isomorphic, baseUrl, bearerProvider, userEmailGetter) {\n        var _this = this;\n        this.http = new RestClient(isomorphic, baseUrl, { bearerProvider: bearerProvider });\n        this.userEmailGetter = userEmailGetter;\n        var isApiMethod = function (m) {\n            return typeof _this[m] === 'function' &&\n                m !== 'constructor' && // Since makeSuspenseApi() walks prototype chain\n                m !== 'privatizingCacheBust' &&\n                m !== 'userEmailGetter';\n        } // List non-API methods here...\n        ;\n        Object.keys(EdsClient.prototype).forEach(function (method) {\n            if (isApiMethod(method)) {\n                _this[method] = avoidSimultanousCalls(_this[method]);\n            }\n        });\n        this.suspense = makeSuspenseApi(this, { isApiMethod: isApiMethod });\n    }\n    EdsClient.prototype.privatizingCacheBust = function () {\n        return { user: this.userEmailGetter() };\n    };\n    /**\n       * Retrieve active courses for current logged in student.\n       *\n       * @param courseCode Short-name of the course. Optional.\n       */\n    EdsClient.prototype.getActiveCourses = function (q) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var query, res, _a, _b, json, ex_1;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _c.trys.push([0, 5, , 6]);\n                        query = this.privatizingCacheBust();\n                        if (q) {\n                            if (q.courseCode)\n                                query.CourseCode = q.courseCode;\n                            if (q.periodName)\n                                query.PeriodName = q.periodName;\n                        }\n                        return [4 /*yield*/, this.http.get(\"studentactivecourses\", query)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.courses];\n                    case 5:\n                        ex_1 = _c.sent();\n                        console.error(\"Error from EDS: \" + ex_1);\n                        throw new Error(L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"Kunde tyv\\u00E4rr inte ladda terminsm\\u00E5l eller avklarade steg fr\\u00E5n EDS. F\\u00F6rs\\u00F6k igen senare...\"], [\"Kunde tyv\\u00E4rr inte ladda terminsm\\u00E5l eller avklarade steg fr\\u00E5n EDS. F\\u00F6rs\\u00F6k igen senare...\"]))));\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Retrieve latest assessments for current logged in user.\n     *\n     * @param limit Optional limit\n     */\n    EdsClient.prototype.getLatestAssessments = function (limit) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var query, res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        query = this.privatizingCacheBust();\n                        if (!isNaN(limit))\n                            query.Count = limit;\n                        return [4 /*yield*/, this.http.get(\"studentassessments\", query)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.assessments];\n                }\n            });\n        });\n    };\n    /**\n     * Retrieve studyplans for current logged-in user\n     */\n    EdsClient.prototype.getStudentGoals = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"studentgoals\", this.privatizingCacheBust())];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.studentGoals];\n                }\n            });\n        });\n    };\n    EdsClient.prototype.getStudentFutureAbilities = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"studentFutureAbilities\", this.privatizingCacheBust())];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.studentFutureAbilities];\n                }\n            });\n        });\n    };\n    EdsClient.prototype.getTeacherTutorStudents = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"teachertutorstudents\", this.privatizingCacheBust())];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.students];\n                }\n            });\n        });\n    };\n    /**\n     * getSchoolTuitionGroups()\n     *\n     * Return tuitiongroups for school\n     *\n     * @param schoolName - name of school\n     * @param courseCode - Skolverkets code for course\n     */\n    EdsClient.prototype.getSchoolTuitionGroups = function (q) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"SchoolTuitionGroups\", tslib_1.__assign({}, this.privatizingCacheBust(), q))];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.schoolTuitionGroups];\n                }\n            });\n        });\n    };\n    /**\n     * getTuitionGroupStudents()\n     *\n     * Return name and mailadresses for tutitiongroups in schools\n     *\n     * @param schoolName - name of school\n     * @param tuitionGroupName - tuition gruop name in EDS\n     */\n    EdsClient.prototype.getTuitionGroupStudents = function (q) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"TuitionGroupStudents\", tslib_1.__assign({}, this.privatizingCacheBust(), q))];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.tuitionGroupStudents];\n                }\n            });\n        });\n    };\n    /**\n     * getSchoolTeachers()\n     *\n     * Return name and mailadresses for tutitiongroups in schools\n     *\n     * @param schoolName - name of school\n     */\n    EdsClient.prototype.getSchoolTeachers = function (q) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"SchoolTeachers\", tslib_1.__assign({}, this.privatizingCacheBust(), q))];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.schoolTeachers];\n                }\n            });\n        });\n    };\n    // we assume that the EDS will return the current academic year dates determined by the current date\n    EdsClient.prototype.getAcademicYearTerms = function (schoolLocale, date) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var holidays, firstTermMoment, secondTermMoment, startFirstTermDate, startSecondTermDate, endFirstTermDate, endSecondTermDate, firstTerm, secondTerm;\n            return tslib_1.__generator(this, function (_a) {\n                // mock data\n                switch (schoolLocale) {\n                    case 'en_sin':\n                        return [2 /*return*/, mockJsonFile.SouthIndia.filter(function (f) { return moment(date).isSameOrAfter(f.firstTerm.startDate) && moment(date).isSameOrBefore(f.secondTerm.endDate); })[0]];\n                    case 'en_nin':\n                        return [2 /*return*/, mockJsonFile.NorthIndia.filter(function (f) { return moment(date).isSameOrAfter(f.firstTerm.startDate) && moment(date).isSameOrBefore(f.secondTerm.endDate); })[0]];\n                    case 'sv':\n                        {\n                            holidays = [];\n                            firstTermMoment = getTermStarEndDate(date, true);\n                            secondTermMoment = getTermStarEndDate(date, false);\n                            startFirstTermDate = firstTermMoment[0];\n                            startSecondTermDate = secondTermMoment[0];\n                            endFirstTermDate = firstTermMoment[1];\n                            endSecondTermDate = secondTermMoment[1];\n                            firstTerm = { startDate: new Date(startFirstTermDate.year(), startFirstTermDate.month(), startFirstTermDate.date()).toDateString(), endDate: new Date(startFirstTermDate.year(), endFirstTermDate.month(), endFirstTermDate.date()).toDateString() };\n                            secondTerm = { startDate: new Date(startSecondTermDate.year(), startSecondTermDate.month(), startSecondTermDate.date()).toDateString(), endDate: new Date(startSecondTermDate.year(), endSecondTermDate.month(), endSecondTermDate.date()).toDateString() };\n                            return [2 /*return*/, { firstTerm: firstTerm, secondTerm: secondTerm, holidays: holidays }];\n                        }\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    return EdsClient;\n}());\nexport { EdsClient };\nvar EDSPeriod = /** @class */ (function () {\n    function EDSPeriod(periodStringOrSchoolTerm) {\n        if (typeof periodStringOrSchoolTerm === 'string') {\n            this.period = periodStringOrSchoolTerm;\n            this.term = this.period.startsWith('HT') ? 'AT' : 'ST';\n            this.year = parseInt(this.period.substr(2));\n            if (isNaN(this.year))\n                throw new Error(\"Invalid period: \" + this.period);\n        }\n        else {\n            var schoolTerm = new SchoolTerm(periodStringOrSchoolTerm);\n            this.period = (schoolTerm.term === 'AT' ? \"HT\" : \"VT\") + schoolTerm.year;\n            this.term = schoolTerm.term;\n            this.year = schoolTerm.year;\n        }\n    }\n    Object.defineProperty(EDSPeriod.prototype, \"schoolTerm\", {\n        get: function () {\n            return new SchoolTerm({\n                academicYear: this.term === 'AT' ?\n                    this.year + \"/\" + (this.year + 1) :\n                    this.year - 1 + \"/\" + this.year,\n                term: this.term\n            });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    EDSPeriod.prototype.toString = function () {\n        return this.period;\n    };\n    EDSPeriod.prototype.valueOf = function () {\n        return this.year + \":\" + (this.term === 'ST' ? \"1\" : \"2\");\n    };\n    return EDSPeriod;\n}());\nexport { EDSPeriod };\nexport function parseJsonDate_old(jsonDateStr) {\n    var date = dateTimeReviver(\"\", jsonDateStr);\n    if (!(date instanceof Date))\n        throw new Error(\"Invalid JSON date string: \" + jsonDateStr);\n    return date;\n}\nfunction avoidSimultanousCalls(method) {\n    var ongoingPromises = {};\n    return function () {\n        var argsJson = JSON.stringify([].slice.call(arguments));\n        if (!ongoingPromises[argsJson]) {\n            ongoingPromises[argsJson] = method.apply(this, arguments).then(function (result) {\n                delete ongoingPromises[argsJson];\n                return result;\n            });\n        }\n        return ongoingPromises[argsJson];\n    };\n}\nvar templateObject_1;\n","import * as tslib_1 from \"tslib\";\nimport { GoogleClient } from './google-client';\nimport { env } from '../globals/KED.env';\nvar GoogleClassroom = /** @class */ (function (_super) {\n    tslib_1.__extends(GoogleClassroom, _super);\n    function GoogleClassroom() {\n        return _super.call(this, { discoveryDocs: 'https://classroom.googleapis.com/$discovery/rest?version=v1' }) || this;\n    }\n    GoogleClassroom.prototype.reclaimSubmission = function (submission) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var result;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions\n                                .reclaim({\n                                courseId: submission.courseId,\n                                courseWorkId: submission.courseWorkId,\n                                id: submission.id\n                            })\n                                .then(function (resp) { return resp.result; })];\n                    case 2:\n                        result = _a.sent();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.handInSubmission = function (submission) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var result;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions\n                                .turnIn({\n                                courseId: submission.courseId,\n                                courseWorkId: submission.courseWorkId,\n                                id: submission.id\n                            })\n                                .then(function (resp) { return resp.result; })];\n                    case 2:\n                        result = _a.sent();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.returnSubmission = function (submission) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var result;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions\n                                .return({\n                                courseId: submission.courseId,\n                                courseWorkId: submission.courseWorkId,\n                                id: submission.id\n                            })\n                                .then(function (resp) { return resp.result; })];\n                    case 2:\n                        result = _a.sent();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getSubmissions = function (courseId, taskId, isTeacher, hasTemplate) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var classrooms, submissions, allSubmissions, updatedSubmissions_1, newSubmissions, courseWork, newSubmissions, templateFile;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.getClassrooms(courseId)];\n                    case 2:\n                        classrooms = _a.sent();\n                        submissions = [];\n                        if (!isTeacher) return [3 /*break*/, 6];\n                        return [4 /*yield*/, Promise.all(classrooms.map(function (classroom, i) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                                var courseWork;\n                                return tslib_1.__generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.getCourseWork(classroom.id, taskId, false)];\n                                        case 1:\n                                            courseWork = _a.sent();\n                                            classrooms[i].courseWork = courseWork;\n                                            return [2 /*return*/];\n                                    }\n                                });\n                            }); }))];\n                    case 3:\n                        _a.sent();\n                        classrooms = classrooms.filter(function (cr) { return !!cr.courseWork; });\n                        return [4 /*yield*/, Promise.all(classrooms.map(function (classroom, i) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                                return tslib_1.__generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.getStudentSubmissions(classroom.id, classroom.courseWork.id, false)];\n                                        case 1: return [2 /*return*/, _a.sent()];\n                                    }\n                                });\n                            }); }))];\n                    case 4:\n                        allSubmissions = _a.sent();\n                        updatedSubmissions_1 = [];\n                        allSubmissions.map(function (subs, i) {\n                            var group = classrooms[i].room.split(\"|\")[1];\n                            var crLink = classrooms[i].courseWork.alternateLink;\n                            var newsubs = subs.map(function (s) {\n                                return tslib_1.__assign({}, s, { group: group, crLink: crLink });\n                            });\n                            updatedSubmissions_1.push.apply(updatedSubmissions_1, tslib_1.__spread(newsubs));\n                        });\n                        return [4 /*yield*/, Promise.all(updatedSubmissions_1.map(function (sub) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                                var user;\n                                return tslib_1.__generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.getUser(sub.userId)];\n                                        case 1:\n                                            user = _a.sent();\n                                            return [2 /*return*/, tslib_1.__assign({}, sub, user)];\n                                    }\n                                });\n                            }); }))];\n                    case 5:\n                        newSubmissions = _a.sent();\n                        submissions.push.apply(submissions, tslib_1.__spread(newSubmissions));\n                        return [3 /*break*/, 9];\n                    case 6: return [4 /*yield*/, this.getCourseWork(classrooms[0].id, taskId)];\n                    case 7:\n                        courseWork = _a.sent();\n                        return [4 /*yield*/, this.getStudentSubmissions(courseWork.courseId, courseWork.id, true)];\n                    case 8:\n                        newSubmissions = _a.sent();\n                        submissions.push.apply(submissions, tslib_1.__spread(newSubmissions.map(function (sub) {\n                            sub.userEmail = env.currentUser.mail;\n                            return sub;\n                        })));\n                        _a.label = 9;\n                    case 9:\n                        if (hasTemplate) {\n                            templateFile = isTeacher\n                                ? classrooms[0].courseWork.materials[0].driveFile.driveFile\n                                : submissions[0].assignmentSubmission.attachments[0].driveFile;\n                            return [2 /*return*/, {\n                                    submissions: submissions,\n                                    templateFile: templateFile.alternateLink,\n                                    templateThumbnail: templateFile.thumbnailUrl,\n                                    templateTitle: templateFile.title\n                                }];\n                        }\n                        else {\n                            return [2 /*return*/, {\n                                    submissions: submissions\n                                }];\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.addFilesToSubmission = function (classroomId, courseWorkId, submissionId, files) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var result;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions.modifyAttachments({\n                                courseId: classroomId,\n                                courseWorkId: courseWorkId,\n                                id: submissionId,\n                                addAttachments: files.map(function (file) {\n                                    return { driveFile: { id: file.fileId } };\n                                })\n                            }).then(function (resp) { return console.log(resp); })];\n                    case 2:\n                        result = _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getUser = function (userId) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var result;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, gapi.client.classroom.userProfiles\n                            .get({\n                            userId: userId\n                        })\n                            .then(function (resp) {\n                            var name = resp.result.name;\n                            return {\n                                name: { firstName: name.givenName, lastName: name.familyName },\n                                userEmail: resp.result.emailAddress\n                            };\n                        })];\n                    case 1:\n                        result = _a.sent();\n                        if (result.name)\n                            return [2 /*return*/, result];\n                        throw \"Användare inte hittad\";\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getClassrooms = function (courseId) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var result;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, gapi.client.classroom.courses\n                            .list({\n                            fields: \"courses.id,courses.room,courses.descriptionHeading\",\n                            courseStates: \"ACTIVE\"\n                        })\n                            .then(function (resp) {\n                            return resp.result.courses.filter(function (cr) { return cr.room && cr.room.indexOf(courseId) > -1; });\n                        })];\n                    case 1:\n                        result = _a.sent();\n                        if (result.length > 0)\n                            return [2 /*return*/, result];\n                        throw \"Inte registrerad på kurs\";\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getCourseWork = function (classroomId, taskId, throwError) {\n        if (throwError === void 0) { throwError = true; }\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var result;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, gapi.client.classroom.courses.courseWork\n                            .list({\n                            courseId: classroomId,\n                            fields: \"courseWork.courseId,courseWork.alternateLink,courseWork.id,courseWork.materials,courseWork.description,courseWork.workType,courseWork.dueDate,courseWork.dueTime\"\n                        })\n                            .then(function (resp) { return resp.result.courseWork ? resp.result.courseWork.filter(function (cw) { return cw.description.indexOf(taskId) > -1; }) : []; })];\n                    case 1:\n                        result = _a.sent();\n                        if (result.length == 1)\n                            return [2 /*return*/, result[0]];\n                        if (throwError)\n                            throw \"Hittar ingen matchad inlämningsuppgift\";\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getStudentSubmissions = function (classroomId, courseWorkId, throwError) {\n        if (throwError === void 0) { throwError = true; }\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var result;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions\n                            .list({\n                            courseId: classroomId,\n                            courseWorkId: courseWorkId\n                        })\n                            .then(function (resp) { return resp.result.studentSubmissions; })];\n                    case 1:\n                        result = _a.sent();\n                        if (result)\n                            return [2 /*return*/, result];\n                        if (throwError)\n                            throw \"Hittar ingen matchad inlämning\";\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return GoogleClassroom;\n}(GoogleClient));\nexport { GoogleClassroom };\n","import * as tslib_1 from \"tslib\";\nimport { env } from '../globals/KED.env';\nvar GoogleClient = /** @class */ (function () {\n    function GoogleClient(_a) {\n        var discoveryDocs = _a.discoveryDocs;\n        this.googleTokenProvider = env.googleTokenProvider;\n        this.discoveryDocs = [];\n        this.discoveryDocs.push(discoveryDocs);\n    }\n    GoogleClient.prototype.setBearerProvider = function (googleTokenProvider) {\n        this.googleTokenProvider = googleTokenProvider;\n    };\n    GoogleClient.prototype.ensureInited = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var tokenResult;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(typeof gapi === 'undefined')) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.loadGapi()];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        if (!(!this.tokenExpiration || this.tokenExpiration < new Date())) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.googleTokenProvider.getBearer()];\n                    case 3:\n                        tokenResult = _a.sent();\n                        this.tokenExpiration = new Date(tokenResult.expires);\n                        this.token = tokenResult.token;\n                        _a.label = 4;\n                    case 4: \n                    // Load all discovyerDocs\n                    return [4 /*yield*/, gapi.client.init({\n                            discoveryDocs: this.discoveryDocs\n                        })];\n                    case 5:\n                        // Load all discovyerDocs\n                        _a.sent();\n                        return [4 /*yield*/, gapi.client.setToken({\n                                access_token: this.token\n                            })];\n                    case 6:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GoogleClient.prototype.loadGapi = function () {\n        return new Promise(function (resolve) {\n            if (typeof gapi !== 'undefined')\n                return resolve();\n            var script = document.createElement('script');\n            script.src = \"https://apis.google.com/js/client.js?onload=gaapi_loaded\";\n            document.getElementsByTagName(\"head\")[0].appendChild(script);\n            window.gaapi_loaded = resolve;\n        });\n    };\n    return GoogleClient;\n}());\nexport { GoogleClient };\n","import * as tslib_1 from \"tslib\";\nimport { GoogleClient } from './google-client';\nvar GoogleDrive = /** @class */ (function (_super) {\n    tslib_1.__extends(GoogleDrive, _super);\n    function GoogleDrive() {\n        return _super.call(this, { discoveryDocs: 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest' }) || this;\n    }\n    GoogleDrive.prototype.getFile = function (fileId) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, gapi.client.drive.files.get({\n                                fileId: fileId,\n                                supportsAllDrives: true,\n                                fields: 'id,name,mimeType,webViewLink,iconLink,modifiedTime,thumbnailLink'\n                            }).then(function (resp) {\n                                if (resp.result.name) {\n                                    var file = resp.result;\n                                    return { fileId: file.id, url: file.webViewLink, mimeType: file.mimeType, name: file.name, modiifiedTime: file.modifiedTime, iconUrl: file.iconLink, thumbnailUrl: file.thumbnailLink };\n                                }\n                                return null;\n                            })];\n                }\n            });\n        });\n    };\n    /**\n     * updatePermissions()\n     *\n     * @param fileId\n     *\n     * Make the file accessible to all in the domain. Should be unnecessary but some\n     * teachers have changed their default permissions.\n     * We don't care right now if this fails because this is just an extra precaution.\n     * If we plan on using this on other domains the domain-attribute needs to be dynamic.\n     *\n     */\n    GoogleDrive.prototype.updatePermissions = function (fileId) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var error_1;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        console.log('updating permissions');\n                        return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        gapi.client.drive.permissions.create({\n                            fileId: fileId,\n                            sendNotificationEmail: false,\n                            role: 'reader',\n                            type: 'anyone',\n                            // type: 'domain', \n                            // domain: 'kunskapsskolan.se'\n                            supportsAllDrives: true\n                        }).then(function (resp) { return console.log(resp); });\n                        return [3 /*break*/, 3];\n                    case 2:\n                        error_1 = _a.sent();\n                        console.log('unable to update permissions');\n                        return [3 /*break*/, 3];\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Creates a folder with given name in a parent folder\n     * @param name folder name\n     * @param parent parent folders id\n     */\n    GoogleDrive.prototype.createFolder = function (name, parent) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        console.log('Creating folder ' + name);\n                        return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, gapi.client.drive.files.create({\n                                name: name,\n                                mimeType: 'application/vnd.google-apps.folder',\n                                parents: [parent]\n                            }).then(function (resp) { return resp.result; })];\n                }\n            });\n        });\n    };\n    /**\n     * Gets the id for the folder in a path. If folder/path does not exists\n     * a new folder at that path is created.\n     * @param path the path to the file from root folder as an array\n     */\n    GoogleDrive.prototype.getIdForFolderPath = function (path) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var parent, path_1, path_1_1, folder, folderId, newFolder, e_1_1;\n            var e_1, _a;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        console.log('Getting id for ' + path.join('/'));\n                        return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _b.sent();\n                        parent = 'root';\n                        _b.label = 2;\n                    case 2:\n                        _b.trys.push([2, 9, 10, 11]);\n                        path_1 = tslib_1.__values(path), path_1_1 = path_1.next();\n                        _b.label = 3;\n                    case 3:\n                        if (!!path_1_1.done) return [3 /*break*/, 8];\n                        folder = path_1_1.value;\n                        return [4 /*yield*/, this.getIdForFolder(folder, parent)];\n                    case 4:\n                        folderId = _b.sent();\n                        if (!folderId) return [3 /*break*/, 5];\n                        parent = folderId;\n                        return [3 /*break*/, 7];\n                    case 5: return [4 /*yield*/, this.createFolder(folder, parent)];\n                    case 6:\n                        newFolder = _b.sent();\n                        parent = newFolder.id;\n                        _b.label = 7;\n                    case 7:\n                        path_1_1 = path_1.next();\n                        return [3 /*break*/, 3];\n                    case 8: return [3 /*break*/, 11];\n                    case 9:\n                        e_1_1 = _b.sent();\n                        e_1 = { error: e_1_1 };\n                        return [3 /*break*/, 11];\n                    case 10:\n                        try {\n                            if (path_1_1 && !path_1_1.done && (_a = path_1.return)) _a.call(path_1);\n                        }\n                        finally { if (e_1) throw e_1.error; }\n                        return [7 /*endfinally*/];\n                    case 11: return [2 /*return*/, parent];\n                }\n            });\n        });\n    };\n    /**\n     * Gets the id for a folder in a given parent folder\n     * @param name name of folder\n     * @param parent parent folders id\n     */\n    GoogleDrive.prototype.getIdForFolder = function (name, parent) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        console.log('Getting id for ' + name);\n                        return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, gapi.client.drive.files.list({\n                                corpora: 'user',\n                                q: \"'\" + parent + \"' in parents and mimeType = 'application/vnd.google-apps.folder' and name = '\" + name + \"'\"\n                            }).then(function (resp) {\n                                if (resp.result.files.length) {\n                                    return resp.result.files[0].id;\n                                }\n                                else {\n                                    return false;\n                                }\n                            })];\n                }\n            });\n        });\n    };\n    /**\n     * Copies a file to a destination\n     * @param file\n     * @param destination the destination as an array of folder names\n     */\n    GoogleDrive.prototype.copyFile = function (file, destination) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var parent_1, parent_2;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        console.log('Copying file: ' + file.name);\n                        return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        if (!destination) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.getIdForFolderPath(destination)];\n                    case 2:\n                        parent_1 = _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        parent_2 = 'root';\n                        _a.label = 4;\n                    case 4: return [2 /*return*/, gapi.client.drive.files.copy({\n                            fileId: file.id,\n                            supportsAllDrives: true,\n                            parents: [parent],\n                            name: file.name,\n                            fields: 'id,name,mimeType,webViewLink,iconLink,modifiedTime,thumbnailLink'\n                        }).then(function (resp) { return resp.result; })];\n                }\n            });\n        });\n    };\n    GoogleDrive.prototype.handInFile = function (fileId, student, newOwner, teachers) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var batch;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // This should:\n                        // - add teachers to editors of file\n                        // - makes newOwner the owner of the file\n                        // - makes the caller a reader of the file\n                        // Now it makes teachers editors\n                        console.log('handing in file');\n                        return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        batch = gapi.client.newBatch();\n                        return [4 /*yield*/, teachers.forEach(function (teacher) {\n                                batch.add(gapi.client.drive.permissions.create({\n                                    fileId: fileId,\n                                    sendNotificationEmail: false,\n                                    role: 'writer',\n                                    type: 'user',\n                                    emailAddress: teacher\n                                }));\n                            })];\n                    case 2:\n                        _a.sent();\n                        batch.then(function (resp) { return console.log(resp); });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GoogleDrive.prototype.reclaimFile = function (file, student, teachers) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                return [2 /*return*/];\n            });\n        });\n    };\n    GoogleDrive.prototype.returnFile = function (file, student) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                return [2 /*return*/];\n            });\n        });\n    };\n    GoogleDrive.prototype.updateUrkundProperties = function (file) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n     * downloadFile()\n     * @param file\n     *\n     * When Classroom has been integrated we will want to handle only the fileId:s\n     * so that editing capabilities are peserved on the file (if it is a google-apps file)\n     * Right now google-apps files are converted to pdf and passed into the current flow.\n     *\n     * TODO: error handling\n     */\n    GoogleDrive.prototype.downloadFile = function (_a) {\n        var file = _a.file, limitSize = _a.limitSize, mimeType = _a.mimeType;\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var type, xhrDownload_1;\n            var _this = this;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: \n                    // A file that can be exported to PDF is retreived with\n                    // file.export() from Drive, converted to a blob and then\n                    // to a File.\n                    // A file that can not be exported to PDF is retrieved\n                    // through XHR and converted to a File.\n                    // If we don't need to handle the physical files on the client\n                    // we could save only the fileId:s and display filename and mimeType\n                    // for the file in our listings. When/if we use Google Classroom for\n                    // our task-handling that would be the preferred approach to keep\n                    // the file as an editable Google file\n                    // Init the drive-api (only needed for download so not loaded initially)\n                    return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        // A file that can be exported to PDF is retreived with\n                        // file.export() from Drive, converted to a blob and then\n                        // to a File.\n                        // A file that can not be exported to PDF is retrieved\n                        // through XHR and converted to a File.\n                        // If we don't need to handle the physical files on the client\n                        // we could save only the fileId:s and display filename and mimeType\n                        // for the file in our listings. When/if we use Google Classroom for\n                        // our task-handling that would be the preferred approach to keep\n                        // the file as an editable Google file\n                        // Init the drive-api (only needed for download so not loaded initially)\n                        _b.sent();\n                        type = mimeType ? mimeType : 'application/pdf';\n                        if (file.canExport) {\n                            return [2 /*return*/, new Promise(function (resolve, reject) {\n                                    gapi.client.drive.files.export({\n                                        fileId: file.fileId,\n                                        mimeType: type\n                                    }).then(function (resp) {\n                                        var len = resp.body.length;\n                                        var data = new Uint8Array(new ArrayBuffer(len));\n                                        for (var i = 0; i < len; i++) {\n                                            data[i] = resp.body.charCodeAt(i);\n                                        }\n                                        var blob = new Blob([data], { type: type });\n                                        var filename = file.name + '.pdf';\n                                        resolve(new File([blob], filename, { type: type, lastModified: file.modifiedTime }));\n                                    });\n                                })];\n                        }\n                        else {\n                            xhrDownload_1 = function (file) {\n                                return new Promise(function (resolve, reject) {\n                                    var xhr = new XMLHttpRequest();\n                                    xhr.open(\"GET\", \"https://www.googleapis.com/drive/v3/files/\" + file.fileId + '?alt=media', true);\n                                    xhr.setRequestHeader('Authorization', 'Bearer ' + _this.token);\n                                    xhr.responseType = 'blob';\n                                    xhr.onload = function () {\n                                        resolve(new File([xhr.response], file.name, { type: file.mimeType, lastModified: file.modifiedTime }));\n                                    };\n                                    xhr.send();\n                                });\n                            };\n                            return [2 /*return*/, new Promise(function (resolve, reject) {\n                                    if (limitSize !== undefined) {\n                                        gapi.client.drive.files.get({\n                                            fileId: file.fileId,\n                                            fields: 'size'\n                                        }).then(function (resp) {\n                                            var size = Number(resp.result.size);\n                                            if (size > limitSize * 1024 * 1024) {\n                                                reject('GooglePickerError: Fildsize is too laarge');\n                                            }\n                                        }).then(function () {\n                                            xhrDownload_1(file).then(function (resp) {\n                                                resolve(resp);\n                                            });\n                                        });\n                                    }\n                                    else {\n                                        xhrDownload_1(file).then(function (resp) {\n                                            resolve(resp);\n                                        });\n                                    }\n                                })];\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return GoogleDrive;\n}(GoogleClient));\nexport { GoogleDrive };\n","import * as tslib_1 from \"tslib\";\nimport { GoogleWebClient } from './google-webclient';\nimport { GoogleDrive } from './google-drive';\nvar mimeTypeCollections = {\n    'google-apps': 'application/vnd.google-apps.document,application/vnd.google-apps.presentation,application/vnd.google-apps.spreadsheet',\n    'pdf': 'application/pdf'\n};\n/**\n * GooglePicker\n * Includes the initiation of the correct api:s.\n * Certain options can be passed to the constructor\n * and there could be others worth incorporating (i.e. Team Drive-support).\n *\n * Right now two options are handled:\n * - upload: if a user can upload to Drive in the Google Drive Picker\n * - multiple: if a user can select multiple files\n * - limitType: active limits to certain mimeTypesCollections\n * - mineOnly: if only show files owned by the user\n *\n * We could probably split this into google-picker and google-drive where google-drive\n * handles the explicit calls to the google drive api.\n */\nvar GooglePicker = /** @class */ (function (_super) {\n    tslib_1.__extends(GooglePicker, _super);\n    function GooglePicker(options) {\n        var _this = _super.call(this, { scopes: ['https://www.googleapis.com/auth/drive'] }) || this;\n        _this.options = { upload: false, multiple: false, limitType: false, onlyMine: false };\n        Object.assign(_this.options, options);\n        _this.drive = new GoogleDrive();\n        return _this;\n    }\n    /**\n     * show()\n     *\n     * If a single file is requested from the picker a list of files with one element is returned.\n     * It is up to the caller to handle the list in a relevant manner.\n     *\n     * More data from the file could be extracted if it is deemed necessary.\n     *\n     */\n    GooglePicker.prototype.show = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, new Promise(function (resolve, reject) {\n                                var callback = function (response) {\n                                    if (response['action'] == google.picker.Action.CANCEL) {\n                                        reject();\n                                    }\n                                    else if (response['action'] == google.picker.Action.PICKED) {\n                                        var selected_1 = [];\n                                        response.docs.map(function (doc) {\n                                            var fileId = doc.id, mimeType = doc.mimeType, name = doc.name, modifiedTime = doc.modifiedTime, iconUrl = doc.iconUrl, url = doc.url;\n                                            var canExport = mimeType.includes('google-apps');\n                                            selected_1.push({ fileId: fileId, mimeType: mimeType, name: name, modifiedTime: modifiedTime, canExport: canExport, iconUrl: iconUrl, url: url });\n                                            // update permissions to read by all in domain\n                                            _this.drive.updatePermissions(fileId);\n                                        });\n                                        resolve(selected_1);\n                                    }\n                                };\n                                var pickerbuilder = new google.picker.PickerBuilder()\n                                    .enableFeature(google.picker.Feature.SUPPORT_DRIVES)\n                                    .enableFeature(google.picker.Feature.SUPPORT_TEAM_DRIVES)\n                                    .addView(new google.picker.DocsView()\n                                    .setOwnedByMe(true) // should this be an option?\n                                    .setIncludeFolders(true))\n                                    .addView(new google.picker.DocsView()\n                                    .setIncludeFolders(true)\n                                    .setEnableTeamDrives(true))\n                                    .setLocale(\"sv\") // should this be an option?\n                                    .setSize(1051, 650) // should this be an option?\n                                    .setOAuthToken(_this.authToken)\n                                    .setCallback(callback);\n                                if (_this.options.upload) {\n                                    pickerbuilder.addView(new google.picker.DocsUploadView().setIncludeFolders(true));\n                                }\n                                if (_this.options.multiple) {\n                                    pickerbuilder.enableFeature(google.picker.Feature.MULTISELECT_ENABLED);\n                                }\n                                if (_this.options.onlyMine) {\n                                    pickerbuilder.enableFeature(google.picker.Feature.MINE_ONLY);\n                                }\n                                if (_this.options.limitType) {\n                                    var mimeTypes = mimeTypeCollections[_this.options.limitType];\n                                    console.log(mimeTypes);\n                                    pickerbuilder.setSelectableMimeTypes(mimeTypes);\n                                }\n                                _this.picker = pickerbuilder.build();\n                                _this.picker.setVisible(true);\n                            })];\n                }\n            });\n        });\n    };\n    GooglePicker.prototype.close = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                this.picker.dispose();\n                return [2 /*return*/];\n            });\n        });\n    };\n    return GooglePicker;\n}(GoogleWebClient));\nexport { GooglePicker };\n","import * as tslib_1 from \"tslib\";\nimport env from '../globals/KED.env';\nimport { WebClientId } from './configs';\nvar GoogleWebClient = /** @class */ (function () {\n    function GoogleWebClient(_a) {\n        var _b;\n        var _c = _a.scopes, scopes = _c === void 0 ? [] : _c;\n        this.scopes = ['https://www.googleapis.com/auth/userinfo.email', 'https://www.googleapis.com/auth/userinfo.profile'];\n        (_b = this.scopes).push.apply(_b, tslib_1.__spread(scopes));\n    }\n    GoogleWebClient.prototype.ensureInited = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var SCOPES;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(typeof gapi === \"undefined\")) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.loadGapi()];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        SCOPES = this.scopes.join(' ');\n                        return [4 /*yield*/, new Promise(function (resolve, reject) {\n                                gapi.load(\"client:auth2\", function () {\n                                    // Calls authorize without prompting the user. If authorization hasn't been given by\n                                    // the user an error is returned and we call authorize again with consent-screen\n                                    var reauthorize = false;\n                                    return gapi.auth2.authorize({\n                                        client_id: WebClientId,\n                                        scope: SCOPES,\n                                        response_type: 'permission',\n                                        login_hint: env.currentUser.mail,\n                                        prompt: 'none'\n                                    }, function (resp) {\n                                        console.table(resp);\n                                        if (resp.error) {\n                                            // no consent given so reauthorize\n                                            reauthorize = true;\n                                        }\n                                        else {\n                                            // check if we have all the scopes we want\n                                            var scopeset_1 = new Set(resp.scope.split(' '));\n                                            var missingScopes = _this.scopes.filter(function (x) { return !scopeset_1.has(x); });\n                                            if (missingScopes.length > 0) {\n                                                console.log('missing scopes');\n                                                // scopes are missing from our consent so reauthorize\n                                                reauthorize = true;\n                                            }\n                                            else {\n                                                // everything seems to be ok so store our token\n                                                _this.authToken = resp.access_token;\n                                                resolve();\n                                            }\n                                        }\n                                        if (reauthorize) {\n                                            console.log('reauthorize');\n                                            return gapi.auth2.authorize({\n                                                client_id: WebClientId,\n                                                scope: SCOPES,\n                                                response_type: 'permission',\n                                                login_hint: env.currentUser.mail,\n                                                prompt: 'consent'\n                                            }, function (resp) {\n                                                console.table(resp);\n                                                if (resp.error) {\n                                                    // something is still wrong so throw an error\n                                                    reject('Google Web Client: No access token');\n                                                }\n                                                else {\n                                                    // we now have a token (hopefully with the right scopes)\n                                                    // should we check again?\n                                                    _this.authToken = resp.access_token;\n                                                    resolve();\n                                                }\n                                            });\n                                        }\n                                        if (resp.expires_in < 500) {\n                                            return gapi.auth2.authorize({\n                                                client_id: WebClientId,\n                                                scope: SCOPES,\n                                                response_type: 'permission',\n                                                login_hint: env.currentUser.mail,\n                                                prompt: 'none'\n                                            }, function (resp) {\n                                                _this.authToken = resp.access_token;\n                                                resolve();\n                                            });\n                                        }\n                                    });\n                                });\n                            })];\n                    case 3:\n                        _a.sent();\n                        if (!(typeof google === \"undefined\" || typeof google.picker === \"undefined\")) return [3 /*break*/, 5];\n                        return [4 /*yield*/, new Promise(function (resolve) {\n                                gapi.load(\"picker\", function () { resolve(); });\n                            })];\n                    case 4:\n                        _a.sent();\n                        _a.label = 5;\n                    case 5:\n                        if (!(typeof gapi.client === \"undefined\" || typeof gapi.client.classroom === \"undefined\")) return [3 /*break*/, 7];\n                        return [4 /*yield*/, new Promise(function (resolve) {\n                                gapi.client.load(\"classroom\", 'v1', function () { resolve(); });\n                            })];\n                    case 6:\n                        _a.sent();\n                        _a.label = 7;\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GoogleWebClient.prototype.loadGapi = function () {\n        return new Promise(function (resolve, reject) {\n            if (typeof gapi !== \"undefined\")\n                return resolve();\n            var script = document.createElement(\"script\");\n            script.src = \"https://apis.google.com/js/client.js?onload=gaapi_loaded\";\n            document.getElementsByTagName(\"head\")[0].appendChild(script);\n            window.gaapi_loaded = resolve;\n        });\n    };\n    return GoogleWebClient;\n}());\nexport { GoogleWebClient };\n","import * as tslib_1 from \"tslib\";\nvar createStudents = function (group, n, m) {\n    var students = [];\n    for (var i = n; i <= m; i++) {\n        students.push({\n            schoolName: 'KED',\n            tuitionGroupName: group,\n            studentFirstName: 'Student ' + i,\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student' + i + '.classroom@kedschools.com'\n        });\n    }\n    return students;\n};\nexport var mockTeachers = [\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Teacher 1',\n        teacherLastName: 'Classroom',\n        teacherEmailAddress: 'teacher1.classroom@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Teacher 2',\n        teacherLastName: 'Classroom',\n        teacherEmailAddress: 'teacher2.classroom@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Teacher 3',\n        teacherLastName: 'Classroom',\n        teacherEmailAddress: 'teacher3.classroom@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Carl',\n        teacherLastName: 'Holmberg',\n        teacherEmailAddress: 'carl@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'David',\n        teacherLastName: 'Fahlander',\n        teacherEmailAddress: 'david.fahlander@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Andrei',\n        teacherLastName: 'Spatarelu',\n        teacherEmailAddress: 'andrei.spatarelu@vemendo.se'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Andrei',\n        teacherLastName: 'Spatarelu',\n        teacherEmailAddress: 'andrei@kedschools.com'\n    }\n];\nexport var mockTuitionGroups = {\n    'DJUSÄL01': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR1 (180816-190614)',\n            courseCode: 'DJUSÄL01'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR2 (180816-190614)',\n            courseCode: 'DJUSÄL01'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            courseCode: 'DJUSÄL01'\n        }\n    ],\n    'DJUDJI0': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\n            courseCode: 'DJUDJI0'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\n            courseCode: 'DJUDJI0'\n        },\n    ],\n    'KEMKEM01': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            courseCode: 'KEMKEM01'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\n            courseCode: 'KEMKEM01'\n        }\n    ],\n    \"MATMAT03b\": [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'MAT3b_Gr1 (180816-190614)',\n            courseCode: 'MATMAT03b'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'MAT3b_Gr2 (180816-190614)',\n            courseCode: 'MATMAT03b'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'MAT3b_Gr3 (180816-190614)',\n            courseCode: 'MATMAT03b'\n        }\n    ],\n    'BIOBIO01': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            courseCode: 'BIOBIO01'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\n            courseCode: 'BIOBIO01'\n        }\n    ],\n    'SVESVE03': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr1 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr2 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr3 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr4 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr5 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr6 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr7 (180816-190614)',\n            courseCode: 'SVESVE03'\n        }\n    ]\n};\nexport var mockTuitionStudents = {\n    'DJUR1_GR1 (180816-190614)': createStudents('DJUR1_GR1 (180816-190614)', 1, 12),\n    'DJUR1_GR2 (180816-190614)': createStudents('DJUR1_GR2 (180816-190614)', 13, 24),\n    'DJUR1_GR3 (180816-190614)': tslib_1.__spread([\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            studentFirstName: 'Student2',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student2.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            studentFirstName: 'Carl',\n            studentLastName: 'Holmberg',\n            studentEmailAddress: 'carl@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            studentFirstName: 'Andrei',\n            studentLastName: 'Spatarelu',\n            studentEmailAddress: 'andrei.spatarelu@vemendo.se'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            studentFirstName: 'Student3',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student3.classroom@kedschools.com'\n        }\n    ], createStudents('DJUR1_GR3 (180816-190614)', 23, 34)),\n    'DJUDJ_Gr1 (180816-190614)': tslib_1.__spread([\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\n            studentFirstName: 'Carl',\n            studentLastName: 'Holmberg',\n            studentEmailAddress: 'carl@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\n            studentFirstName: 'Andrei',\n            studentLastName: 'Spatarelu',\n            studentEmailAddress: 'andrei.spatarelu@vemendo.se'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\n            studentFirstName: 'David',\n            studentLastName: 'Fahlander',\n            studentEmailAddress: 'david.fahlander@kedschools.com'\n        }\n    ], createStudents('DJUDJ_Gr1 (180816-190614)', 151, 160)),\n    'DJUDJ_Gr2 (180816-190614)': tslib_1.__spread([\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\n            studentFirstName: 'Carl',\n            studentLastName: 'Holmberg',\n            studentEmailAddress: 'carl@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\n            studentFirstName: 'Andrei',\n            studentLastName: 'Spatarelu',\n            studentEmailAddress: 'andrei.spatarelu@vemendo.se'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\n            studentFirstName: 'David',\n            studentLastName: 'Fahlander',\n            studentEmailAddress: 'david.fahlander@kedschools.com'\n        }\n    ], createStudents('DJUDJ_Gr2 (180816-190614)', 161, 165)),\n    'MAT3b_Gr1 (180816-190614)': createStudents('MAT3b_Gr1 (180816-190614)', 3, 23),\n    'MAT3b_Gr3 (180816-190614)': createStudents('MAT3b_Gr3 (180816-190614)', 24, 49),\n    'MAT3b_Gr2 (180816-190614)': tslib_1.__spread([\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'MAT3b_Gr2 (180816-190614)',\n            studentFirstName: 'Andrei',\n            studentLastName: 'Spatarelu',\n            studentEmailAddress: 'andrei@kedschools.com'\n        }\n    ], createStudents('MAT3b_Gr2 (180816-190614)', 50, 72)),\n    'IDR1_Gr1 (180816-190614)': createStudents('IDR1_Gr1 (180816-190614)', 1, 12),\n    'IDR1_Gr2 (180816-190614)': createStudents('IDR1_Gr2 (180816-190614)', 13, 22),\n    'IDR1_Gr3 (180816-190614)': createStudents('IDR1_Gr3 (180816-190614)', 23, 34),\n    'KEM1_Gr1 (180816-190614)': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 2',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student2.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 3',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student3.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 8',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student8.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 9',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student9.classroom@kedschools.com'\n        }\n    ],\n    'KEM1_Gr2 (180816-190614)': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 1',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student1.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 5',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student5.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 6',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student6.classroom@kedschools.com'\n        }\n    ],\n    'BIO1_Gr1 (180816-190614)': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 1',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student1.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 4',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student4.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 6',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student6.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 10',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student10.classroom@kedschools.com'\n        }\n    ],\n    'BIO1_Gr2 (180816-190614)': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 2',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student2.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 7',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student7.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 8',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student8.classroom@kedschools.com'\n        },\n    ],\n    'SVE3_Gr1 (180816-190614)': createStudents('SVE3_Gr1 (180816-190614)', 1, 21),\n    'SVE3_Gr2 (180816-190614)': createStudents('SVE3_Gr2 (180816-190614)', 22, 44),\n    'SVE3_Gr3 (180816-190614)': createStudents('SVE3_Gr3 (180816-190614)', 45, 61),\n    'SVE3_Gr4 (180816-190614)': createStudents('SVE3_Gr4 (180816-190614)', 62, 78),\n    'SVE3_Gr5 (180816-190614)': createStudents('SVE3_Gr5 (180816-190614)', 83, 107),\n    'SVE3_Gr6 (180816-190614)': createStudents('SVE3_Gr6 (180816-190614)', 108, 124),\n    'SVE3_Gr7 (180816-190614)': createStudents('SVE3_Gr7 (180816-190614)', 125, 150)\n};\n","export function courseNameToCssClass(cssPrefix, courseName) {\n    return \"\" + cssPrefix + courseName.substr(0, 3).toLowerCase();\n}\n","export function getWeekplannerProgressData(taskSets) {\n    var chartTasks = { completedTasks: 0, totalNumberOfTasks: 0, subjectData: {} };\n    taskSets.forEach(function (elem) { return elem.learningGoals.forEach(function (x) {\n        var subjectCompletedTasks = x.tasks.filter(function (t) { return t.done; }).length;\n        var courseSubjectData = chartTasks.subjectData[elem.courseName];\n        if (!courseSubjectData) {\n            courseSubjectData = chartTasks.subjectData[elem.courseName] = {\n                completedNumberOfTasks: 0,\n                numberOfTasks: 0\n            };\n        }\n        courseSubjectData.completedNumberOfTasks += subjectCompletedTasks;\n        courseSubjectData.numberOfTasks += x.tasks.length;\n        chartTasks.completedTasks += subjectCompletedTasks;\n        chartTasks.totalNumberOfTasks += x.tasks.length;\n    }); });\n    return chartTasks;\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nvar GoalProgress = /** @class */ (function (_super) {\n    tslib_1.__extends(GoalProgress, _super);\n    function GoalProgress() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.createProgress = function () {\n            var _a = _this.props, numberOfTasks = _a.numberOfTasks, completedNumberOfTasks = _a.completedNumberOfTasks, maximumTasksDisplayed = _a.maximumTasksDisplayed, backgroundColor = _a.backgroundColor, progressColor = _a.progressColor;\n            var progress = [];\n            if (numberOfTasks > maximumTasksDisplayed) {\n                return React.createElement(\"div\", { className: \"progress-overview\" },\n                    \" \",\n                    completedNumberOfTasks,\n                    \" / \",\n                    numberOfTasks,\n                    \" \");\n            }\n            for (var taskNo = 1; taskNo <= numberOfTasks; taskNo++) {\n                progress.push(React.createElement(\"svg\", { key: taskNo },\n                    React.createElement(\"circle\", { className: \"circle-chart-background\", fill: taskNo > completedNumberOfTasks ? backgroundColor : progressColor, cx: \"8\", cy: \"8\", r: \"8\" })));\n            }\n            return progress;\n        };\n        return _this;\n    }\n    GoalProgress.prototype.render = function () {\n        return React.createElement(\"div\", { className: \"goals-progress\" }, this.createProgress());\n    };\n    GoalProgress.defaultProps = {\n        numberofTasks: 0,\n        completedNumberOfTasks: 0,\n        maximumTasksDisplayed: 10,\n        backgroundColor: \"lightgrey\",\n        progressColor: \"#3dbca2\",\n    };\n    return GoalProgress;\n}(React.Component));\nexport { GoalProgress };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nvar Progress = /** @class */ (function (_super) {\n    tslib_1.__extends(Progress, _super);\n    function Progress() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Progress.prototype.render = function () {\n        var _a = this.props, percentage = _a.percentage, backgroundColor = _a.backgroundColor, progressColor = _a.progressColor;\n        var roundedPercentage = Math.round(percentage);\n        return (React.createElement(\"svg\", { className: \"progress-chart\", width: \"100%\", height: \"25\" },\n            React.createElement(\"rect\", { fill: backgroundColor, width: \"100%\", height: \"100%\", rx: \"4\" }),\n            React.createElement(\"rect\", { className: \"fill\", fill: progressColor, width: roundedPercentage + \"%\", height: \"100%\", rx: \"4\" }),\n            React.createElement(\"text\", { className: \"filled-text\", textAnchor: \"middle\", x: \"50%\", y: \"50%\", dy: \".3em\" }, roundedPercentage + \"%\")));\n    };\n    Progress.defaultProps = {\n        percentage: 0,\n        backgroundColor: \"#F1F5F4\",\n        progressColor: \"#3dbca2\",\n    };\n    return Progress;\n}(React.Component));\nexport { Progress };\n","import env from '../../../globals/KED.env';\nimport { isTeacherAtSchool } from '../../../access-control';\nexport function isEmployee(atSchool) {\n    return atSchool ?\n        isTeacherAtSchool(env.currentUser, atSchool) || env.currentUser.roles.includes(\"ADMIN\") :\n        env.currentUser.roles.some(function (role) { return role === 'EMPLOYEE' || role === 'ADMIN'; });\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { L } from \"../../../utils/utils\";\n;\nexport var RemoveItem = function (_a) {\n    var onClick = _a.onClick, className = _a.className, style = _a.style, title = _a.title;\n    return React.createElement(\"div\", { title: title || L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"Radera\"], [\"Radera\"]))), className: \"removeItem \" + (className || \"\"), onClick: onClick, style: style });\n};\nvar templateObject_1;\n","import * as React from 'react';\nexport var Spinner = function (_a) {\n    var _b = _a.label, label = _b === void 0 ? \"\" : _b;\n    return React.createElement(\"span\", null,\n        React.createElement(\"i\", { className: \"fas fa-spinner fa-spin\", \"aria-hidden\": \"true\" }),\n        \"\\u00A0\",\n        label);\n};\n","import * as tslib_1 from \"tslib\";\nimport moment from 'moment';\nimport { createUUID } from 'kedbackend/client';\nimport update from 'react-addons-update';\nimport $ from 'jquery';\nimport env from '../../globals/KED.env';\nexport function updateDocumentGraphs(oldDoc, newDoc, table, graphs, batch) {\n    var e_1, _a;\n    var docUpdates = {};\n    var docId = newDoc.id;\n    var _loop_1 = function (navProp) {\n        var e_2, _a, e_3, _b, e_4, _c;\n        var foreignTable = graphs[navProp];\n        var oldList = oldDoc[navProp] || [];\n        var newList = newDoc[navProp];\n        if (!newList)\n            return \"continue\";\n        var tuples = newList\n            .map(function (doc, idx) { return ({ doc: doc, idx: idx }); }); // Create tubles of {doc, array-index} so we can update result\n        var added = tuples.filter(function (tuple) { return !oldList.some(function (o) { return o.id === tuple.doc.id; }); }); // Find added items\n        try {\n            for (var added_1 = (e_2 = void 0, tslib_1.__values(added)), added_1_1 = added_1.next(); !added_1_1.done; added_1_1 = added_1.next()) {\n                var a = added_1_1.value;\n                var mutatedSubDoc = tslib_1.__assign({}, a.doc);\n                var meta = mutatedSubDoc.$meta;\n                delete mutatedSubDoc.$meta; // Delete $meta so that \"add\" or \"update\" does not persiste to next state.\n                if (meta === 'add') {\n                    if (!mutatedSubDoc.id)\n                        mutatedSubDoc.id = createUUID(); // Generate ID if not done yet.\n                    // Now put an 'add' mutation in the batch queue.\n                    batch.add(foreignTable, mutatedSubDoc);\n                }\n                else if (meta === 'update') {\n                    batch.put(foreignTable, mutatedSubDoc);\n                }\n                batch.link(table, docId, foreignTable, mutatedSubDoc.id, navProp);\n                // Update result so that state is reflected after succesful POST to server.\n                if (!docUpdates[navProp])\n                    docUpdates[navProp] = {};\n                docUpdates[navProp][a.idx] = { $set: mutatedSubDoc };\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (added_1_1 && !added_1_1.done && (_a = added_1.return)) _a.call(added_1);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        var removed = oldList.filter(function (o) { return !newList.some(function (n) { return n.id === o.id; }); });\n        try {\n            for (var removed_1 = (e_3 = void 0, tslib_1.__values(removed)), removed_1_1 = removed_1.next(); !removed_1_1.done; removed_1_1 = removed_1.next()) {\n                var r = removed_1_1.value;\n                batch.unlink(table, docId, foreignTable, r.id, navProp);\n            }\n        }\n        catch (e_3_1) { e_3 = { error: e_3_1 }; }\n        finally {\n            try {\n                if (removed_1_1 && !removed_1_1.done && (_b = removed_1.return)) _b.call(removed_1);\n            }\n            finally { if (e_3) throw e_3.error; }\n        }\n        var updated = tuples.filter(function (tuple) { return oldList.some(function (o) { return o.id === tuple.doc.id && tuple.doc.$meta === 'update'; }); });\n        try {\n            for (var updated_1 = (e_4 = void 0, tslib_1.__values(updated)), updated_1_1 = updated_1.next(); !updated_1_1.done; updated_1_1 = updated_1.next()) {\n                var u = updated_1_1.value;\n                var mutatedSubDoc = tslib_1.__assign({}, u.doc);\n                delete mutatedSubDoc.$meta;\n                batch.put(foreignTable, mutatedSubDoc);\n                // Update result so that $meta is removed from navigation prop after successful POST to server.\n                if (!docUpdates[navProp])\n                    docUpdates[navProp] = {};\n                docUpdates[navProp][u.idx] = { $set: mutatedSubDoc };\n            }\n        }\n        catch (e_4_1) { e_4 = { error: e_4_1 }; }\n        finally {\n            try {\n                if (updated_1_1 && !updated_1_1.done && (_c = updated_1.return)) _c.call(updated_1);\n            }\n            finally { if (e_4) throw e_4.error; }\n        }\n    };\n    try {\n        for (var _b = tslib_1.__values(Object.keys(graphs)), _c = _b.next(); !_c.done; _c = _b.next()) {\n            var navProp = _c.value;\n            _loop_1(navProp);\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return update(newDoc, docUpdates);\n}\nexport function dtFormat(dateTime) {\n    return moment(dateTime).format('YYMMDD HH:mm');\n}\nexport function shortDateFormat(dateTime) {\n    return moment(dateTime).format('YYMMDD');\n}\nexport function shortPersonNameFormat(name) {\n    if (!name)\n        return \"\";\n    var names = name.split(' ').filter(function (n) { return !!n; });\n    var lastName = names.pop();\n    return names.map(function (name) { return name[0] + \".\"; }).concat(lastName).join(' ');\n}\nexport function updateModificationStamp(now, obj, user) {\n    return update(obj, {\n        dateTime: { $set: now },\n        modifiedDate: { $set: now },\n        modifiedBy: {\n            $set: {\n                name: user.displayName,\n                url: \"mailto:\" + user.mail\n            }\n        }\n    });\n}\nexport function updateCreationStamp(now, obj, user) {\n    return update(obj, {\n        createdDate: { $set: now },\n        createdBy: {\n            $set: {\n                name: user.displayName,\n                url: \"mailto:\" + user.mail\n            }\n        }\n    });\n}\nexport function getEmailFromDocAccess(resource) {\n    if (resource.email)\n        return resource.email;\n    return resource.url ?\n        resource.url.startsWith('mailto:') ?\n            resource.url.substring('mailto:'.length) :\n            resource.url :\n        resource.url;\n}\nexport function updateModificationAndCreationStamps(obj, user) {\n    var now = Date.now();\n    obj = updateModificationStamp(now, obj, user);\n    if (!obj.createdBy)\n        obj = updateCreationStamp(now, obj, user);\n    return obj;\n}\nexport function applyEtags(doc, newEtags, graphs) {\n    var e_5, _a;\n    var res = tslib_1.__assign({}, doc);\n    var etag = newEtags[doc.id];\n    if (etag)\n        res.$etag = etag;\n    try {\n        for (var graphs_1 = tslib_1.__values(graphs), graphs_1_1 = graphs_1.next(); !graphs_1_1.done; graphs_1_1 = graphs_1.next()) {\n            var label = graphs_1_1.value;\n            var newList = doc[label].map(function (d) { return applyEtags(d, newEtags, []); });\n            res[label] = newList;\n        }\n    }\n    catch (e_5_1) { e_5 = { error: e_5_1 }; }\n    finally {\n        try {\n            if (graphs_1_1 && !graphs_1_1.done && (_a = graphs_1.return)) _a.call(graphs_1);\n        }\n        finally { if (e_5) throw e_5.error; }\n    }\n    return res;\n}\nexport function readBlob(blob, m) {\n    return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onload = function (ev) { return resolve(ev.target.result); };\n        reader.onabort = function (ev) { return reject(new Error(\"file read aborted\")); };\n        reader.onerror = function (ev) { return reject(ev.target.error); };\n        m(reader);\n    });\n}\nexport function readBlobAsText(blob) {\n    return readBlob(blob, function (r) { return r.readAsText(blob); });\n}\nexport function readBlobAsDataUrl(blob) {\n    return readBlob(blob, function (r) { return r.readAsDataURL(blob); });\n}\nexport function allowCopy(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'copy';\n}\nexport function updateCourseBuilderStatus(status) {\n    var div = $('div.course-builder')[0];\n    if (div)\n        div.className = \"course-builder\" + (status ? \" status \" + status : \"\");\n}\nexport function loadCourse(id, options) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n        var client, includeTemplateChain, includeTasks, _a, course, courseTasks, templateChain;\n        return tslib_1.__generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    client = env.kedBackendClient;\n                    includeTemplateChain = options && options.includeTemplateChain;\n                    includeTasks = !options || !options.include || options.include.indexOf(\"tasks\") !== -1;\n                    return [4 /*yield*/, Promise.all([\n                            client.get(\"courses\", id, {\n                                include: options && options.include ? options.include.filter(function (i) { return i !== \"tasks\"; }) : [\n                                    \"centralContent\",\n                                    \"knowledgeRequirements\",\n                                    \"abilities\",\n                                    \"images\",\n                                    \"acl\" // Don't include tasks here...\n                                ]\n                            }),\n                            // ... but include tasks here instead so that we can load the graphs for the\n                            // tasks as well!\n                            includeTasks && client.list(\"tasks\", {\n                                hasEdgesFrom: id,\n                                include: ['knowledgeRequirements', 'centralContent', 'abilities', 'acl'],\n                                flags: ['includeIdsOnly'] // Don't need redundant info that's already on course\n                            }),\n                            includeTemplateChain && client.list(\"courses\", {\n                                hasEdgesFrom: id,\n                                flags: ['idsOnly']\n                            })\n                        ])];\n                case 1:\n                    _a = tslib_1.__read.apply(void 0, [(_b.sent()), 3]), course = _a[0], courseTasks = _a[1], templateChain = _a[2];\n                    course.tasks = courseTasks;\n                    // Correct the order of Abilities\n                    if (course.abilities && course.abilitiesOrder) {\n                        course.abilities = course.abilitiesOrder.map(function (id) {\n                            return course.abilities.find(function (a) { return a.id === id; });\n                        });\n                    }\n                    // Correct the order of KnowledgeRequirements\n                    if (course.knowledgeRequirements && course.knowledgeRequirementsOrder) {\n                        course.knowledgeRequirements = course.knowledgeRequirementsOrder.map(function (id) {\n                            return course.knowledgeRequirements.find(function (c) { return c.id === id; });\n                        });\n                    }\n                    // Correct the order of CentralContent\n                    if (course.centralContent && course.centralContentOrder) {\n                        course.centralContent = course.centralContentOrder.map(function (id) {\n                            return course.centralContent.find(function (cc) { return cc.id === id; });\n                        }); //.filter(x => !!x);// Debugging somthin' . Normally the last .filter()... part should not be nescessary...\n                    }\n                    // Include template chain if requested.\n                    if (includeTemplateChain)\n                        course.templateChain = templateChain;\n                    return [2 /*return*/, course];\n            }\n        });\n    });\n}\n// Check differences between two array of type T\nexport function hasChanges(originalValues, currentValues) {\n    return originalValues === undefined || currentValues.filter(function (x) { return !originalValues.includes(x); }).length > 0 || originalValues.filter(function (x) { return !currentValues.includes(x); }).length > 0;\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from \"react\";\nimport env from \"../../../globals/KED.env\";\nimport { showError } from \"../../../utils/utils\";\nimport { Spinner } from \"../../course-builder/sub-components/spinner\";\nimport { HttpError } from \"kedbackend/client\";\nimport { isTeacherAtSchool } from \"../../../access-control\";\nimport { GooglePicker } from \"../../../apis/google-picker\";\nimport { DriveButton, Button } from \"../../../apis/buttons\";\nimport { GoogleDrive } from \"../../../apis/google-drive\";\nimport { GoogleClassroom } from \"../../../apis/google-classroom\";\nimport { SubmissionListings } from \"../subcomponents/classroom-assignments-listing\";\nimport { FileView } from \"../subcomponents/task-fileview\";\nimport moment from \"moment\";\nvar ClassroomAssignments = /** @class */ (function (_super) {\n    tslib_1.__extends(ClassroomAssignments, _super);\n    function ClassroomAssignments(props) {\n        var _this = _super.call(this, props) || this;\n        _this.drive = new GoogleDrive();\n        _this.classroom = new GoogleClassroom();\n        _this.state = {\n            assignment: null,\n            assignments: null,\n            loading: true,\n            loadingMessage: \"Laddar inlämning...\"\n        };\n        return _this;\n    }\n    ClassroomAssignments.prototype.setStatePromised = function (cb) {\n        var _this = this;\n        return new Promise(function (resolve) { return _super.prototype.setState.call(_this, cb, resolve); });\n    };\n    ClassroomAssignments.prototype.componentDidMount = function () {\n        this.load();\n    };\n    ClassroomAssignments.prototype.componentWillReceiveProps = function (nextProps) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var err_1;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 4, , 5]);\n                        if (!(nextProps.task.id !== this.props.task.id ||\n                            nextProps.course.id !== this.props.course.id)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.setStatePromised(function () { return ({\n                                assignment: null,\n                                loading: true\n                            }); })];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.load()];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3: return [3 /*break*/, 5];\n                    case 4:\n                        err_1 = _a.sent();\n                        showError(err_1);\n                        return [3 /*break*/, 5];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.update = function (assignments, assignment) {\n        var retval = tslib_1.__spread([\n            assignment\n        ], assignments.filter(function (_a) {\n            var user = _a.user, filename = _a.filename;\n            return user !== assignment.user || filename !== assignment.filename;\n        }));\n        return retval;\n    };\n    ClassroomAssignments.prototype.load = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, taskId, templateFile, _b, courseId, school, teacherAtSchool, res, submissions_1, refreshableAssigments_1, assignments, error_1;\n            var _this = this;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _c.trys.push([0, 5, , 6]);\n                        _a = this.props.task, taskId = _a.id, templateFile = _a.templateFile;\n                        _b = this.props.course, courseId = _b.id, school = _b.school;\n                        teacherAtSchool = isTeacherAtSchool(env.currentUser, school);\n                        return [4 /*yield*/, this.classroom.getSubmissions(courseId, taskId, teacherAtSchool, !!templateFile)];\n                    case 1:\n                        res = _c.sent();\n                        submissions_1 = res.submissions;\n                        refreshableAssigments_1 = [];\n                        return [4 /*yield*/, (teacherAtSchool\n                                ? env.kedBackendClient.http.get(\"assignments/\" + school + \"/\" + courseId + \"/\" + taskId)\n                                : env.kedBackendClient.http.get(\"assignments/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + env.currentUser.mail))\n                                .then(function (resp) {\n                                if (resp.ok)\n                                    return resp.json();\n                                return [];\n                            })\n                                .then(function (res) {\n                                return res.map(function (assignment) {\n                                    var e_1, _a;\n                                    if (!assignment.metadata || !assignment.metadata.driveFileId)\n                                        return assignment;\n                                    var urkundResponse = assignment.metadata.urkundResponse\n                                        ? JSON.parse(assignment.metadata.urkundResponse)\n                                        : false;\n                                    // urkund\n                                    if (!assignment.metadata.urkundUploadError && // Not possible to refresh if upload has failed\n                                        (!assignment.metadata.urkundLastPoll || // Never checked status yet\n                                            (urkundResponse &&\n                                                urkundResponse[0].Status.State &&\n                                                [\"Accepted\", \"Submitted\"].indexOf(urkundResponse[0].Status.State) >= 0 &&\n                                                parseInt(assignment.metadata.urkundLastPoll) <\n                                                    moment()\n                                                        .add(-15, \"seconds\")\n                                                        .toDate()\n                                                        .getTime()))\n                                    // Checked status for a long time ago\n                                    )\n                                        refreshableAssigments_1.push(assignment);\n                                    // add submission data\n                                    var submission = submissions_1.filter(function (sub) { return sub.userEmail == assignment.user; });\n                                    var _loop_1 = function (sub) {\n                                        if (!sub.assignmentSubmission.attachments)\n                                            return \"continue\";\n                                        sub.assignmentSubmission.attachments.forEach(function (attachment) {\n                                            if (attachment.driveFile.id == assignment.metadata.driveFileId) {\n                                                assignment.inClassroom = true;\n                                                assignment.submissionId = sub.id;\n                                            }\n                                        });\n                                    };\n                                    try {\n                                        for (var submission_1 = tslib_1.__values(submission), submission_1_1 = submission_1.next(); !submission_1_1.done; submission_1_1 = submission_1.next()) {\n                                            var sub = submission_1_1.value;\n                                            _loop_1(sub);\n                                        }\n                                    }\n                                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                                    finally {\n                                        try {\n                                            if (submission_1_1 && !submission_1_1.done && (_a = submission_1.return)) _a.call(submission_1);\n                                        }\n                                        finally { if (e_1) throw e_1.error; }\n                                    }\n                                    return assignment;\n                                });\n                            })];\n                    case 2:\n                        assignments = _c.sent();\n                        res.submissions = submissions_1;\n                        this.setState({\n                            error: null,\n                            loading: false,\n                            assignments: assignments,\n                            assignment: res\n                        });\n                        if (!teacherAtSchool) return [3 /*break*/, 4];\n                        return [4 /*yield*/, Promise.all(refreshableAssigments_1.map(function (a) { return tslib_1.__awaiter(_this, void 0, void 0, function () { return tslib_1.__generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, this.refreshAssignment(a)];\n                                    case 1: return [2 /*return*/, _a.sent()];\n                                }\n                            }); }); }))];\n                    case 3:\n                        _c.sent();\n                        _c.label = 4;\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        error_1 = _c.sent();\n                        this.setState({\n                            loading: false,\n                            error: \"Kunde inte ladda inl\\u00E4mningsuppgifter\",\n                            assignment: null\n                        });\n                        console.error(error_1);\n                        return [3 /*break*/, 6];\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.verifyAndUpload = function (file, driveFile, user, name) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var error_2;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 3, , 4]);\n                        if (!file)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, this.upload(file, driveFile, user, name)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.load()];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_2 = _a.sent();\n                        console.error(error_2);\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.upload = function (file, driveFile, user, name) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, taskId, sendToUrkund, _b, courseId, school, body, queryParams, res, _c, _d;\n            return tslib_1.__generator(this, function (_e) {\n                switch (_e.label) {\n                    case 0:\n                        _a = this.props.task, taskId = _a.id, sendToUrkund = _a.sendToUrkund;\n                        _b = this.props.course, courseId = _b.id, school = _b.school;\n                        body = new FormData();\n                        body.append(\"files\", file);\n                        queryParams = {\n                            userDisplayName: name,\n                            verifyWithUrkund: sendToUrkund === undefined ? true : sendToUrkund\n                        };\n                        if (driveFile) {\n                            queryParams = tslib_1.__assign({}, queryParams, { driveFileId: driveFile.fileId, driveFileUrl: driveFile.url, driveFileIconUrl: driveFile.iconUrl });\n                        }\n                        return [4 /*yield*/, env.kedBackendClient.http.fetch(\"assignments/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + user, \"put\", {}, queryParams, {\n                                body: body\n                            })];\n                    case 1:\n                        res = _e.sent();\n                        if (!(res.status !== 200)) return [3 /*break*/, 3];\n                        _c = HttpError.bind;\n                        _d = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_c.apply(HttpError, _d.concat([_e.sent()])))();\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.reclaimSubmission = function (submission) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!confirm(\"Är du säker på att du vill återta uppgiften?\"))\n                            return [2 /*return*/];\n                        this.setState({ loading: true, loadingMessage: \"Återtar inlämning...\" });\n                        return [4 /*yield*/, this.classroom.reclaimSubmission(submission)];\n                    case 1:\n                        _a.sent();\n                        // should we check for erorrs etc?\n                        return [4 /*yield*/, this.load()];\n                    case 2:\n                        // should we check for erorrs etc?\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.handInSubmission = function (submission, onlyKedBackend) {\n        if (onlyKedBackend === void 0) { onlyKedBackend = false; }\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!confirm(\"Är du säker på att du vill lämna in?\"))\n                            return [2 /*return*/];\n                        this.setState({ loading: true, loadingMessage: \"Lämnar in uppgiften...\" });\n                        // send files to urkund via kedbackend\n                        if (this.props.task.sendToUrkund) {\n                            this.sendSubmissionToKedBackend(submission, env.currentUser.displayName);\n                        }\n                        if (!!onlyKedBackend) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.classroom.handInSubmission(submission)];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2: \n                    // if additional files these have to be added before handing in\n                    // should we check for erorrs etc?\n                    return [4 /*yield*/, this.load()];\n                    case 3:\n                        // if additional files these have to be added before handing in\n                        // should we check for erorrs etc?\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.sendSubmissionToKedBackend = function (submission, name) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var assignmentFiles, driveFiles, urkundFiles;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        assignmentFiles = submission.assignmentSubmission.attachments.map(function (sub) {\n                            return sub.driveFile;\n                        });\n                        return [4 /*yield*/, Promise.all(assignmentFiles.map(function (file) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                                var driveFile;\n                                return tslib_1.__generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.drive.getFile(file.id)];\n                                        case 1:\n                                            driveFile = _a.sent();\n                                            return [2 /*return*/, driveFile];\n                                    }\n                                });\n                            }); }))];\n                    case 1:\n                        driveFiles = _a.sent();\n                        return [4 /*yield*/, Promise.all(driveFiles.map(function (file) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                                var selectedFile, urkundFile;\n                                return tslib_1.__generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0:\n                                            selectedFile = tslib_1.__assign({}, file, { canExport: file.mimeType.includes(\"google-apps\") });\n                                            return [4 /*yield*/, this.drive.downloadFile({\n                                                    file: selectedFile,\n                                                    mimeType: \"text/plain\"\n                                                })];\n                                        case 1:\n                                            urkundFile = _a.sent();\n                                            return [2 /*return*/, { file: selectedFile, data: urkundFile }];\n                                    }\n                                });\n                            }); }))];\n                    case 2:\n                        urkundFiles = _a.sent();\n                        // send to kedbackend\n                        return [4 /*yield*/, Promise.all(urkundFiles.map(function (file) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                                return tslib_1.__generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.verifyAndUpload(file.data, file.file, submission.userEmail, name)];\n                                        case 1:\n                                            _a.sent();\n                                            return [2 /*return*/];\n                                    }\n                                });\n                            }); }))];\n                    case 3:\n                        // send to kedbackend\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.addFilesToSubmission = function (submission, files) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var error_3;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.setState({\n                            loading: true,\n                            loadingMessage: \"Uppdaterar inlämning med nya filer...\"\n                        });\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.classroom.addFilesToSubmission(submission.courseId, submission.courseWorkId, submission.id, files)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_3 = _a.sent();\n                        console.log(error_3);\n                        showError(\"Du försökte lämna in en fil som du inte äger.\");\n                        return [3 /*break*/, 4];\n                    case 4: return [4 /*yield*/, this.load()];\n                    case 5:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.refreshAssignment = function (assignment) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var client, _a, courseId, school, taskId, user, filename, req, _b, _c, resJson_1, e_2;\n            var _this = this;\n            return tslib_1.__generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        client = env.kedBackendClient.http;\n                        _a = this.props.course, courseId = _a.id, school = _a.school;\n                        taskId = this.props.task.id;\n                        user = assignment.user, filename = assignment.filename;\n                        return [4 /*yield*/, this.setState(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({\n                                    assignments: _this.update(assignments, tslib_1.__assign({}, assignment, { isRefreshing: true }))\n                                });\n                            })];\n                    case 1:\n                        _d.sent();\n                        _d.label = 2;\n                    case 2:\n                        _d.trys.push([2, 8, , 10]);\n                        return [4 /*yield*/, client.get(\"assignments/urkund/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + user + \"/\" + filename)];\n                    case 3:\n                        req = _d.sent();\n                        if (!(req.status >= 400)) return [3 /*break*/, 5];\n                        _b = HttpError.bind;\n                        _c = [void 0, req.status];\n                        return [4 /*yield*/, req.text()];\n                    case 4: throw new (_b.apply(HttpError, _c.concat([_d.sent()])))();\n                    case 5: return [4 /*yield*/, req.text()];\n                    case 6:\n                        resJson_1 = _d.sent();\n                        return [4 /*yield*/, this.setState(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({\n                                    assignments: _this.update(assignments, tslib_1.__assign({}, assignment, { isRefreshing: false, metadata: tslib_1.__assign({}, assignment.metadata, { urkundResponse: resJson_1 }) }))\n                                });\n                            })];\n                    case 7:\n                        _d.sent();\n                        return [3 /*break*/, 10];\n                    case 8:\n                        e_2 = _d.sent();\n                        return [4 /*yield*/, this.setState(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({\n                                    assignments: _this.update(assignments, tslib_1.__assign({}, assignment, { isRefreshing: false, refreshError: e_2 }))\n                                });\n                            })];\n                    case 9:\n                        _d.sent();\n                        return [3 /*break*/, 10];\n                    case 10: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.teacherView = function () {\n        var _a = this.state, assignment = _a.assignment, assignments = _a.assignments;\n        var _b = this.props.task, sendToUrkund = _b.sendToUrkund, templateFile = _b.templateFile;\n        return (React.createElement(React.Fragment, null,\n            React.createElement(\"p\", null, \"H\\u00E4r kan du som l\\u00E4rare se inl\\u00E4mnade arbeten\"),\n            React.createElement(SubmissionListings, { sendToKedbackend: this.sendSubmissionToKedBackend.bind(this), assignments: assignments || [], submissions: assignment ? assignment.submissions : [], hasTemplate: !!templateFile, sendToUrkund: sendToUrkund, courseId: this.props.course.id, taskId: this.props.task.id })));\n    };\n    ClassroomAssignments.prototype.studentView = function () {\n        var _this = this;\n        var _a = this.props.task, sendToUrkund = _a.sendToUrkund, additionalUploads = _a.additionalUploads, templateFile = _a.templateFile;\n        var _b = this.state, assignment = _b.assignment, assignments = _b.assignments, error = _b.error;\n        if (assignment == undefined || assignment.submissions == undefined || assignment.submissions.length == 0) {\n            return React.createElement(\"p\", null, \"Uppgift inte skapad i Classroom \\u00E4nnu. Provaa igen om n\\u00E5gra minuter.\");\n        }\n        var submission = assignment ? assignment.submissions[0] : null;\n        var hasTemplate = !!templateFile;\n        var hasAttachments = submission &&\n            submission.assignmentSubmission.attachments &&\n            submission.assignmentSubmission.attachments.length > 0;\n        var turnedIn = submission && submission.state == \"TURNED_IN\";\n        var returned = submission && submission.state == \"RETURNED\";\n        var inKedBackend = turnedIn && hasAttachments\n            ? !!assignments.find(function (ass) { return ass.submissionId == submission.id; })\n            : false;\n        return (React.createElement(React.Fragment, null,\n            turnedIn ? (!sendToUrkund || (inKedBackend && sendToUrkund) ? (React.createElement(\"p\", null, \"Uppgiften \\u00E4r inl\\u00E4mnad.\")) : (React.createElement(\"p\", null, \"Uppgiften \\u00E4r inl\\u00E4mnad men m\\u00E5ste \\u00E4ven skickas till Urkund\"))) : returned ?\n                (React.createElement(\"p\", null, \"Uppgiften \\u00E4r \\u00E5terl\\u00E4mnad av din l\\u00E4rare.\")) :\n                (React.createElement(\"p\", null,\n                    \"Uppgiften \\u00E4r inte inl\\u00E4mnad\",\n                    submission && submission.state == \"RECLAIMED_BY_STUDENT\"\n                        ? \" (återtagen)\"\n                        : undefined,\n                    \".\")),\n            hasTemplate ? (React.createElement(React.Fragment, null,\n                React.createElement(\"p\", null, \"Dokumentet nedan ska anv\\u00E4ndas till inl\\u00E4mningen.\"),\n                React.createElement(FileView, { size: \"large\", thumbnail: assignment.templateThumbnail, url: assignment.templateFile, label: assignment.templateTitle, title: assignment.templateTitle }))) : (undefined),\n            React.createElement(React.Fragment, null,\n                React.createElement(\"div\", { className: \"btn-group\" },\n                    hasTemplate || hasAttachments ? (!turnedIn ? (React.createElement(Button, { addClass: \"red\", action: function () { return _this.handInSubmission(submission); }, faIcon: \"fas fa-thumbs-up\", label: \"L\\u00E4mna in\" })) : (React.createElement(Button, { action: function () { return _this.reclaimSubmission(submission); }, faIcon: \"fas fa-thumbs-down\", label: \"\\u00C5terta\" }))) : (undefined),\n                    turnedIn && !inKedBackend && sendToUrkund && (React.createElement(Button, { action: function () { return _this.handInSubmission(submission, true); }, label: \"Skicka till urkund\" })),\n                    (!hasTemplate || additionalUploads) && !turnedIn && (React.createElement(DriveButton, { label: additionalUploads ? \"Bifoga filer\" : \"Välj filer\", action: function () {\n                            var picker = new GooglePicker({\n                                upload: true,\n                                multiple: true,\n                                onlyMine: true\n                            });\n                            picker.show().then(function (files) {\n                                _this.addFilesToSubmission(submission, files);\n                                picker.close();\n                            });\n                        } }))),\n                sendToUrkund && (React.createElement(\"p\", null,\n                    \"Uppgiften \",\n                    additionalUploads ? \"och alla bifagde filer \" : \"\",\n                    \"skickas till Urkund.\")),\n                ((additionalUploads &&\n                    submission.assignmentSubmission.attachments.length > 1) ||\n                    (!hasTemplate && hasAttachments)) && (React.createElement(React.Fragment, null,\n                    React.createElement(\"table\", { className: \"task-assignments-table\" },\n                        React.createElement(\"thead\", null,\n                            React.createElement(\"tr\", null,\n                                React.createElement(\"th\", null, \"Bifogade filer\"))),\n                        React.createElement(\"tbody\", null, submission.assignmentSubmission.attachments.map(function (sub, i) {\n                            if (hasTemplate && i == 0)\n                                return undefined;\n                            return (React.createElement(\"tr\", { key: i },\n                                React.createElement(\"td\", null,\n                                    React.createElement(FileView, { size: \"small\", label: sub.driveFile.title, title: sub.driveFile.title, thumbnail: sub.driveFile.thumbnailUrl, url: sub.driveFile.alternateLink }))));\n                        }))),\n                    React.createElement(\"p\", null,\n                        React.createElement(\"em\", null,\n                            \"De bifogade filerna l\\u00E4mnas in samtidigt som uppgiften l\\u00E4mnas in. F\\u00F6r att ta bort bifogade filer m\\u00E5ste du g\\u00E5 via\\u00A0\",\n                            React.createElement(\"a\", { href: submission.alternateLink, target: \"_blank\" }, \"Classroom\"),\n                            \". Obs! Ta inte bort sj\\u00E4lva uppgiftsfilen.\"))))),\n            error && React.createElement(\"p\", { className: \"error\" }, error)));\n    };\n    ClassroomAssignments.prototype.render = function () {\n        if (this.state.loading) {\n            return React.createElement(Spinner, { label: this.state.loadingMessage });\n        }\n        var teacherAtThisSchool = isTeacherAtSchool(env.currentUser, this.props.course.school);\n        return teacherAtThisSchool ? this.teacherView() : this.studentView();\n    };\n    return ClassroomAssignments;\n}(React.Component));\nexport { ClassroomAssignments };\n","import * as React from 'react';\nexport var CourseBanner = function (props) {\n    var title = props.title, backgroundImage = props.backgroundImage, tabs = props.tabs, activeTab = props.activeTab;\n    return React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\n        React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\n            React.createElement(\"div\", { className: \"sv-script-portlet sv-portlet sv-skip-spacer\" },\n                backgroundImage && React.createElement(\"style\", null, \"\\n        .pageHeader {\\n          background-image: url('\" + backgroundImage + \"') !important;\\n        }\\n      \"),\n                React.createElement(\"div\", { className: \"pageHeader\" },\n                    React.createElement(\"a\", null,\n                        React.createElement(\"h1\", null, title)),\n                    React.createElement(\"div\", { className: \"buttonsField\" },\n                        React.createElement(\"div\", { className: \"buttonsContainer\" },\n                            React.createElement(\"div\", { className: \"align-horizontal\" }),\n                            React.createElement(\"div\", { className: 'horizontalMenu' },\n                                React.createElement(\"ul\", null, tabs.map(function (_a, idx) {\n                                    var name = _a.name, key = _a.key, link = _a.link;\n                                    var isActive = activeTab === link;\n                                    return React.createElement(\"li\", { key: key || (typeof name === 'string' ? name : idx), className: isActive ? \"activePage\" : \"\" },\n                                        React.createElement(\"a\", { href: link }, name));\n                                })))))))));\n};\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { arrayToLookup } from '../../../utils/utils';\nimport { KnowledgeRequirementsBox } from \"../subcomponents/knowledge-requirements-table\";\nimport getIncludedIds from '../utils/get-included-ids';\nimport { AbilitiesBox } from \"../subcomponents/abilities-box\";\nimport { CentralContentBox } from \"../subcomponents/central-content-box\";\nimport { LearningGoalsList } from '../subcomponents/learning-goals-list';\nimport { TaskList } from '../subcomponents/task-list';\nimport { getCustomizedTask } from './get-customized-task';\nvar CourseModulePage = /** @class */ (function (_super) {\n    tslib_1.__extends(CourseModulePage, _super);\n    function CourseModulePage(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {};\n        return _this;\n    }\n    CourseModulePage.prototype.render = function () {\n        var _a = this.props, module = _a.module, course = _a.course;\n        var incluedIds = getIncludedIds(module, course);\n        var learningTasks = module.taskIds\n            .map(function (id) { return course.tasks.find(function (t) { return t.id === id; }); })\n            .filter(function (task) { return !!task; })\n            .map(function (task) { return ({\n            id: task.id,\n            task: getCustomizedTask(module, task),\n            course: course,\n            name: task.name,\n            url: \"#\" + encodeURIComponent(module.name.trim()) + \"/\" + task.id,\n            courseName: course.name,\n            learningGoal: task.learningGoal || module.name,\n        }); });\n        var assignmentTasks = learningTasks.filter(function (t) { return t.task && t.task.assignment; });\n        var nonAssignmentTasks = learningTasks.filter(function (t) { return !t.task || !t.task.assignment; });\n        var commonTasks = nonAssignmentTasks.filter(function (t) { return !t.task.learningGoal; });\n        var learningGoals = arrayToLookup(nonAssignmentTasks.filter(function (t) { return !!t.task.learningGoal; }), function (t) { return t.learningGoal; });\n        var includedAbilities = course.abilities.filter(function (a) { return incluedIds[a.id]; });\n        var includedCentralContent = course.centralContent.filter(function (c) { return incluedIds[c.id]; });\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"sv-text-portlet sv-use-margins sv-skip-spacer\" },\n                React.createElement(\"div\", { className: \"sv-text-portlet-content\" },\n                    React.createElement(\"h1\", { className: \"h1\" }, module.name))),\n            React.createElement(\"div\", { className: \"sv-vertical sv-layout\" },\n                React.createElement(\"div\", { dangerouslySetInnerHTML: { __html: module.mandatoryContent } })),\n            (!!module.startWeek || !!module.endWeek) && React.createElement(React.Fragment, null,\n                React.createElement(\"br\", null),\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    React.createElement(\"h3\", null, \"Modulens period\"),\n                    React.createElement(\"div\", { className: \"week-period-div\" },\n                        React.createElement(\"div\", null, \"Startvecka\"),\n                        React.createElement(\"div\", null, module.startWeek || \"--\"),\n                        React.createElement(\"div\", null, \"Slutvecka\"),\n                        React.createElement(\"div\", null, module.endWeek || \"--\")),\n                    React.createElement(\"br\", null))),\n            Object.keys(incluedIds).length > 0 && React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    React.createElement(\"h3\", null, \"Modulens kunskapskrav, f\\u00F6rm\\u00E5gor och centrala inneh\\u00E5ll\"),\n                    React.createElement(\"hr\", null),\n                    Object.keys(incluedIds).length > 0 && React.createElement(KnowledgeRequirementsBox, { title: \"I den h\\u00E4r modulen bed\\u00F6ms f\\u00F6ljande kunskapskrav\", requirements: course.knowledgeRequirements, includedIds: incluedIds }),\n                    includedAbilities.length > 0 && React.createElement(AbilitiesBox, { title: \"Den h\\u00E4r modulen behandlar f\\u00F6ljande f\\u00F6rm\\u00E5gor\", abilities: includedAbilities }),\n                    includedCentralContent.length > 0 && React.createElement(CentralContentBox, { title: \"Den h\\u00E4r modulen behandlar f\\u00F6ljande centrala inneh\\u00E5ll\", centralContent: includedCentralContent }))),\n            module.taskIds.length > 0 && React.createElement(\"div\", { className: \"sv-script-portlet sv-portlet\" },\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    assignmentTasks.length === 0 ? undefined : React.createElement(React.Fragment, null,\n                        React.createElement(\"h2\", null, \"Inl\\u00E4mningsuppgifter\"),\n                        React.createElement(\"hr\", null),\n                        React.createElement(TaskList, { learningTasks: assignmentTasks })),\n                    nonAssignmentTasks.length === 0 ? undefined : React.createElement(React.Fragment, null,\n                        React.createElement(\"h2\", null, \"Uppgifter\"),\n                        React.createElement(\"hr\", null),\n                        React.createElement(LearningGoalsList, { commonTasks: commonTasks, learningGoals: Object.keys(learningGoals).map(function (learningGoal) { return ({\n                                name: learningGoal,\n                                learningTasks: learningGoals[learningGoal]\n                            }); }) })))),\n            module.resources.length > 0 && React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    React.createElement(\"h2\", null, \"Resurser\"),\n                    React.createElement(\"hr\", null),\n                    React.createElement(\"div\", { className: \"taskContainer\" }, module.resources.map(function (r, idx) {\n                        return React.createElement(\"div\", { className: \"align-horizontal\", key: idx },\n                            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                React.createElement(\"a\", { href: r.url }, r.name)));\n                    })))));\n    };\n    return CourseModulePage;\n}(React.Component));\nexport { CourseModulePage };\n","import * as tslib_1 from \"tslib\";\nexport function getCustomizedTask(module, task) {\n    return module.taskCustomizations ? tslib_1.__assign({}, task, module.taskCustomizations[task.id]) :\n        task;\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { CourseBanner } from \"./course-banner\";\nimport { CourseModulePage } from './course-module-page';\nimport { RunUpPage } from './run-up-page';\nimport { initManualScrollRestoration, restoreScrollPosition } from '../utils/manual-scroll-restoration';\nimport { hasWriteAccess, preserveImpersonationQuery } from '../../../access-control';\nimport { WeekPlanner } from \"../../weekplanner\";\nimport { TaskPage } from \"./task-page\";\nimport { getCustomizedTask } from './get-customized-task';\nimport env from '../../../globals/KED.env';\ninitManualScrollRestoration();\nvar CoursePage = /** @class */ (function (_super) {\n    tslib_1.__extends(CoursePage, _super);\n    function CoursePage(props) {\n        var _this = _super.call(this, props) || this;\n        _this.onHashChange = _this.onHashChange.bind(_this);\n        var _a = _this.getModuleAndTaskFromHash(), module = _a.module, task = _a.task;\n        _this.state = {\n            module: module,\n            task: task\n        };\n        return _this;\n    }\n    CoursePage.prototype.getModuleAndTaskFromHash = function () {\n        var split = (location.hash.substr(1) || \"\").split('/');\n        if (split.length > 0 && !split[0])\n            split = split.slice(1); // Allow leading slash #/module/task\n        var _a = tslib_1.__read(split.map(function (part) { return decodeURIComponent(part); }), 2), moduleName = _a[0], taskId = _a[1];\n        var module = this.props.course.modules\n            .filter(function (m) { return (m.name || \"\")\n            .trim().toLowerCase() === (moduleName || \"\").trim().toLowerCase(); })[0] || null;\n        var task = taskId ?\n            this.props.course.tasks.find(function (t) { return t.id === taskId; }) || null :\n            null;\n        if (task && !module) {\n            // Resolve module by finding the module that holds the task:\n            module = this.getOrderedModules()\n                .filter(function (m) { return m.taskIds\n                .some(function (taskId) { return task.id === taskId; }); })[0];\n        }\n        if (task && module) {\n            task = getCustomizedTask(module, task);\n        }\n        return { module: module, task: task };\n    };\n    CoursePage.prototype.componentDidMount = function () {\n        window.addEventListener('hashchange', this.onHashChange);\n    };\n    CoursePage.prototype.componentWillUnmount = function () {\n        window.removeEventListener('hashchange', this.onHashChange);\n    };\n    CoursePage.prototype.onHashChange = function () {\n        var _a = this.getModuleAndTaskFromHash(), module = _a.module, task = _a.task;\n        this.setState({\n            module: module,\n            task: task\n        }, function () {\n            var fallbackScrollPosition = undefined;\n            if (task) {\n                var taskAnchor = document.getElementById('ked-task-anchor');\n                if (taskAnchor)\n                    fallbackScrollPosition = (window.pageYOffset + taskAnchor.getBoundingClientRect().top);\n                else\n                    fallbackScrollPosition = 0;\n            }\n            restoreScrollPosition({ fallbackScrollPosition: fallbackScrollPosition });\n        });\n    };\n    CoursePage.prototype.getOrderedModules = function () {\n        var course = this.props.course;\n        var moduleOrder = course.moduleOrder || course.modules.map(function (m) { return m.id; });\n        return moduleOrder\n            // Map ordered id to module\n            .map(function (id) { return course.modules.find(function (m) { return m.id === id && !m.inactive; }); })\n            // Ignore entries that only exists in moduleOrder but not in modules\n            .filter(function (m) { return !!m; })\n            // Append modules at end that are not listed in moduleOrder\n            .concat(course.modules.filter(function (m) { return !moduleOrder.find(function (id) { return m.id === id; }); }));\n    };\n    CoursePage.prototype.render = function () {\n        var _a = this.props, course = _a.course, courseBuilderUrl = _a.courseBuilderUrl;\n        var _b = this.state, module = _b.module, task = _b.task;\n        var orderedModules = this.getOrderedModules();\n        return React.createElement(\"div\", null,\n            React.createElement(CourseBanner, { title: course.name + \" - \" + course.points + \"p\", backgroundImage: (course.images.find(function (img) { return img.id === course.imageId; }) || { url: '' }).url, tabs: [{ name: \"Upptakt\", link: \"#\", key: \"Upptakt\" }]\n                    .concat(orderedModules.map(function (_a) {\n                    var name = _a.name;\n                    return ({ name: name, link: \"#\" + encodeURIComponent(name), key: name });\n                }))\n                    .concat(course.workFlowLink ? [{\n                        name: \"Arbetsgång\",\n                        key: \"workflow\",\n                        link: course.workFlowLink\n                    }] : [])\n                    .concat(hasWriteAccess(env.currentUser, course) ? [{\n                        name: React.createElement(\"span\", null,\n                            React.createElement(\"i\", { className: \"fas fa-pencil-alt\", \"aria-hidden\": \"true\" }),\n                            \" Redigera denna kurs\"),\n                        key: \"edit\",\n                        link: preserveImpersonationQuery(courseBuilderUrl, {}) + \"#/courses/\" + course.id + \"/edit\"\n                    }] : []), activeTab: module ? \"#\" + encodeURIComponent(module.name) : \"#\" }),\n            React.createElement(\"div\", { className: \"sv-row sv-layout\" },\n                React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\n                    React.createElement(\"div\", { className: \"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\" },\n                        React.createElement(\"div\", { className: \"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\" },\n                            React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\n                                React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-7\" }, task ?\n                                    React.createElement(TaskPage, { task: task, course: course }) :\n                                    module ?\n                                        React.createElement(CourseModulePage, { course: course, module: module }) :\n                                        React.createElement(RunUpPage, { course: course })),\n                                React.createElement(\"div\", { className: \"sv-layout sv-column-5\" },\n                                    React.createElement(\"div\", { className: \"sv-vertical sv-layout sv-skip-spacer\" },\n                                        React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                                            React.createElement(WeekPlanner, { viewCourseUrl: '', env: env }))))))))));\n    };\n    return CoursePage;\n}(React.Component));\nexport { CoursePage };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\n// Views\nimport { AbilitiesBox } from '../subcomponents/abilities-box';\nimport { CentralContentBox } from '../subcomponents/central-content-box';\nimport { KnowledgeRequirementsBox } from '../subcomponents/knowledge-requirements-table';\nimport { ResourceList } from '../subcomponents/resource-list';\nvar RunUpPage = /** @class */ (function (_super) {\n    tslib_1.__extends(RunUpPage, _super);\n    function RunUpPage(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {};\n        return _this;\n    }\n    RunUpPage.prototype.render = function () {\n        var course = this.props.course;\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                course.runUpText && React.createElement(\"div\", null,\n                    React.createElement(\"h1\", null, \"Upptakt\"),\n                    React.createElement(\"p\", { className: \"normal\", dangerouslySetInnerHTML: { __html: course.runUpText } })),\n                course.responsibleTeachers && course.responsibleTeachers.length > 0 && React.createElement(\"div\", null,\n                    React.createElement(\"h2\", null, \"L\\u00E4rare\"),\n                    course.responsibleTeachers.map(function (teacher, i) {\n                        return React.createElement(\"p\", { key: i },\n                            React.createElement(\"a\", { href: interpretTeacherUrl(teacher.email || teacher.url || '') }, teacher.name));\n                    })),\n                course.workFlowLink && React.createElement(\"a\", { className: \"btn\", href: course.workFlowLink }, \"Arbetsg\\u00E5ng\"),\n                React.createElement(\"br\", null),\n                React.createElement(\"br\", null),\n                course.abilities.length > 0 && React.createElement(AbilitiesBox, { title: \"\\u00C4mnets f\\u00F6rm\\u00E5gor\", subTitle: \"F\\u00F6rm\\u00E5gor\", abilities: course.abilities, className: \"larger\" }),\n                course.centralContent.length > 0 && React.createElement(CentralContentBox, { title: \"Kursens centrala inneh\\u00E5ll\", subTitle: \"Centralt inneh\\u00E5ll\", centralContent: course.centralContent, className: \"larger\" }),\n                course.knowledgeRequirements.length > 0 && React.createElement(KnowledgeRequirementsBox, { title: \"Kursens kunskapskrav\", requirements: course.knowledgeRequirements, className: \"larger\" })),\n            course.resources.length > 0 && React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    React.createElement(\"h2\", null, \"Resurser\"),\n                    React.createElement(\"hr\", null),\n                    React.createElement(ResourceList, { resources: course.resources }))));\n    };\n    return RunUpPage;\n}(React.Component));\nexport { RunUpPage };\nfunction interpretTeacherUrl(url) {\n    if (url.indexOf(':') === -1 && url.indexOf('@') >= 0)\n        return \"mailto:\" + url;\n    return url;\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport moment from 'moment';\nimport { Spinner } from '../../course-builder/sub-components/spinner';\nimport env from '../../../globals/KED.env';\nimport { features } from '../../../features';\nimport { FileView } from '../subcomponents/task-fileview';\nimport { downloadFile, getUrkundStatus } from './task-assignments-utils';\nvar TaskAssignmentsTable = /** @class */ (function (_super) {\n    tslib_1.__extends(TaskAssignmentsTable, _super);\n    function TaskAssignmentsTable(props) {\n        return _super.call(this, props) || this;\n    }\n    TaskAssignmentsTable.prototype.render = function () {\n        var _a = this.props, loading = _a.loading, files = _a.files, usersNotHandedInDocs = _a.usersNotHandedInDocs, taskDeadline = _a.taskDeadline, teacherAtThisSchool = _a.teacherAtThisSchool, refreshAssignment = _a.refreshAssignment, sendToUrkund = _a.sendToUrkund, deleteAssignment = _a.deleteAssignment;\n        var hasOwnDocs = files.some(function (file) { return file.user === env.currentUser.mail; });\n        return loading ? React.createElement(Spinner, { label: \"Laddar inl\\u00E4mnade filer...\" }) : files.length === 0 && !usersNotHandedInDocs ?\n            (teacherAtThisSchool ? React.createElement(\"p\", null, \"Ingen elev har l\\u00E4mnat in n\\u00E5got arbete \\u00E4nnu.\") : null)\n            : (teacherAtThisSchool ? getTeacherView(files, hasOwnDocs, usersNotHandedInDocs, taskDeadline, refreshAssignment, sendToUrkund, deleteAssignment) : getStudentView(files, hasOwnDocs, deleteAssignment));\n    };\n    return TaskAssignmentsTable;\n}(React.Component));\nexport { TaskAssignmentsTable };\nfunction getTeacherView(files, hasOwnDocs, usersNotHandedInDocs, taskDeadline, refreshAssignment, sendToUrkund, deleteAssignment) {\n    return React.createElement(React.Fragment, null,\n        files.length > 0 && React.createElement(React.Fragment, null,\n            features.studyGroups && React.createElement(\"p\", null, \"Uploaded assignments\"),\n            React.createElement(\"table\", { className: \"task-assignments-table\" },\n                React.createElement(\"thead\", null,\n                    React.createElement(\"tr\", null,\n                        React.createElement(\"th\", null, \"Elev\"),\n                        React.createElement(\"th\", null, \"Filnamn\"),\n                        React.createElement(\"th\", null, \"Inl\\u00E4mnat den\"),\n                        React.createElement(\"th\", null, \"Rapport\"),\n                        React.createElement(\"th\", null, \"Niv\\u00E5\"),\n                        hasOwnDocs && React.createElement(\"th\", null))),\n                React.createElement(\"tbody\", null, files.map(function (file) { return React.createElement(\"tr\", { key: file.mediaLink, style: file.metadata.$meta ? { opacity: 0.5 } : {} },\n                    React.createElement(React.Fragment, null,\n                        React.createElement(\"td\", null,\n                            React.createElement(\"a\", { href: \"mailto:\" + file.user }, file.metadata.userDisplayName || file.user)),\n                        React.createElement(\"td\", null, file.metadata.driveFileId ?\n                            // The file can be edited on drive. Link to editing it.\n                            React.createElement(FileView, { thumbnail: file.metadata.driveFileIconUrl, title: file.filename.substr(0, file.filename.lastIndexOf('.')), url: file.metadata.driveFileUrl }) :\n                            // The file cannot be edited on drive. Link to downloading it.\n                            React.createElement(FileView, { customAction: function (ev) {\n                                    ev.preventDefault();\n                                    ev.stopPropagation();\n                                    downloadFile(file);\n                                }, title: file.filename })),\n                        React.createElement(\"td\", { className: \"assignment-date-col\" }, moment(file.uploadDate).format('YYYY-MM-DD HH:mm')),\n                        file.metadata.$meta === 'add' ?\n                            React.createElement(\"td\", { colSpan: 2 },\n                                React.createElement(Spinner, { label: \"Laddar upp...\" })) :\n                            file.metadata.$meta === 'delete' ?\n                                React.createElement(\"td\", { colSpan: 2 },\n                                    React.createElement(Spinner, null),\n                                    \" Tar bort...\") :\n                                getUrkundStatus(file, refreshAssignment, sendToUrkund)),\n                    hasOwnDocs && getDeleteOwnDocsColumn(file, deleteAssignment)); })))),\n        React.createElement(\"br\", null),\n        usersNotHandedInDocs && usersNotHandedInDocs.length > 0 && getStudentNotHandedInAssignment(usersNotHandedInDocs, taskDeadline));\n}\nfunction getStudentView(files, hasOwnDocs, deleteAssignments) {\n    return React.createElement(\"table\", { className: \"task-assignments-table\" },\n        React.createElement(\"thead\", null,\n            React.createElement(\"tr\", null,\n                React.createElement(\"th\", null, \"Filnamn\"),\n                React.createElement(\"th\", null, \"Inl\\u00E4mnat den\"),\n                hasOwnDocs && React.createElement(\"th\", null))),\n        React.createElement(\"tbody\", null, files.map(function (file) {\n            return React.createElement(\"tr\", { key: file.mediaLink, style: file.metadata.$meta ? { opacity: 0.5 } : {} },\n                React.createElement(\"td\", null, file.metadata.driveFileId ?\n                    // The file can be edited on drive. Link to editing it.\n                    React.createElement(FileView, { thumbnail: file.metadata.driveFileIconUrl, title: file.filename.substr(0, file.filename.lastIndexOf('.')), url: file.metadata.driveFileUrl }) :\n                    // The file cannot be edited on drive. Link to downloading it.\n                    React.createElement(FileView, { customAction: function (ev) {\n                            ev.preventDefault();\n                            ev.stopPropagation();\n                            downloadFile(file);\n                        }, title: file.filename })),\n                React.createElement(\"td\", { className: \"assignment-date-col\" }, file.metadata.$meta === 'add' ?\n                    React.createElement(Spinner, { label: \"Laddar upp...\" }) :\n                    file.metadata.$meta === 'delete' ?\n                        React.createElement(Spinner, { label: \"Tar bort...\" }) :\n                        moment(file.uploadDate).format('YYYY-MM-DD HH:mm')),\n                hasOwnDocs && getDeleteOwnDocsColumn(file, deleteAssignments));\n        })));\n}\nfunction getDeleteOwnDocsColumn(file, deleteAssignment) {\n    return React.createElement(\"td\", null, !file.metadata.$meta && file.user === env.currentUser.mail &&\n        React.createElement(\"a\", { href: \"#\", onClick: function (ev) {\n                ev.stopPropagation();\n                ev.preventDefault();\n                if (confirm(\"Radera inl\\u00E4mnad fil \" + file.filename + \"?\"))\n                    deleteAssignment(file.mediaLink);\n            } },\n            React.createElement(\"i\", { className: \"fas fa-trash-alt\" })));\n}\nfunction getStudentNotHandedInAssignment(usersNotHandedInDocs, taskDeadline) {\n    return React.createElement(React.Fragment, null,\n        features.studyGroups && React.createElement(\"p\", null, \"Not handed in assignments\"),\n        React.createElement(\"table\", { className: \"task-assignments-table\" },\n            React.createElement(\"thead\", null,\n                React.createElement(\"tr\", null,\n                    React.createElement(\"th\", null, \"Elev\"),\n                    React.createElement(\"th\", null, \"Task deadline\"))),\n            React.createElement(\"tbody\", null, usersNotHandedInDocs.map(function (user) {\n                return React.createElement(\"tr\", { key: user.displayName, style: { opacity: 0.5 } },\n                    React.createElement(\"td\", null,\n                        React.createElement(\"a\", { href: \"mailto:\" + user.email }, user.displayName)),\n                    React.createElement(\"td\", null,\n                        \" \",\n                        taskDeadline,\n                        \" \"));\n            }))),\n        React.createElement(\"br\", null));\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { HttpError } from 'kedbackend/client';\nimport { env } from '../../../globals/KED.env';\nimport download from 'downloadjs';\nimport { Spinner } from '../../course-builder/sub-components/spinner';\nimport { getUrkundHoverText, getUrkundStatusClass, getUrkundSignificanceClass } from './urkund-utils';\nexport function getUrkundStatus(file, refreshAssignment, checkWithUrkund) {\n    var metadata = file.metadata;\n    var urkundResponses;\n    try {\n        urkundResponses = metadata.urkundResponse && JSON.parse(metadata.urkundResponse);\n    }\n    catch (err) {\n        urkundResponses = null;\n    }\n    var urkundResponse = urkundResponses && urkundResponses[0];\n    if (!urkundResponse && file.metadata.urkundUploadError) {\n        urkundResponse = {\n            Status: {\n                ErrorCode: -1,\n                Message: file.metadata.urkundUploadError,\n                State: 'Error'\n            },\n            ExternalId: file.metadata.urkundExternalId\n        };\n    }\n    if (file.isRefreshing)\n        return React.createElement(\"td\", { colSpan: 2 },\n            React.createElement(Spinner, null),\n            \" Uppdaterar...\");\n    return urkundResponse ? React.createElement(React.Fragment, null,\n        React.createElement(\"td\", { className: \"urkund-status-col\" },\n            React.createElement(\"a\", { href: urkundResponse.Report && urkundResponse.Report.ReportUrl, onClick: function (ev) {\n                    if (['Accepted', 'Submitted'].indexOf(urkundResponse.Status.State) === -1)\n                        return; // Follow HREF instead.\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                    checkWithUrkund && refreshAssignment(file);\n                }, target: \"_blank\", title: getUrkundHoverText(urkundResponse) },\n                React.createElement(\"div\", { className: getUrkundStatusClass(urkundResponse) }))),\n        React.createElement(\"td\", { className: \"urkund-status-col\" },\n            React.createElement(\"div\", { className: getUrkundSignificanceClass(urkundResponse) }, urkundResponse.Report && typeof urkundResponse.Report.Significance === 'number' ?\n                urkundResponse.Report.Significance.toFixed() + \"%\" : ' '))) : React.createElement(\"td\", { colSpan: 2 });\n}\nexport function update(assignments, assignment) {\n    var retval = tslib_1.__spread([\n        assignment\n    ], assignments.filter(function (_a) {\n        var user = _a.user, filename = _a.filename;\n        return user !== assignment.user ||\n            filename !== assignment.filename;\n    }));\n    return retval;\n}\nexport function downloadFile(file) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n        var res, _a, _b, blob, err_1;\n        return tslib_1.__generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    _c.trys.push([0, 5, , 6]);\n                    return [4 /*yield*/, env.kedBackendClient.http.fetch(file.mediaLink, 'get', {})];\n                case 1:\n                    res = _c.sent();\n                    if (!(res.status >= 400)) return [3 /*break*/, 3];\n                    _a = HttpError.bind;\n                    _b = [void 0, res.status];\n                    return [4 /*yield*/, res.text()];\n                case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                case 3: return [4 /*yield*/, res.blob()];\n                case 4:\n                    blob = _c.sent();\n                    download(blob, file.filename, file.contentType);\n                    return [3 /*break*/, 6];\n                case 5:\n                    err_1 = _c.sent();\n                    this.setState({ error: \"Kunde inte ladda ned filen. \" + (err_1.message || err_1) });\n                    console.error(err_1);\n                    return [3 /*break*/, 6];\n                case 6: return [2 /*return*/];\n            }\n        });\n    });\n}\nexport function DriveFileListing(_a) {\n    var file = _a.file;\n    var _b = file.metadata, driveFileIconUrl = _b.driveFileIconUrl, driveFileUrl = _b.driveFileUrl;\n    var filename = file.filename.substr(0, file.filename.lastIndexOf('.'));\n    return (React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n        React.createElement(\"div\", { className: \"horizontalItem top\" },\n            React.createElement(\"img\", { className: \"file-icon\", src: driveFileIconUrl })),\n        React.createElement(\"div\", { className: \"horizontalItem top\" },\n            React.createElement(\"span\", null,\n                React.createElement(\"a\", { target: \"_blank\", href: driveFileUrl }, filename)))));\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport env from '../../../globals/KED.env';\nimport { showError, compareProps, flatten } from '../../../utils/utils';\nimport moment from 'moment';\nimport { HttpError } from 'kedbackend/client';\nimport { isTeacherAtSchool } from '../../../access-control';\nimport { isEmployee } from '../../course-builder-ks/logic/is-employee';\nimport { GooglePicker } from '../../../apis/google-picker';\nimport { DriveButton } from \"../../../apis/buttons\";\nimport { features } from '../../../features';\nimport { GoogleDrive } from '../../../apis/google-drive';\nimport { mockTuitionStudents } from '../../../apis/mock/mock-classroom-data';\nimport { TaskAssignmentsTable } from './task-assignments-table';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\nimport { update } from './task-assignments-utils';\nimport { db } from '../../../globals/db';\nvar MAX_URKUND_FILE_SIZE_MB = 50;\nvar MAX_NONURKUND_FILE_SIZE_MB = 100;\nvar ALLOWED_EXTENSIONS = [\n    \".pdf\",\n    \".odt\",\n    \".docx\",\n    \".doc\",\n    \".cad\",\n    \".wav\",\n    \".mp3\",\n    \".mpeg4\",\n    \".mp4\",\n    \".zip\",\n    \".png\",\n    \".jpg\",\n    \".jpeg\",\n    \".gif\",\n    \".txt\",\n    \".html\"\n];\nvar URKUND_EXTENSIONS = [\n    \".pdf\",\n    \".odt\",\n    \".docx\",\n    \".doc\",\n    \".txt\",\n    \".html\"\n];\nvar TaskAssignments = /** @class */ (function (_super) {\n    tslib_1.__extends(TaskAssignments, _super);\n    function TaskAssignments(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            assignments: [],\n            loading: true,\n            studyGroupStudents: []\n        };\n        return _this;\n    }\n    TaskAssignments.prototype.setStatePromised = function (cb) {\n        var _this = this;\n        return new Promise(function (resolve) { return _super.prototype.setState.call(_this, cb, resolve); });\n    };\n    TaskAssignments.prototype.componentDidMount = function () {\n        this.load();\n    };\n    TaskAssignments.prototype.componentWillReceiveProps = function (nextProps) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var err_1;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 4, , 5]);\n                        if (!(nextProps.taskId !== this.props.taskId ||\n                            nextProps.courseId !== this.props.courseId)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.setStatePromised(function () { return ({\n                                assignments: [],\n                                loading: true,\n                                studyGroupStudents: []\n                            }); })];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.load()];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3: return [3 /*break*/, 5];\n                    case 4:\n                        err_1 = _a.sent();\n                        showError(err_1);\n                        return [3 /*break*/, 5];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TaskAssignments.prototype.refreshAssignment = function (assignment) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var client, _a, courseId, taskId, school, user, filename, req, _b, _c, resJson_1, e_1;\n            return tslib_1.__generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        client = env.kedBackendClient.http;\n                        _a = this.props, courseId = _a.courseId, taskId = _a.taskId, school = _a.school;\n                        user = assignment.user, filename = assignment.filename;\n                        return [4 /*yield*/, this.setState(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({\n                                    assignments: update(assignments, tslib_1.__assign({}, assignment, { isRefreshing: true }))\n                                });\n                            })];\n                    case 1:\n                        _d.sent();\n                        _d.label = 2;\n                    case 2:\n                        _d.trys.push([2, 8, , 10]);\n                        return [4 /*yield*/, client.get(\"assignments/urkund/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + user + \"/\" + filename)];\n                    case 3:\n                        req = _d.sent();\n                        if (!(req.status >= 400)) return [3 /*break*/, 5];\n                        _b = HttpError.bind;\n                        _c = [void 0, req.status];\n                        return [4 /*yield*/, req.text()];\n                    case 4: throw new (_b.apply(HttpError, _c.concat([_d.sent()])))();\n                    case 5: return [4 /*yield*/, req.text()];\n                    case 6:\n                        resJson_1 = _d.sent();\n                        return [4 /*yield*/, this.setState(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({\n                                    assignments: update(assignments, tslib_1.__assign({}, assignment, { isRefreshing: false, metadata: tslib_1.__assign({}, assignment.metadata, { urkundResponse: resJson_1 }) }))\n                                });\n                            })];\n                    case 7:\n                        _d.sent();\n                        return [3 /*break*/, 10];\n                    case 8:\n                        e_1 = _d.sent();\n                        return [4 /*yield*/, this.setState(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({\n                                    assignments: update(assignments, tslib_1.__assign({}, assignment, { isRefreshing: false, refreshError: e_1 }))\n                                });\n                            })];\n                    case 9:\n                        _d.sent();\n                        return [3 /*break*/, 10];\n                    case 10: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TaskAssignments.prototype.load = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var client, _a, courseId, taskId, school, courseStudyGroups_1, sendToUrkund, teacherAtSchool, res, _b, _c, assignments, tuitionStudents, schoolObj_1, mockDatasource, emptyOrMock, result, _d, refreshableAssigments, refreshableAssigments_1, refreshableAssigments_1_1, a, e_2_1, error_1;\n            var e_2, _e;\n            var _this = this;\n            return tslib_1.__generator(this, function (_f) {\n                switch (_f.label) {\n                    case 0:\n                        _f.trys.push([0, 18, , 19]);\n                        client = env.kedBackendClient.http;\n                        _a = this.props, courseId = _a.courseId, taskId = _a.taskId, school = _a.school, courseStudyGroups_1 = _a.courseStudyGroups, sendToUrkund = _a.sendToUrkund;\n                        teacherAtSchool = isTeacherAtSchool(env.currentUser, school);\n                        return [4 /*yield*/, (teacherAtSchool ?\n                                client.get(\"assignments/\" + school + \"/\" + courseId + \"/\" + taskId) :\n                                client.get(\"assignments/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + env.currentUser.mail))];\n                    case 1:\n                        res = _f.sent();\n                        if (!(res.status !== 200)) return [3 /*break*/, 3];\n                        _b = HttpError.bind;\n                        _c = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_b.apply(HttpError, _c.concat([_f.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        assignments = _f.sent();\n                        tuitionStudents = [];\n                        if (!(courseStudyGroups_1 && courseStudyGroups_1.length > 0)) return [3 /*break*/, 9];\n                        return [4 /*yield*/, db.schools.name(school).single().load()];\n                    case 5:\n                        schoolObj_1 = _f.sent();\n                        mockDatasource = Object.keys(mockTuitionStudents).filter(function (m) { return courseStudyGroups_1.includes(m); }).map(function (sp) { return mockTuitionStudents[sp]; });\n                        emptyOrMock = school === 'KED' && mockDatasource ? mockDatasource : [];\n                        if (!schoolObj_1.edsSchoolNameGymn) return [3 /*break*/, 7];\n                        return [4 /*yield*/, Promise.all(courseStudyGroups_1.map(function (stGroup) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                                return tslib_1.__generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, env.edsClient.getTuitionGroupStudents({\n                                                schoolName: schoolObj_1.edsSchoolNameGymn,\n                                                tuitionGroupName: stGroup\n                                            })];\n                                        case 1: return [2 /*return*/, _a.sent()];\n                                    }\n                                });\n                            }); }))];\n                    case 6:\n                        _d = _f.sent();\n                        return [3 /*break*/, 8];\n                    case 7:\n                        _d = emptyOrMock;\n                        _f.label = 8;\n                    case 8:\n                        result = _d;\n                        tuitionStudents = flatten(result);\n                        _f.label = 9;\n                    case 9:\n                        this.setState({\n                            error: null,\n                            loading: false,\n                            assignments: assignments,\n                            studyGroupStudents: tuitionStudents\n                        });\n                        if (!(teacherAtSchool && sendToUrkund)) return [3 /*break*/, 17];\n                        refreshableAssigments = assignments.filter(function (a) {\n                            return a.metadata &&\n                                a.metadata.urkundExternalId &&\n                                a.metadata.urkundExternalId.length > 0 && // Must have metadata.urkundExternalId Otherwise not possible to refresh\n                                !a.metadata.urkundUploadError && ( // Not possible to refresh if upload has failed\n                            !a.metadata.urkundLastPoll || // Never checked status yet\n                                (['Accepted', 'Submitted'].indexOf(JSON.parse(a.metadata.urkundResponse)[0].Status.State) >= 0 &&\n                                    parseInt(a.metadata.urkundLastPoll) < moment().add(-15, \"seconds\").toDate().getTime()));\n                        }\n                        // Checked status for a long time ago\n                        );\n                        _f.label = 10;\n                    case 10:\n                        _f.trys.push([10, 15, 16, 17]);\n                        refreshableAssigments_1 = tslib_1.__values(refreshableAssigments), refreshableAssigments_1_1 = refreshableAssigments_1.next();\n                        _f.label = 11;\n                    case 11:\n                        if (!!refreshableAssigments_1_1.done) return [3 /*break*/, 14];\n                        a = refreshableAssigments_1_1.value;\n                        return [4 /*yield*/, this.refreshAssignment(a)];\n                    case 12:\n                        _f.sent();\n                        _f.label = 13;\n                    case 13:\n                        refreshableAssigments_1_1 = refreshableAssigments_1.next();\n                        return [3 /*break*/, 11];\n                    case 14: return [3 /*break*/, 17];\n                    case 15:\n                        e_2_1 = _f.sent();\n                        e_2 = { error: e_2_1 };\n                        return [3 /*break*/, 17];\n                    case 16:\n                        try {\n                            if (refreshableAssigments_1_1 && !refreshableAssigments_1_1.done && (_e = refreshableAssigments_1.return)) _e.call(refreshableAssigments_1);\n                        }\n                        finally { if (e_2) throw e_2.error; }\n                        return [7 /*endfinally*/];\n                    case 17: return [3 /*break*/, 19];\n                    case 18:\n                        error_1 = _f.sent();\n                        this.setState({\n                            loading: false,\n                            error: \"Kunde inte ladda inl\\u00E4mningsuppgifter\",\n                            assignments: []\n                        });\n                        console.error(error_1);\n                        return [3 /*break*/, 19];\n                    case 19: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TaskAssignments.prototype.onDrag = function (ev) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        ev.dataTransfer.dropEffect = 'copy';\n    };\n    TaskAssignments.prototype.verifyAndUpload = function (file, driveFile) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var error_2;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 3, , 4]);\n                        if (!file)\n                            return [2 /*return*/];\n                        if (this.state.assignments.some(function (a) {\n                            return a.user === env.currentUser.mail &&\n                                a.filename === file.name;\n                        })) {\n                            if (!confirm(\"Ers\\u00E4tta befintlig fil (\" + file.name + \")?\")) {\n                                return [2 /*return*/];\n                            }\n                        }\n                        if (this.props.school.toLowerCase() !== env.currentUser.school.toLowerCase()) {\n                            if (!confirm(\"Uppgiften tillh\\u00F6r en annan skola (\" + this.props.school + \").\\n\" +\n                                \"Vill du \\u00E4nd\\u00E5 l\\u00E4mna in ditt arbete h\\u00E4r?\")) {\n                                return [2 /*return*/];\n                            }\n                        }\n                        this.setState({ uploadingFile: file });\n                        return [4 /*yield*/, this.upload(file, driveFile)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.load()];\n                    case 2:\n                        _a.sent();\n                        this.setState({\n                            uploadingFile: null\n                        });\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_2 = _a.sent();\n                        this.setState({\n                            error: \"Kunde inte ladda upp filen. \" + (error_2.message || error_2),\n                            uploadingFile: null\n                        });\n                        console.error(error_2);\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TaskAssignments.prototype.upload = function (file, driveFile) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var client, _a, courseId, taskId, school, sendToUrkund, mail, isUrkundExtension, lowerFilename, body, queryParams, res, _b, _c;\n            return tslib_1.__generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        client = env.kedBackendClient.http;\n                        _a = this.props, courseId = _a.courseId, taskId = _a.taskId, school = _a.school, sendToUrkund = _a.sendToUrkund;\n                        mail = env.currentUser.mail;\n                        isUrkundExtension = URKUND_EXTENSIONS\n                            .indexOf(\".\" + file.name.split('.').reverse()[0].toLowerCase()) >= 0;\n                        if (isUrkundExtension) {\n                            if (file.size > MAX_URKUND_FILE_SIZE_MB * 1024 * 1024) {\n                                throw new Error(\"Filer av denna typ f\\u00E5r inte vara st\\u00F6rre \\u00E4n \" + MAX_URKUND_FILE_SIZE_MB + \" MB\");\n                            }\n                        }\n                        else {\n                            if (file.size > MAX_NONURKUND_FILE_SIZE_MB * 1024 * 1024) {\n                                throw new Error(\"Filen f\\u00E5r inte vara st\\u00F6rre \\u00E4n \" + MAX_NONURKUND_FILE_SIZE_MB + \" MB\");\n                            }\n                        }\n                        lowerFilename = file.name.toLowerCase();\n                        if (!ALLOWED_EXTENSIONS.some(function (ext) { return lowerFilename.endsWith(ext); })) {\n                            throw new Error(\"Filens \\u00E4ndelse m\\u00E5ste vara \" + ALLOWED_EXTENSIONS.join(' / '));\n                        }\n                        body = new FormData();\n                        body.append('files', file);\n                        queryParams = {\n                            userDisplayName: env.currentUser.displayName,\n                            verifyWithUrkund: sendToUrkund\n                        };\n                        if (driveFile) {\n                            queryParams = tslib_1.__assign({}, queryParams, { driveFileId: driveFile.fileId, driveFileUrl: driveFile.url, driveFileIconUrl: driveFile.iconUrl });\n                        }\n                        return [4 /*yield*/, env.kedBackendClient.http.fetch(\"assignments/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + mail, 'put', {}, queryParams, {\n                                body: body\n                            })];\n                    case 1:\n                        res = _d.sent();\n                        if (!(res.status !== 200)) return [3 /*break*/, 3];\n                        _b = HttpError.bind;\n                        _c = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_b.apply(HttpError, _c.concat([_d.sent()])))();\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TaskAssignments.prototype.delete = function (url) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, err_2;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _c.trys.push([0, 6, , 7]);\n                        return [4 /*yield*/, this.setStatePromised(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({ assignments: assignments.map(function (a) { return a.mediaLink === url ? tslib_1.__assign({}, a, { metadata: tslib_1.__assign({}, a.metadata, { $meta: 'delete' }) }) : tslib_1.__assign({}, a); }) });\n                            })];\n                    case 1:\n                        _c.sent();\n                        return [4 /*yield*/, env.kedBackendClient.http.fetch(url, 'delete', {})];\n                    case 2:\n                        res = _c.sent();\n                        if (!(res.status >= 400)) return [3 /*break*/, 4];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 3: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 4: return [4 /*yield*/, this.load()];\n                    case 5:\n                        _c.sent();\n                        return [3 /*break*/, 7];\n                    case 6:\n                        err_2 = _c.sent();\n                        this.setState({ error: \"Kunde inte ta bort filen. \" + (err_2.message || err_2) });\n                        console.error(err_2);\n                        return [3 /*break*/, 7];\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TaskAssignments.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, courseId = _a.courseId, taskId = _a.taskId, school = _a.school, courseStudyGroups = _a.courseStudyGroups, taskDeadline = _a.taskDeadline, sendToUrkund = _a.sendToUrkund;\n        var _b = this.state, loading = _b.loading, assignments = _b.assignments, error = _b.error, uploadingFile = _b.uploadingFile, studyGroupStudents = _b.studyGroupStudents;\n        var teacherAtThisSchool = isTeacherAtSchool(env.currentUser, school);\n        var files = tslib_1.__spread(assignments);\n        var showGooglePicker = features.picker;\n        if (uploadingFile) {\n            var virtualFile_1 = {\n                school: school,\n                courseId: courseId,\n                taskId: taskId,\n                filename: uploadingFile.name,\n                size: uploadingFile.size,\n                user: env.currentUser.mail,\n                contentType: uploadingFile.type,\n                uploadDate: Date.now(),\n                mediaLink: \"assignments/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + env.currentUser.mail + \"/\" + uploadingFile.name,\n                metadata: {\n                    $meta: 'add',\n                    userDisplayName: env.currentUser.displayName\n                }\n            };\n            files = files.filter(function (file) { return file.mediaLink !== virtualFile_1.mediaLink; });\n            files = tslib_1.__spread(files, [virtualFile_1]);\n        }\n        files = files.map(function (s) {\n            var _a = tslib_1.__read((s.metadata.userDisplayName || s.user).split(' ')), firstName = _a[0], rest = _a.slice(1);\n            return tslib_1.__assign({}, s, { firstName: firstName, lastName: rest.join(' ') });\n        }).sort(compareProps([\n            \"lastName\",\n            \"firstName\",\n            \"filename\",\n            \"uploadDate\"\n        ], [\"sv\", \"en\"], { sensitivity: 'base' }));\n        //groupping files by study group\n        var filesStudyGroups = {};\n        var groupByStudyGroup = courseStudyGroups && courseStudyGroups.length > 0 && features.studyGroups && teacherAtThisSchool;\n        courseStudyGroups && courseStudyGroups.forEach(function (courseSg) {\n            //compute study groups files\n            var sgFiles = files.filter(function (file) { return studyGroupStudents.find(function (c) { return c.studentEmailAddress == file.user && courseSg === c.tuitionGroupName; }); });\n            // compute users that have not submitted their assignments\n            var notSubmittedUsers = studyGroupStudents.filter(function (cs) { return !sgFiles.find(function (f) { return f.user === cs.studentEmailAddress; }) && courseSg === cs.tuitionGroupName; })\n                .map(function (ns) { return { displayName: ns.studentFirstName + \" \" + ns.studentLastName, email: ns.studentEmailAddress }; });\n            //sort users\n            notSubmittedUsers = notSubmittedUsers.map(function (s) {\n                var _a = tslib_1.__read(s.displayName.split(' ')), firstName = _a[0], rest = _a.slice(1);\n                return tslib_1.__assign({}, s, { firstName: firstName, lastName: rest.join(' ') });\n            }).sort(compareProps([\"lastName\", \"firstName\"]));\n            filesStudyGroups[courseSg] = { assignments: sgFiles, notSubmittedUsers: notSubmittedUsers };\n        });\n        return (React.createElement(\"div\", { className: \"stopFloats\", onDragOver: function (ev) { return _this.onDrag(ev); }, onDrop: function (ev) {\n                ev.stopPropagation();\n                ev.preventDefault();\n                _this.verifyAndUpload(ev.dataTransfer.files[0]);\n            } },\n            error ? React.createElement(React.Fragment, null,\n                React.createElement(\"p\", { className: \"error\" }, error)) : undefined,\n            groupByStudyGroup ? Object.keys(filesStudyGroups).map(function (key) {\n                return React.createElement(OpenCloseBox, { headerOpen: false, title: key, key: key },\n                    React.createElement(TaskAssignmentsTable, { loading: loading, files: filesStudyGroups[key].assignments, usersNotHandedInDocs: filesStudyGroups[key].notSubmittedUsers, school: school, refreshAssignment: _this.refreshAssignment.bind(_this), deleteAssignment: _this.delete.bind(_this), taskDeadline: taskDeadline, teacherAtThisSchool: teacherAtThisSchool, sendToUrkund: sendToUrkund }));\n            }) :\n                React.createElement(TaskAssignmentsTable, { loading: loading, files: files, school: school, refreshAssignment: this.refreshAssignment.bind(this), deleteAssignment: this.delete.bind(this), teacherAtThisSchool: teacherAtThisSchool, sendToUrkund: sendToUrkund }),\n            isEmployee() ? undefined : React.createElement(React.Fragment, null,\n                React.createElement(\"div\", { className: \"drop-zone task-assignment-drop-zone\" },\n                    \"Droppa ditt f\\u00E4rdiga arbete h\\u00E4r.\",\n                    React.createElement(\"br\", null),\n                    \"Det g\\u00E5r ocks\\u00E5 bra att anv\\u00E4nda bl\\u00E4ddra-knappen nedan.\"),\n                React.createElement(\"input\", { type: \"file\", onChange: function (ev) { return _this.verifyAndUpload(ev.target.files[0]); } }),\n                showGooglePicker && React.createElement(DriveButton, { label: \"H\\u00E4mta fr\\u00E5n Google Drive\", action: function () {\n                        var picker = new GooglePicker({ upload: true });\n                        var drive = new GoogleDrive();\n                        picker.show().then(function (files) {\n                            var pickedFile = files[0];\n                            if (!pickedFile)\n                                return;\n                            drive.downloadFile({\n                                file: pickedFile,\n                                mimeType: \"text/plain\",\n                                limitSize: MAX_NONURKUND_FILE_SIZE_MB\n                            }).then(function (file) { return _this.verifyAndUpload(file, pickedFile); });\n                        });\n                    } }))));\n    };\n    return TaskAssignments;\n}(React.Component));\nexport { TaskAssignments };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { AbilitiesBox } from \"../subcomponents/abilities-box\";\nimport { CentralContentBox } from \"../subcomponents/central-content-box\";\nimport { KnowledgeRequirementsBox } from \"../subcomponents/knowledge-requirements-table\";\nimport { userTasksRepo } from '../../../repos/user-tasks-repo';\nimport { L } from '../../../utils/utils';\nimport { createUUID, DocumentAccess } from 'kedbackend/client';\nimport env from '../../../globals/KED.env';\nimport moment from 'moment';\nimport { TaskAssignments } from './task-assignments';\nimport { isTeacherAtSchool } from '../../../access-control';\nimport { UIAddbox } from '../../utility-components/checkbox';\nimport { ClassroomAssignments } from './classroom-assignments';\nimport { FileView } from '../subcomponents/task-fileview';\nvar TaskPage = /** @class */ (function (_super) {\n    tslib_1.__extends(TaskPage, _super);\n    function TaskPage(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            userTask: undefined,\n            weekPlannerWeek: moment().week()\n        };\n        _this.onUserTasksChanged = _this.onUserTasksChanged.bind(_this);\n        return _this;\n    }\n    TaskPage.prototype.componentDidMount = function () {\n        userTasksRepo.subscribe(this.onUserTasksChanged);\n    };\n    TaskPage.prototype.componentWillUnmount = function () {\n        userTasksRepo.unsubscribe(this.onUserTasksChanged);\n    };\n    TaskPage.prototype.componentWillReceiveProps = function (nextProps) {\n        if (nextProps.task.id !== this.props.task.id) {\n            var userTask = userTasksRepo.mem.items.find(function (ut) { return ut.task && ut.task.length > 0 && ut.task[0].id === nextProps.task.id; }) || null;\n            this.setState({\n                userTask: userTask,\n                weekPlannerWeek: moment(userTasksRepo.persistedState.weekDate).week()\n            });\n        }\n    };\n    TaskPage.prototype.onUserTasksChanged = function (userTasks) {\n        var _this = this;\n        var userTask = userTasks.find(function (ut) { return ut.task && ut.task.length > 0 && ut.task[0].id === _this.props.task.id; }) || null;\n        this.setState({\n            userTask: userTask,\n            weekPlannerWeek: moment(userTasksRepo.persistedState.weekDate).week()\n        });\n    };\n    TaskPage.prototype.toggleTask = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var weekDate, userTask, _a, course, task, module, latestTimeStamp, userTask_1;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        weekDate = userTasksRepo.persistedState.weekDate;\n                        userTask = this.state.userTask;\n                        _a = this.props, course = _a.course, task = _a.task;\n                        module = course.modules.find(function (m) { return m.taskIds.some(function (id) { return id === task.id; }); });\n                        if (!module)\n                            return [2 /*return*/]; // Oh uh!\n                        if (userTask === undefined)\n                            return [2 /*return*/]; // Not yet loaded.\n                        if (!!userTask) return [3 /*break*/, 2];\n                        latestTimeStamp = Math.max.apply(Math.max, [weekDate].concat(userTasksRepo.mem.items.map(function (t) { return t.dateTime; })));\n                        userTask_1 = {\n                            id: createUUID(),\n                            courseName: course.name,\n                            dateTime: latestTimeStamp + 2000,\n                            learningGoal: task.learningGoal || module.name,\n                            name: task.name,\n                            url: task.url,\n                            task: [task],\n                            course: [course],\n                            acl: [\n                                // Default ACL: Let user self have full control over this item:\n                                new DocumentAccess(\"email\", env.currentUser.mail, \"S\"),\n                            ].map(function (ac) { return ac.toString(); })\n                        };\n                        if (task.deadline) {\n                            userTask_1.deadline = task.deadline;\n                        }\n                        return [4 /*yield*/, Promise.all([\n                                userTasksRepo.setWeekPlannerBoxOpen(this.props.course.name, true),\n                                userTasksRepo.insert([userTask_1])\n                            ])];\n                    case 1:\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 2: return [4 /*yield*/, userTasksRepo.delete([userTask.id])];\n                    case 3:\n                        _b.sent();\n                        _b.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TaskPage.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, task = _a.task, course = _a.course;\n        var _b = this.state, userTask = _b.userTask, weekPlannerWeek = _b.weekPlannerWeek;\n        var abilities = task.abilities.map(function (a) { return course.abilities.find(function (ab) { return ab.id === a.id; }); }).filter(function (a) { return !!a; });\n        var centralContent = task.centralContent.map(function (c) { return course.centralContent.find(function (cc) { return cc.id == c.id; }); }).filter(function (c) { return !!c; });\n        var requirements = task.knowledgeRequirements.map(function (k) { return course.knowledgeRequirements.find(function (kr) { return kr.id === k.id; }); }).filter(function (k) { return !!k; });\n        var isWorking = userTask && (userTask.$meta === 'adding' || userTask.$meta === 'deleting');\n        var currentWeek = moment().week();\n        var forWeekString = weekPlannerWeek === currentWeek ? \"loggboken\" :\n            weekPlannerWeek === currentWeek + 1 ? L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"vald vecka (n\\u00E4sta vecka)\"], [\"vald vecka (n\\u00E4sta vecka)\"]))) :\n                weekPlannerWeek === currentWeek - 1 ? L(templateObject_2 || (templateObject_2 = tslib_1.__makeTemplateObject([\"vald vecka (f\\u00F6rra veckan)\"], [\"vald vecka (f\\u00F6rra veckan)\"]))) : L(templateObject_3 || (templateObject_3 = tslib_1.__makeTemplateObject([\"vald vecka (v \", \")\"], [\"vald vecka (v \", \")\"])), weekPlannerWeek);\n        var deadlineTooLate = task.deadline && moment(task.deadline).endOf('day') < moment();\n        if (course.googleCreateClassrooms) {\n            // we have google classroom active\n            if (task.templateFile && task.templateFile.mimeType.includes('google-apps')) {\n                // we have a google apps file so this should be in classroom\n            }\n            else {\n                // we have a template file that is not a google apps file -- should never happen\n            }\n        }\n        return React.createElement(React.Fragment, null,\n            React.createElement(\"h1\", null, task.name),\n            task.content && React.createElement(React.Fragment, null,\n                React.createElement(\"div\", { dangerouslySetInnerHTML: { __html: task.content } })),\n            task.learningGoal && React.createElement(\"div\", null,\n                React.createElement(\"h2\", null, \"Uppgiftens l\\u00E4randem\\u00E5l\"),\n                React.createElement(\"p\", null, task.learningGoal)),\n            task.url && React.createElement(\"a\", { href: task.url, className: \"btn btn-large\" }, \"G\\u00E5 till uppgiften\"),\n            React.createElement(\"br\", null),\n            task.assignment &&\n                React.createElement(\"div\", { className: \"card\" + (deadlineTooLate ? \" warning\" : \"\") },\n                    React.createElement(\"div\", { className: \"card-icon\" },\n                        React.createElement(\"i\", { className: \"fas fa-file-alt\" }),\n                        React.createElement(\"p\", { className: \"card-icon-info\" }, task.deadline ? task.deadline : 'Ingen deadline')),\n                    React.createElement(\"h2\", null, \"Inl\\u00E4mningsuppgift\"),\n                    course.googleCreateClassrooms ? React.createElement(React.Fragment, null,\n                        React.createElement(ClassroomAssignments, { course: course, task: task })) : React.createElement(React.Fragment, null,\n                        isTeacherAtSchool(env.currentUser, course.school) ?\n                            React.createElement(\"p\", null, \"H\\u00E4r kan du som l\\u00E4rare se elevernas inl\\u00E4mnade arbeten.\") : task.templateFile ? React.createElement(React.Fragment, null,\n                            React.createElement(\"p\", null, \"Till den h\\u00E4r uppgiften ska du anv\\u00E4dna f\\u00F6ljande mall:\"),\n                            React.createElement(FileView, { thumbnail: task.templateFile.iconUrl, title: task.templateFile.name, url: task.templateFile.url.substr(0, task.templateFile.url.lastIndexOf('/')) + '/copy' })) : React.createElement(React.Fragment, null,\n                            React.createElement(\"p\", null, \"Det h\\u00E4r \\u00E4r en inl\\u00E4mningsuppgift. L\\u00E4mna in ditt arbete som en pdf, doc eller odt fil genom att dra det till f\\u00E4ltet under. Du kan \\u00E4ven ladda up en fil eller v\\u00E4lja en fil fr\\u00E5n din Google Drive.\"),\n                            task.deadline ? React.createElement(\"p\", null,\n                                React.createElement(\"b\", null,\n                                    \"Den h\\u00E4r uppgiften \",\n                                    deadlineTooLate ? 'skulle ha lämnats in ' : 'ska vara inlämnad ',\n                                    moment(task.deadline).format('YYYY-MM-DD'))) : undefined),\n                        React.createElement(TaskAssignments, { courseId: course.id, taskId: task.id, school: course.school, sendToUrkund: task.sendToUrkund === undefined ? true : task.sendToUrkund, courseStudyGroups: course.studyGroups, taskDeadline: task.deadline }),\n                        React.createElement(\"br\", null))),\n            abilities.length > 0 && React.createElement(AbilitiesBox, { title: \"Den h\\u00E4r uppgiften behandlar f\\u00F6ljande f\\u00F6rm\\u00E5gor\", className: \"larger\", headerOpen: false, abilities: abilities }),\n            centralContent.length > 0 && React.createElement(CentralContentBox, { title: \"Den h\\u00E4r uppgiften behandlar f\\u00F6ljande centrala inneh\\u00E5ll\", className: \"larger\", headerOpen: false, centralContent: centralContent }),\n            requirements.length > 0 && React.createElement(KnowledgeRequirementsBox, { title: \"I den h\\u00E4r uppgiften bed\\u00F6ms f\\u00F6ljande kunskapskrav\", className: \"larger\", headerOpen: false, requirements: requirements }),\n            React.createElement(\"hr\", null),\n            userTask !== undefined && React.createElement(\"div\", { className: \"taskContainer\", style: isWorking ? { opacity: 0.5 } : {} },\n                React.createElement(UIAddbox, { state: userTask && userTask.$meta !== 'deleting' ? 'checked' : '', label: userTask ? L(templateObject_4 || (templateObject_4 = tslib_1.__makeTemplateObject([\"Ta bort uppgiften fr\\u00E5n \", \"\"], [\"Ta bort uppgiften fr\\u00E5n \", \"\"])), forWeekString) : L(templateObject_5 || (templateObject_5 = tslib_1.__makeTemplateObject([\"L\\u00E4gg till uppgiften i \", \"\"], [\"L\\u00E4gg till uppgiften i \", \"\"])), forWeekString), onChange: function () { return !isWorking && _this.toggleTask(); } })),\n            React.createElement(\"hr\", null),\n            task.resources && task.resources.length > 0 && React.createElement(React.Fragment, null,\n                React.createElement(\"h2\", null, \"Resurser kopplade till uppgiften\"),\n                React.createElement(\"div\", { className: \"taskContainer\" }, task.resources.map(function (r, idx) {\n                    return React.createElement(\"div\", { key: idx, className: \"align-horizontal\" },\n                        React.createElement(\"div\", { className: \"horizontalItem top\" },\n                            React.createElement(\"a\", { href: r.url }, r.name)));\n                })),\n                React.createElement(\"br\", null)),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null));\n    };\n    return TaskPage;\n}(React.Component));\nexport { TaskPage };\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5;\n","export function getUrkundStatusClass(res) {\n    if (!res || !res.Status) {\n        return null;\n    }\n    else\n        switch (res.Status.State) {\n            case 'Error':\n                return \"urkund-status urkund-status-error\";\n            case 'Submitted':\n                return \"urkund-status urkund-status-submitted\";\n            case 'Accepted':\n                return \"urkund-status urkund-status-accepted\";\n            case 'Analyzed':\n                return \"urkund-status urkund-status-analyzed\";\n        }\n}\nexport function getUrkundHoverText(res) {\n    if (!res || !res.Status)\n        return null;\n    switch (res.Status.State) {\n        case 'Error':\n            return res.ExternalId ?\n                \"Kunde inte tas emot av urkund. Felkod: \" + res.Status.ErrorCode + \"\\n\" +\n                    (\"External ID: \" + res.ExternalId + \"\\nFelmeddelande: \" + res.Status.Message)\n                :\n                    res.Status.Message;\n        case 'Submitted':\n            return \"Filen \\u00E4r uppladdad till Urkund. Klicka f\\u00F6r att uppdatera status.\";\n        case 'Accepted':\n            return \"Filen analyseras fortfarande av Urkund. Klicka f\\u00F6r att uppdatera status.\";\n        case 'Analyzed':\n            return \"Rapport skapad. Klicka f\\u00F6r att \\u00F6ppna rapporten i nytt f\\u00F6nster\";\n    }\n}\nexport function getUrkundSignificanceClass(res) {\n    if (!res || !res.Status)\n        return '';\n    switch (res.Status.State) {\n        case 'Error': return 'urkund-significance-error';\n        case 'Submitted': return 'urkund-significance-submitted';\n        case 'Accepted': return 'urkund-significance-accepted';\n    }\n    var report = res.Report;\n    if (!report) {\n        return \"\";\n    }\n    if (report.Significance < 1)\n        //return `${cdn}/images/urkund/0.gif`;\n        return \"urkund-significance urkund-significance-0\";\n    if (report.Significance < 10)\n        //return `${cdn}/images/urkund/1.gif`;\n        return \"urkund-significance urkund-significance-1\";\n    if (report.Significance < 25)\n        return \"urkund-significance urkund-significance-2\";\n    //return `${cdn}/images/urkund/2.gif`;\n    if (report.Significance < 40)\n        return \"urkund-significance urkund-significance-3\";\n    //return `${cdn}/images/urkund/3.gif`;\n    if (report.Significance < 55)\n        return \"urkund-significance urkund-significance-4\";\n    //return `${cdn}/images/urkund/4.gif`;\n    if (report.Significance < 70)\n        return \"urkund-significance urkund-significance-5\";\n    //return `${cdn}/images/urkund/5.gif`;\n    if (report.Significance < 85)\n        return \"urkund-significance urkund-significance-6\";\n    //return `${cdn}/images/urkund/6.gif`;\n    if (report.Significance < 99.9)\n        return \"urkund-significance urkund-significance-7\";\n    //return `${cdn}/images/urkund/7.gif`;\n    if (report.Significance >= 99.9)\n        return \"urkund-significance urkund-significance-8\";\n    //return `${cdn}/images/urkund/8.gif`;\n    return \"\";\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { showError } from '../../utils/utils';\nimport { ErrorSuccessFeedback } from '../../utils/error-success-feedback';\nimport { loadCourse } from \"../course-builder/utils\";\nimport { Spinner } from \"../course-builder/sub-components/spinner\";\nimport { CoursePage } from \"./course-page\";\nimport { parseQueryString } from \"../../utils/query-string\";\nimport { ListCoursesPage } from '../list-courses/list-courses-page';\nvar CourseViewer = /** @class */ (function (_super) {\n    tslib_1.__extends(CourseViewer, _super);\n    function CourseViewer(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            course: null,\n            isLoading: true\n        };\n        return _this;\n    }\n    CourseViewer.prototype.componentWillMount = function () {\n        var _this = this;\n        this.load().catch(showError)\n            .then(function () { return _this.setState({ isLoading: false }); });\n    };\n    CourseViewer.prototype.load = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var courseId, course, _a;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        courseId = parseQueryString(location.search)[\"courseId\"];\n                        if (!courseId) return [3 /*break*/, 2];\n                        return [4 /*yield*/, loadCourse(courseId)];\n                    case 1:\n                        _a = _b.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        _a = null;\n                        _b.label = 3;\n                    case 3:\n                        course = _a;\n                        this.setState({ course: course });\n                        document.title =\n                            course ?\n                                course.name + \" - \" + course.points + \"p\" :\n                                \"Kurser\";\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CourseViewer.prototype.render = function () {\n        return React.createElement(\"div\", { className: \"course-viewer\" },\n            this.state.isLoading ?\n                React.createElement(Spinner, null) :\n                this.state.course ?\n                    React.createElement(CoursePage, { course: this.state.course, courseBuilderUrl: this.props.courseBuilderUrl }) :\n                    React.createElement(ListCoursesPage, null),\n            React.createElement(ErrorSuccessFeedback, null));\n    };\n    return CourseViewer;\n}(React.Component));\nexport { CourseViewer };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nvar AbilitiesBox = /** @class */ (function (_super) {\n    tslib_1.__extends(AbilitiesBox, _super);\n    function AbilitiesBox(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            headerOpen: props.headerOpen || false\n        };\n        return _this;\n    }\n    AbilitiesBox.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, title = _a.title, subTitle = _a.subTitle, abilities = _a.abilities, className = _a.className;\n        var headerOpen = this.state.headerOpen;\n        return React.createElement(\"div\", { className: (className || '') + \" openClose\" + (headerOpen ? \" open\" : \"\") },\n            React.createElement(\"div\", { className: \"openHeader\", onClick: function () { return _this.setState({ headerOpen: !_this.state.headerOpen }); } },\n                React.createElement(\"p\", null, title)),\n            React.createElement(\"div\", { className: \"openContent\" },\n                React.createElement(\"div\", { className: \"abilityList\" },\n                    subTitle && React.createElement(\"div\", { className: \"contentHeader\" },\n                        React.createElement(\"h5\", null, subTitle)),\n                    abilities.map(function (a) {\n                        return React.createElement(\"div\", { key: a.id, className: \"contentPart\" },\n                            React.createElement(\"div\", { className: \"contentText\" },\n                                React.createElement(\"p\", { dangerouslySetInnerHTML: { __html: a.name } })));\n                    }))));\n    };\n    return AbilitiesBox;\n}(React.Component));\nexport { AbilitiesBox };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nvar CentralContentBox = /** @class */ (function (_super) {\n    tslib_1.__extends(CentralContentBox, _super);\n    function CentralContentBox(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            headerOpen: props.headerOpen || false\n        };\n        return _this;\n    }\n    CentralContentBox.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, title = _a.title, subTitle = _a.subTitle, centralContent = _a.centralContent, className = _a.className;\n        var headerOpen = this.state.headerOpen;\n        return React.createElement(\"div\", { className: (className || '') + \" openClose\" + (headerOpen ? \" open\" : \"\") },\n            React.createElement(\"div\", { className: \"openHeader\", onClick: function () { return _this.setState({ headerOpen: !_this.state.headerOpen }); } },\n                React.createElement(\"p\", null, title)),\n            React.createElement(\"div\", { className: \"openContent\" },\n                React.createElement(\"div\", { className: \"abilityList\" },\n                    subTitle && React.createElement(\"div\", { className: \"contentHeader\" },\n                        React.createElement(\"h5\", null, subTitle)),\n                    centralContent.map(function (cc) {\n                        return React.createElement(\"div\", { key: cc.id, className: \"contentPart\" },\n                            React.createElement(\"div\", { className: \"contentText\" },\n                                React.createElement(\"p\", { dangerouslySetInnerHTML: { __html: cc.name } })));\n                    }))));\n    };\n    return CentralContentBox;\n}(React.Component));\nexport { CentralContentBox };\n","import * as tslib_1 from \"tslib\";\nimport * as React from \"react\";\nimport { OpenCloseBox } from \"../../utility-components/open-close-box\";\nimport { FileView } from \"./task-fileview\";\nimport { getUrkundHoverText, getUrkundSignificanceClass, getUrkundStatusClass } from \"../course-page/urkund-utils\";\nimport { Button } from \"../../../apis/buttons\";\nimport { env } from \"../../../globals/KED.env\";\nimport { HttpError } from \"kedbackend/client\";\nimport { GoogleClassroom } from \"../../../apis/google-classroom\";\nvar stateMap = {\n    TURNED_IN: \"inlämnad\",\n    RECLAIMED_BY_STUDENT: \"återtagen\",\n    RETURNED: \"återlämnad\",\n    CREATED: \"ej inlämnad\",\n    NEW: \"ej inlämnad\"\n};\nexport var SubmissionListings = function (_a) {\n    var submissions = _a.submissions, assignments = _a.assignments, sendToKedbackend = _a.sendToKedbackend, hasTemplate = _a.hasTemplate, sendToUrkund = _a.sendToUrkund, courseId = _a.courseId, taskId = _a.taskId;\n    var subGroups = {};\n    var assGroups = {};\n    submissions.forEach(function (s) {\n        if (subGroups[s.group])\n            subGroups[s.group].push(s);\n        else\n            subGroups[s.group] = [s];\n    });\n    assignments.forEach(function (a) {\n        var submission = submissions.find(function (sub) { return sub.id == a.submissionId; });\n        if (submission) {\n            if (assGroups[submission.group])\n                assGroups[submission.group].push(a);\n            else\n                assGroups[submission.group] = [a];\n        }\n    });\n    var ClassroomLink = submissions.length > 0 ? submissions[0].crLink.replace('details', 'submissions/by-status/and-sort-last-name/all') : '';\n    return (React.createElement(\"div\", { className: \"stopFloats\" }, Object.keys(subGroups)\n        .sort()\n        .map(function (group, i) {\n        return (React.createElement(OpenCloseBox, { key: i, title: group, children: React.createElement(React.Fragment, null,\n                ClassroomLink !== '' && React.createElement(\"div\", { className: \"pullRight\" },\n                    React.createElement(Button, { url: ClassroomLink, label: 'Visa i Classroom', faIcon: 'fas fa-graduation-cap' })),\n                React.createElement(SubmissionTables, { assignments: assGroups[group] ? assGroups[group] : [], submissions: subGroups[group], hasTemplate: hasTemplate, sendToKedbackend: sendToKedbackend, sendToUrkund: sendToUrkund, courseId: courseId, taskId: taskId })) }));\n    })));\n};\nvar SubmissionTables = /** @class */ (function (_super) {\n    tslib_1.__extends(SubmissionTables, _super);\n    function SubmissionTables(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            submissions: _this.props.submissions,\n            assignments: _this.props.assignments\n        };\n        return _this;\n    }\n    SubmissionTables.prototype.render = function () {\n        var _this = this;\n        var namesort = function (a, b) {\n            var lnCmp = a.name.lastName.localeCompare(b.name.lastName);\n            return lnCmp == 0\n                ? a.name.firstName.localeCompare(b.name.firstName)\n                : lnCmp;\n        };\n        var _a = this.state, submissions = _a.submissions, assignments = _a.assignments;\n        var complete = submissions\n            .filter(function (sub) { return sub.state === \"TURNED_IN\" || sub.state === 'RETURNED'; })\n            .sort(namesort);\n        var incomplete = submissions\n            .filter(function (sub) { return !(sub.state === \"TURNED_IN\" || sub.state === 'RETURNED'); })\n            .sort(namesort);\n        return (React.createElement(React.Fragment, null,\n            \" \",\n            complete.length > 0 && (React.createElement(React.Fragment, null,\n                React.createElement(\"p\", null, \"Inl\\u00E4mnade uppgifter:\"),\n                React.createElement(\"table\", { className: \"task-assignments-table\" },\n                    React.createElement(\"thead\", null,\n                        React.createElement(\"tr\", null,\n                            React.createElement(\"th\", null, \"Elev\"),\n                            React.createElement(\"th\", null, \"Inl\\u00E4mingsdatum\"),\n                            React.createElement(\"th\", null, \"Inl\\u00E4mning\"),\n                            React.createElement(\"th\", { className: \"actions\" },\n                                React.createElement(\"i\", { className: \"fas fa-cogs\" })))),\n                    React.createElement(\"tbody\", null, complete.map(function (submission, i) { return (React.createElement(SubmissionRow, { key: i, submission: submission, files: assignments.filter(function (file) { return file.submissionId === submission.id; }), hasTemplate: _this.props.hasTemplate, sendToKedbackend: _this.props.sendToKedbackend, sendToUrkund: _this.props.sendToUrkund, courseId: _this.props.courseId, taskId: _this.props.taskId })); }))))),\n            incomplete.length > 0 && (React.createElement(React.Fragment, null,\n                React.createElement(\"p\", null, \"Ej inl\\u00E4mnade:\"),\n                React.createElement(\"table\", { className: \"task-assignments-table\" },\n                    React.createElement(\"thead\", null,\n                        React.createElement(\"tr\", null,\n                            React.createElement(\"th\", null, \"Elev\"),\n                            React.createElement(\"th\", null, \"Status\"),\n                            React.createElement(\"th\", null, \"Inl\\u00E4mning\"),\n                            React.createElement(\"th\", { className: \"actions\" },\n                                React.createElement(\"i\", { className: \"fas fa-cogs\" })))),\n                    React.createElement(\"tbody\", null, incomplete.map(function (submission, i) { return (React.createElement(SubmissionRow, { key: i, submission: submission, files: assignments.filter(function (file) { return file.submissionId === submission.id; }), hasTemplate: _this.props.hasTemplate, sendToKedbackend: _this.props.sendToKedbackend, sendToUrkund: false })); })))))));\n    };\n    return SubmissionTables;\n}(React.Component));\nvar SubmissionRow = /** @class */ (function (_super) {\n    tslib_1.__extends(SubmissionRow, _super);\n    function SubmissionRow(props) {\n        var _this = _super.call(this, props) || this;\n        _this.classroom = new GoogleClassroom();\n        _this.state = {\n            files: _this.props.files,\n            submission: _this.props.submission,\n            loading: false,\n            loadingMessage: 'Laddar inlämning...'\n        };\n        return _this;\n    }\n    SubmissionRow.prototype.transformUrl = function (url) {\n        // Transforms alternateLink for submission to link to Classroom-interface for correcting submission\n        var parts = url.split(\"/\");\n        parts.splice(3, 1, \"u\", \"0\", \"g\", \"tg\");\n        parts[8] = parts[9] + \"?authuser=0#u=\" + parts[12];\n        return parts.slice(0, 9).join(\"/\");\n    };\n    SubmissionRow.prototype.sendToKedbackend = function (submission) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var assignments;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.setState({ loading: true, loadingMessage: 'Skickar filer...' });\n                        return [4 /*yield*/, this.props.sendToKedbackend(submission)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, env.kedBackendClient.http.get(\"assignments/\" + env.currentUser.school + \"/\" + this.props.courseId + \"/\" + this.props.taskId + \"/\" + submission.userEmail).then(function (resp) {\n                                if (resp.ok)\n                                    return resp.json();\n                                return [];\n                            })\n                                .then(function (res) {\n                                return res.map(function (assignment) {\n                                    if (!assignment.metadata || !assignment.metadata.driveFileId)\n                                        return assignment;\n                                    if (!submission.assignmentSubmission.attachments)\n                                        return assignment;\n                                    // add submission data\n                                    submission.assignmentSubmission.attachments.forEach(function (attachment) {\n                                        if (attachment.driveFile.id == assignment.metadata.driveFileId) {\n                                            assignment.inClassroom = true;\n                                            assignment.submissionId = submission.id;\n                                        }\n                                    });\n                                    return assignment;\n                                });\n                            })];\n                    case 2:\n                        assignments = _a.sent();\n                        this.setState({\n                            loading: false, files: assignments\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SubmissionRow.prototype.refreshAssignment = function (assignment) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var req, _a, _b, resJson, files;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        this.setState({ loading: true, loadingMessage: \"Väntar på svar...\" });\n                        return [4 /*yield*/, env.kedBackendClient.http.get(\"assignments/urkund/\" + env.currentUser.school + \"/\" + this.props.courseId + \"/\" + this.props.taskId + \"/\" + assignment.user + \"/\" + assignment.filename)];\n                    case 1:\n                        req = _c.sent();\n                        if (!(req.status >= 400)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, req.status];\n                        return [4 /*yield*/, req.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, req.text()];\n                    case 4:\n                        resJson = _c.sent();\n                        files = this.state.files.map(function (f) {\n                            if (f.metadata.driveFileId == assignment.metadata.driveFileId) {\n                                f.metadata.urkundResponse = resJson;\n                            }\n                            return f;\n                        });\n                        this.setState({ loading: false, files: files });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SubmissionRow.prototype.returnSubmission = function (submission) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.setState({ loading: true, loadingMessage: \"Returnerar inlämning...\" });\n                        return [4 /*yield*/, this.classroom.returnSubmission(submission)];\n                    case 1:\n                        _a.sent();\n                        this.setState({ loading: false, submission: tslib_1.__assign({}, submission, { state: 'RETURNED' }) });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SubmissionRow.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, hasTemplate = _a.hasTemplate, sendToUrkund = _a.sendToUrkund;\n        if (this.state.loading) {\n            return React.createElement(\"tr\", null,\n                React.createElement(\"td\", { colSpan: 4 }, this.state.loadingMessage));\n        }\n        var _b = this.state, files = _b.files, submission = _b.submission;\n        var file = submission.assignmentSubmission.attachments\n            ? submission.assignmentSubmission.attachments[0].driveFile\n            : false;\n        var name = submission.name, state = submission.state, userEmail = submission.userEmail, late = submission.late, updateTime = submission.updateTime;\n        var turnedIn = state == \"TURNED_IN\";\n        var returned = state == 'RETURNED';\n        var crUrl = turnedIn ? this.transformUrl(submission.alternateLink) : \"\";\n        if (file && hasTemplate && crUrl !== \"\")\n            file.alternateLink = crUrl;\n        var appendedFiles = file\n            ? hasTemplate\n                ? submission.assignmentSubmission.attachments.slice(1)\n                : submission.assignmentSubmission.attachments\n            : [];\n        var showUrkundBtn = sendToUrkund &&\n            (file &&\n                files.filter(function (f) { return f.metadata.driveFileId == file.id; }).length == 0);\n        return (React.createElement(\"tr\", { className: late && turnedIn ? \"late\" : undefined },\n            React.createElement(\"td\", null,\n                React.createElement(\"a\", { href: \"mailto:\" + userEmail },\n                    name.firstName,\n                    \" \",\n                    name.lastName)),\n            React.createElement(\"td\", null,\n                turnedIn || returned\n                    ? new Date(updateTime)\n                        .toLocaleString()\n                        .split(\" \")\n                        .join(\" kl. \")\n                    : stateMap[state],\n                returned ? ' (återlämnad)' : ''),\n            React.createElement(\"td\", null, file && (turnedIn || returned)\n                ? [\n                    !hasTemplate && appendedFiles.length > 1 && (React.createElement(\"p\", null,\n                        React.createElement(Button, { label: \"Bed\\u00F6m i Classroom\", url: crUrl, faIcon: \"fas fa-highlighter\" }))),\n                    (hasTemplate ||\n                        (!hasTemplate && appendedFiles.length == 1)) && (React.createElement(StatusView, { key: 0, file: file, data: files.find(function (f) { return f.metadata.driveFileId === file.id; }), refreshAssignment: this.refreshAssignment.bind(this) })),\n                    (!hasTemplate && appendedFiles.length > 1) ||\n                        (hasTemplate && appendedFiles.length) ? (React.createElement(OpenCloseBox, { key: 1, title: \"Bifogade filer (\" + appendedFiles.length + \")\" }, appendedFiles.map(function (sub, i) {\n                        return (React.createElement(StatusView, { key: i, file: sub.driveFile, data: files.find(function (f) { return f.metadata.driveFileId === sub.driveFile.id; }), refreshAssignment: _this.refreshAssignment.bind(_this) }));\n                    }))) : (undefined)\n                ]\n                : file && [\n                    hasTemplate && (React.createElement(FileView, { key: 0, thumbnail: file.thumbnailUrl, url: file.alternateLink, title: file.title })),\n                    appendedFiles.length ? (React.createElement(OpenCloseBox, { key: 1, title: \"Bifogade filer (\" + appendedFiles.length + \")\" }, appendedFiles.map(function (sub, i) {\n                        var file = files.find(function (file) { return file.metadata.driveFileId === sub.driveFile.id; });\n                        return (React.createElement(FileView, { key: i, thumbnail: sub.driveFile.thumbnailUrl, url: sub.driveFile.alternateLink, title: sub.driveFile.title }));\n                    }))) : (undefined)\n                ]),\n            React.createElement(\"td\", { className: \"actions\" },\n                showUrkundBtn && (React.createElement(Button, { label: \"Skicka till Urkund\", action: function () {\n                        console.table(submission);\n                        _this.sendToKedbackend(submission);\n                    } })),\n                turnedIn && (React.createElement(Button, { label: \"\\u00C5terl\\u00E4mna\", action: function () {\n                        _this.returnSubmission(submission);\n                        console.log('return submission');\n                    } })))));\n    };\n    return SubmissionRow;\n}(React.Component));\nvar StatusView = function (_a) {\n    var file = _a.file, data = _a.data, refreshAssignment = _a.refreshAssignment;\n    var sentToUrkund = !!data && data.metadata.urkundExternalId;\n    var urkundResponse = !!data && data.metadata.urkundResponse\n        ? JSON.parse(data.metadata.urkundResponse)[0]\n        : false;\n    return (React.createElement(\"div\", { className: \"stats-view\" },\n        React.createElement(FileView, { thumbnail: file.thumbnailUrl, url: file.alternateLink, title: file.title }),\n        React.createElement(\"div\", { className: \"urkund-stats urkund-status-col\" }, urkundResponse ? (React.createElement(React.Fragment, null,\n            React.createElement(\"p\", null, \"Urkund\"),\n            React.createElement(\"a\", { href: urkundResponse.Report && urkundResponse.Report.ReportUrl, onClick: function (ev) {\n                    if ([\"Accepted\", \"Submitted\"].indexOf(urkundResponse.Status.State) === -1)\n                        return; // Follow HREF instead.\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                    refreshAssignment(data);\n                }, target: \"_blank\", title: getUrkundHoverText(urkundResponse) },\n                React.createElement(\"div\", { className: getUrkundStatusClass(urkundResponse) })),\n            React.createElement(\"div\", { className: getUrkundSignificanceClass(urkundResponse) }, urkundResponse.Report &&\n                typeof urkundResponse.Report.Significance === \"number\"\n                ? urkundResponse.Report.Significance.toFixed() + \"%\"\n                : \" \"))) : sentToUrkund ? (React.createElement(React.Fragment, null,\n            React.createElement(\"p\", null, \"Urkund\"),\n            React.createElement(\"a\", { href: \"#\", onClick: function (ev) {\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                    refreshAssignment(data);\n                }, target: \"_blank\", title: 'Filen \\u00E4r uppladdad till Urkund. Klicka f\\u00F6r att uppdatera status.' },\n                React.createElement(\"div\", { className: 'urkund-status urkund-status-submitted' })))) : (React.createElement(\"p\", null, \"Ej skickad till Urkund\")))));\n};\n","import * as React from 'react';\nexport function Confirmation(props) {\n    return React.createElement(\"div\", { className: \"confirmation-box \" + props.className + (props.visible ? \" visible\" : \"\") },\n        React.createElement(\"p\", null, props.text),\n        React.createElement(\"button\", { onClick: function () { return props.onConfirm(); } }, \"OK\"),\n        React.createElement(\"button\", { onClick: function () { return props.onCancel(); } }, \"Avbryt\"));\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { OpenCloseBox } from \"../../utility-components/open-close-box\";\nimport { arrayToLookup } from '../../../utils/utils';\nexport var KnowledgeRequirementsBox = function (props) {\n    var title = props.title, className = props.className, headerOpen = props.headerOpen, idsToSubjectMap = props.idsToSubjectMap, requirements = props.requirements;\n    if (!idsToSubjectMap) {\n        // Normal case\n        return (React.createElement(OpenCloseBox, { title: React.createElement(\"p\", null, title), className: className, headerOpen: headerOpen },\n            React.createElement(KnowledgeRequirementsTable, tslib_1.__assign({}, tslib_1.__assign({}, props)))));\n    }\n    // Special case: Requirements that spans multiple subjects:\n    var requirementsPerSubjectLookup = idsToSubjectMap ?\n        arrayToLookup(requirements, function (r) { return idsToSubjectMap[r.id] || \"\"; }) : { \"\": requirements };\n    var reqsPerSubject = Object.keys(requirementsPerSubjectLookup)\n        .map(function (subject) { return ({ subject: subject, requirements: requirementsPerSubjectLookup[subject] }); });\n    return React.createElement(OpenCloseBox, { title: React.createElement(\"p\", null, title), className: className, headerOpen: headerOpen }, reqsPerSubject.map(function (_a) {\n        var subject = _a.subject, requirements = _a.requirements;\n        return React.createElement(KnowledgeRequirementsTable, tslib_1.__assign({}, tslib_1.__assign({}, props, { key: subject, heading: subject, requirements: requirements })));\n    }));\n};\nvar KnowledgeRequirementsTable = function (_a) {\n    var requirements = _a.requirements, includedIds = _a.includedIds, explainedRequirements = _a.explainedRequirements, partialRequirments = _a.partialRequirments, heading = _a.heading;\n    var columns = [\"E\", \"C\", \"A\"];\n    var rows = [];\n    var reqs = requirements.slice();\n    var row = null;\n    while (true) {\n        row = columns.map(function (grade) {\n            var pNext = reqs.findIndex(function (r) { return r.gradeStep.toUpperCase() === grade; });\n            if (pNext < 0)\n                return null;\n            var rv = reqs[pNext];\n            reqs.splice(pNext, 1);\n            return includedIds ?\n                (includedIds[rv.id] ? rv : undefined) :\n                rv;\n        });\n        if (row.every(function (r) { return r === null; }))\n            break;\n        if (!row.every(function (r) { return !r; })) {\n            rows.push(row);\n        }\n    }\n    return React.createElement(React.Fragment, null,\n        heading && React.createElement(\"h4\", null, heading),\n        React.createElement(\"table\", null,\n            React.createElement(\"thead\", null,\n                React.createElement(\"tr\", null, columns.map(function (c) { return React.createElement(\"th\", { key: c }, c); }))),\n            React.createElement(\"tbody\", null, rows.map(function (row, i) { return React.createElement(React.Fragment, { key: i },\n                React.createElement(\"tr\", { key: i }, row.map(function (column, j) {\n                    var columnPartialReq = column && partialRequirments && partialRequirments[column.id];\n                    return React.createElement(\"td\", { key: j, dangerouslySetInnerHTML: { __html: columnPartialReq ? columnPartialReq.join(\".\") : column ? column.name : \"\" } });\n                }\n                // <td key={j}>\n                // {partialRequirments.map((pr, k) => pr[column.id] ?\n                //   <span key={k} dangerouslySetInnerHTML={{}}/>\n                // )}\n                // </td>\n                )),\n                explainedRequirements && React.createElement(\"tr\", null, row.map(function (column, j) {\n                    return React.createElement(\"td\", { key: j, className: \"explained-requirement\" },\n                        React.createElement(\"div\", null, (column && explainedRequirements[column.id]) || \"\"));\n                }))); }))));\n};\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { TaskList } from './task-list';\nimport { LanguageContext } from '../../utility-components/LanguageContext';\nvar LearningGoalsList = /** @class */ (function (_super) {\n    tslib_1.__extends(LearningGoalsList, _super);\n    function LearningGoalsList() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    LearningGoalsList.prototype.render = function () {\n        var _a = this.props, commonTasks = _a.commonTasks, learningGoals = _a.learningGoals;\n        var intl = this.context.intl;\n        return React.createElement(\"div\", null,\n            learningGoals.map(function (lg) { return React.createElement(\"div\", { key: lg.name },\n                React.createElement(\"h5\", null, lg.name),\n                React.createElement(TaskList, { learningTasks: lg.learningTasks })); }),\n            commonTasks.length > 0 && React.createElement(\"div\", null,\n                learningGoals.length > 0 && React.createElement(\"h5\", null, intl.formatMessage({ id: \"learningGoalsLost.overall\", defaultMessage: \"Övergripande\" })),\n                React.createElement(TaskList, { learningTasks: commonTasks })));\n    };\n    LearningGoalsList.contextType = LanguageContext;\n    return LearningGoalsList;\n}(React.Component));\nexport { LearningGoalsList };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nvar ResourceList = /** @class */ (function (_super) {\n    tslib_1.__extends(ResourceList, _super);\n    function ResourceList(props) {\n        return _super.call(this, props) || this;\n    }\n    ResourceList.prototype.render = function () {\n        var resources = this.props.resources;\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"taskContainer\" }, resources.map(function (resource, idx) {\n                return React.createElement(\"div\", { className: \"align-horizontal\", key: idx },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"a\", { href: resource.url }, resource.name)));\n            })));\n    };\n    return ResourceList;\n}(React.Component));\nexport { ResourceList };\n","import * as React from \"react\";\nexport var FileView = function (_a) {\n    var thumbnail = _a.thumbnail, url = _a.url, title = _a.title, label = _a.label, icon = _a.icon, _b = _a.size, size = _b === void 0 ? \"small\" : _b, customAction = _a.customAction;\n    var myLabel = !!label ? label : title;\n    var myIcon = !!thumbnail ? thumbnail : icon;\n    var hasIcon = !!myIcon;\n    return (React.createElement(\"div\", { className: \"file-view \" + size },\n        React.createElement(\"a\", { href: customAction ? \"#\" : url, target: customAction ? undefined : \"_blank\", title: title }, hasIcon ? (React.createElement(\"img\", { className: \"file-\" + (thumbnail ? \"thumbnail\" : \"icon\"), src: myIcon, alt: title })) : (React.createElement(\"i\", { className: \"fas fa-file\" }))),\n        React.createElement(\"a\", { href: customAction ? \"#\" : url, target: customAction ? undefined : \"_blank\", title: title, onClick: customAction }, myLabel)));\n};\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport env from '../../../globals/KED.env';\nimport moment from 'moment';\nimport { createUUID, DocumentAccess } from 'kedbackend/client';\nimport { userTasksRepo } from '../../../repos/user-tasks-repo';\nimport { arrayToMap } from '../../../utils/utils';\nimport { Confirmation } from './confirmation';\nimport { LanguageContext } from '../../utility-components/LanguageContext';\nimport { UIAddbox } from '../../utility-components/checkbox';\nvar TaskList = /** @class */ (function (_super) {\n    tslib_1.__extends(TaskList, _super);\n    function TaskList(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            userTasks: [],\n            weekDate: Date.now(),\n            confirmations: []\n        };\n        _this.onChange = _this.onChange.bind(_this);\n        return _this;\n    }\n    TaskList.prototype.onChange = function (userTasks, persisted) {\n        if (persisted.weekDate !== this.state.weekDate) {\n            this.setState({\n                confirmations: []\n            });\n        }\n        this.setState({\n            userTasks: userTasks,\n            weekDate: persisted.weekDate\n        });\n    };\n    TaskList.prototype.componentDidMount = function () {\n        userTasksRepo.subscribe(this.onChange);\n    };\n    TaskList.prototype.componentWillUnmount = function () {\n        userTasksRepo.unsubscribe(this.onChange);\n    };\n    TaskList.prototype.toggleTask = function (learningTask) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var userTasks, weekDate, latestTimeStamp, userTask;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        userTasks = this.state.userTasks.filter(function (ut) {\n                            return learningTask.task ?\n                                ut.task && ut.task.some(function (t) { return t.id === learningTask.id; }) :\n                                ut.siteVisionPageId === learningTask.id;\n                        });\n                        weekDate = this.state.weekDate;\n                        if (!(userTasks.length === 0)) return [3 /*break*/, 2];\n                        latestTimeStamp = Math.max.apply(Math.max, [weekDate].concat(this.state.userTasks.map(function (t) { return t.dateTime; })));\n                        userTask = {\n                            id: createUUID(),\n                            courseName: learningTask.courseName,\n                            dateTime: latestTimeStamp + 2000,\n                            learningGoal: learningTask.learningGoal,\n                            name: learningTask.name,\n                            url: learningTask.url,\n                            acl: [\n                                // Default ACL: Let user self have full control over this item:\n                                new DocumentAccess(\"email\", env.currentUser.mail, \"S\"),\n                            ].map(function (ac) { return ac.toString(); })\n                        };\n                        if (learningTask.task && learningTask.task.deadline) {\n                            userTask.deadline = learningTask.task.deadline;\n                        }\n                        if (learningTask.task) {\n                            userTask.task = [learningTask.task];\n                            if (learningTask.course) {\n                                userTask.course = [learningTask.course];\n                            }\n                            else if (learningTask.courseInfo) {\n                                userTask.courseInfo = learningTask.courseInfo;\n                            }\n                        }\n                        else {\n                            userTask.siteVisionPageId = learningTask.id;\n                        }\n                        if (learningTask.step) {\n                            userTask.step = learningTask.step;\n                        }\n                        return [4 /*yield*/, Promise.all([\n                                userTasksRepo.setWeekPlannerBoxOpen(learningTask.courseName, true),\n                                userTasksRepo.insert([userTask])\n                            ])];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 2: \n                    // Already present in weekplanner. It's time to delete those that matched us.\n                    return [4 /*yield*/, userTasksRepo.delete(userTasks.map(function (t) { return t.id; }))];\n                    case 3:\n                        // Already present in weekplanner. It's time to delete those that matched us.\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TaskList.prototype.render = function () {\n        var _this = this;\n        var intl = this.context.intl;\n        var learningTasks = this.props.learningTasks;\n        var userTasks = arrayToMap(this.state.userTasks, function (ut) { return ut.task && ut.task.length > 0 ?\n            ut.task.map(function (t) { return t.id; })[0] : // course-builder tasks looked up by id\n            ut.siteVisionPageId ? ut.siteVisionPageId : // non-course-builder tasks\n                ut.url; });\n        var confirmations = this.state.confirmations;\n        var weekPlannerWeek = moment(this.state.weekDate).week();\n        var currentWeek = moment().week();\n        var forWeekString = weekPlannerWeek === currentWeek ? \"\" :\n            weekPlannerWeek === currentWeek + 1 ? intl.formatMessage({ id: \"taskList.nextWeekTask\", defaultMessage: \"för nästa vecka (v{week})\" }, { week: weekPlannerWeek }) :\n                weekPlannerWeek === currentWeek - 1 ? intl.formatMessage({ id: \"taskList.lastWeekTask\", defaultMessage: \"för förra veckan (v{week})\" }, { week: weekPlannerWeek }) :\n                    intl.formatMessage({ id: \"taskList.currentWeekTask\", defaultMessage: \"för vecka {week}\" }, { week: weekPlannerWeek });\n        return React.createElement(\"div\", { className: \"taskContainer\" }, learningTasks.map(function (learningTask, idx) {\n            var taskLookupId = learningTask.id;\n            var userTask = userTasks[taskLookupId] || { $meta: 'deleted' }; // No exist = $meta: 'deleted'\n            var isWorking = userTask.$meta === 'adding' || userTask.$meta === 'deleting';\n            var selected = userTask.$meta !== 'deleted' && userTask.$meta !== 'deleting';\n            var describedAction = selected ?\n                intl.formatMessage({ id: \"taskList.removeTaskFromWeeklyPlanning\", defaultMessage: \"Ta bort uppgiften från egen veckoplanering {week}\" }, { week: forWeekString }) :\n                intl.formatMessage({ id: \"taskList.addTaskToWeeklyPlanning\", defaultMessage: \"Lägg till uppgiften i egen veckoplanering {week}\" }, { week: forWeekString });\n            var confirmationVisible = confirmations.some(function (tid) { return taskLookupId === tid; });\n            return React.createElement(\"div\", { key: idx },\n                React.createElement(UIAddbox, { state: selected ? 'checked' : '', onChange: function () { return !isWorking && weekPlannerWeek === currentWeek ?\n                        _this.toggleTask(learningTask) :\n                        confirmationVisible ?\n                            _this.setState({ confirmations: confirmations.filter(function (tid) { return tid !== taskLookupId; }) }) :\n                            _this.setState({ confirmations: tslib_1.__spread(confirmations).concat(taskLookupId) }); }, label: React.createElement(\"a\", { title: describedAction, href: learningTask.url }, learningTask.name) }),\n                React.createElement(Confirmation, { visible: confirmationVisible, text: describedAction, onConfirm: function () {\n                        _this.toggleTask(learningTask);\n                        _this.setState({ confirmations: confirmations.filter(function (tid) { return tid !== taskLookupId; }) });\n                    }, onCancel: function () {\n                        _this.setState({ confirmations: confirmations.filter(function (tid) { return tid !== taskLookupId; }) });\n                    } }));\n        }));\n    };\n    TaskList.contextType = LanguageContext;\n    return TaskList;\n}(React.Component));\nexport { TaskList };\n","export default function getIncludedIds(module, course) {\n    var result = {};\n    course.tasks.filter(function (t) { return module.taskIds.indexOf(t.id) !== -1; }).forEach(function (task) {\n        task.abilities.forEach(function (_a) {\n            var id = _a.id;\n            return result[id] = true;\n        });\n        task.centralContent.forEach(function (_a) {\n            var id = _a.id;\n            return result[id] = true;\n        });\n        task.knowledgeRequirements.forEach(function (_a) {\n            var id = _a.id;\n            return result[id] = true;\n        });\n    });\n    return result;\n}\n","var initialized = false;\nexport function initManualScrollRestoration() {\n    if (!initialized) {\n        initialized = true;\n        document.documentElement.addEventListener('click', function (ev) {\n            var target = ev.target;\n            if (target && target.tagName === 'A') {\n                history.replaceState({ pageYOffset: window.pageYOffset }, null, null);\n            }\n        });\n        if (history.scrollRestoration)\n            history.scrollRestoration = 'manual';\n    }\n}\nexport function restoreScrollPosition(_a) {\n    var fallbackScrollPosition = _a.fallbackScrollPosition;\n    if (history.state && history.state.pageYOffset !== undefined) {\n        window.scrollTo(0, history.state.pageYOffset);\n    }\n    else if (fallbackScrollPosition !== undefined) {\n        window.scrollTo(0, fallbackScrollPosition);\n    }\n}\n","import * as React from 'react';\nimport { CourseBanner } from \"../course-viewer/course-page/course-banner\";\nimport { ListCourses } from './list-courses';\nimport env from '../../globals/KED.env';\nexport function ListCoursesPage() {\n    return React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n        React.createElement(CourseBanner, { title: env.currentUser.school, backgroundImage: \"\", tabs: [{ name: \"Skolans kurser\", link: \"#\" }], activeTab: \"#\" }),\n        React.createElement(\"div\", { className: \"sv-row sv-layout\" },\n            React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\n                React.createElement(\"div\", { className: \"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\" },\n                    React.createElement(ListCourses, null)))));\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport cfg from '../../globals/KED.cfg';\nimport { showInfo, L } from \"../../utils/utils\";\nimport { Spinner } from \"../course-builder/sub-components/spinner\";\nimport { parseQueryString, generateQueryString } from \"../../utils/query-string\";\nimport { preserveImpersonationQuery } from '../../access-control/index';\nimport { hiddenCoursesRepo } from '../../repos/hidden-courses-repo';\nvar ListCourses = /** @class */ (function (_super) {\n    tslib_1.__extends(ListCourses, _super);\n    function ListCourses(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            isLoading: true,\n            courses: [],\n            headerOpen: false\n        };\n        _this.updateHiddenCourses = _this.updateHiddenCourses.bind(_this);\n        return _this;\n    }\n    ListCourses.prototype.componentWillMount = function () {\n        hiddenCoursesRepo.subscribe(this.updateHiddenCourses, { fullCourse: true });\n    };\n    ListCourses.prototype.componentWillUnmount = function () {\n        hiddenCoursesRepo.unsubscribe(this.updateHiddenCourses);\n    };\n    ListCourses.prototype.updateHiddenCourses = function (courses) {\n        this.setState({ courses: courses, isLoading: false });\n    };\n    ListCourses.prototype.hideCourse = function (course) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        showInfo(L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"Sparar...\"], [\"Sparar...\"]))));\n                        return [4 /*yield*/, hiddenCoursesRepo.hideCourse(course)];\n                    case 1:\n                        _a.sent();\n                        showInfo(\"\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ListCourses.prototype.showCourse = function (course) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        showInfo(L(templateObject_2 || (templateObject_2 = tslib_1.__makeTemplateObject([\"Sparar...\"], [\"Sparar...\"]))));\n                        return [4 /*yield*/, hiddenCoursesRepo.showCourse(course)];\n                    case 1:\n                        _a.sent();\n                        showInfo(\"\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ListCourses.prototype.render = function () {\n        var _this = this;\n        if (this.state.isLoading)\n            return React.createElement(Spinner, null);\n        var courses = this.state.courses;\n        var visibleCourses = courses.filter(function (course) { return course.visible; });\n        var hiddenCourses = courses.filter(function (course) { return !course.visible; });\n        var query = parseQueryString(location.search);\n        var viewCourseUrl = cfg.KED_COURSE_VIEWER_URL;\n        return React.createElement(\"div\", { className: \"ked_boxed\" },\n            React.createElement(\"h3\", null, \"Skolans kurser\"),\n            React.createElement(\"div\", { className: \"taskContainer odd-even\" }, visibleCourses.map(function (course) {\n                return React.createElement(\"div\", { className: \"studentCourse\", key: course.id },\n                    React.createElement(\"div\", { className: \"align-horizontal\" },\n                        React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\n                            React.createElement(\"a\", { className: \"hideItem\", onClick: function () { return _this.hideCourse(course); } })),\n                        React.createElement(\"div\", { className: \"horizontalItem top\" },\n                            React.createElement(\"a\", { href: preserveImpersonationQuery(viewCourseUrl, { courseId: course.id }) }, course.name))),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"p\", { className: \"small\" }, course.description)));\n            })),\n            React.createElement(\"div\", { className: \"openClose\" + (this.state.headerOpen ? \" open\" : \"\") },\n                React.createElement(\"div\", { className: \"openHeader\", onClick: function () { return _this.setState({ headerOpen: !_this.state.headerOpen }); } },\n                    React.createElement(\"h5\", null, \"Dolda kurser\")),\n                React.createElement(\"div\", { className: \"openContent\" },\n                    React.createElement(\"div\", { className: \"taskContainer odd-even\" }, hiddenCourses.map(function (course) {\n                        return React.createElement(\"div\", { className: \"studentCourse\", key: course.id },\n                            React.createElement(\"div\", { className: \"align-horizontal\" },\n                                React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\n                                    React.createElement(\"a\", { className: \"showItem\", onClick: function () { return _this.showCourse(course); } })),\n                                React.createElement(\"a\", { href: generateQueryString(tslib_1.__assign({}, query, { courseId: course.id })) }, course.name)),\n                            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                React.createElement(\"p\", { className: \"small\" }, course.description)));\n                    })))));\n    };\n    return ListCourses;\n}(React.Component));\nexport { ListCourses };\nvar templateObject_1, templateObject_2;\n","import * as React from 'react';\nexport var LanguageContext = React.createContext({ intl: null });\n","import * as tslib_1 from \"tslib\";\nimport { IntlProvider, addLocaleData } from 'react-intl';\nimport locale_en from 'react-intl/locale-data/en';\nimport locale_sv from 'react-intl/locale-data/sv';\nimport messages_sv from \"../../translations/sv.json\";\nimport messages_en from \"../../translations/en.json\";\nimport * as React from 'react';\nimport cfg from '../../globals/KED.cfg';\nimport moment from 'moment';\nexport var setupIntl = function (Component) {\n    return /** @class */ (function (_super) {\n        tslib_1.__extends(_SetupLanguageIntl, _super);\n        function _SetupLanguageIntl(props) {\n            var _this = _super.call(this, props) || this;\n            addLocaleData(tslib_1.__spread(locale_en, locale_sv));\n            _this.messages = {\n                'sv': messages_sv,\n                'en': messages_en\n            };\n            moment().locale(cfg.KED_LOCALE);\n            return _this;\n        }\n        _SetupLanguageIntl.prototype.render = function () {\n            return React.createElement(IntlProvider, { locale: cfg.KED_LOCALE, messages: this.messages[cfg.KED_LOCALE] },\n                React.createElement(Component, tslib_1.__assign({}, this.props)));\n        };\n        return _SetupLanguageIntl;\n    }(React.Component));\n};\n","import React from 'react';\nexport var UICheckbox = function (_a) {\n    var state = _a.state, label = _a.label, onChange = _a.onChange;\n    return React.createElement(\"label\", { className: 'ui-checkbox' },\n        label,\n        React.createElement(\"input\", { type: \"checkbox\", checked: state == \"checked\", onChange: onChange }),\n        React.createElement(\"span\", { className: \"custom-element\" }));\n};\nexport var UIAddbox = function (_a) {\n    var state = _a.state, label = _a.label, _b = _a.onChange, onChange = _b === void 0 ? function () { return null; } : _b;\n    return React.createElement(\"label\", { className: 'ui-addbox' },\n        label,\n        React.createElement(\"input\", { type: \"checkbox\", checked: state == \"checked\", onChange: onChange }),\n        React.createElement(\"span\", { className: \"custom-element\" }));\n};\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { RemoveItem } from '../course-builder/sub-components/remove-item';\nimport { findDOMNode } from 'react-dom';\nimport $ from 'jquery';\nvar Dialogs = /** @class */ (function (_super) {\n    tslib_1.__extends(Dialogs, _super);\n    function Dialogs(props) {\n        return _super.call(this, props) || this;\n    }\n    Dialogs.prototype.componentDidUpdate = function (prevProps) {\n        if (this.lastDiv !== null && prevProps.dialogs.length > this.props.dialogs.length) {\n            // A dialog was closed. Now focus the last dialog:\n            $(findDOMNode(this.lastDiv)).find(':input').first().focus();\n        }\n    };\n    Dialogs.prototype.render = function () {\n        var _this = this;\n        this.lastDiv = null;\n        var _a = this.props, dialogs = _a.dialogs, popDialog = _a.popDialog;\n        $('body').attr('aria-disabled', dialogs.length > 0);\n        $('body').css('overflow', dialogs.length > 0 ? 'hidden' : 'auto');\n        return dialogs.length > 0 && React.createElement(\"div\", null, dialogs.map(function (dialog, idx) {\n            var div;\n            function onKeyPress(ev) {\n                if (ev.which === 13 && (!ev.target || ev.target.tagName !== 'TEXTAREA')) {\n                    $(findDOMNode(div)).find('.btn-default').click();\n                }\n                ev.stopPropagation();\n            }\n            function onKeyDown(ev) {\n                if (ev.which === 27) { // Escape\n                    popDialog();\n                    ev.stopPropagation();\n                    return;\n                }\n                if (ev.which === 83 && (ev.ctrlKey || ev.metaKey)) { // CTRL-S\n                    var domNode = findDOMNode(div);\n                    ev.preventDefault();\n                    var defaultButton = $(domNode).find('.btn-default');\n                    defaultButton.click();\n                    ev.stopPropagation();\n                }\n            }\n            return React.createElement(\"div\", { key: idx },\n                React.createElement(\"div\", { className: \"darken\" }),\n                React.createElement(\"div\", { className: \"modal-page-wrap\" },\n                    React.createElement(\"div\", { className: \"modal-page\", ref: function (elem) {\n                            div = elem;\n                            if (idx === dialogs.length - 1)\n                                _this.lastDiv = elem;\n                        }, tabIndex: 0, \"aria-disabled\": idx < dialogs.length - 1, onKeyPress: onKeyPress, onKeyDown: onKeyDown },\n                        dialog,\n                        React.createElement(RemoveItem, { onClick: popDialog }),\n                        React.createElement(\"div\", { className: \"stopFloats\" }))));\n        }));\n    };\n    return Dialogs;\n}(React.Component));\nexport { Dialogs };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { FormField } from './form-field';\nvar TextInput = /** @class */ (function (_super) {\n    tslib_1.__extends(TextInput, _super);\n    function TextInput(props) {\n        return _super.call(this, props) || this;\n    }\n    TextInput.prototype.render = function () {\n        var _this = this;\n        return (React.createElement(FormField, { label: this.props.label },\n            React.createElement(\"div\", null,\n                React.createElement(\"input\", { type: \"text\", autoFocus: this.props.autoFocus, id: this.props.id, size: this.props.size || 35, value: this.props.value, onChange: this.props.onChange && (function (ev) { return _this.props.onChange(ev.target.value); }), disabled: this.props.disabled, placeholder: this.props.placeholder }))));\n    };\n    return TextInput;\n}(React.Component));\nexport { TextInput };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { FormField } from './form-field';\nvar TextAreaFormField = /** @class */ (function (_super) {\n    tslib_1.__extends(TextAreaFormField, _super);\n    function TextAreaFormField(props) {\n        return _super.call(this, props) || this;\n    }\n    TextAreaFormField.prototype.render = function () {\n        var _this = this;\n        return (React.createElement(FormField, { label: this.props.label, id: this.props.id },\n            React.createElement(\"div\", { className: \"align-horizontal\" },\n                React.createElement(\"div\", { className: \"horizontalItem top\" },\n                    React.createElement(\"textarea\", { autoFocus: this.props.autoFocus, id: this.props.id, cols: 35, rows: this.props.rows || 5, value: this.props.value, onChange: function (ev) { return _this.props.onChange(ev.target.value); }, placeholder: this.props.placeholder })),\n                !!this.props.children && React.createElement(\"div\", { className: \"horizontalItem\" }, this.props.children))));\n    };\n    return TextAreaFormField;\n}(React.Component));\nexport { TextAreaFormField };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nfunction findId(node) {\n    var recucheck = new Set();\n    return (function findId(node) {\n        if (typeof node === 'string')\n            return null;\n        if (recucheck.has(node)) {\n            return;\n        }\n        recucheck.add(node);\n        if (node.props) {\n            if (node.props.id)\n                return node.props.id;\n            if (node.props.children) {\n                return findId(node.props.children);\n            }\n            return;\n        }\n        if (node.length) {\n            for (var i = 0; i < node.length; ++i) {\n                var child = node[i];\n                if (child) {\n                    var childId = findId(child);\n                    if (childId)\n                        return childId;\n                    //console.log(child);\n                }\n            }\n        }\n    })(node);\n}\nvar FormField = /** @class */ (function (_super) {\n    tslib_1.__extends(FormField, _super);\n    function FormField(props) {\n        return _super.call(this, props) || this;\n    }\n    FormField.prototype.render = function () {\n        return React.createElement(React.Fragment, null,\n            React.createElement(\"label\", { className: \"kclabel\", htmlFor: this.props.id || findId(this.props.children) }, this.props.label),\n            this.props.children);\n    };\n    return FormField;\n}(React.Component));\nexport { FormField };\n","/* REFACTOR: Move this component outside coursebuilder!\n   This is a general-purpose component\n*/\nimport * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { GoalProgress } from '../charts/goal-progress';\nvar OpenCloseBox = /** @class */ (function (_super) {\n    tslib_1.__extends(OpenCloseBox, _super);\n    function OpenCloseBox(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            headerOpen: props.headerOpen || false\n        };\n        return _this;\n    }\n    OpenCloseBox.prototype.componentWillReceiveProps = function (nextProps) {\n        if (nextProps.headerOpen !== this.props.headerOpen) {\n            this.setState({ headerOpen: nextProps.headerOpen });\n        }\n    };\n    OpenCloseBox.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, title = _a.title, className = _a.className, children = _a.children, headerClassName = _a.headerClassName, contentClassName = _a.contentClassName, displayProgress = _a.displayProgress, progressData = _a.progressData, inactivated = _a.inactivated, inactivatedRender = _a.inactivatedRender;\n        var headerOpen = this.state.headerOpen;\n        if (inactivated)\n            return inactivatedRender === 'titleAndChildren' ? React.createElement(React.Fragment, null,\n                React.createElement(React.Fragment, null, title),\n                React.createElement(React.Fragment, null, children)) : React.createElement(React.Fragment, null, children);\n        //var currentProgressData = //progressData();\n        return React.createElement(\"div\", { className: (className || '') + \" openClose\" + (headerOpen ? \" open\" : \"\") },\n            React.createElement(\"div\", { className: \"openHeader\" + (headerClassName ? \" \" + headerClassName : \"\"), onClick: function () {\n                    if (_this.props.onOpenClose)\n                        _this.props.onOpenClose(!_this.state.headerOpen);\n                    _this.setState({ headerOpen: !_this.state.headerOpen });\n                } },\n                React.createElement(\"div\", { className: \"openHeaderContainer\" },\n                    React.createElement(\"div\", null, title),\n                    displayProgress && React.createElement(GoalProgress, tslib_1.__assign({}, progressData)))),\n            React.createElement(\"div\", { className: \"openContent\" + (contentClassName ? \" \" + contentClassName : \"\") }, children));\n    };\n    return OpenCloseBox;\n}(React.Component));\nexport { OpenCloseBox };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { env } from '../../globals/KED.env';\nvar AddCustomGoal = /** @class */ (function (_super) {\n    tslib_1.__extends(AddCustomGoal, _super);\n    function AddCustomGoal(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            learningGoal: props.learningGoal || ''\n        };\n        return _this;\n    }\n    AddCustomGoal.prototype.render = function () {\n        var _this = this;\n        var learningGoal = this.state.learningGoal;\n        var onSave = this.props.onSave;\n        var isGymnasiumStudent = ('' + env.currentUser.schoolType).toLowerCase() === \"gymnasium\";\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                React.createElement(\"h2\", null, isGymnasiumStudent ? React.createElement(FormattedMessage, { id: \"weekplanner.addLearningGoalGymnasiumSchoolTitle\", defaultMessage: \"L\\u00E4gg till rubrik\" }) :\n                    React.createElement(FormattedMessage, { id: \"weekplanner.addLearningGoalPrimarySchoolTitle\", defaultMessage: \"L\\u00E4gg till eget l\\u00E4randem\\u00E5l\" })),\n                React.createElement(\"hr\", null),\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" }, isGymnasiumStudent ? React.createElement(FormattedMessage, { id: \"weekplanner.addLearningGoalGymnasiumSchool\", defaultMessage: \"Rubrik\" }) : React.createElement(FormattedMessage, { id: \"weekplanner.addLearningGoalPrimarySchool\", defaultMessage: \"M\\u00E5l\" })),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"input\", { type: \"text\", tabIndex: 1, size: 50, autoFocus: true, value: learningGoal, onChange: function (e) { return _this.setState({ learningGoal: e.target.value }); } })),\n                    React.createElement(\"div\", { className: \"horizontalItem top spaced\" })),\n                React.createElement(\"br\", null)),\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(\"button\", { tabIndex: 1, className: \"btn btn-large btn-default\", onClick: function () { return onSave(learningGoal); } },\n                    React.createElement(FormattedMessage, { id: \"common.save\", defaultMessage: \"save\" }))));\n    };\n    return AddCustomGoal;\n}(React.Component));\nexport { AddCustomGoal };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { TextInput } from '../utility-components/form-field-text-input';\nimport { TextAreaFormField } from '../utility-components/form-field-textarea';\nimport { LanguageContext } from '../utility-components/LanguageContext';\nimport { FormattedMessage } from 'react-intl';\nimport { env } from '../../globals/KED.env';\nvar AddCustomTask = /** @class */ (function (_super) {\n    tslib_1.__extends(AddCustomTask, _super);\n    function AddCustomTask(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            name: '',\n            description: '',\n            url: ''\n        };\n        return _this;\n    }\n    AddCustomTask.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, name = _a.name, description = _a.description, url = _a.url;\n        var _b = this.props, isTask = _b.isTask, onSave = _b.onSave;\n        var intl = this.context.intl;\n        var isGymnasiumStudent = ('' + env.currentUser.schoolType).toLowerCase() === \"gymnasium\";\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                React.createElement(\"h2\", null, isGymnasiumStudent ? React.createElement(FormattedMessage, { id: \"customTask.addWorkGoalGymnasiumSchoolTitle\", defaultMessage: \"L\\u00E4gg till uppgift\" }) :\n                    React.createElement(FormattedMessage, { id: \"customTask.addWorkGoalPrimarySchoolTitle\", defaultMessage: \"L\\u00E4gg till eget arbetsm\\u00E5l\" })),\n                React.createElement(\"hr\", null),\n                React.createElement(TextInput, { label: intl.formatMessage({ id: 'common.nameLabel', defaultMessage: 'Namn' }), id: \"AddCustomTask:name\", placeholder: intl.formatMessage({ id: 'customTask.enterNamePlhd', defaultMessage: 'Ange namn...' }), value: name, autoFocus: true, onChange: function (name) { return _this.setState({ name: name }); } }),\n                React.createElement(TextAreaFormField, { rows: 7, label: intl.formatMessage({ id: 'common.descriptionLabel', defaultMessage: 'Beskrivning' }), id: \"AddCustomTask:description\", placeholder: intl.formatMessage({ id: 'common.addDescriptionPlhd', defaultMessage: \"Lägg till en beskrivning...\" }), value: description, onChange: function (description) { return _this.setState({ description: description }); } }),\n                React.createElement(TextInput, { label: intl.formatMessage({ id: 'common.linkLabel', defaultMessage: 'Länk' }), id: \"AddCustomTask:url\", placeholder: \"http://www...\", value: url, onChange: function (url) { return _this.setState({ url: url }); } })),\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(\"button\", { tabIndex: 1, className: \"btn btn-large btn-default\", onClick: function () { return onSave(name, description, url); } },\n                    React.createElement(FormattedMessage, { id: \"common.save\", defaultMessage: \"Spara\" }))));\n    };\n    AddCustomTask.contextType = LanguageContext;\n    return AddCustomTask;\n}(React.Component));\nexport { AddCustomTask };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { TextInput } from '../utility-components/form-field-text-input';\nimport { TextAreaFormField } from '../utility-components/form-field-textarea';\nimport { createUUID } from 'kedbackend/client';\nimport { FormattedMessage } from 'react-intl';\nimport { LanguageContext } from '../utility-components/LanguageContext';\nvar AddOrEditSubTask = /** @class */ (function (_super) {\n    tslib_1.__extends(AddOrEditSubTask, _super);\n    function AddOrEditSubTask(props) {\n        var _this = _super.call(this, props) || this;\n        if (props.mode === 'edit') {\n            var subTask = props.subTask;\n            _this.state = {\n                name: subTask.name || '',\n                description: subTask.description || '',\n                url: subTask.url || ''\n            };\n        }\n        else {\n            _this.state = {\n                name: '',\n                description: '',\n                url: ''\n            };\n        }\n        return _this;\n    }\n    AddOrEditSubTask.prototype.save = function () {\n        // Update repo:\n        var props = this.props;\n        var userTask = props.userTask, closeDialog = props.closeDialog, userTasksRepo = props.userTasksRepo;\n        var _a = this.state, name = _a.name, description = _a.description, url = _a.url;\n        if (props.mode === 'edit') {\n            // Edit existing:\n            userTasksRepo.update([userTask], function (ut) {\n                var subTasks = ut.subTasks;\n                if (subTasks) {\n                    ut.subTasks = subTasks.map(function (st) {\n                        return st.id === props.subTask.id ? tslib_1.__assign({}, st, { name: name, description: description, url: url }) : tslib_1.__assign({}, st);\n                    });\n                }\n            });\n        }\n        else {\n            // Create new task\n            var newSubTask_1 = {\n                id: createUUID(),\n                name: name,\n                description: description,\n                url: url\n            };\n            // Update repo:\n            userTasksRepo.update([userTask], function (ut) {\n                if (!ut.subTasks) {\n                    ut.subTasks = [];\n                }\n                ut.subTasks = ut.subTasks.concat(newSubTask_1);\n            });\n        }\n        // Close dialog\n        closeDialog();\n    };\n    AddOrEditSubTask.prototype.delete = function () {\n        // Update repo:\n        var props = this.props;\n        if (props.mode !== 'edit') {\n            throw new Error(\"Can only delete in edit mode\");\n        }\n        props.userTasksRepo.update([props.userTask], function (ut) {\n            if (ut.subTasks) {\n                ut.subTasks = ut.subTasks.filter(function (t) { return t.id !== props.subTask.id; });\n            }\n        });\n        // Close dialog:\n        props.closeDialog();\n    };\n    AddOrEditSubTask.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, name = _a.name, description = _a.description, url = _a.url;\n        var props = this.props;\n        var isEditMode = props.mode === 'edit';\n        var intl = this.context.intl;\n        return React.createElement(React.Fragment, null,\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                React.createElement(\"h2\", null, isEditMode ? React.createElement(FormattedMessage, { id: \"addeditsubtask.editSubtask\", defaultMessage: 'Redigera underuppgift' }) : React.createElement(FormattedMessage, { id: \"addeditsubtask.addSubtask\", defaultMessage: 'L\\u00E4gg till underuppgift' })),\n                React.createElement(\"hr\", null),\n                React.createElement(TextInput, { autoFocus: true, label: intl.formatMessage({ id: 'addeditsubtask.nameLabel', defaultMessage: 'Underuppgiftens namn' }), id: \"AddUserSubTask:name\", placeholder: \"\", value: this.state.name, onChange: function (name) { return _this.setState({ name: name }); } }),\n                React.createElement(TextAreaFormField, { label: intl.formatMessage({ id: 'common.descriptionLabel', defaultMessage: 'Beskrivning' }), id: \"AddUserSubTask:description\", rows: 7, placeholder: \"\", value: this.state.description, onChange: function (description) { return _this.setState({ description: description }); } }),\n                React.createElement(TextInput, { label: intl.formatMessage({ id: 'common.linkLabel', defaultMessage: 'Länk' }), id: \"AddUserSubTask:url\", placeholder: \"\", value: this.state.url, onChange: function (url) { return _this.setState({ url: url }); } }),\n                React.createElement(\"br\", null)),\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                props.mode === 'edit' && React.createElement(\"button\", { className: \"btn btn-warning btn-large pull-right\", onClick: function (ev) { return _this.delete(); } },\n                    React.createElement(FormattedMessage, { id: \"addeditsubtask.deleteSubtask\", defaultMessage: \"Ta bort underuppgift\" })),\n                React.createElement(\"button\", { tabIndex: 1, className: \"btn btn-large btn-default\", onClick: function () { return _this.save(); } },\n                    React.createElement(FormattedMessage, { id: \"common.save\", defaultMessage: \"Spara\" }))));\n    };\n    AddOrEditSubTask.contextType = LanguageContext;\n    return AddOrEditSubTask;\n}(React.Component));\nexport { AddOrEditSubTask };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { getTaskType } from './get-task-type';\nimport ReactDatePicker from 'react-datepicker';\nimport '../../globals/moment-sv-locale';\nimport { TextInput } from '../utility-components/form-field-text-input';\nimport moment from 'moment';\nimport { FormField } from '../utility-components/form-field';\nimport { AddOrEditSubTask } from './add-or-edit-sub-task';\nimport { TextAreaFormField } from '../utility-components/form-field-textarea';\nimport { FormattedMessage } from 'react-intl';\nimport { LanguageContext } from \"../utility-components/LanguageContext\";\nvar EditUserTask = /** @class */ (function (_super) {\n    tslib_1.__extends(EditUserTask, _super);\n    function EditUserTask(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            userTask: props.userTask,\n            name: props.userTask.name,\n            description: props.userTask.description,\n            url: props.userTask.url,\n            deadline: props.userTask.deadline,\n            subTasks: props.userTask.subTasks\n        };\n        _this.onUserTasksChanged = _this.onUserTasksChanged.bind(_this);\n        return _this;\n    }\n    EditUserTask.prototype.componentDidMount = function () {\n        this.props.userTasksRepo.subscribe(this.onUserTasksChanged);\n    };\n    EditUserTask.prototype.onUserTasksChanged = function (userTasks) {\n        var _this = this;\n        var myUserTask = userTasks.find(function (ut) { return ut.id === _this.props.userTask.id; });\n        if (!myUserTask) {\n            this.props.closeDialog();\n            return;\n        }\n        this.setState({\n            userTask: myUserTask,\n            subTasks: myUserTask.subTasks\n        });\n    };\n    EditUserTask.prototype.componentWillUnmount = function () {\n        this.props.userTasksRepo.unsubscribe(this.onUserTasksChanged);\n    };\n    EditUserTask.prototype.isModified = function () {\n        // Don't count subtask changes! They live their own life and is maintained\n        // in add-or-edit-sub-task.tsx. Reason: User would expect added /edited subtasks\n        // to be persisted right away. May click away this dialog.\n        // Also reason: Can invoke that dialog by itself from other components. From WeekPlanner\n        // when clicking the subtask for example!\n        var _a = this.state, deadline = _a.deadline, description = _a.description, name = _a.name, url = _a.url, userTask = _a.userTask;\n        return (deadline !== userTask.deadline ||\n            description !== userTask.description ||\n            name !== userTask.name ||\n            url !== userTask.url);\n    };\n    EditUserTask.prototype.addSubTask = function () {\n        this.props.openDialog(React.createElement(AddOrEditSubTask, { mode: \"add\", userTask: this.state.userTask, closeDialog: this.props.closeDialog, userTasksRepo: this.props.userTasksRepo }));\n    };\n    EditUserTask.prototype.editSubTask = function (subTask) {\n        this.props.openDialog(React.createElement(AddOrEditSubTask, { mode: \"edit\", subTask: subTask, userTask: this.state.userTask, closeDialog: this.props.closeDialog, userTasksRepo: this.props.userTasksRepo }));\n    };\n    EditUserTask.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, name = _a.name, description = _a.description, url = _a.url, deadline = _a.deadline, subTasks = _a.subTasks, showCalendar = _a.showCalendar, userTask = _a.userTask;\n        var id = userTask.id, courseName = userTask.courseName;\n        var _b = this.props, onUpdate = _b.onUpdate, onDelete = _b.onDelete;\n        var isModified = this.isModified();\n        var taskType = getTaskType(userTask);\n        var isCustomTask = taskType === 'customTask';\n        var expired = moment(userTask.deadline) < moment();\n        var intl = this.context.intl;\n        return React.createElement(\"div\", { className: \"editTaskDialog sv-html-portlet sv-portlet sv-skip-spacer\" },\n            React.createElement(\"h2\", null, isCustomTask ?\n                React.createElement(FormattedMessage, { id: \"task.editWorkGoals\", defaultMessage: 'Redigera arbetsm\\u00E5l' }) :\n                React.createElement(FormattedMessage, { id: \"task.editTask\", defaultMessage: 'Redigera uppgift' })),\n            React.createElement(\"hr\", null),\n            React.createElement(TextInput, { autoFocus: true, label: isCustomTask ? intl.formatMessage({ id: 'task.targetNameLabel', defaultMessage: 'Arbetsmålets namn' }) : intl.formatMessage({ id: 'task.taskNameLabel', defaultMessage: 'Uppgiftens namn' }), id: \"EditUserTask:name\", placeholder: isCustomTask ? intl.formatMessage({ id: 'task.whatShouldYouDoPlhd', defaultMessage: 'Vad ska du göra?' }) : intl.formatMessage({ id: 'task.enterTaskNamePlhd', defaultMessage: 'Ange uppgiftens namn...' }), value: name, onChange: function (name) { return _this.setState({ name: name }); } }),\n            isCustomTask && React.createElement(React.Fragment, null,\n                React.createElement(TextAreaFormField, { rows: 5, label: intl.formatMessage({ id: 'common.descriptionLabel', defaultMessage: 'Beskrivning' }), id: \"EditUserTask:description\", placeholder: intl.formatMessage({ id: 'common.addDescriptionPlhd', defaultMessage: 'Lägg till en beskrivning...' }), value: description, onChange: function (description) { return _this.setState({ description: description }); } }),\n                React.createElement(TextInput, { label: intl.formatMessage({ id: 'common.linkLabel', defaultMessage: \"Länk\" }), id: \"EdutUserTask:url\", placeholder: \"http(s)://...\", value: url, onChange: function (url) { return _this.setState({ url: url }); } })),\n            React.createElement(FormField, { label: intl.formatMessage({ id: 'task.setDeadline', defaultMessage: 'Ange deadline' }) }, (deadline || showCalendar) ?\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(ReactDatePicker, { ref: function (elem) { return _this.datePicker = elem; }, id: \"EditUserTask:deadline\", nextMonthButtonLabel: \"\", previousMonthButtonLabel: \"\", showWeekNumbers: true, selected: deadline && moment(deadline).toDate(), autoFocus: showCalendar, dateFormat: \"yyyy-MM-dd\", className: expired ? \"expired\" : undefined, locale: intl.locale, popperPlacement: isCustomTask ? \"top-start\" : \"bottom-start\", onBlur: function () { return _this.setState({ showCalendar: false }); }, onChange: function (value) {\n                                _this.setState({\n                                    deadline: value && moment(value).format(\"YYYY-MM-DD\"),\n                                    showCalendar: false\n                                });\n                            } })),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"a\", { className: \"deleteDate\", href: \"#\", title: intl.formatMessage({ id: 'task.removeDeadline', defaultMessage: 'Ta bort deadline' }), onClick: function (ev) {\n                                ev.preventDefault();\n                                _this.setState({ deadline: null, showCalendar: false });\n                            } }))) :\n                React.createElement(\"div\", { className: \"top\", ref: function () { _this.datePicker = null; } },\n                    React.createElement(\"a\", { className: \"btn\", onClick: function (ev) {\n                            if (_this.datePicker) {\n                                _this.datePicker.setOpen(true);\n                            }\n                            _this.setState({\n                                showCalendar: true\n                            });\n                        } },\n                        React.createElement(\"i\", { className: \"fas fa-calendar-alt\", \"aria-hidden\": \"true\" }),\n                        React.createElement(FormattedMessage, { id: \"task.setDeadlineLabel\", defaultMessage: \"Ange deadline...\" })))),\n            React.createElement(FormField, { label: intl.formatMessage({ id: 'task.subTasks', defaultMessage: 'Underuppgifter' }) },\n                React.createElement(\"div\", { className: \"learningGoalTasks\" },\n                    React.createElement(\"div\", { className: \"taskContainer\" }, subTasks && subTasks.map(function (subTask) { return React.createElement(\"div\", { key: subTask.id, className: \"align-horizontal\" },\n                        React.createElement(\"div\", { className: \"horizontalItem top\" },\n                            React.createElement(\"a\", { onClick: function () { return _this.editSubTask(subTask); }, href: \"#\" }, subTask.name))); }))),\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"top\" },\n                        React.createElement(\"button\", { id: \"EditUserTask:addSubTask\", className: \"btn\", onClick: function () { return _this.addSubTask(); } },\n                            React.createElement(\"i\", { className: \"fas fa-plus\", \"aria-hidden\": \"true\" }),\n                            \" \",\n                            React.createElement(FormattedMessage, { id: \"task.addSubtask\", defaultMessage: \"L\\u00E4gg till underuppgift\" }))))),\n            React.createElement(\"div\", { className: \"divider large\" }),\n            React.createElement(\"div\", { className: \"align-horizontal\" },\n                React.createElement(\"div\", { className: \"horizontalButton top\" },\n                    React.createElement(\"button\", { tabIndex: 1, className: \"btn btn-default\", onClick: function () {\n                            isModified ? onUpdate(function (userTask) {\n                                userTask.name = name;\n                                userTask.description = description;\n                                userTask.url = url;\n                                userTask.deadline = deadline;\n                            }) : _this.props.closeDialog();\n                        } },\n                        React.createElement(FormattedMessage, { id: \"common.save\", defaultMessage: \"Spara\" }))),\n                React.createElement(\"div\", { className: \"horizontalButton top\" },\n                    React.createElement(\"button\", { tabIndex: 1, className: \"btn\", onClick: function () {\n                            _this.props.closeDialog();\n                        } },\n                        React.createElement(FormattedMessage, { id: \"common.cancel\", defaultMessage: \"Avbryt\" }))),\n                React.createElement(\"div\", { className: \"confirm top pull-right\" },\n                    React.createElement(\"button\", { tabIndex: 1, className: \"btn btn-warning\", onClick: function () {\n                            onDelete(id);\n                        } }, isCustomTask ?\n                        React.createElement(FormattedMessage, { id: \"task.removeWorkGoals\", defaultMessage: \"Ta bort arbetsm\\u00E5l\" }) :\n                        React.createElement(FormattedMessage, { id: \"task.removeThisTask\", defaultMessage: \"Ta bort den h\\u00E4r uppgiften\" })))));\n    };\n    EditUserTask.contextType = LanguageContext;\n    return EditUserTask;\n}(React.Component));\nexport { EditUserTask };\n","export function getTaskType(userTask) {\n    return userTask.course && userTask.task && userTask.course.length > 0 && userTask.task.length > 0 ?\n        'courseBuilderTask' :\n        userTask.siteVisionPageId ?\n            'siteVisionTask' :\n            userTask.courseInfo ?\n                'subjectPlannerTask' :\n                'customTask';\n}\n","export { WeekPlanner } from './weekplanner';\n","import * as tslib_1 from \"tslib\";\nimport { arrayToLookup, compareProp } from \"../../utils/utils\";\nexport function refine(tasks) {\n    var e_1, _a, e_2, _b;\n    var result = [];\n    var mapper = {};\n    var tasksPerCourse = arrayToLookup(tasks, function (t) { return t.courseName || ''; });\n    try {\n        for (var _c = tslib_1.__values(Object.keys(tasksPerCourse).sort().filter(function (x) { return x; }).concat(tasksPerCourse[''] ?\n            [''] : [])), _d = _c.next(); !_d.done; _d = _c.next()) {\n            var courseName = _d.value;\n            var courseTasks = tasksPerCourse[courseName] || tasksPerCourse[''];\n            var tasksPerLearningGoal = arrayToLookup(courseTasks, function (t) { return t.learningGoal; });\n            var resultLearningGoals = [];\n            try {\n                for (var _e = (e_2 = void 0, tslib_1.__values(Object.keys(tasksPerLearningGoal))), _f = _e.next(); !_f.done; _f = _e.next()) {\n                    var learningGoal = _f.value;\n                    var lgTasks = tasksPerLearningGoal[learningGoal].sort(compareProp(\"dateTime\"));\n                    var learningGoalTask = lgTasks\n                        .filter(function (t) { return t.name == null; }) // If name is undefined or null, this represents a learning goal\n                    [0];\n                    var url = learningGoalTask && learningGoalTask.url;\n                    resultLearningGoals.push({\n                        name: learningGoal,\n                        allTasks: lgTasks,\n                        url: url,\n                        step: lgTasks.map(function (t) { return t.step; }).filter(function (step) { return step; })[0],\n                        tasks: lgTasks.filter(function (t) { return t.name; })\n                    });\n                }\n            }\n            catch (e_2_1) { e_2 = { error: e_2_1 }; }\n            finally {\n                try {\n                    if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                }\n                finally { if (e_2) throw e_2.error; }\n            }\n            result.push({\n                courseName: courseName,\n                learningGoals: resultLearningGoals\n            });\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return result;\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { OpenCloseBox } from '../utility-components/open-close-box';\nimport { preserveImpersonationQuery } from '../../access-control';\nimport { courseNameToCssClass } from '../calendar/course-name-to-css-class';\nimport { getTaskType } from './get-task-type';\nimport moment from 'moment';\nimport { Features } from '../../features';\nimport cfg from '../../globals/KED.cfg';\nimport { FormattedMessage } from 'react-intl';\nimport { LanguageContext } from '../utility-components/LanguageContext';\nimport { env } from '../../globals/KED.env';\n;\nvar UserTasksBox = /** @class */ (function (_super) {\n    tslib_1.__extends(UserTasksBox, _super);\n    function UserTasksBox(props) {\n        return _super.call(this, props) || this;\n    }\n    UserTasksBox.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, courseName = _a.courseName, learningGoals = _a.learningGoals, progressData = _a.progressData, displayProgress = _a.displayProgress;\n        var isOpen = !!this.props.openCourses[courseName];\n        var features = new Features();\n        var intl = this.context.intl;\n        var isGymnasiumStudent = ('' + env.currentUser.schoolType).toLowerCase() === \"gymnasium\";\n        return React.createElement(OpenCloseBox, { title: React.createElement(\"h5\", null, courseName || (isGymnasiumStudent ? React.createElement(FormattedMessage, { id: \"userTasks.gymnasiumSchoolGoals\", defaultMessage: \"\\u00D6vriga uppgifter\" }) : React.createElement(FormattedMessage, { id: \"userTasks.primarySchoolGoals\", defaultMessage: \"Egna l\\u00E4randem\\u00E5l\" }))), headerOpen: isOpen, className: courseName && courseNameToCssClass('wp-course-', courseName), onOpenClose: function (becameOpen) { return _this.props.setIsOpen(courseName, becameOpen); }, displayProgress: displayProgress, progressData: progressData }, learningGoals.map(function (lg) {\n            return React.createElement(\"div\", { key: lg.name, className: \"learningGoalContainer\" },\n                lg.step && React.createElement(\"div\", { className: \"stepIndicator\" }, lg.step),\n                React.createElement(\"div\", { className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"learningGoalText horizontalItem top\" }, lg.name),\n                    React.createElement(\"div\", { className: \"horizontalItem\" },\n                        \"\\u00A0\",\n                        React.createElement(\"a\", { className: \"trash\", href: \"#\", title: intl.formatMessage({ id: 'userTasks.deleteLearningGoal', defaultMessage: 'Ta bort lärandemålet och dess uppgifter' }), onClick: function (ev) {\n                                ev.preventDefault();\n                                _this.props.removeLearningGoal(lg);\n                            } },\n                            React.createElement(\"i\", { className: \"fas fa-trash-alt\" })))),\n                React.createElement(\"div\", { className: \"learningGoalTasks\" },\n                    React.createElement(\"div\", { className: \"taskContainer\" }, lg.tasks.map(function (userTask) {\n                        var isWorking = userTask.$meta === 'adding' || userTask.$meta === 'deleting' || userTask.$meta === 'updating';\n                        var taskType = getTaskType(userTask);\n                        var expired = moment(userTask.deadline).startOf('day') < moment().startOf('day');\n                        return React.createElement(\"div\", { key: userTask.id, style: isWorking ? { opacity: 0.5 } : {} },\n                            React.createElement(\"div\", { className: \"align-horizontal\" },\n                                React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                    React.createElement(\"div\", { className: \"checkBox\" + (userTask.done ? \" checked\" : \"\"), onClick: function (ev) { return !isWorking && _this.props.setTaskDone(userTask, !userTask.done); } })),\n                                React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                    taskType === 'courseBuilderTask' ?\n                                        React.createElement(\"a\", { href: getTaskUrl(userTask, _this.props.viewCourseUrl) }, userTask.name) :\n                                        taskType === 'subjectPlannerTask' ?\n                                            React.createElement(\"a\", { href: getSubjectPlannerTaskUrl(userTask) }, userTask.name) :\n                                            taskType === 'siteVisionTask' ?\n                                                React.createElement(\"a\", { href: userTask.url }, userTask.name) :\n                                                React.createElement(\"a\", { className: !userTask.url ? \"link-less\" : \"\", href: userTask.url || undefined, target: (userTask.url + '').toLowerCase().startsWith(location.host.toLowerCase()) ?\n                                                        \"_self\" :\n                                                        \"_blank\" }, userTask.name),\n                                    userTask.deadline && React.createElement(\"div\", { className: \"dateSet\" + (expired ? ' expired' : '') },\n                                        React.createElement(\"i\", { title: moment(userTask.deadline).format(\"YYYY-MM-DD\"), className: \"fas fa-calendar-alt\", \"aria-hidden\": \"true\", onClick: function () { } }))),\n                                React.createElement(\"div\", { className: \"horizontalItem top taskEdit\" },\n                                    React.createElement(\"a\", { className: \"editItem\", onClick: function () { return _this.props.editTask(userTask); } }))),\n                            userTask.subTasks && React.createElement(\"div\", { className: \"subtasks\" }, userTask.subTasks.map(function (subTask) {\n                                return React.createElement(\"div\", { key: subTask.id },\n                                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                        React.createElement(\"div\", { className: \"checkBox\" + (subTask.done ? \" checked\" : \"\"), onClick: function (ev) {\n                                                return !isWorking &&\n                                                    _this.props.setSubTaskDone(userTask, subTask, !subTask.done);\n                                            } })),\n                                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                        React.createElement(\"a\", { href: subTask.url || undefined, target: (userTask.url + '').toLowerCase().startsWith(location.host.toLowerCase()) ?\n                                                \"_self\" :\n                                                \"_blank\", className: subTask.url ?\n                                                undefined :\n                                                'link-less' }, subTask.name)),\n                                    React.createElement(\"div\", { className: \"horizontalItem top taskEdit\" },\n                                        React.createElement(\"a\", { className: \"editItem\", onClick: function () { return _this.props.editSubTask(userTask, subTask); } })));\n                            })));\n                    }))),\n                React.createElement(\"div\", { className: \"learningGoalTools\" },\n                    React.createElement(\"div\", { className: \"btn addOwnGoal\", onClick: function () { return _this.props.addOwnTask(_this.props.courseName, lg.name); } },\n                        React.createElement(\"i\", { className: \"fas fa-plus\", \"aria-hidden\": \"true\" }),\n                        \" \",\n                        isGymnasiumStudent ?\n                            React.createElement(FormattedMessage, { id: \"weekplanner.learningGoalGymnasium\", defaultMessage: \"Uppgift\" }) :\n                            React.createElement(FormattedMessage, { id: 'userTasks.addLearningGoal', defaultMessage: 'Eget arbetsm\\u00E5l' }))),\n                React.createElement(\"br\", null));\n        }));\n    };\n    UserTasksBox.contextType = LanguageContext;\n    return UserTasksBox;\n}(React.Component));\nexport { UserTasksBox };\nfunction getTaskUrl(userTask, viewCourseUrl) {\n    if (userTask.course && userTask.course.length > 0 && userTask.task && userTask.task.length > 0) {\n        var courseUrl = preserveImpersonationQuery(viewCourseUrl, { courseId: userTask.course[0].id });\n        return courseUrl + \"#/task/\" + userTask.task[0].id;\n    }\n    return userTask.url;\n}\nfunction getSubjectPlannerTaskUrl(userTask) {\n    if (userTask.courseInfo && userTask.task && userTask.task.length > 0) {\n        var _a = userTask.courseInfo, school = _a.school, course = _a.course, tab = _a.tab;\n        var courseUrl = preserveImpersonationQuery(cfg.KED_SUBJECT_PLANNER_URL, {});\n        return courseUrl + \"#/\" + school + \"/courses/\" + course + \"/tabs/\" + tab + \"/tasks/\" + userTask.task[0].id;\n    }\n    return userTask.url;\n}\n","import * as tslib_1 from \"tslib\";\nimport moment from 'moment';\nimport { localMoment } from '../../globals/moment-sv-locale';\nvar WeekPlannerPersistedState = /** @class */ (function () {\n    function WeekPlannerPersistedState(userOrCopy) {\n        if (typeof userOrCopy === 'string') {\n            this.user = userOrCopy;\n            this.lastWrite = Date.now();\n            this.weekDate = localMoment().startOf('week').valueOf();\n            this.openCourses = {};\n        }\n        else {\n            Object.assign(this, userOrCopy);\n        }\n    }\n    WeekPlannerPersistedState.load = function (user) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var cookie, storedData, state;\n            return tslib_1.__generator(this, function (_a) {\n                cookie = localStorage.getItem('WeekPlannerPersistedState2');\n                storedData = cookie && JSON.parse(cookie);\n                state = new WeekPlannerPersistedState(user);\n                if (storedData)\n                    Object.assign(state, storedData);\n                return [2 /*return*/, state.user === user && !state.isExpired(moment()) ?\n                        state : new WeekPlannerPersistedState(user)];\n            });\n        });\n    };\n    WeekPlannerPersistedState.prototype.save = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var json;\n            return tslib_1.__generator(this, function (_a) {\n                this.lastWrite = Date.now();\n                json = JSON.stringify(this);\n                localStorage.setItem('WeekPlannerPersistedState2', json);\n                return [2 /*return*/];\n            });\n        });\n    };\n    WeekPlannerPersistedState.prototype.isExpired = function (asOf) {\n        return moment(this.lastWrite)\n            .isBefore(asOf.add(0 - WeekPlannerPersistedState.EXPIRATION_HOURS, 'hours'));\n    };\n    WeekPlannerPersistedState.EXPIRATION_HOURS = 12;\n    WeekPlannerPersistedState.VERSION = 2;\n    return WeekPlannerPersistedState;\n}());\nexport { WeekPlannerPersistedState };\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { UserTasksBox } from './user-tasks-box';\nimport { createUUID } from \"kedbackend/client\";\nimport { refine } from './refiner';\nimport { env } from '../../globals/KED.env';\nimport { compareProp } from '../../utils/utils';\nimport moment from 'moment';\nimport { Dialogs } from '../utility-components/dialogs';\nimport { AddCustomGoal } from './add-custom-goal';\nimport { AddCustomTask } from './add-custom-task';\nimport { EditUserTask } from './edit-user-task';\nimport { Spinner } from '../course-builder/sub-components/spinner';\nimport { OpenCloseBox } from '../utility-components/open-close-box';\nimport { PendingJob } from '../../utils/pending-job';\nimport { AddOrEditSubTask } from './add-or-edit-sub-task';\nimport { getAdjustedWeek, KEDWeek, getNextWeekDate, getPrevWeekDate } from '../../utils/weekutil';\nimport { FormattedMessage } from 'react-intl';\nimport { LanguageContext } from '../utility-components/LanguageContext';\nimport { Progress } from '../charts/progress';\nimport { getWeekplannerProgressData } from '../charts/charts-utils';\nimport { features } from '../../features';\nvar MAX_STRATEGY_LENGTH = 16384;\nvar MAX_ASSESSMENT_LENGTH = 16384;\nvar WeekPlanner = /** @class */ (function (_super) {\n    tslib_1.__extends(WeekPlanner, _super);\n    function WeekPlanner(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            userTasks: [],\n            weekDate: Date.now(),\n            openCourses: {},\n            dialogs: [],\n            saving: false,\n            weekTextsUT: null,\n            isLoading: true,\n            isCopyingTasks: false\n        };\n        _this.onChange = _this.onChange.bind(_this);\n        _this.weekTextsSavingJob = new PendingJob(function () { return _this.saveWeekTexts(); });\n        return _this;\n    }\n    WeekPlanner.prototype.componentDidMount = function () {\n        this.props.env.userTasksRepo.subscribe(this.onChange);\n    };\n    WeekPlanner.prototype.componentWillUnmount = function () {\n        this.props.env.userTasksRepo.unsubscribe(this.onChange);\n        this.weekTextsSavingJob.stop();\n    };\n    WeekPlanner.prototype.onChange = function (userTasks, persisted, weekTextsUT) {\n        var newState = {\n            userTasks: userTasks,\n            weekDate: persisted.weekDate,\n            openCourses: persisted.openCourses,\n            weekTextsUT: weekTextsUT,\n            isLoading: false\n        };\n        if (!this.state.weekTextsUT || (weekTextsUT.dateTime !== this.state.weekTextsUT.dateTime)) {\n            // Changing week. Reset to new week's values\n            newState.strategy = weekTextsUT.weekTexts.strategy;\n            newState.assessment = weekTextsUT.weekTexts.assessment;\n        }\n        this.setState(newState); // React's use of Pick instead of Partial makes things complex here.\n    };\n    WeekPlanner.prototype.isWeekTextsEdited = function () {\n        var _a = this.state, strategy = _a.strategy, assessment = _a.assessment, weekTextsUT = _a.weekTextsUT;\n        return !!weekTextsUT && (strategy !== weekTextsUT.weekTexts.strategy || assessment !== weekTextsUT.weekTexts.assessment);\n    };\n    WeekPlanner.prototype.saveWeekTexts = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, strategy, assessment, weekTextsUT;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        console.log(\"Saving texts...\");\n                        _a = this.state, strategy = _a.strategy, assessment = _a.assessment, weekTextsUT = _a.weekTextsUT;\n                        if (!this.isWeekTextsEdited()) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.props.env.userTasksRepo.upsert(weekTextsUT, function (ut) {\n                                ut.weekTexts = { strategy: strategy, assessment: assessment };\n                            })];\n                    case 1:\n                        _b.sent();\n                        _b.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WeekPlanner.prototype.prevWeek = function () {\n        //this.saveWeekTexts(); \n        var prevWeekObj = getPrevWeekDate(moment(this.state.weekDate));\n        this.props.env.userTasksRepo.changeWeek(prevWeekObj.nextDate, prevWeekObj.adjusted);\n    };\n    WeekPlanner.prototype.nextWeek = function () {\n        //this.saveWeekTexts();\n        var nextWeekObj = getNextWeekDate(moment(this.state.weekDate));\n        this.props.env.userTasksRepo.changeWeek(nextWeekObj.nextDate, nextWeekObj.adjusted);\n    };\n    WeekPlanner.prototype.openDialog = function (dialog) {\n        this.setState({ dialogs: tslib_1.__spread(this.state.dialogs, [dialog]) });\n    };\n    WeekPlanner.prototype.openAddGoalDialog = function () {\n        var _this = this;\n        this.openDialog(React.createElement(AddCustomGoal, { onSave: function (learningGoal) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            if (!learningGoal)\n                                throw new Error(this.context.intl.formatMessage({ id: 'weekplanner.emptyLearningGoalErr', defaultMessage: 'Lärandemålet kan inte vara tomt' }));\n                            if (!!this.state.saving) return [3 /*break*/, 5];\n                            this.setState({ saving: true });\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, , 3, 4]);\n                            return [4 /*yield*/, this.addCustomGoal(learningGoal)];\n                        case 2:\n                            _a.sent();\n                            return [3 /*break*/, 4];\n                        case 3:\n                            this.setState({ saving: false });\n                            return [7 /*endfinally*/];\n                        case 4:\n                            this.closeDialog();\n                            _a.label = 5;\n                        case 5: return [2 /*return*/];\n                    }\n                });\n            }); } }));\n    };\n    WeekPlanner.prototype.openAddOwnTaskDialog = function (courseName, learningGoalName) {\n        var _this = this;\n        this.openDialog(React.createElement(AddCustomTask, { isTask: !courseName, onSave: function (name, description, url) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            if (!name)\n                                throw new Error(this.context.intl.formatMessage({ id: 'weekplanner.nameCannotBeEmpty', defaultMessage: 'Namnet kan inte vara tomt' }));\n                            if (!!this.state.saving) return [3 /*break*/, 5];\n                            this.setState({ saving: true });\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, , 3, 4]);\n                            return [4 /*yield*/, this.addCustomTask(courseName, learningGoalName, name, description, url)];\n                        case 2:\n                            _a.sent();\n                            return [3 /*break*/, 4];\n                        case 3:\n                            this.setState({ saving: false });\n                            return [7 /*endfinally*/];\n                        case 4:\n                            this.closeDialog();\n                            _a.label = 5;\n                        case 5: return [2 /*return*/];\n                    }\n                });\n            }); } }));\n    };\n    WeekPlanner.prototype.editTask = function (userTask) {\n        var _this = this;\n        this.openDialog(React.createElement(EditUserTask, { userTasksRepo: this.props.env.userTasksRepo, userTask: userTask, onUpdate: function (updater) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var test;\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            test = tslib_1.__assign({}, userTask);\n                            updater(test);\n                            if (!test.name)\n                                throw new Error(this.context.intl.formatMessage({ id: 'weekplanner.nameMustNotBeEmpty', defaultMessage: 'Namnet får inte vara tomt' }));\n                            this.closeDialog();\n                            return [4 /*yield*/, this.props.env.userTasksRepo.update([userTask], updater)];\n                        case 1:\n                            _a.sent();\n                            return [2 /*return*/];\n                    }\n                });\n            }); }, onDelete: function (id) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            this.closeDialog();\n                            return [4 /*yield*/, this.props.env.userTasksRepo.delete([id])];\n                        case 1:\n                            _a.sent();\n                            return [2 /*return*/];\n                    }\n                });\n            }); }, openDialog: function (dialog) { return _this.openDialog(dialog); }, closeDialog: function () { return _this.closeDialog(); } }));\n    };\n    WeekPlanner.prototype.editSubTask = function (userTask, subTask) {\n        var _this = this;\n        this.openDialog(React.createElement(AddOrEditSubTask, { userTasksRepo: this.props.env.userTasksRepo, mode: \"edit\", userTask: userTask, subTask: subTask, closeDialog: function () { return _this.closeDialog(); } }));\n    };\n    WeekPlanner.prototype.closeDialog = function () {\n        this.setState({ dialogs: this.state.dialogs.slice(0, this.state.dialogs.length - 1) });\n    };\n    WeekPlanner.prototype.addCustomGoal = function (learningGoal) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var latestTimeStamp;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        latestTimeStamp = Math.max.apply(Math.max, [this.state.weekDate].concat(this.state.userTasks.map(function (t) { return t.dateTime; })));\n                        return [4 /*yield*/, this.props.env.userTasksRepo.insert([{\n                                    id: createUUID(),\n                                    learningGoal: learningGoal,\n                                    dateTime: latestTimeStamp + 2000\n                                }])];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.props.env.userTasksRepo.setWeekPlannerBoxOpen(\"\", true)];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WeekPlanner.prototype.removeLearningGoal = function (learningGoal) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (learningGoal.tasks.length > 0) {\n                            if (!confirm(this.context.intl.formatMessage({ id: 'weekplanner.confirmRemoveLearningObjectives', defaultMessage: 'Ta bort lärandemål samt {learningGoalsNumber} uppgifter?' }, { learningGoalsNumber: learningGoal.tasks.length }))) {\n                                return [2 /*return*/];\n                            }\n                        }\n                        return [4 /*yield*/, this.props.env.userTasksRepo.delete(learningGoal.allTasks.map(function (t) { return t.id; }))];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WeekPlanner.prototype.addCustomTask = function (courseName, learningGoal, name, description, url) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var latestTimeStamp;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        latestTimeStamp = Math.max.apply(Math.max, [this.state.weekDate].concat(this.state.userTasks.map(function (t) { return t.dateTime; })));\n                        /*const emptyLearningGoalPlaceholder = this.state.userTasks.find(ut =>\n                          ut.name == null &&\n                          !ut.courseName &&\n                          ut.learningGoal === learningGoal);\n                    \n                        if (emptyLearningGoalPlaceholder) {\n                          // Hijack learning-goal placeholder and make it the real task.\n                          // This will make the learning goal disappear once this task\n                          // is deleted.\n                          await userTasksRepo.update([emptyLearningGoalPlaceholder], ut => {\n                            Object.assign(ut, { name, description, url });\n                          });\n                        } else {*/\n                        // Add another task to same learning-goal\n                        return [4 /*yield*/, this.props.env.userTasksRepo.insert([{\n                                    id: createUUID(),\n                                    dateTime: latestTimeStamp + 2000,\n                                    courseName: courseName,\n                                    learningGoal: learningGoal,\n                                    name: name,\n                                    description: description,\n                                    url: url\n                                }])];\n                    case 1:\n                        /*const emptyLearningGoalPlaceholder = this.state.userTasks.find(ut =>\n                          ut.name == null &&\n                          !ut.courseName &&\n                          ut.learningGoal === learningGoal);\n                    \n                        if (emptyLearningGoalPlaceholder) {\n                          // Hijack learning-goal placeholder and make it the real task.\n                          // This will make the learning goal disappear once this task\n                          // is deleted.\n                          await userTasksRepo.update([emptyLearningGoalPlaceholder], ut => {\n                            Object.assign(ut, { name, description, url });\n                          });\n                        } else {*/\n                        // Add another task to same learning-goal\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WeekPlanner.prototype.setIsOpen = function (courseName, isOpen) {\n        this.props.env.userTasksRepo.setWeekPlannerBoxOpen(courseName, isOpen);\n    };\n    WeekPlanner.prototype.setTaskDone = function (task, done) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.props.env.userTasksRepo.setTaskDoneState(task, done)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WeekPlanner.prototype.setSubTaskDone = function (task, subTask, done) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.props.env.userTasksRepo.setSubTaskDoneState(task, subTask.id, done)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WeekPlanner.prototype.copyFromPreviousWeek = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, userTasks_1, openCourses, weekDate, prevWeek, prevWeekNo, prevKEDWeek, prevTasks, test, latestTimeStamp_1, copies;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.setState({ isCopyingTasks: true })];\n                    case 1:\n                        _b.sent();\n                        _b.label = 2;\n                    case 2:\n                        _b.trys.push([2, , 5, 6]);\n                        _a = this.state, userTasks_1 = _a.userTasks, openCourses = _a.openCourses, weekDate = _a.weekDate;\n                        prevWeek = moment(weekDate).add(-1, 'week');\n                        prevWeekNo = getAdjustedWeek(prevWeek);\n                        prevKEDWeek = KEDWeek(prevWeek.year(), prevWeekNo);\n                        return [4 /*yield*/, this.props.env.kedBackendClient.list(\"usertasks\", {\n                                from: prevKEDWeek.notBefore,\n                                to: prevKEDWeek.notAfter,\n                                role: \"USER\",\n                                include: [\"task\", \"course\", \"acl\"],\n                                flags: [\"includeIdsOnly\"]\n                            })];\n                    case 3:\n                        prevTasks = _b.sent();\n                        prevTasks = prevTasks\n                            .filter(function (prevTask) { return !prevTask.done; }) // Don't copy done tasks\n                            .filter(function (prevTask) { return !!prevTask.name; }) // Don't copy empty learning goals\n                            .filter(function (prevTask) { return !userTasks_1.some(function (taskOfCurrentWeek) {\n                            return taskOfCurrentWeek.name === prevTask.name &&\n                                taskOfCurrentWeek.learningGoal === prevTask.learningGoal &&\n                                taskOfCurrentWeek.courseName === prevTask.courseName;\n                        }); }); // Ignore identical tasks (already copied)\n                        test = [weekDate].concat(userTasks_1.map(function (t) { return t.dateTime; }));\n                        latestTimeStamp_1 = Math.max.apply(Math.max, [weekDate].concat(userTasks_1.map(function (t) { return t.dateTime; })));\n                        copies = prevTasks.sort(compareProp(\"dateTime\")).map(function (task) {\n                            var copy = tslib_1.__assign({}, task, { dateTime: latestTimeStamp_1 += 1000 });\n                            copy.id = createUUID();\n                            if (copy.subTasks) {\n                                copy.subTasks = copy.subTasks.filter(function (st) { return !st.done; });\n                            }\n                            // Stop sharing these to employees. We have the tutor solution for this instead!\n                            copy.acl = task.acl && task.acl.filter(function (ac) { return ac.startsWith(\"email:\"); });\n                            delete copy.$etag;\n                            return copy;\n                        });\n                        // Store it\n                        return [4 /*yield*/, this.props.env.userTasksRepo.insert(copies)];\n                    case 4:\n                        // Store it\n                        _b.sent();\n                        return [3 /*break*/, 6];\n                    case 5:\n                        this.setState({ isCopyingTasks: false });\n                        return [7 /*endfinally*/];\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WeekPlanner.prototype.getHeaderTitle = function () {\n        return React.createElement(\"h4\", null,\n            React.createElement(FormattedMessage, { id: \"weekplanner.logBook\", defaultMessage: \"Loggbok\" }));\n    };\n    WeekPlanner.prototype.render = function () {\n        var _this = this;\n        var weekNumber = moment(this.state.weekDate).week();\n        var showProgressCharts = features.weekplannerCharts;\n        //console.log(\"Weekydate: \"  + new Date(this.state.weekDate) + \" which is week no \" + weekNumber);\n        var currentWeek = moment().week();\n        var taskSets = refine(this.state.userTasks);\n        var _a = this.state, dialogs = _a.dialogs, weekTextsUT = _a.weekTextsUT, strategy = _a.strategy, assessment = _a.assessment, isLoading = _a.isLoading, isCopyingTasks = _a.isCopyingTasks;\n        var isSaving = weekTextsUT && (weekTextsUT.$meta === 'adding' || weekTextsUT.$meta === 'updating');\n        var isStrategyEdited = !!weekTextsUT && (strategy !== weekTextsUT.weekTexts.strategy);\n        var isAssessmentEdited = !!weekTextsUT && (assessment !== weekTextsUT.weekTexts.assessment);\n        var enableSaveButton = !isSaving && (isStrategyEdited || isAssessmentEdited);\n        var isGymnasiumStudent = ('' + env.currentUser.schoolType).toLowerCase() === \"gymnasium\";\n        var chartTasks = getWeekplannerProgressData(taskSets);\n        var percentage = chartTasks.totalNumberOfTasks > 0 ? chartTasks.completedTasks / chartTasks.totalNumberOfTasks * 100 : 0;\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"ked_boxed weekPlanner\" + (weekNumber === currentWeek ? \" currentWeek\" : \"\"), onKeyDown: function (ev) {\n                    if (ev.which === 83 && ev.ctrlKey) {\n                        ev.preventDefault();\n                        if (!isSaving && _this.isWeekTextsEdited()) {\n                            _this.weekTextsSavingJob.triggerChange(0);\n                        }\n                    }\n                } },\n                showProgressCharts && chartTasks.totalNumberOfTasks > 0 && this.getHeaderTitle(),\n                React.createElement(\"div\", { className: \"widgets\" },\n                    showProgressCharts && chartTasks.totalNumberOfTasks > 0 ? React.createElement(\"div\", { className: \"progressBar\" },\n                        React.createElement(Progress, { percentage: percentage })) : this.getHeaderTitle(),\n                    React.createElement(\"div\", { className: \"weekSelect\" },\n                        React.createElement(\"div\", { className: \"horizontalItem\" },\n                            React.createElement(\"p\", null,\n                                React.createElement(FormattedMessage, { id: \"weekplanner.weekNumber\", values: { weekNumber: weekNumber }, defaultMessage: \"Vecka {weekNumber}\" }))),\n                        React.createElement(\"div\", { className: \"horizontalItem\" },\n                            React.createElement(\"div\", { className: \"btn-group\" },\n                                React.createElement(\"button\", { className: \"btn\", onClick: function () { return _this.prevWeek(); } },\n                                    React.createElement(\"i\", { className: \"fas fa-angle-left\", \"aria-hidden\": \"true\" })),\n                                React.createElement(\"button\", { className: \"btn\", onClick: function () { return _this.nextWeek(); } },\n                                    React.createElement(\"i\", { className: \"fas fa-angle-right\", \"aria-hidden\": \"true\" })))))),\n                taskSets.length > 0 && React.createElement(\"hr\", null),\n                taskSets.map(function (props) {\n                    return React.createElement(UserTasksBox, tslib_1.__assign({ key: props.courseName }, props, { courseName: props.courseName, learningGoals: props.learningGoals, viewCourseUrl: _this.props.viewCourseUrl, openCourses: _this.state.openCourses, addOwnTask: function (courseName, learningGoalName) { return _this.openAddOwnTaskDialog(courseName, learningGoalName); }, setIsOpen: _this.setIsOpen.bind(_this), setTaskDone: _this.setTaskDone.bind(_this), setSubTaskDone: _this.setSubTaskDone.bind(_this), editTask: function (task) { return _this.editTask(task); }, editSubTask: function (task, subTask) { return _this.editSubTask(task, subTask); }, removeLearningGoal: function (lg) { return _this.removeLearningGoal(lg); }, displayProgress: showProgressCharts, progressData: chartTasks.subjectData[props.courseName] }));\n                }),\n                React.createElement(\"hr\", null),\n                isLoading ? React.createElement(Spinner, null) : React.createElement(\"div\", null,\n                    React.createElement(\"div\", { className: \"btn\", onClick: function (ev) { return _this.openAddGoalDialog(); } },\n                        React.createElement(\"i\", { className: \"far fa-list-alt\", \"aria-hidden\": \"true\" }),\n                        isGymnasiumStudent ? React.createElement(FormattedMessage, { id: \"weekplanner.learningGoalGymnasium\", defaultMessage: \"Uppgift\" }) : React.createElement(FormattedMessage, { id: \"weekplanner.learningGoalPrimary\", defaultMessage: \"Eget l\\u00E4randem\\u00E5l\" })),\n                    React.createElement(\"div\", { className: \"btn\", style: isCopyingTasks ? { opacity: 0.5 } : undefined, onClick: function (ev) { return (!isCopyingTasks) && _this.copyFromPreviousWeek(); } },\n                        React.createElement(\"i\", { className: \"far fa-clone\", \"aria-hidden\": \"true\" }),\n                        React.createElement(FormattedMessage, { id: \"weekplanner.copyPreviousWeekTaks\", defaultMessage: \"Kopiera ej klara fr\\u00E5n f\\u00F6reg\\u00E5ende vecka\" })),\n                    React.createElement(OpenCloseBox, { title: React.createElement(\"h5\", null,\n                            React.createElement(FormattedMessage, { id: \"weekplanner.strategyAndEvaluation\", defaultMessage: \"Strategi & Utv\\u00E4rdering\" })), headerOpen: this.state.openCourses[\"StratUtv\"], onOpenClose: function (becameOpen) { return _this.setIsOpen(\"StratUtv\", becameOpen); } },\n                        React.createElement(\"h3\", null,\n                            React.createElement(FormattedMessage, { id: \"weekplanner.strategy\", defaultMessage: \"Strategi\" })),\n                        React.createElement(\"p\", null,\n                            React.createElement(FormattedMessage, { id: \"weekplanner.strategyDescription\", defaultMessage: \"Hur jag ska g\\u00F6ra f\\u00F6r att l\\u00E4ra mig.\" })),\n                        React.createElement(\"hr\", null),\n                        React.createElement(\"textarea\", { className: \"weekplanner-textarea\", disabled: this.props.env.tutored, value: strategy && strategy.substr(0, MAX_STRATEGY_LENGTH), onChange: function (ev) {\n                                _this.setState({ strategy: (ev.target.value || '').substr(0, MAX_STRATEGY_LENGTH) });\n                                _this.weekTextsSavingJob.triggerChange(500);\n                            } }),\n                        React.createElement(\"h3\", null,\n                            React.createElement(FormattedMessage, { id: \"weekplanner.evaluation\", defaultMessage: \"Utv\\u00E4rdering\" })),\n                        React.createElement(\"p\", null,\n                            React.createElement(FormattedMessage, { id: \"weekplanner.evaluationDescription\", defaultMessage: \"Reflektion kring din arbetsinsats och dina valda strategier under veckan.Utv\\u00E4rdera i f\\u00F6rh\\u00E5llande till dina m\\u00E5l.\" })),\n                        React.createElement(\"hr\", null),\n                        React.createElement(\"textarea\", { className: \"weekplanner-textarea\", value: assessment && assessment.substr(0, MAX_ASSESSMENT_LENGTH), disabled: this.props.env.tutored, onChange: function (ev) {\n                                _this.setState({ assessment: (ev.target.value || '').substr(0, MAX_ASSESSMENT_LENGTH) });\n                                _this.weekTextsSavingJob.triggerChange(500);\n                            } }),\n                        React.createElement(\"div\", { className: \"btn\", tabIndex: 0, style: enableSaveButton ? {} : { opacity: 0.5 }, onClick: function () { return !isSaving && _this.weekTextsSavingJob.triggerChange(0); } },\n                            React.createElement(\"i\", { className: \"far fa-save\", \"aria-hidden\": \"true\" }),\n                            enableSaveButton ? React.createElement(FormattedMessage, { id: \"common.save\", defaultMessage: \" Spara\" }) : React.createElement(FormattedMessage, { id: \"common.saved\", defaultMessage: \" Sparad\" }))))),\n            React.createElement(Dialogs, { dialogs: dialogs, popDialog: function () {\n                    _this.setState(function (_a) {\n                        var dialogs = _a.dialogs;\n                        return ({ dialogs: dialogs.slice(0, dialogs.length - 1) });\n                    });\n                } }));\n    };\n    WeekPlanner.contextType = LanguageContext;\n    return WeekPlanner;\n}(React.Component));\nexport { WeekPlanner };\n","import * as tslib_1 from \"tslib\";\nimport '../../global-setters/set-all';\nimport env from '../../globals/KED.env';\nimport cfg from '../../globals/KED.cfg';\nvar bearerPromise = env.bearerProvider.getBearer(); // Start getting bearer as soon as possible.\nimport * as React from 'react';\nimport { CourseViewer } from '../../components/course-viewer';\nimport { showError } from \"../../utils/utils\";\nimport { Spinner } from \"../../components/course-builder/sub-components/spinner\"; // TODO: Move outside of course-builder!\nimport { LanguageContext } from '../../components/utility-components/LanguageContext';\nimport { injectIntl } from 'react-intl';\nimport { setupIntl } from '../../components/utility-components/SetupLanguageIntl';\nvar _KEDAppCourseViewer = /** @class */ (function (_super) {\n    tslib_1.__extends(_KEDAppCourseViewer, _super);\n    function _KEDAppCourseViewer(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            isTokenLoaded: false\n        };\n        return _this;\n    }\n    _KEDAppCourseViewer.prototype.componentWillMount = function () {\n        var _this = this;\n        bearerPromise.then(function () {\n            _this.setState({ isTokenLoaded: true });\n        }).catch(function (err) {\n            showError(err);\n        });\n    };\n    _KEDAppCourseViewer.prototype.render = function () {\n        var intl = this.props.intl;\n        return this.state.isTokenLoaded ?\n            React.createElement(LanguageContext.Provider, { value: { intl: intl } },\n                React.createElement(CourseViewer, { courseBuilderUrl: cfg.KED_COURSE_BUILDER_URL })) :\n            React.createElement(\"p\", null,\n                React.createElement(Spinner, null),\n                \"V.g. v\\u00E4nta... autenticerar...\");\n    };\n    return _KEDAppCourseViewer;\n}(React.Component));\nexport var KEDAppCourseViewer = setupIntl(injectIntl(_KEDAppCourseViewer));\n","import * as tslib_1 from \"tslib\";\nimport KED from '../../globals/KED';\nimport { KEDAppCourseViewer } from './app.courseviewer.client';\n// Add KEDAppCourseViewer to the set of components in KED.components\nKED.components = tslib_1.__assign({}, KED.components, { KEDAppCourseViewer: KEDAppCourseViewer });\n","import * as tslib_1 from \"tslib\";\nimport { parseQueryString } from '../utils/query-string';\nimport FeatureDescriptions from './feature-flags.json';\nimport { cfg } from '../globals/KED.cfg';\nvar Features = /** @class */ (function () {\n    function Features() {\n        var e_1, _a;\n        this._initialized = false;\n        var _loop_1 = function (featureName) {\n            Object.defineProperty(this_1, featureName, {\n                get: function () {\n                    if (!this._initialized)\n                        this.init();\n                    return this._features[featureName];\n                },\n                set: function (value) {\n                    throw new Error('Feature flags cannot be set here');\n                }\n            });\n        };\n        var this_1 = this;\n        try {\n            for (var _b = tslib_1.__values(Object.keys(FeatureDescriptions)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var featureName = _c.value;\n                _loop_1(featureName);\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    }\n    Features.prototype.init = function () {\n        var e_2, _a;\n        if (this._initialized)\n            return;\n        var turnedOnFeatures = (cfg.KED_FEATURES || \"\").split(',').map(function (name) { return name.trim().toLowerCase(); });\n        var query = parseQueryString(location.search, { toLower: true });\n        if (query.testversion) {\n            turnedOnFeatures = [\"*\"];\n        }\n        if (query.features) {\n            turnedOnFeatures = query.features\n                .split(',')\n                .map(function (feature) { return feature.trim().toLowerCase(); });\n        }\n        var turnOnAll = turnedOnFeatures.includes('*');\n        this._features = {};\n        try {\n            for (var _b = tslib_1.__values(Object.keys(FeatureDescriptions)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var featureName = _c.value;\n                this._features[featureName] = turnOnAll ||\n                    turnedOnFeatures.includes(featureName.toLowerCase());\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        this._initialized = true;\n    };\n    return Features;\n}());\nexport { Features };\nexport var features = new Features();\n","export * from './features';\n","import cfg from '../globals/KED.cfg';\ncfg.ENVIRONMENT = process.env.ENVIRONMENT;\ncfg.KED_API_URL = process.env.KED_API_URL; // \"https://kedbackendtest.azurewebsites.net/api/\"\ncfg.EDS_API_URL = process.env.EDS_API_URL; // \"https://edsportalowinapi.azurewebsites.net/api/\"\ncfg.KED_TOKEN_URL = process.env.KED_TOKEN_URL; // \"https://kedauthtest.azurewebsites.net/token\"\ncfg.KED_CLIENT_ID = process.env.KED_CLIENT_ID; // \"devclient\", \"testclient\", \"...\"\ncfg.KED_CLIENT_SECRET = process.env.KED_CLIENT_SECRET;\ncfg.KED_REALM = process.env.KED_REALM; // \"SE1\"\ncfg.KED_LOCALE = cfg.KED_LOCALE || process.env.KED_LOCALE; // \"sv\", \"en\". Only set from process.env if not set from SiteVision element config.\ncfg.KED_SCHOOL_LOCALE = cfg.KED_SCHOOL_LOCALE || process.env.KED_SCHOOL_LOCALE; // \"sv\", \"en_sin\", \"en_nin\". Only set from process.env if not set from SiteVision element config.\ncfg.KED_RESOURCES_URL = cfg.KED_RESOURCES_URL || process.env.KED_RESOURCES_URL;\n","/* These scripts assume some of the global vars have already been set:\n  * KED.cfg\n  * KED.env.currentUser\n\n  The rest will be set here (client side)\n*/\nimport './configure';\nimport './set-bearer-providers';\nimport './set-ked-backend-client';\nimport './set-eds-client';\n","import * as tslib_1 from \"tslib\";\nimport { parseQueryString, generateQueryString, splitUrlAndQuery } from \"../utils/query-string\";\nimport { WebServerBearerProvider, isomorphic, storage } from 'kedbackend/clientweb';\nimport { KedBearerProvider } from 'kedbackend/client';\nimport cfg from '../globals/KED.cfg';\nimport env from '../globals/KED.env';\nimport { IMPERSONATION_QUERY_PARAMS } from \"../access-control/index\";\nimport { cherryPickProps } from \"../utils/utils\";\nvar employeeClassroomScopes = [\n    \"https://www.googleapis.com/auth/classroom.courses\",\n    \"https://www.googleapis.com/auth/classroom.profile.emails\",\n    \"https://www.googleapis.com/auth/classroom.rosters\",\n    \"https://www.googleapis.com/auth/classroom.coursework.students\"\n];\nvar studentClassroomScopes = [\n    \"https://www.googleapis.com/auth/classroom.courses\",\n    \"https://www.googleapis.com/auth/classroom.coursework.me\"\n];\nfunction getMergedTokenPath(tokenPath, locationSearch, scopes) {\n    // Merge configured query params of token path with params given to current page\n    var currentQuery = parseQueryString(locationSearch);\n    var impersonationProps = cherryPickProps(currentQuery, IMPERSONATION_QUERY_PARAMS);\n    var _a = tslib_1.__read(splitUrlAndQuery(tokenPath), 2), tokenPathWithoutQuery = _a[0], tokenQueryString = _a[1];\n    var tokenPathQuery = parseQueryString(tokenQueryString);\n    return tokenPathWithoutQuery + generateQueryString(tslib_1.__assign({}, tokenPathQuery, impersonationProps, { scopes: scopes.join(',') }));\n}\nfunction getTokenId(mergedTokenPath, userEmail) {\n    return mergedTokenPath + \"/\" + userEmail;\n}\nfunction saveUserInfo(user, tokenId) {\n    env.currentUser = user;\n    var schoolgrade = parseQueryString(location.search, { toLower: true }).schoolgrade;\n    if (schoolgrade) {\n        var schoolGradeInt = parseInt(schoolgrade);\n        env.currentUser.schoolGrade = schoolGradeInt;\n        env.currentUser.schoolType = schoolGradeInt > 9 ? \"Gymnasium\" : \"Grundskolor\";\n    }\n    sessionStorage.setItem(\"userInfo\" + tokenId, JSON.stringify(user));\n}\nfunction loadUserInfo(tokenId) {\n    var storedSessionUser = sessionStorage.getItem(\"userInfo\" + tokenId);\n    if (storedSessionUser) {\n        env.currentUser = JSON.parse(storedSessionUser);\n    }\n}\nfunction createBearerProvider(mergedTokenPath, userEmail) {\n    var tokenId = getTokenId(mergedTokenPath, userEmail);\n    return new WebServerBearerProvider(mergedTokenPath, function (responseText) {\n        var res = JSON.parse(responseText);\n        if (!res.ok)\n            throw new Error(res.error);\n        if (res.user) {\n            saveUserInfo(res.user, tokenId);\n        }\n        return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\n    }, tokenId);\n}\nfunction createGoogleTokenProvider(mergedTokenPath, userEmail) {\n    var tokenId = getTokenId(mergedTokenPath, userEmail);\n    return new WebServerBearerProvider(mergedTokenPath, function (responseText) {\n        var res = JSON.parse(responseText);\n        if (!res.ok)\n            throw new Error(res.error);\n        return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\n    }, tokenId);\n}\nfunction createTestTokenProvider(tokenUrl, user, scopes) {\n    return new KedBearerProvider(isomorphic, storage, tokenUrl + user.mail + location.search, cfg.KED_CLIENT_ID, cfg.KED_CLIENT_SECRET, tokenUrl, {\n        email: user.mail.toLowerCase(),\n        roles: user.roles,\n        school: user.school,\n        schoolType: user.schoolType,\n        scopes: scopes,\n        name: user.displayName\n    });\n}\n// env.currentUser.mail is set by SiteVision server initially.\n// A response from /api/token may change the mail attribute of the current\n// user, so env.currentUser.mail may be different after getting a response.\n// However, the initial value is valuable always in order to distinguish the case\n// when one normal user logs out and another user logs in.\nvar initialUserEmail = env.currentUser && env.currentUser.mail; // Initial value of mail. May change.\nif (initialUserEmail) {\n    // KED\n    if (cfg.KED_TOKEN_PATH) {\n        //\n        //\n        // Production / SiteVision proxied /api/token to request tokens from:\n        //\n        //\n        var mergedTokenPath = getMergedTokenPath(cfg.KED_TOKEN_PATH, location.search, [\n            \"kedbackend\",\n            \"EDS\",\n        ]);\n        env.bearerProvider = createBearerProvider(mergedTokenPath, initialUserEmail);\n        loadUserInfo(getTokenId(mergedTokenPath, initialUserEmail));\n        var scopes = [\n            \"https://www.googleapis.com/auth/calendar.readonly\",\n            \"https://www.googleapis.com/auth/drive\"\n        ].concat(env.currentUser.roles.includes(\"EMPLOYEE\")\n            ? employeeClassroomScopes\n            : studentClassroomScopes);\n        // Google\n        var googleMergedPath = getMergedTokenPath(cfg.KED_TOKEN_PATH, location.search, scopes);\n        env.googleTokenProvider = createGoogleTokenProvider(googleMergedPath, initialUserEmail);\n    }\n    else if (cfg.KED_TOKEN_URL && cfg.KED_CLIENT_ID && cfg.KED_CLIENT_SECRET) {\n        //\n        //\n        // Test - go directly to KEDAUTH server to retrieve tokens\n        //\n        //\n        env.bearerProvider = createTestTokenProvider(cfg.KED_TOKEN_URL, env.currentUser, [\n            \"kedbackend\",\n            \"EDS\",\n        ]);\n        var scopes = [\n            \"https://www.googleapis.com/auth/calendar.readonly\",\n            \"https://www.googleapis.com/auth/drive\"\n        ].concat(env.currentUser.roles.includes(\"EMPLOYEE\")\n            ? employeeClassroomScopes\n            : studentClassroomScopes);\n        env.googleTokenProvider = createTestTokenProvider(cfg.KED_TOKEN_URL + \"/google\", env.currentUser, scopes);\n    }\n    else {\n        throw new Error(\"Missing configuration parameter KED_TOKEN_PATH\");\n    }\n}\n","import env from '../globals/KED.env';\nimport cfg from '../globals/KED.cfg';\nimport { isomorphic } from 'kedbackend/clientweb';\nimport { EdsClient } from '../apis/edsclient';\nenv.edsClient = new EdsClient(isomorphic, cfg.EDS_API_URL, env.bearerProvider, function () { return env.currentUser.mail; });\n","import env from '../globals/KED.env';\nimport cfg from '../globals/KED.cfg';\nimport { KedBackendClientWeb } from 'kedbackend/clientweb';\nenv.kedBackendClient = new KedBackendClientWeb(cfg.KED_API_URL, env.bearerProvider);\n","import KED from './KED';\n;\nif (!KED.cfg)\n    KED.cfg = {};\nexport default KED.cfg;\nexport var cfg = KED.cfg;\n","import KED from './ked';\nif (!KED.env)\n    KED.env = {};\nexport default KED.env;\nexport var env = KED.env;\n","export var KED_NAMESPACE = \"KED\";\nvar result = typeof KED === 'undefined' ? {} : KED;\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\n    window[KED_NAMESPACE] = result;\n}\nexport default result;\n","import env from './KED.env';\nimport { KedBackendRepo } from 'kedbackend/repo';\nimport { getGlobalId, createUUID } from 'kedbackend/client';\nimport cfg from './KED.cfg';\nif (!env.db) {\n    // Put db on env so that it is shared between subject planner and other components!\n    env.db = new KedBackendRepo(function () { return env.kedBackendClient; }, function () { return env.currentUser ?\n        env.currentUser.mail :\n        \"\"; }, function () { return env.currentUser ?\n        env.currentUser.displayName || env.currentUser.mail :\n        \"\"; });\n}\nexport var db = env.db;\nexport var globalId = getGlobalId(cfg.KED_REALM);\nexport var Schools = {\n    standardSchool: db.schools.name(\"standard\").cacheOptimized().single(),\n    get mySchool() { return db.schools.name(env.currentUser.school).cacheOptimized().single(); }\n};\nexport var CourseInstances = {\n    getBranchId: function (school, courseId) {\n        return school.switchMap(function (school) {\n            return db.branches\n                .hasEdgesFrom([school.officialBranchId])\n                .name(\"draft\")\n                .tags(courseId)\n                .idsOnly()\n                .map(function (_a) {\n                var id = _a.id;\n                return id;\n            })\n                .toValue()\n                .map(function (ids) { return ids.length > 0 ? ids[0] : undefined; });\n        });\n    },\n    /** Get a DRAFT branch for given course ID and given school.\n     * If there is not yet such a branch, create it using mutationsOnEmpty() which will\n     * lead to the C# code DocumentRepository.ReadOrMutate() via DocumentController.\n     */\n    getOrCreateBranchId: function (school, courseId) {\n        return db.courseInstances.idsOnly().id(courseId).switchMap(function () {\n            return school.switchMap(function (school) {\n                return db.branches\n                    .hasEdgesFrom([school.officialBranchId])\n                    .name(\"draft\")\n                    .tags(courseId)\n                    .idsOnly()\n                    .mutationsOnEmpty(function (tx) {\n                    // These 2 mutations will occur server side, atomically.\n                    // Will be sent on each request in the query, but will only execute if query results in zero items.\n                    //console.log(\"School:\", school);\n                    var id = createUUID();\n                    tx.add(\"branches\", {\n                        id: id,\n                        acl: [\n                            \"role:USER:R\",\n                            \"schoolRole:\" + school.name + \"/EMPLOYEE:S\"\n                        ],\n                        name: 'draft',\n                        schoolId: school.id,\n                        treeParentId: school.officialBranchId,\n                        tags: [courseId]\n                    });\n                    // Approving the branch makes sure that it was created by an EMPLOYEE on given school.\n                    tx.link2(\"branches\", school.officialBranchId, \"approvedChildren\", id);\n                })\n                    .single()\n                    .map(function (_a) {\n                    var id = _a.id;\n                    return id;\n                });\n            });\n        });\n    },\n    getAllDescendantIds: function (courseId) {\n        return db.courseBlocks.tags(courseId).idsOnly().concat(db.courseContents.tags(courseId).idsOnly()).concat(db.courseTabs.tags(courseId).idsOnly()).concat(db.tasks.tags(courseId).idsOnly())\n            .map(function (x) { return x.id; });\n    }\n};\n","export var KED_NAMESPACE = \"KED\";\nvar result = typeof KED === 'undefined' ? {} : KED;\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\n    window[KED_NAMESPACE] = result;\n}\nexport default result;\n","import moment from 'moment';\nimport cfg from '../globals/KED.cfg';\nif (cfg.KED_LOCALE === \"sv\") {\n    moment.updateLocale('sv', {\n        months: 'januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december'.split('_'),\n        monthsShort: 'jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec'.split('_'),\n        weekdays: 'söndag_måndag_tisdag_onsdag_torsdag_fredag_lördag'.split('_'),\n        weekdaysShort: 'sön_mån_tis_ons_tor_fre_lör'.split('_'),\n        weekdaysMin: 'sö_må_ti_on_to_fr_lö'.split('_'),\n        longDateFormat: {\n            LT: 'HH:mm',\n            LTS: 'HH:mm:ss',\n            L: 'YYYY-MM-DD',\n            LL: 'D MMMM YYYY',\n            LLL: 'D MMMM YYYY [kl.] HH:mm',\n            LLLL: 'dddd D MMMM YYYY [kl.] HH:mm',\n            lll: 'D MMM YYYY HH:mm',\n            llll: 'ddd D MMM YYYY HH:mm'\n        },\n        calendar: {\n            sameDay: '[Idag] LT',\n            nextDay: '[Imorgon] LT',\n            lastDay: '[Igår] LT',\n            nextWeek: '[På] dddd LT',\n            lastWeek: '[I] dddd[s] LT',\n            sameElse: 'L'\n        },\n        relativeTime: {\n            future: 'om %s',\n            past: 'för %s sedan',\n            s: 'några sekunder',\n            ss: '%d sekunder',\n            m: 'en minut',\n            mm: '%d minuter',\n            h: 'en timme',\n            hh: '%d timmar',\n            d: 'en dag',\n            dd: '%d dagar',\n            M: 'en månad',\n            MM: '%d månader',\n            y: 'ett år',\n            yy: '%d år'\n        },\n        dayOfMonthOrdinalParse: /\\d{1,2}(e|a)/,\n        ordinal: function (number) {\n            var b = number % 10, output = (~~(number % 100 / 10) === 1) ? 'e' :\n                (b === 1) ? 'a' :\n                    (b === 2) ? 'a' :\n                        (b === 3) ? 'e' : 'e';\n            return number + output;\n        },\n        week: {\n            dow: 1,\n            doy: 4 // The week that contains Jan 4th is the first week of the year.\n        }\n    });\n}\nexport var localMoment = function () {\n    return moment.apply(this, arguments).locale(cfg.KED_LOCALE);\n};\n","import * as tslib_1 from \"tslib\";\nimport { KedRepo } from './ked-repo';\nimport env from '../globals/KED.env';\nimport { showError, flatten, compareProp, arrayToMap } from '../utils/utils';\nimport { createUUID } from 'kedbackend/client';\nimport { EDSPeriod } from '../apis/edsclient';\nimport { getSchoolMoment } from '../utils/school-moment';\nimport moment from 'moment';\nexport var hiddenCoursesRepo = env.hiddenCoursesRepo;\nvar HiddenCoursesRepo = /** @class */ (function () {\n    function HiddenCoursesRepo() {\n        var _this = this;\n        this.result = null;\n        this.subscribers = [];\n        this.fullCourse = false;\n        this.notifySubscriber = function (subscriber, options) {\n            try {\n                subscriber(options.fullCourse ? _this.result : _this.result.filter(function (c) { return c.visible; }));\n            }\n            catch (err) {\n                console.error(err);\n            }\n        };\n        this.kedRepo = new KedRepo({\n            getClient: function () { return env.kedBackendClient; },\n            optimistic: true,\n            table: \"userhiddencourses\",\n            user: env.currentUser ? env.currentUser.mail : \"\",\n            getQueryOptions: function () { return tslib_1.__awaiter(_this, void 0, void 0, function () { return tslib_1.__generator(this, function (_a) {\n                return [2 /*return*/, ({ role: \"USER\" })];\n            }); }); },\n        });\n        var initPromise = this.init();\n        Promise.all([\n            initPromise,\n            this.kedCoursesPromise,\n            this.edsCoursesPromise\n        ]).catch(function (err) { return showError(err); });\n    }\n    HiddenCoursesRepo.prototype.init = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var bearerPromise, resolveUserHiddenCoursesPromise, userHiddenCoursesResolved;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        bearerPromise = env.bearerProvider ? env.bearerProvider.getBearer() : Promise.resolve({});\n                        // In parallell, we request:\n                        //  1) KEDBackend: Schools.activeCourses\n                        //  2) EDS.getActiveAcourses()\n                        //  3) (via subscription): KEDBackend: userHiddenCourses\n                        this.kedCoursesPromise = bearerPromise.then(function () { return _this.listKedCourses(); });\n                        this.edsCoursesPromise = bearerPromise.then(function () { return _this.listEDSCourses(); });\n                        userHiddenCoursesResolved = false;\n                        this.userHiddenCoursesPromise = new Promise(function (resolve) { return resolveUserHiddenCoursesPromise = function (x) {\n                            if (userHiddenCoursesResolved) {\n                                _this.userHiddenCoursesPromise = Promise.resolve(x);\n                            }\n                            else {\n                                userHiddenCoursesResolved = true;\n                                resolve(x);\n                            }\n                        }; });\n                        return [4 /*yield*/, bearerPromise];\n                    case 1:\n                        _a.sent();\n                        this.kedRepo.mem.subscribe(function (userHiddenCourses) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                            var _a, activeCourses, edsActiveCourses, _b;\n                            var _this = this;\n                            return tslib_1.__generator(this, function (_c) {\n                                switch (_c.label) {\n                                    case 0: return [4 /*yield*/, Promise.all([\n                                            this.kedCoursesPromise,\n                                            this.edsCoursesPromise\n                                        ])];\n                                    case 1:\n                                        _a = tslib_1.__read.apply(void 0, [_c.sent(), 2]), activeCourses = _a[0], edsActiveCourses = _a[1];\n                                        // Refine the three results into a single result\n                                        _b = this;\n                                        return [4 /*yield*/, this.createCoursesList(edsActiveCourses, userHiddenCourses, activeCourses)];\n                                    case 2:\n                                        // Refine the three results into a single result\n                                        _b.result = _c.sent();\n                                        // Notify our subscribers:\n                                        this.subscribers.forEach(function (subscriber) { return _this.notifySubscriber(subscriber.subscriber, subscriber.options); });\n                                        resolveUserHiddenCoursesPromise(userHiddenCourses);\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    HiddenCoursesRepo.prototype.listKedCourses = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var fullCourse, schools, activeCourses;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        fullCourse = this.fullCourse;\n                        console.log(\"FullCourse: \" + fullCourse);\n                        return [4 /*yield*/, env.kedBackendClient.list('schools', {\n                                role: \"USER\",\n                                name: env.currentUser.school,\n                                include: \"activeCourses\",\n                                flags: fullCourse ? [] : [\"includeIdsAndNamesOnly\"],\n                                cacheBust: env.currentUser.username\n                            })];\n                    case 1:\n                        schools = _a.sent();\n                        activeCourses = flatten(schools.map(function (school) { return school.activeCourses; })).sort(compareProp(\"name\"));\n                        return [2 /*return*/, activeCourses];\n                }\n            });\n        });\n    };\n    HiddenCoursesRepo.prototype.listEDSCourses = function () {\n        var periodName = new EDSPeriod(getSchoolMoment(moment())).period;\n        return env.currentUser.roles.indexOf('EMPLOYEE') === -1 ?\n            // STUDENTs should, by default, only show courses that is listed in EDS\n            env.edsClient.getActiveCourses({ periodName: periodName }) :\n            // EMPLOYEEs should, by default, show all courses on school - no need to query EDS\n            null;\n    };\n    HiddenCoursesRepo.prototype.createCoursesList = function (edsActiveCourses, userHiddenCourses, activeCourses) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var hiddenCoursesMap, visibleCoursesMap, isStudent, edsCourseMap, result;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hiddenCoursesMap = arrayToMap(userHiddenCourses.filter(function (hc) { return !hc.show; }), function (hc) { return hc.name; });\n                        visibleCoursesMap = arrayToMap(userHiddenCourses.filter(function (hc) { return hc.show; }), function (hc) { return hc.name; });\n                        isStudent = env.currentUser.roles.some(function (role) { return role === 'STUDENT'; });\n                        edsCourseMap = edsActiveCourses ?\n                            arrayToMap(edsActiveCourses, function (c) { return c.name; }) :\n                            {};\n                        return [4 /*yield*/, Promise.all(activeCourses.map(function (_a) {\n                                var id = _a.id, name = _a.name, description = _a.description, modifiedBy = _a.modifiedBy;\n                                return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                                    var edsCourse, defaultVisible, visible;\n                                    return tslib_1.__generator(this, function (_b) {\n                                        edsCourse = edsCourseMap[name];\n                                        defaultVisible = isStudent ?\n                                            edsCourse != null : // Course name also listed in EDS\n                                            true;\n                                        visible = defaultVisible ?\n                                            !hiddenCoursesMap[id] : // Visible unless user has overridden that.\n                                            !!visibleCoursesMap[id];\n                                        // Resolve description:\n                                        if (modifiedBy && modifiedBy.name && !description) {\n                                            description = modifiedBy.name + \"s version\";\n                                        }\n                                        return [2 /*return*/, {\n                                                id: id,\n                                                name: name,\n                                                description: description,\n                                                visible: visible,\n                                                defaultVisible: defaultVisible\n                                            }];\n                                    });\n                                });\n                            }))];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/, result.sort(function (_a, _b) {\n                                var a = _a.name;\n                                var b = _b.name;\n                                return a < b ? -1 : a > b ? 1 : 0;\n                            })];\n                }\n            });\n        });\n    };\n    HiddenCoursesRepo.prototype.hideCourse = function (c) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var overrides;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        overrides = this.kedRepo.mem.items.filter(function (hc) { return hc.name === c.id; });\n                        if (!c.defaultVisible) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.kedRepo.insert([{\n                                    id: createUUID(),\n                                    name: c.id\n                                }])];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 2: return [4 /*yield*/, this.kedRepo.delete(overrides.map(function (ov) { return ov.id; }))];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    HiddenCoursesRepo.prototype.showCourse = function (c) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var overrides;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        overrides = this.kedRepo.mem.items.filter(function (hc) { return hc.name === c.id; });\n                        if (!c.defaultVisible) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.kedRepo.delete(overrides.map(function (ov) { return ov.id; }))];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 2: return [4 /*yield*/, this.kedRepo.insert([{\n                                id: createUUID(),\n                                name: c.id,\n                                show: true\n                            }])];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    HiddenCoursesRepo.prototype.subscribe = function (subscriber, options) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, activeCourses, edsActiveCourses, userHiddenCourses, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (!(!this.fullCourse && options.fullCourse)) return [3 /*break*/, 3];\n                        // The subscriber demands full courses\n                        // Need to query that before notifying\n                        // Also affect state for future internal notification\n                        this.fullCourse = options.fullCourse;\n                        this.kedCoursesPromise = this.listKedCourses(); // Redo this call, now loading full courses\n                        return [4 /*yield*/, Promise.all([\n                                this.kedCoursesPromise,\n                                this.edsCoursesPromise,\n                                this.userHiddenCoursesPromise\n                            ])];\n                    case 1:\n                        _a = tslib_1.__read.apply(void 0, [_c.sent(), 3]), activeCourses = _a[0], edsActiveCourses = _a[1], userHiddenCourses = _a[2];\n                        // Assemble result:\n                        _b = this;\n                        return [4 /*yield*/, this.createCoursesList(edsActiveCourses, userHiddenCourses, activeCourses)];\n                    case 2:\n                        // Assemble result:\n                        _b.result = _c.sent();\n                        _c.label = 3;\n                    case 3: return [4 /*yield*/, this.userHiddenCoursesPromise];\n                    case 4:\n                        _c.sent(); // So we know that this.result is there.\n                        this.notifySubscriber(subscriber, options);\n                        this.subscribers.push({ subscriber: subscriber, options: options });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    HiddenCoursesRepo.prototype.unsubscribe = function (subscriber) {\n        this.subscribers = this.subscribers.filter(function (s) { return s.subscriber !== subscriber; });\n    };\n    return HiddenCoursesRepo;\n}());\nif (!hiddenCoursesRepo) {\n    hiddenCoursesRepo = env.hiddenCoursesRepo = new HiddenCoursesRepo();\n}\n","import * as tslib_1 from \"tslib\";\nimport { Repo } from './repo';\nimport { BatchRunner, createUUID } from 'kedbackend/client';\nvar KedRepo = /** @class */ (function () {\n    function KedRepo(options) {\n        var _this = this;\n        var table = options.table, getClient = options.getClient, getQueryOptions = options.getQueryOptions;\n        this.mem = new Repo({ query: function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var queryOptions;\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, getQueryOptions()];\n                        case 1:\n                            queryOptions = _a.sent();\n                            return [4 /*yield*/, getClient().list(table, tslib_1.__assign({}, queryOptions, { cacheBust: this.getCacheBust() }))];\n                        case 2: return [2 /*return*/, _a.sent()];\n                    }\n                });\n            }); } });\n        this.options = options;\n    }\n    KedRepo.prototype.getCacheBust = function () {\n        var _a = this.options, table = _a.table, user = _a.user;\n        var cacheBust = localStorage.getItem('cache-bust-' + table + '-' + user);\n        return cacheBust || this.regenerateCacheBust();\n    };\n    KedRepo.prototype.regenerateCacheBust = function () {\n        var _a = this.options, table = _a.table, user = _a.user;\n        var cacheBust = createUUID();\n        localStorage.setItem('cache-bust-' + table + '-' + user, cacheBust);\n        return cacheBust;\n    };\n    KedRepo.prototype.upsert = function (item, updater) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var updatedItem;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!!item.$etag) return [3 /*break*/, 2];\n                        updatedItem = Object.assign({}, item);\n                        updater(updatedItem);\n                        return [4 /*yield*/, this.insert([updatedItem])];\n                    case 1: return [2 /*return*/, _a.sent()];\n                    case 2: \n                    // We have an $etag, so we can expect it to live on the server.\n                    // However, take care of the unlikely situation that it was deleted from server,\n                    // and if so, insert it again.\n                    return [4 /*yield*/, this.update([item], updater).catch(function (e) {\n                            if (e.name === \"http404\") {\n                                var updatedItem = Object.assign({}, item);\n                                updater(updatedItem);\n                                return _this.insert([updatedItem]);\n                            }\n                            return Promise.reject(e);\n                        })];\n                    case 3:\n                        // We have an $etag, so we can expect it to live on the server.\n                        // However, take care of the unlikely situation that it was deleted from server,\n                        // and if so, insert it again.\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedRepo.prototype.update = function (items, updater) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, getClient, optimistic, table, client, modifiedItems, res;\n            var _this = this;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.options, getClient = _a.getClient, optimistic = _a.optimistic, table = _a.table;\n                        client = getClient();\n                        modifiedItems = items.map(function (item) {\n                            var memRepoItem = _this.mem.items.find(function (it) { return it.id === item.id; });\n                            item = Object.assign({}, memRepoItem || item);\n                            updater(item);\n                            return item;\n                        });\n                        if (!optimistic) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.mem.update(modifiedItems.map(function (x) { return Object.assign({}, x, { $meta: 'updating' }); }))];\n                    case 1:\n                        _b.sent();\n                        _b.label = 2;\n                    case 2: return [4 /*yield*/, client.do(function (br) { return modifiedItems.forEach(function (item) { return br.put(table, item); }); })\n                            .catch(function (e) { return e.name === \"http409\" ? // conflict\n                            // Get a fresh version from server:\n                            client.list(table, { ids: items.map(function (item) { return item.id; }) }, { cache: 'no-cache' }).then(function (freshItems) {\n                                // Update local version:\n                                var modifiedItems = freshItems.map(function (freshItem) {\n                                    // Clone the fresh item\n                                    var modified = Object.assign({}, freshItem);\n                                    // Re-run the updater on the clone:\n                                    updater(modified);\n                                    return modified;\n                                });\n                                // Re-do the the put operation towards the server.\n                                return client.do(function (br) { return modifiedItems.forEach(function (item) { return br.put(table, item); }); });\n                            }) :\n                            // Other unexpected error:\n                            Promise.resolve(optimistic &&\n                                _this.mem.update(items)) // Undo optimistic update\n                                .then(function () {\n                                return Promise.reject(e); // Reject with the error no matter.\n                            }); })];\n                    case 3:\n                        res = _b.sent();\n                        this.regenerateCacheBust();\n                        modifiedItems.forEach(function (item) {\n                            item.$etag = res.newEtags[item.id];\n                            item.$meta = undefined;\n                        });\n                        return [4 /*yield*/, this.mem.update(modifiedItems)];\n                    case 4:\n                        _b.sent(); // Ensures new etag is is applied on next action.\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedRepo.prototype.stripGraphs = function (items, graphs) {\n        return items.map(function (item) {\n            var clone = Object.assign({}, item);\n            graphs.forEach(function (graph) {\n                if (item[graph]) {\n                    clone[graph] = item[graph].map(function (doc) { return ({ id: doc.id }); });\n                }\n            });\n            return clone;\n        });\n    };\n    KedRepo.prototype.insert = function (items) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, getClient, optimistic, table, getQueryOptions, client, queryOptions, graphs, stripped, br, _loop_1, stripped_1, stripped_1_1, item, res;\n            var e_1, _b;\n            var _this = this;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = this.options, getClient = _a.getClient, optimistic = _a.optimistic, table = _a.table, getQueryOptions = _a.getQueryOptions;\n                        client = getClient();\n                        return [4 /*yield*/, getQueryOptions()];\n                    case 1:\n                        queryOptions = _c.sent();\n                        graphs = [].concat(queryOptions.include);\n                        // Give IDs to each item:\n                        items = items.map(function (item) { return item.id ? item : Object.assign({}, item, { id: createUUID() }); });\n                        stripped = this.stripGraphs(items, graphs);\n                        if (!optimistic) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.mem.insert(stripped.map(function (x) { return Object.assign({}, x, { $meta: 'adding' }); }))];\n                    case 2:\n                        _c.sent();\n                        _c.label = 3;\n                    case 3:\n                        br = new BatchRunner();\n                        _loop_1 = function (item) {\n                            var e_2, _a;\n                            var _loop_2 = function (graph) {\n                                var foreignItems = item[graph];\n                                if (foreignItems) {\n                                    foreignItems.forEach(function (doc) {\n                                        br.link2(table, item.id, graph, doc.id);\n                                    });\n                                }\n                            };\n                            try {\n                                // Also add links to all foreign related items:\n                                for (var graphs_1 = (e_2 = void 0, tslib_1.__values(graphs)), graphs_1_1 = graphs_1.next(); !graphs_1_1.done; graphs_1_1 = graphs_1.next()) {\n                                    var graph = graphs_1_1.value;\n                                    _loop_2(graph);\n                                }\n                            }\n                            catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                            finally {\n                                try {\n                                    if (graphs_1_1 && !graphs_1_1.done && (_a = graphs_1.return)) _a.call(graphs_1);\n                                }\n                                finally { if (e_2) throw e_2.error; }\n                            }\n                            br.add(table, item);\n                        };\n                        try {\n                            for (stripped_1 = tslib_1.__values(stripped), stripped_1_1 = stripped_1.next(); !stripped_1_1.done; stripped_1_1 = stripped_1.next()) {\n                                item = stripped_1_1.value;\n                                _loop_1(item);\n                            }\n                        }\n                        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                        finally {\n                            try {\n                                if (stripped_1_1 && !stripped_1_1.done && (_b = stripped_1.return)) _b.call(stripped_1);\n                            }\n                            finally { if (e_1) throw e_1.error; }\n                        }\n                        return [4 /*yield*/, client.batch(br.mutationRequests).catch(function (e) {\n                                if (optimistic)\n                                    _this.mem.delete(items.map(function (item) { return item.id; }));\n                                return Promise.reject(e);\n                            })];\n                    case 4:\n                        res = _c.sent();\n                        this.regenerateCacheBust();\n                        items.forEach(function (item) { return item.$etag = res.newEtags[item.id]; });\n                        if (!optimistic) return [3 /*break*/, 6];\n                        return [4 /*yield*/, this.mem.update(items)];\n                    case 5:\n                        _c.sent(); // Update with new $etag.\n                        return [3 /*break*/, 8];\n                    case 6: return [4 /*yield*/, this.mem.insert(items)];\n                    case 7:\n                        _c.sent();\n                        _c.label = 8;\n                    case 8: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedRepo.prototype.delete = function (ids) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, getClient, optimistic, table, client, res;\n            var _this = this;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.options, getClient = _a.getClient, optimistic = _a.optimistic, table = _a.table;\n                        client = getClient();\n                        if (!optimistic) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.mem.update(ids\n                                .map(function (id) { return _this.mem.items.find(function (x) { return x.id === id; }); })\n                                .filter(function (x) { return x; })\n                                .map(function (x) { return Object.assign({}, x, { $meta: 'deleting' }); }))];\n                    case 1:\n                        _b.sent();\n                        _b.label = 2;\n                    case 2: return [4 /*yield*/, client.do(function (br) { return ids.forEach(function (id) { return br.delete(table, id); }); }).catch(function (e) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                            var _this = this;\n                            return tslib_1.__generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        if (!optimistic) return [3 /*break*/, 2];\n                                        return [4 /*yield*/, this.mem.update(ids\n                                                .map(function (id) { return _this.mem.items.find(function (x) { return x.id === id; }); })\n                                                .filter(function (x) { return x; })\n                                                .map(function (x) {\n                                                x = Object.assign({}, x);\n                                                delete x.$meta;\n                                                return x;\n                                            }))];\n                                    case 1:\n                                        _a.sent();\n                                        _a.label = 2;\n                                    case 2: throw e;\n                                }\n                            });\n                        }); })];\n                    case 3:\n                        res = _b.sent();\n                        this.regenerateCacheBust();\n                        return [4 /*yield*/, this.mem.delete(ids)];\n                    case 4:\n                        _b.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return KedRepo;\n}());\nexport { KedRepo };\n","import * as tslib_1 from \"tslib\";\nvar Repo = /** @class */ (function () {\n    function Repo(comm) {\n        this.comm = comm;\n        this.listPromise = null;\n        this.items = null;\n        this.subscribers = [];\n    }\n    Repo.prototype.subscribe = function (subscriber) {\n        var _this = this;\n        return this.ensureHasData().then(function () {\n            subscriber(_this.items, _this.error);\n            _this.subscribers.push(subscriber);\n        });\n    };\n    Repo.prototype.unsubscribe = function (subscriber) {\n        this.subscribers = this.subscribers.filter(function (s) { return s !== subscriber; });\n    };\n    Repo.prototype.notifySubscribers = function () {\n        var _this = this;\n        this.subscribers.forEach(function (s) { return s(_this.items, _this.error); });\n    };\n    Repo.prototype.ensureHasData = function () {\n        if (!this.listPromise)\n            this.refreshFromServer();\n        return this.listPromise;\n    };\n    Repo.prototype.refreshFromServer = function () {\n        var _this = this;\n        this.listPromise = this.comm.query().then(function (items) {\n            _this.items = items;\n            _this.error = null;\n            _this.notifySubscribers();\n        }).catch(function (error) {\n            _this.error = error;\n            _this.items = _this.items || [];\n            _this.notifySubscribers();\n        });\n        return this.listPromise;\n    };\n    Repo.prototype.update = function (item) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var updatedItems;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureHasData()];\n                    case 1:\n                        _a.sent();\n                        updatedItems = Array.isArray(item) ? item : [item];\n                        this.items = this.items.map(function (it) {\n                            var updatedItem = updatedItems.find(function (_a) {\n                                var id = _a.id;\n                                return it.id === id;\n                            });\n                            return updatedItem ?\n                                Object.assign({}, updatedItem) :\n                                it;\n                        });\n                        this.notifySubscribers();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Repo.prototype.insert = function (item) {\n        var _this = this;\n        return this.ensureHasData().then(function () {\n            _this.items = _this.items.concat(item);\n            _this.notifySubscribers();\n        });\n    };\n    Repo.prototype.delete = function (id) {\n        var _this = this;\n        var ids = Array.isArray(id) ? id : [id];\n        return this.ensureHasData().then(function () {\n            _this.items = _this.items.filter(function (it) { return !ids.some(function (id) { return it.id === id; }); });\n            _this.notifySubscribers();\n        });\n    };\n    return Repo;\n}());\nexport { Repo };\n","import * as tslib_1 from \"tslib\";\nimport { KedRepo } from './ked-repo';\nimport env from '../globals/KED.env';\nimport { WeekPlannerPersistedState } from \"../components/weekplanner/weekplanner-persisted-state\";\nimport moment from 'moment';\nimport { createUUID, DocumentAccess } from 'kedbackend/client';\nimport { KEDWeek } from '../utils/weekutil';\nexport var userTasksRepo = env.userTasksRepo;\nvar UserTasksRepo = /** @class */ (function (_super) {\n    tslib_1.__extends(UserTasksRepo, _super);\n    function UserTasksRepo(getClient, getCurrentUser) {\n        var _this = _super.call(this, {\n            getClient: getClient,\n            optimistic: true,\n            table: \"usertasks\",\n            user: getCurrentUser() ? getCurrentUser().mail : \"\",\n            getQueryOptions: function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var currentUser, userEmail, _a, weekDate, weekNumber, kedWeek;\n                return tslib_1.__generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            currentUser = getCurrentUser();\n                            userEmail = currentUser ? currentUser.mail : \"\";\n                            if (!!this.persistedState) return [3 /*break*/, 2];\n                            _a = this;\n                            return [4 /*yield*/, WeekPlannerPersistedState.load(userEmail)];\n                        case 1:\n                            _a.persistedState = _b.sent();\n                            _b.label = 2;\n                        case 2:\n                            weekDate = this.persistedState.weekDate;\n                            weekNumber = moment(weekDate).week();\n                            kedWeek = KEDWeek(moment(weekDate).year(), weekNumber);\n                            /*const [from, to] = [moment(weekDate).startOf('week'), moment(weekDate).endOf('week')]\n                              .map(m => m.toDate().getTime());*/\n                            return [2 /*return*/, {\n                                    from: kedWeek.notBefore,\n                                    to: kedWeek.notAfter,\n                                    role: \"USER\",\n                                    include: [\"task\", \"course\"],\n                                    flags: [\"includeIdsOnly\"],\n                                }];\n                    }\n                });\n            }); }\n        }) || this;\n        _this.persistedState = null;\n        _this.getCurrentUser = getCurrentUser;\n        return _this;\n    }\n    UserTasksRepo.prototype.updatePersistedState = function (stateChanges) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        Object.assign(this.persistedState, stateChanges);\n                        return [4 /*yield*/, this.persistedState.save()];\n                    case 1:\n                        _a.sent();\n                        this.mem.notifySubscribers();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    UserTasksRepo.prototype.setTaskDoneState = function (userTask, done) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, getClient, optimistic, table, client, modifiedItem, similarTasks, identicalTasks;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.options, getClient = _a.getClient, optimistic = _a.optimistic, table = _a.table;\n                        client = getClient();\n                        modifiedItem = Object.assign({}, userTask, { done: done });\n                        if (!optimistic) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.mem.update(Object.assign({}, modifiedItem, { $meta: 'updating' }))];\n                    case 1:\n                        _b.sent();\n                        _b.label = 2;\n                    case 2: return [4 /*yield*/, client.list('usertasks', {\n                            name: userTask.name,\n                            role: \"USER\",\n                            include: [\"task\", \"course\"],\n                            flags: [\"includeIdsOnly\"],\n                            from: moment(this.persistedState.weekDate).add(-3, 'weeks').valueOf(),\n                            to: moment(this.persistedState.weekDate).add(3, 'weeks').valueOf()\n                        }, {\n                            cache: 'no-cache'\n                        })];\n                    case 3:\n                        similarTasks = _b.sent();\n                        identicalTasks = similarTasks.filter(function (t) {\n                            return t.courseName === userTask.courseName &&\n                                t.learningGoal === userTask.learningGoal &&\n                                (!userTask.task || t.task.map(function (t) { return t.id; }).join('') === userTask.task.map(function (t) { return t.id; }).join('')) &&\n                                (!userTask.course || t.course.map(function (c) { return c.id; }).join('') === userTask.course.map(function (c) { return c.id; }).join(''));\n                        });\n                        if (identicalTasks.length === 0) {\n                            // Workaround for issue in SubjectPlanner migration (usertasks with long names is not found)\n                            identicalTasks.push(userTask);\n                        }\n                        return [4 /*yield*/, this.update(identicalTasks, function (t) { return t.done = done; })];\n                    case 4:\n                        _b.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    UserTasksRepo.prototype.setSubTaskDoneState = function (userTask, subTaskId, done) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, getClient, optimistic, table, client;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.options, getClient = _a.getClient, optimistic = _a.optimistic, table = _a.table;\n                        client = getClient();\n                        return [4 /*yield*/, this.update([userTask], function (t) { return t.subTasks && t.subTasks.filter(function (st) { return st.id === subTaskId; })\n                                .forEach(function (st) { return st.done = done; }); })];\n                    case 1:\n                        _b.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    UserTasksRepo.prototype.setWeekPlannerBoxOpen = function (courseName, isOpen) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var openCourses;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        openCourses = tslib_1.__assign({}, this.persistedState.openCourses);\n                        if (isOpen)\n                            openCourses[courseName] = true;\n                        else\n                            delete openCourses[courseName];\n                        return [4 /*yield*/, this.updatePersistedState({ openCourses: openCourses })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    UserTasksRepo.prototype.changeWeek = function (weekDate, keepCurrentDate) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var persistedState, newPersisted;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        persistedState = this.persistedState;\n                        if (!!persistedState) return [3 /*break*/, 2];\n                        return [4 /*yield*/, WeekPlannerPersistedState.load(this.options.user)];\n                    case 1:\n                        persistedState = _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        newPersisted = new WeekPlannerPersistedState(persistedState);\n                        newPersisted.weekDate = keepCurrentDate ? moment(weekDate).valueOf() : moment(weekDate).startOf('week').valueOf();\n                        newPersisted.save();\n                        this.persistedState = newPersisted;\n                        return [4 /*yield*/, this.mem.refreshFromServer()];\n                    case 3:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    UserTasksRepo.prototype.subscribe = function (subscriber) {\n        var _this = this;\n        var proxySubscriber = function (userTasks) {\n            subscriber(userTasks.filter(function (ut) { return !ut.weekTexts; }), _this.persistedState, userTasks.filter(function (ut) { return !!ut.weekTexts; })[0] || {\n                id: createUUID(),\n                dateTime: _this.persistedState.weekDate,\n                weekTexts: { assessment: '', strategy: '' },\n                acl: [\n                    // Default ACL: Let user self have full control over this item:\n                    new DocumentAccess(\"email\", _this.getCurrentUser().mail, \"S\"),\n                ].map(function (ac) { return ac.toString(); })\n            });\n        };\n        proxySubscriber[\"subscriber\"] = subscriber;\n        this.mem.subscribe(proxySubscriber);\n    };\n    UserTasksRepo.prototype.unsubscribe = function (subscriber) {\n        this.mem.subscribers = this.mem.subscribers.filter(function (s) { return s[\"subscriber\"] !== subscriber; });\n    };\n    return UserTasksRepo;\n}(KedRepo));\nexport { UserTasksRepo };\nif (!userTasksRepo) {\n    userTasksRepo = env.userTasksRepo = new UserTasksRepo(function () { return env.kedBackendClient; }, function () { return env.currentUser; });\n    userTasksRepo.mem.ensureHasData();\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { db } from '../globals/db';\nimport { RemoveItem } from '../components/course-builder/sub-components/remove-item';\nvar ErrorSuccessFeedback = /** @class */ (function (_super) {\n    tslib_1.__extends(ErrorSuccessFeedback, _super);\n    function ErrorSuccessFeedback(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            errors: [],\n            infos: []\n        };\n        _this._unhandledRejection = _this._unhandledRejection.bind(_this);\n        _this._error = _this._error.bind(_this);\n        _this._customError = _this._customError.bind(_this);\n        _this._onInfo = _this._onInfo.bind(_this);\n        _this._dbWriterError = _this._dbWriterError.bind(_this);\n        _this._dbWriterStateChanged = _this._dbWriterStateChanged.bind(_this);\n        return _this;\n    }\n    ErrorSuccessFeedback.prototype._addError = function (message, details, retryable) {\n        var _this = this;\n        //console.error(message, {retryable: !!retryable, details});\n        this.setState(function (_a) {\n            var errors = _a.errors;\n            if (errors.some(function (e) { return e.message === message; }))\n                return { errors: errors };\n            if (errors.length > 2)\n                errors = errors.slice(1);\n            return {\n                errors: errors.concat([{ message: message, details: details, retryable: retryable }])\n            };\n        });\n        // Remove non-retryable errors after 30 seconds:\n        if (!retryable)\n            setTimeout(function () {\n                _this.setState(function (_a) {\n                    var errors = _a.errors;\n                    return ({\n                        errors: errors.filter(function (e) { return e.message !== message; })\n                    });\n                });\n            }, 30000);\n    };\n    ErrorSuccessFeedback.prototype._addInfo = function (message) {\n        var _this = this;\n        if (message === \"\") {\n            // Turn off current info messages\n            this.setState({ infos: [] });\n            return;\n        }\n        this.setState(function (_a) {\n            var infos = _a.infos;\n            if (infos.some(function (info) { return info === message; }))\n                return { infos: infos };\n            if (infos.length > 1)\n                infos = infos.slice(1);\n            return {\n                infos: [message] // was: infos.concat(message). But it sucks!\n            };\n        });\n        // Remove info message after 10 seconds:\n        setTimeout(function () {\n            _this.setState(function (_a) {\n                var infos = _a.infos;\n                return ({\n                    infos: infos.filter(function (msg) { return msg !== message; })\n                });\n            });\n        }, 10000);\n    };\n    ErrorSuccessFeedback.prototype._dbWriterError = function (error, retryable) {\n        this._addError(\"Det g\\u00E5r inte att spara till servern\", error, retryable);\n    };\n    ErrorSuccessFeedback.prototype._dbWriterStateChanged = function (_a) {\n        var isEdited = _a.isEdited, isSaving = _a.isSaving;\n        if (!isEdited) {\n            // If isEdited is false, a successful write must have happened, and\n            // there cannot be any retryable error anymore\n            this.setState(function (_a) {\n                var errors = _a.errors;\n                errors = errors.filter(function (e) { return !e.retryable; });\n                return { errors: errors };\n            });\n        }\n        this.setState({\n            dbWriterIsEdited: isEdited,\n            dbWriterIsSaving: isSaving\n        });\n    };\n    ErrorSuccessFeedback.prototype.componentDidMount = function () {\n        window.addEventListener('unhandledrejection', this._unhandledRejection);\n        window.addEventListener('error', this._error);\n        window.addEventListener('customerror', this._customError);\n        window.addEventListener('info', this._onInfo);\n        db.writer.onError(this._dbWriterError);\n        db.writer.onStateChange(this._dbWriterStateChanged);\n    };\n    ErrorSuccessFeedback.prototype.componentWillUnmount = function () {\n        window.removeEventListener('unhandledrejection', this._unhandledRejection);\n        window.removeEventListener('error', this._error);\n        window.removeEventListener('customerror', this._customError);\n        window.removeEventListener('info', this._onInfo);\n        db.writer.off(this._dbWriterError);\n        db.writer.off(this._dbWriterStateChanged);\n    };\n    ErrorSuccessFeedback.prototype._unhandledRejection = function (ev) {\n        this._addError(\"Ett ok\\u00E4nt fel intr\\u00E4ffade...\", ev.reason);\n    };\n    ErrorSuccessFeedback.prototype._error = function (ev) {\n        this._addError(ev.error ? ev.error.message : \"Ett ok\\u00E4nt fel intr\\u00E4ffade...\", ev.error);\n    };\n    ErrorSuccessFeedback.prototype._customError = function (ev) {\n        this._addError(ev.detail);\n    };\n    ErrorSuccessFeedback.prototype._onInfo = function (ev) {\n        this._addInfo(ev.detail);\n    };\n    ErrorSuccessFeedback.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, errors = _a.errors, infos = _a.infos, dbWriterIsSaving = _a.dbWriterIsSaving;\n        return React.createElement(\"div\", { className: \"error-success-feedback\", style: {\n                position: \"fixed\",\n                left: 0,\n                top: 0,\n                width: \"100%\",\n                pointerEvents: 'none'\n            } },\n            React.createElement(\"div\", { style: { display: 'table', margin: \"0 auto\" } },\n                errors.filter(function (e) { return !e.retryable || !dbWriterIsSaving; })\n                    .map(function (_a) {\n                    var message = _a.message, details = _a.details, retryable = _a.retryable, showDetails = _a.showDetails;\n                    return (React.createElement(\"div\", { key: message, className: \"error\" },\n                        React.createElement(\"div\", { style: { float: 'left' } }, message),\n                        React.createElement(\"div\", { style: { pointerEvents: 'auto' } },\n                            React.createElement(RemoveItem, { onClick: function () { return _this.removeError(message); } })),\n                        details || retryable ? React.createElement(\"div\", { style: { pointerEvents: 'auto' } },\n                            details ? React.createElement(React.Fragment, null,\n                                React.createElement(\"a\", { className: \"btn\", onClick: function () { return _this.toggleDetails(message); } }, showDetails ? \"Dölj detailer\" : \"Visa detailjer\"),\n                                \"\\u00A0\") : undefined,\n                            showDetails ? React.createElement(\"p\", null, '' + details) : React.createElement(React.Fragment, null, \"\\u00A0\"),\n                            retryable ? React.createElement(\"a\", { className: \"btn\", onClick: function () { return _this.retrySave(); } }, \"F\\u00F6rs\\u00F6k spara nu\") : undefined) : undefined));\n                }),\n                infos.map(function (message) {\n                    return React.createElement(\"p\", { key: message, className: \"info\" }, message);\n                })));\n    };\n    ErrorSuccessFeedback.prototype.removeError = function (message) {\n        this.setState(function (_a) {\n            var errors = _a.errors;\n            return ({\n                errors: errors.filter(function (e) { return e.message !== message; })\n            });\n        });\n    };\n    ErrorSuccessFeedback.prototype.retrySave = function () {\n        db.writer.retrySave();\n    };\n    ErrorSuccessFeedback.prototype.toggleDetails = function (message) {\n        this.setState(function (_a) {\n            var errors = _a.errors;\n            return ({ errors: errors.map(function (error) { return error.message === message ? tslib_1.__assign({}, error, { showDetails: !error.showDetails }) :\n                    error; })\n            });\n        });\n    };\n    return ErrorSuccessFeedback;\n}(React.Component));\nexport { ErrorSuccessFeedback };\n","import * as tslib_1 from \"tslib\";\nvar DEFAULT_CACHE_EXPIRATION = 30 * 60 * 1000; // 30 minutes.\nvar defaultOptions = {\n    isApiMethod: function (f) { return typeof f === 'function'; },\n    cacheExpiration: DEFAULT_CACHE_EXPIRATION\n};\nexport function makeSuspenseApi(api, options) {\n    if (options === void 0) { options = defaultOptions; }\n    options = tslib_1.__assign({}, defaultOptions, options);\n    var isApiMethod = options.isApiMethod, cacheExpiration = options.cacheExpiration;\n    var rv = Object.create(api);\n    var cache = {};\n    // Walk the instance + prototype chain to generate suspense version of each promise returning method\n    for (var proto = api; proto && proto !== Object.prototype; proto = Object.getPrototypeOf(proto)) {\n        suspendify(proto);\n    }\n    function suspendify(proto) {\n        Object.keys(proto).forEach(function (prop) {\n            if (!rv.hasOwnProperty(prop) && isApiMethod(prop)) {\n                rv[prop] = function () {\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    var key = JSON.stringify(tslib_1.__spread([prop], args));\n                    var cachedEntry = cache[key];\n                    if (cachedEntry !== undefined) {\n                        if (cachedEntry.promise)\n                            throw cachedEntry.promise;\n                        if (cachedEntry.error)\n                            throw cachedEntry.error;\n                        if (cachedEntry.timeout > Date.now()) {\n                            return cachedEntry.value;\n                        }\n                    }\n                    try {\n                        var promise = proto[prop].apply(api, args).then(function (result) {\n                            cache[key] = { timeout: Date.now() + cacheExpiration, value: result };\n                        }).catch(function (error) {\n                            cache[key] = { timeout: Date.now() + cacheExpiration, error: error };\n                        });\n                        cache[key] = { timeout: Date.now() + cacheExpiration, promise: promise };\n                        throw promise;\n                    }\n                    catch (error) {\n                        if (error.then)\n                            throw error;\n                        cache[key] = { timeout: Date.now() + cacheExpiration, error: error };\n                    }\n                };\n            }\n        });\n    }\n    return rv;\n}\n","import * as tslib_1 from \"tslib\";\nvar PendingJob = /** @class */ (function () {\n    function PendingJob(callback) {\n        this.timeoutId = null;\n        this.cancelled = false;\n        this.pending = false;\n        this.isJobExecuting = false;\n        this.jobCallback = callback;\n    }\n    PendingJob.prototype.triggerChange = function (throttle) {\n        var _this = this;\n        if (this.cancelled)\n            return;\n        this.pending = true;\n        if (this.timeoutId !== null)\n            clearTimeout(this.timeoutId);\n        this.timeoutId = setTimeout(function () { return _this.launchJob(); }, throttle);\n    };\n    PendingJob.prototype.stop = function () {\n        if (this.timeoutId !== null)\n            clearTimeout(this.timeoutId);\n        this.timeoutId = null;\n        this.cancelled = true;\n    };\n    PendingJob.prototype.launchJob = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.cancelled)\n                            return [2 /*return*/];\n                        if (!this.pending)\n                            return [2 /*return*/];\n                        if (this.isJobExecuting)\n                            return [2 /*return*/];\n                        this.timeoutId = null;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, , 3, 4]);\n                        this.isJobExecuting = true;\n                        this.pending = false;\n                        return [4 /*yield*/, this.jobCallback()];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        this.isJobExecuting = false;\n                        return [7 /*endfinally*/];\n                    case 4:\n                        if (!this.pending) return [3 /*break*/, 6];\n                        return [4 /*yield*/, this.launchJob()];\n                    case 5:\n                        _a.sent();\n                        _a.label = 6;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return PendingJob;\n}());\nexport { PendingJob };\n","import * as tslib_1 from \"tslib\";\nexport function parseQueryString(locationSearch, options) {\n    var toLower = (options || {}).toLower;\n    var result = {};\n    if (locationSearch && locationSearch.length > 1)\n        locationSearch.substr(1)\n            .split('&')\n            .map(function (part) { return part.split('=').map(function (s) { return decodeURIComponent(s.trim()); }); })\n            .forEach(function (_a) {\n            var _b = tslib_1.__read(_a, 2), key = _b[0], value = _b[1];\n            return result[toLower ? key.toLowerCase() : key] = value;\n        });\n    return result;\n}\nfunction encodeParams(params) {\n    return Object.keys(params).filter(function (key) { return params[key] !== undefined; }).map(function (key) { return encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key]); }).join('&');\n}\nexport function generateQueryString(params) {\n    return \"?\" + encodeParams(params);\n}\nexport function parseHashQueryString(locationHash, options) {\n    return parseQueryString(locationHash, options);\n}\nexport function generateHashQueryString(params) {\n    return \"#\" + encodeParams(params);\n}\nexport function splitUrlAndQuery(urlWithPossibleQuery) {\n    var pQuery = urlWithPossibleQuery.indexOf('?');\n    return pQuery >= 0 ?\n        [urlWithPossibleQuery.substr(0, pQuery), urlWithPossibleQuery.substr(pQuery)] :\n        [urlWithPossibleQuery, \"\"];\n}\n","import * as tslib_1 from \"tslib\";\nimport moment from 'moment';\nexport function getFirstAndLastWeekOfTerm(term) {\n    return term === 'AT' ?\n        [32, 51] :\n        [1, 25];\n}\n//Not used anymore\n// export function getTermStartAndEnd(now: moment.Moment) : moment.Moment[] {\n//     return now.month() >= 6 ? // 6 = July in JS Dates and in moment as well!\n//     [moment(new Date(now.year(), 7, 1)), moment(new Date(now.year(), 11, 31))] : // aug1 - dec31\n//     [moment(new Date(now.year(), 0, 1)), moment(new Date(now.year(), 6, 31))]; // jan1 - july31\n// }\nexport function getTermStarEndDate(date, isFirstTerm) {\n    var addYear = date.getMonth() >= 7;\n    var termYear = null;\n    if (addYear) {\n        termYear = isFirstTerm ? date.getFullYear() : date.getFullYear() + 1;\n    }\n    else {\n        termYear = isFirstTerm ? date.getFullYear() - 1 : date.getFullYear();\n    }\n    var termYearMoment = moment(termYear.toString(), \"YYYY\");\n    if (termYearMoment.week() != 1) {\n        termYearMoment = termYearMoment.clone().add(1, 'week');\n    }\n    return isFirstTerm ? [moment(termYearMoment.clone()).week(32).startOf('week'), moment(termYearMoment.clone()).week(51).endOf('week')] :\n        [moment(termYearMoment.clone()), moment(termYearMoment.clone()).week(25).endOf('week')];\n}\nexport function getSchoolMoment(m) {\n    var thisYear = m.year();\n    var isAutumn = m.month() >= 6; // determine \n    var _a = tslib_1.__read(isAutumn ?\n        [thisYear, thisYear + 1] :\n        [thisYear - 1, thisYear], 2), autumnYear = _a[0], springYear = _a[1];\n    var academicYear = '' + autumnYear + '/' + springYear;\n    var term = isAutumn ? 'AT' : 'ST';\n    var week = m.week();\n    return { academicYear: academicYear, term: term, week: week };\n}\nexport function addYear(aYear, numYearsToAdd) {\n    return aYear.split('/')\n        .map(function (yearStr) { return parseInt(yearStr) + numYearsToAdd; })\n        .map(function (year) { return '' + year; })\n        .join('/');\n}\nexport function nextAcademicYear(aYear) {\n    return addYear(aYear, 1);\n}\nexport function prevAcademicYear(aYear) {\n    return addYear(aYear, -1);\n}\n","import moment from 'moment';\nimport { getSchoolMoment, addYear } from './school-moment';\nfunction isSchoolMoment(obj) {\n    return 'academicYear' in obj;\n}\nvar SchoolTerm = /** @class */ (function () {\n    function SchoolTerm(dateOrSchoolMoment) {\n        var schoolMoment = isSchoolMoment(dateOrSchoolMoment) ?\n            dateOrSchoolMoment : getSchoolMoment(moment(dateOrSchoolMoment));\n        this.academicYear = schoolMoment.academicYear;\n        this.term = schoolMoment.term;\n    }\n    Object.defineProperty(SchoolTerm.prototype, \"year\", {\n        get: function () {\n            return parseInt(this.academicYear\n                .split('/')[this.term === 'AT' ? 0 : 1]);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    SchoolTerm.prototype.nextTerm = function () {\n        return new SchoolTerm(this.term === 'AT' ?\n            {\n                term: 'ST',\n                academicYear: this.academicYear\n            } :\n            {\n                term: 'AT',\n                academicYear: addYear(this.academicYear, 1)\n            });\n    };\n    SchoolTerm.prototype.prevTerm = function () {\n        return new SchoolTerm(this.term === 'AT' ?\n            {\n                term: 'ST',\n                academicYear: addYear(this.academicYear, -1)\n            } :\n            {\n                term: 'AT',\n                academicYear: this.academicYear\n            });\n    };\n    SchoolTerm.prototype.toLocaleString = function (intl, shortYear) {\n        var year = this.term === 'AT' ?\n            this.academicYear.split('/')[0] :\n            this.academicYear.split('/')[1];\n        if (shortYear)\n            year = year.substr(2);\n        return this.term === 'AT' ? intl.formatMessage({ id: 'termplanner.secondTerm', defaultMessage: 'HT {year}' }, { year: year }) :\n            intl.formatMessage({ id: 'termplanner.firstTerm', defaultMessage: 'VT {year}' }, { year: year });\n    };\n    return SchoolTerm;\n}());\nexport { SchoolTerm };\n","import * as tslib_1 from \"tslib\";\nexport function capitalizeFirst(str) {\n    for (var i = 0, l = str.length; i < l; ++i) {\n        if (str.charCodeAt(i) < 0x2000) {\n            return str.substr(0, i) + str[i].toLocaleUpperCase() + str.substr(i + 1);\n        }\n    }\n    return str;\n}\nexport function extend(obj, extension) {\n    if (typeof extension !== 'object')\n        return obj;\n    Object.keys(extension).forEach(function (key) {\n        obj[key] = extension[key];\n    });\n    return obj;\n}\nexport function clone(obj, extension) {\n    var clone = {};\n    Object.getOwnPropertyNames(obj).forEach(function (key) {\n        Object.defineProperty(clone, key, Object.getOwnPropertyDescriptor(obj, key));\n    });\n    if (extension)\n        extend(clone, extension);\n    return clone;\n}\nvar concat = [].concat;\nexport function flatten(a) {\n    return concat.apply([], a);\n}\nexport function compareProp(prop) {\n    return function (a, b) {\n        var aProp = a[prop], bProp = b[prop];\n        return aProp > bProp ? 1 : aProp < bProp ? -1 : 0;\n    };\n}\nexport function compareProps(props, locales, options) {\n    props = Array.isArray(props) ? props : [props];\n    var localeCompare = function (a, b) {\n        return typeof a === 'string' ?\n            a.localeCompare(b, locales, options) :\n            a < b ? -1 : a > b ? 1 : 0;\n    };\n    function cmpPart(a, b, firstPart, rest) {\n        var firstA = a[firstPart];\n        var firstB = b[firstPart];\n        if (firstA === firstB)\n            return 0;\n        if (firstA == null)\n            return -1;\n        if (firstB == null)\n            return 1;\n        return rest.length === 0 ?\n            localeCompare(firstA, firstB) :\n            cmpPart(firstA, firstB, rest[0], rest.slice(1));\n    }\n    return props\n        .map(function (prop) { return prop.split('.'); })\n        .map(function (_a) {\n        var _b = tslib_1.__read(_a), firstPart = _b[0], rest = _b.slice(1);\n        return function (a, b) { return cmpPart(a, b, firstPart, rest); };\n    })\n        .reduce(function (cmp1, cmp2) {\n        return function (a, b) { return cmp1(a, b) || cmp2(a, b); };\n    });\n}\nexport function L(text) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    var first = text[0];\n    return buildMessage(text, args);\n}\nfunction buildMessage(text, args) {\n    var rv = text[0];\n    for (var i = 1, l = text.length; i < l; ++i) {\n        rv += args[i - 1] + text[i];\n    }\n    return rv;\n}\nvar TC = /** @class */ (function () {\n    function TC(template) {\n        extend(this, template);\n    }\n    return TC;\n}());\nexport { TC };\nexport function dateTimeReviver(key, value) {\n    var a;\n    if (typeof value === 'string') {\n        a = /\\/Date\\((\\d*)\\)\\//.exec(value);\n        if (a) {\n            return new Date(+a[1]);\n        }\n    }\n    return value;\n}\n//let infoSerial = 1;\nexport function showInfo(msg) {\n    var event = new CustomEvent('info', { 'detail': msg });\n    window.dispatchEvent(event);\n}\nexport function showError(errMsg) {\n    var msg = typeof errMsg === 'string' ? errMsg : errMsg.message;\n    var event = new CustomEvent('customerror', { 'detail': msg });\n    console.error(errMsg);\n    window.dispatchEvent(event);\n}\nexport function maxLength(str, maxLen) {\n    return str.length > maxLen ?\n        str.substr(0, maxLen - 3) + \"...\" :\n        str;\n}\nexport function arrayToLookup(a, keyAccessor) {\n    var result = {};\n    for (var i = 0, l = a.length; i < l; ++i) {\n        var item = a[i];\n        var key = keyAccessor(item);\n        var array = result[key];\n        if (array)\n            array.push(item);\n        else\n            result[key] = [item];\n    }\n    return result;\n}\nexport function arrayToMap(a, keyAccessor) {\n    var result = {};\n    for (var i = 0, l = a.length; i < l; ++i) {\n        var item = a[i];\n        var key = keyAccessor(item);\n        result[key] = item;\n    }\n    return result;\n}\nexport function cherryPickProps(obj, propsToPick) {\n    var e_1, _a;\n    var result = {};\n    try {\n        for (var propsToPick_1 = tslib_1.__values(propsToPick), propsToPick_1_1 = propsToPick_1.next(); !propsToPick_1_1.done; propsToPick_1_1 = propsToPick_1.next()) {\n            var param = propsToPick_1_1.value;\n            if (param in obj)\n                result[param] = obj[param];\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (propsToPick_1_1 && !propsToPick_1_1.done && (_a = propsToPick_1.return)) _a.call(propsToPick_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return result;\n}\nexport function distinct(a, keyAccessor) {\n    var map = arrayToMap(a, keyAccessor || (function (x) { return x; }));\n    return Object.keys(map).map(function (key) { return map[key]; });\n}\nexport function shallowEquals(a, b) {\n    if (a === b)\n        return true;\n    if (!a || !b)\n        return false;\n    if (typeof a !== 'object' || typeof b !== 'object')\n        return false;\n    var keysA = Object.keys(a);\n    var keysB = Object.keys(b);\n    if (keysA.length !== keysB.length)\n        return false;\n    for (var i = 0, l = keysA.length; i < l; ++i) {\n        var key = keysA[i];\n        if (keysB[i] !== key)\n            return false;\n        if (a[key] !== b[key])\n            return false;\n    }\n    return true;\n}\n","import moment from \"moment\";\nexport function KEDWeek(year, week) {\n    var m = moment(new Date(year, 1, 1)).week(week);\n    var res = {\n        year: year,\n        week: week,\n        notBefore: m.clone().startOf('week').add(-2, 'days').toDate().getTime(),\n        notAfter: m.clone().startOf('week').add(5, 'days').toDate().getTime()\n    };\n    return res;\n}\nexport function getNextWeekDate(date) {\n    var nextDate = moment(date).add(1, 'week');\n    //Set the 01.01 of the next year in case the next week is in the same year \n    //and the previous week is the last week of the year\n    if (date.week() === date.weeksInYear() && nextDate.year() === date.year()) {\n        return { adjusted: true, nextDate: moment(date.year() + 1 + \"-01-01\").toDate() };\n    }\n    return { adjusted: false, nextDate: nextDate.toDate() };\n}\nexport function getPrevWeekDate(date) {\n    var prevDate = moment(date).add(-1, 'week');\n    //Set the 01.01 of the current year in case the prev week is in the previous year\n    if (date.week() === 2 && prevDate.year() !== date.year()) {\n        return { adjusted: true, nextDate: moment(date.year() + \"-01-01\").toDate() };\n    }\n    return { adjusted: false, nextDate: prevDate.toDate() };\n}\nexport function getAdjustedWeek(m) {\n    var clone = m.clone();\n    return m.weekday() >= 5 ? // Lördag 00:00 / Söndag 00:00?\n        m.week() + 1 : // Tillhör nästa vecka\n        m.week();\n}\n/*export function getWeekLimits (m: Moment) {\n  const clonedSwedish = m.clone().locale('sv');\n  const limits = {\n    notBefore: clonedSwedish.startOf('week').add(-2, 'days'),\n    notAfter: clonedSwedish.startOf('week').add(5, 'days')\n  };\n}\n*/\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACvJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClBA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACtGA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrDA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACnPA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC1FA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzDA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/JA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9JA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9JA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC3NA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvZA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjFA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9NA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACtJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjCA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACZA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/CA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACLA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AChBA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrFA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrVA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChSA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7DA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjXA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7GA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACrXA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;ACFA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3gBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtFA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACreA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjLA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9DA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9BA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7SA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/IA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjGA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjJA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3cA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7EA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5QA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/QA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxKA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtDA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}