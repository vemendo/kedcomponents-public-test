{"version":3,"file":"CourseViewer.js","sources":["webpack://[name]/./src/apis/google-classroom.ts","webpack://[name]/./src/components/course-viewer/course-page/classroom-assignments.tsx","webpack://[name]/./src/components/course-viewer/course-page/course-banner.tsx","webpack://[name]/./src/components/course-viewer/course-page/course-module-page.tsx","webpack://[name]/./src/components/course-viewer/course-page/get-customized-task.ts","webpack://[name]/./src/components/course-viewer/course-page/index.tsx","webpack://[name]/./src/components/course-viewer/course-page/run-up-page.tsx","webpack://[name]/./src/components/course-viewer/course-page/task-page.tsx","webpack://[name]/./src/components/course-viewer/index.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/classroom-assignments-listing.tsx","webpack://[name]/./src/components/course-viewer/subcomponents/resource-list.tsx","webpack://[name]/./src/components/course-viewer/utils/get-included-ids.ts","webpack://[name]/./src/components/course-viewer/utils/manual-scroll-restoration.ts","webpack://[name]/./src/components/list-courses/list-courses-page.tsx","webpack://[name]/./src/components/list-courses/list-courses.tsx","webpack://[name]/./src/components/weekplanner/index.ts"],"sourcesContent":["import { __assign, __awaiter, __extends, __generator, __read, __spread } from \"tslib\";\nimport { GoogleClient } from './google-client';\nimport { env } from '../globals/KED.env';\nvar GoogleClassroom = /** @class */ (function (_super) {\n    __extends(GoogleClassroom, _super);\n    function GoogleClassroom() {\n        return _super.call(this, { discoveryDocs: 'https://classroom.googleapis.com/$discovery/rest?version=v1' }) || this;\n    }\n    GoogleClassroom.prototype.reclaimSubmission = function (submission) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions\n                                .reclaim({\n                                courseId: submission.courseId,\n                                courseWorkId: submission.courseWorkId,\n                                id: submission.id\n                            })\n                                .then(function (resp) { return resp.result; })];\n                    case 2:\n                        result = _a.sent();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.handInSubmission = function (submission) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions\n                                .turnIn({\n                                courseId: submission.courseId,\n                                courseWorkId: submission.courseWorkId,\n                                id: submission.id\n                            })\n                                .then(function (resp) { return resp.result; })];\n                    case 2:\n                        result = _a.sent();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.returnSubmission = function (submission) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions\n                                .return({\n                                courseId: submission.courseId,\n                                courseWorkId: submission.courseWorkId,\n                                id: submission.id\n                            })\n                                .then(function (resp) { return resp.result; })];\n                    case 2:\n                        result = _a.sent();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getSubmissions = function (courseId, taskId, isTeacher, hasTemplate) {\n        return __awaiter(this, void 0, void 0, function () {\n            var classrooms, submissions, allSubmissions, updatedSubmissions_1, courseWork, newSubmissions, templateFile;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.getClassrooms(courseId)];\n                    case 2:\n                        classrooms = _a.sent();\n                        submissions = [];\n                        if (!isTeacher) return [3 /*break*/, 5];\n                        return [4 /*yield*/, Promise.all(classrooms.map(function (classroom, i) { return __awaiter(_this, void 0, void 0, function () {\n                                var courseWork, students;\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.getCourseWork(classroom.id, taskId, false)];\n                                        case 1:\n                                            courseWork = _a.sent();\n                                            return [4 /*yield*/, this.getStudents(classroom.id)];\n                                        case 2:\n                                            students = _a.sent();\n                                            classrooms[i].courseWork = courseWork;\n                                            classrooms[i].students = students;\n                                            return [2 /*return*/];\n                                    }\n                                });\n                            }); }))];\n                    case 3:\n                        _a.sent();\n                        classrooms = classrooms.filter(function (cr) { return !!cr.courseWork; });\n                        return [4 /*yield*/, Promise.all(classrooms.map(function (classroom, i) { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.getStudentSubmissions(classroom.id, classroom.courseWork.id, false)];\n                                        case 1: return [2 /*return*/, _a.sent()];\n                                    }\n                                });\n                            }); }))];\n                    case 4:\n                        allSubmissions = _a.sent();\n                        updatedSubmissions_1 = [];\n                        allSubmissions.map(function (subs, i) {\n                            var group = classrooms[i].room.split(\"|\")[1];\n                            var crLink = classrooms[i].courseWork.alternateLink;\n                            var students = classrooms[i].students;\n                            var newsubs = subs.map(function (sub) {\n                                var student = students.filter(function (s) { return s.userId == sub.userId; })[0];\n                                console.log(student);\n                                if (!student) {\n                                    student.name = { firstName: 'FÃ¶rnamn', lastName: 'Efternamn' };\n                                }\n                                return __assign(__assign(__assign({}, student), sub), { group: group, crLink: crLink });\n                            });\n                            updatedSubmissions_1.push.apply(updatedSubmissions_1, __spread(newsubs));\n                        });\n                        submissions.push.apply(submissions, __spread(updatedSubmissions_1));\n                        console.table(submissions);\n                        return [3 /*break*/, 8];\n                    case 5: return [4 /*yield*/, this.getCourseWork(classrooms[0].id, taskId)];\n                    case 6:\n                        courseWork = _a.sent();\n                        return [4 /*yield*/, this.getStudentSubmissions(courseWork.courseId, courseWork.id, true)];\n                    case 7:\n                        newSubmissions = _a.sent();\n                        submissions.push.apply(submissions, __spread(newSubmissions.map(function (sub) {\n                            sub.userEmail = env.currentUser.mail;\n                            return sub;\n                        })));\n                        _a.label = 8;\n                    case 8:\n                        if (hasTemplate) {\n                            templateFile = isTeacher\n                                ? classrooms[0].courseWork.materials[0].driveFile.driveFile\n                                : submissions[0].assignmentSubmission.attachments[0].driveFile;\n                            return [2 /*return*/, {\n                                    submissions: submissions,\n                                    templateFile: templateFile.alternateLink,\n                                    templateThumbnail: templateFile.thumbnailUrl,\n                                    templateTitle: templateFile.title\n                                }];\n                        }\n                        else {\n                            return [2 /*return*/, {\n                                    submissions: submissions\n                                }];\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.addFilesToSubmission = function (classroomId, courseWorkId, submissionId, files) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.ensureInited()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions.modifyAttachments({\n                                courseId: classroomId,\n                                courseWorkId: courseWorkId,\n                                id: submissionId,\n                                addAttachments: files.map(function (file) {\n                                    return { driveFile: { id: file.fileId } };\n                                })\n                            }).then(function (resp) { return console.log(resp); })];\n                    case 2:\n                        result = _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getUser = function (userId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, gapi.client.classroom.userProfiles\n                            .get({\n                            userId: userId\n                        })\n                            .then(function (resp) {\n                            var name = resp.result.name;\n                            return {\n                                name: { firstName: name.givenName, lastName: name.familyName },\n                                userEmail: resp.result.emailAddress\n                            };\n                        })];\n                    case 1:\n                        result = _a.sent();\n                        if (result.name)\n                            return [2 /*return*/, result];\n                        throw \"AnvÃ¤ndare inte hittad\";\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getClassrooms = function (courseId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, gapi.client.classroom.courses\n                            .list({\n                            fields: \"courses.id,courses.room,courses.descriptionHeading\",\n                            courseStates: \"ACTIVE\"\n                        })\n                            .then(function (resp) {\n                            return resp.result.courses.filter(function (cr) { return cr.room && cr.room.indexOf(courseId) > -1; });\n                        })];\n                    case 1:\n                        result = _a.sent();\n                        if (result.length > 0)\n                            return [2 /*return*/, result];\n                        throw \"Inte registrerad pÃ¥ kurs\";\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getStudents = function (classroomId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, gapi.client.classroom.courses.students.list({\n                            courseId: classroomId,\n                            fields: \"students.userId,students.profile.name,students.profile.emailAddress\"\n                        }).then(function (resp) { return resp.result.students.map(function (user) {\n                            return {\n                                userId: user.userId,\n                                name: { firstName: user.profile.name.givenName, lastName: user.profile.name.familyName },\n                                userEmail: user.profile.emailAddress\n                            };\n                        }); })];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getCourseWork = function (classroomId, taskId, throwError) {\n        if (throwError === void 0) { throwError = true; }\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, gapi.client.classroom.courses.courseWork\n                            .list({\n                            courseId: classroomId,\n                            fields: \"courseWork.courseId,courseWork.alternateLink,courseWork.id,courseWork.materials,courseWork.description,courseWork.workType,courseWork.dueDate,courseWork.dueTime\"\n                        })\n                            .then(function (resp) { return resp.result.courseWork ? resp.result.courseWork.filter(function (cw) { return cw.description.indexOf(taskId) > -1; }) : []; })];\n                    case 1:\n                        result = _a.sent();\n                        if (result.length == 1)\n                            return [2 /*return*/, result[0]];\n                        if (throwError)\n                            throw \"Hittar ingen matchad inlÃ¤mningsuppgift\";\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    GoogleClassroom.prototype.getStudentSubmissions = function (classroomId, courseWorkId, throwError) {\n        if (throwError === void 0) { throwError = true; }\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, gapi.client.classroom.courses.courseWork.studentSubmissions\n                            .list({\n                            courseId: classroomId,\n                            courseWorkId: courseWorkId\n                        })\n                            .then(function (resp) { return resp.result.studentSubmissions; })];\n                    case 1:\n                        result = _a.sent();\n                        if (result)\n                            return [2 /*return*/, result];\n                        if (throwError)\n                            throw \"Hittar ingen matchad inlÃ¤mning\";\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return GoogleClassroom;\n}(GoogleClient));\nexport { GoogleClassroom };\n","import { __assign, __awaiter, __extends, __generator, __read, __spread, __values } from \"tslib\";\nimport * as React from \"react\";\nimport env from \"../../../globals/KED.env\";\nimport { showError } from \"../../../utils/utils\";\nimport { TimeoutSpinner } from \"../../course-builder/sub-components/spinner\";\nimport { HttpError } from \"kedbackend/client\";\nimport { isTeacherAtSchool } from \"../../../access-control\";\nimport { GooglePicker } from \"../../../apis/google-picker\";\nimport { DriveButton, Button } from \"../../../apis/buttons\";\nimport { GoogleDrive } from \"../../../apis/google-drive\";\nimport { GoogleClassroom } from \"../../../apis/google-classroom\";\nimport { SubmissionListings } from \"../subcomponents/classroom-assignments-listing\";\nimport { FileView } from \"../subcomponents/task-fileview\";\nimport moment from \"moment\";\nvar ClassroomAssignments = /** @class */ (function (_super) {\n    __extends(ClassroomAssignments, _super);\n    function ClassroomAssignments(props) {\n        var _this = _super.call(this, props) || this;\n        _this.drive = new GoogleDrive();\n        _this.classroom = new GoogleClassroom();\n        _this.state = {\n            assignment: null,\n            assignments: null,\n            loading: true,\n            loadingMessage: \"Laddar inlÃ¤mning...\"\n        };\n        return _this;\n    }\n    ClassroomAssignments.prototype.setStatePromised = function (cb) {\n        var _this = this;\n        return new Promise(function (resolve) { return _super.prototype.setState.call(_this, cb, resolve); });\n    };\n    ClassroomAssignments.prototype.componentDidMount = function () {\n        this.load();\n    };\n    ClassroomAssignments.prototype.componentWillReceiveProps = function (nextProps) {\n        return __awaiter(this, void 0, void 0, function () {\n            var err_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 4, , 5]);\n                        if (!(nextProps.task.id !== this.props.task.id ||\n                            nextProps.course.id !== this.props.course.id)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.setStatePromised(function () { return ({\n                                assignment: null,\n                                loading: true\n                            }); })];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.load()];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3: return [3 /*break*/, 5];\n                    case 4:\n                        err_1 = _a.sent();\n                        showError(err_1);\n                        return [3 /*break*/, 5];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.update = function (assignments, assignment) {\n        var retval = __spread([\n            assignment\n        ], assignments.filter(function (_a) {\n            var user = _a.user, filename = _a.filename;\n            return user !== assignment.user || filename !== assignment.filename;\n        }));\n        return retval;\n    };\n    ClassroomAssignments.prototype.load = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, taskId, templateFile, _b, courseId, school, teacherAtSchool, res, submissions_1, refreshableAssigments_1, assignments, error_1;\n            var _this = this;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _c.trys.push([0, 5, , 6]);\n                        _a = this.props.task, taskId = _a.id, templateFile = _a.templateFile;\n                        _b = this.props.course, courseId = _b.id, school = _b.school;\n                        teacherAtSchool = isTeacherAtSchool(env.currentUser, school);\n                        return [4 /*yield*/, this.classroom.getSubmissions(courseId, taskId, teacherAtSchool, !!templateFile)];\n                    case 1:\n                        res = _c.sent();\n                        submissions_1 = res.submissions;\n                        refreshableAssigments_1 = [];\n                        return [4 /*yield*/, (teacherAtSchool\n                                ? env.kedBackendClient.http.get(\"assignments/\" + school + \"/\" + courseId + \"/\" + taskId)\n                                : env.kedBackendClient.http.get(\"assignments/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + env.currentUser.mail))\n                                .then(function (resp) {\n                                if (resp.ok)\n                                    return resp.json();\n                                return [];\n                            })\n                                .then(function (res) {\n                                return res.map(function (assignment) {\n                                    var e_1, _a;\n                                    if (!assignment.metadata || !assignment.metadata.driveFileId)\n                                        return assignment;\n                                    var urkundResponse = assignment.metadata.urkundResponse\n                                        ? JSON.parse(assignment.metadata.urkundResponse)\n                                        : false;\n                                    // urkund\n                                    if (!assignment.metadata.urkundUploadError && // Not possible to refresh if upload has failed\n                                        (!assignment.metadata.urkundLastPoll || // Never checked status yet\n                                            (urkundResponse &&\n                                                urkundResponse[0].Status.State &&\n                                                [\"Accepted\", \"Submitted\"].indexOf(urkundResponse[0].Status.State) >= 0 &&\n                                                parseInt(assignment.metadata.urkundLastPoll) <\n                                                    moment()\n                                                        .add(-15, \"seconds\")\n                                                        .toDate()\n                                                        .getTime()))\n                                    // Checked status for a long time ago\n                                    )\n                                        refreshableAssigments_1.push(assignment);\n                                    // add submission data\n                                    var submission = submissions_1.filter(function (sub) { return sub.userEmail == assignment.user; });\n                                    var _loop_1 = function (sub) {\n                                        if (!sub.assignmentSubmission.attachments)\n                                            return \"continue\";\n                                        sub.assignmentSubmission.attachments.forEach(function (attachment) {\n                                            if (attachment.driveFile.id == assignment.metadata.driveFileId) {\n                                                assignment.inClassroom = true;\n                                                assignment.submissionId = sub.id;\n                                            }\n                                        });\n                                    };\n                                    try {\n                                        for (var submission_1 = __values(submission), submission_1_1 = submission_1.next(); !submission_1_1.done; submission_1_1 = submission_1.next()) {\n                                            var sub = submission_1_1.value;\n                                            _loop_1(sub);\n                                        }\n                                    }\n                                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                                    finally {\n                                        try {\n                                            if (submission_1_1 && !submission_1_1.done && (_a = submission_1.return)) _a.call(submission_1);\n                                        }\n                                        finally { if (e_1) throw e_1.error; }\n                                    }\n                                    return assignment;\n                                });\n                            })];\n                    case 2:\n                        assignments = _c.sent();\n                        res.submissions = submissions_1;\n                        this.setState({\n                            error: null,\n                            loading: false,\n                            assignments: assignments,\n                            assignment: res\n                        });\n                        if (!teacherAtSchool) return [3 /*break*/, 4];\n                        return [4 /*yield*/, Promise.all(refreshableAssigments_1.map(function (a) { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, this.refreshAssignment(a)];\n                                    case 1: return [2 /*return*/, _a.sent()];\n                                }\n                            }); }); }))];\n                    case 3:\n                        _c.sent();\n                        _c.label = 4;\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        error_1 = _c.sent();\n                        this.setState({\n                            loading: false,\n                            error: \"Kunde inte ladda inl\\u00E4mningsuppgifter\",\n                            assignment: null\n                        });\n                        console.error(error_1);\n                        return [3 /*break*/, 6];\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.verifyAndUpload = function (file, driveFile, user, name) {\n        return __awaiter(this, void 0, void 0, function () {\n            var error_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 3, , 4]);\n                        if (!file)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, this.upload(file, driveFile, user, name)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.load()];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_2 = _a.sent();\n                        console.error(error_2);\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.upload = function (file, driveFile, user, name) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, taskId, sendToUrkund, _b, courseId, school, body, queryParams, res, _c, _d;\n            return __generator(this, function (_e) {\n                switch (_e.label) {\n                    case 0:\n                        _a = this.props.task, taskId = _a.id, sendToUrkund = _a.sendToUrkund;\n                        _b = this.props.course, courseId = _b.id, school = _b.school;\n                        body = new FormData();\n                        body.append(\"files\", file);\n                        queryParams = {\n                            userDisplayName: name,\n                            verifyWithUrkund: sendToUrkund === undefined ? true : sendToUrkund\n                        };\n                        if (driveFile) {\n                            queryParams = __assign(__assign({}, queryParams), { driveFileId: driveFile.fileId, driveFileUrl: driveFile.url, driveFileIconUrl: driveFile.iconUrl });\n                        }\n                        return [4 /*yield*/, env.kedBackendClient.http.fetch(\"assignments/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + user, \"put\", {}, queryParams, {\n                                body: body\n                            })];\n                    case 1:\n                        res = _e.sent();\n                        if (!(res.status !== 200)) return [3 /*break*/, 3];\n                        _c = HttpError.bind;\n                        _d = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_c.apply(HttpError, _d.concat([_e.sent()])))();\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.reclaimSubmission = function (submission) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!confirm(\"Ãr du sÃ¤ker pÃ¥ att du vill Ã¥terta uppgiften?\"))\n                            return [2 /*return*/];\n                        this.setState({ loading: true, loadingMessage: \"Ãtertar inlÃ¤mning...\" });\n                        return [4 /*yield*/, this.classroom.reclaimSubmission(submission)];\n                    case 1:\n                        _a.sent();\n                        // should we check for erorrs etc?\n                        return [4 /*yield*/, this.load()];\n                    case 2:\n                        // should we check for erorrs etc?\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.handInSubmission = function (submission, onlyKedBackend) {\n        if (onlyKedBackend === void 0) { onlyKedBackend = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!confirm(\"Ãr du sÃ¤ker pÃ¥ att du vill lÃ¤mna in?\"))\n                            return [2 /*return*/];\n                        this.setState({ loading: true, loadingMessage: \"LÃ¤mnar in uppgiften...\" });\n                        // send files to urkund via kedbackend\n                        if (this.props.task.sendToUrkund) {\n                            this.sendSubmissionToKedBackend(submission, env.currentUser.displayName);\n                        }\n                        if (!!onlyKedBackend) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.classroom.handInSubmission(submission)];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2: \n                    // if additional files these have to be added before handing in\n                    // should we check for erorrs etc?\n                    return [4 /*yield*/, this.load()];\n                    case 3:\n                        // if additional files these have to be added before handing in\n                        // should we check for erorrs etc?\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.sendSubmissionToKedBackend = function (submission, name) {\n        return __awaiter(this, void 0, void 0, function () {\n            var assignmentFiles, driveFiles, urkundFiles;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        assignmentFiles = submission.assignmentSubmission.attachments.map(function (sub) {\n                            return sub.driveFile;\n                        });\n                        return [4 /*yield*/, Promise.all(assignmentFiles.map(function (file) { return __awaiter(_this, void 0, void 0, function () {\n                                var driveFile;\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.drive.getFile(file.id)];\n                                        case 1:\n                                            driveFile = _a.sent();\n                                            return [2 /*return*/, driveFile];\n                                    }\n                                });\n                            }); }))];\n                    case 1:\n                        driveFiles = _a.sent();\n                        return [4 /*yield*/, Promise.all(driveFiles.map(function (file) { return __awaiter(_this, void 0, void 0, function () {\n                                var selectedFile, urkundFile;\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0:\n                                            selectedFile = __assign(__assign({}, file), { canExport: file.mimeType.includes(\"google-apps\") });\n                                            return [4 /*yield*/, this.drive.downloadFile({\n                                                    file: selectedFile,\n                                                    mimeType: \"text/plain\"\n                                                })];\n                                        case 1:\n                                            urkundFile = _a.sent();\n                                            return [2 /*return*/, { file: selectedFile, data: urkundFile }];\n                                    }\n                                });\n                            }); }))];\n                    case 2:\n                        urkundFiles = _a.sent();\n                        // send to kedbackend\n                        return [4 /*yield*/, Promise.all(urkundFiles.map(function (file) { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, this.verifyAndUpload(file.data, file.file, submission.userEmail, name)];\n                                        case 1:\n                                            _a.sent();\n                                            return [2 /*return*/];\n                                    }\n                                });\n                            }); }))];\n                    case 3:\n                        // send to kedbackend\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.addFilesToSubmission = function (submission, files) {\n        return __awaiter(this, void 0, void 0, function () {\n            var error_3;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.setState({\n                            loading: true,\n                            loadingMessage: \"Uppdaterar inlÃ¤mning med nya filer...\"\n                        });\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.classroom.addFilesToSubmission(submission.courseId, submission.courseWorkId, submission.id, files)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_3 = _a.sent();\n                        console.log(error_3);\n                        showError(\"Du fÃ¶rsÃ¶kte lÃ¤mna in en fil som du inte Ã¤ger.\");\n                        return [3 /*break*/, 4];\n                    case 4: return [4 /*yield*/, this.load()];\n                    case 5:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.refreshAssignment = function (assignment) {\n        return __awaiter(this, void 0, void 0, function () {\n            var client, _a, courseId, school, taskId, user, filename, req, _b, _c, resJson_1, e_2;\n            var _this = this;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        client = env.kedBackendClient.http;\n                        _a = this.props.course, courseId = _a.id, school = _a.school;\n                        taskId = this.props.task.id;\n                        user = assignment.user, filename = assignment.filename;\n                        return [4 /*yield*/, this.setState(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({\n                                    assignments: _this.update(assignments, __assign(__assign({}, assignment), { isRefreshing: true }))\n                                });\n                            })];\n                    case 1:\n                        _d.sent();\n                        _d.label = 2;\n                    case 2:\n                        _d.trys.push([2, 8, , 10]);\n                        return [4 /*yield*/, client.get(\"assignments/urkund/\" + school + \"/\" + courseId + \"/\" + taskId + \"/\" + user + \"/\" + filename)];\n                    case 3:\n                        req = _d.sent();\n                        if (!(req.status >= 400)) return [3 /*break*/, 5];\n                        _b = HttpError.bind;\n                        _c = [void 0, req.status];\n                        return [4 /*yield*/, req.text()];\n                    case 4: throw new (_b.apply(HttpError, _c.concat([_d.sent()])))();\n                    case 5: return [4 /*yield*/, req.text()];\n                    case 6:\n                        resJson_1 = _d.sent();\n                        return [4 /*yield*/, this.setState(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({\n                                    assignments: _this.update(assignments, __assign(__assign({}, assignment), { isRefreshing: false, metadata: __assign(__assign({}, assignment.metadata), { urkundResponse: resJson_1 }) }))\n                                });\n                            })];\n                    case 7:\n                        _d.sent();\n                        return [3 /*break*/, 10];\n                    case 8:\n                        e_2 = _d.sent();\n                        return [4 /*yield*/, this.setState(function (_a) {\n                                var assignments = _a.assignments;\n                                return ({\n                                    assignments: _this.update(assignments, __assign(__assign({}, assignment), { isRefreshing: false, refreshError: e_2 }))\n                                });\n                            })];\n                    case 9:\n                        _d.sent();\n                        return [3 /*break*/, 10];\n                    case 10: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ClassroomAssignments.prototype.teacherView = function () {\n        var _a = this.state, assignment = _a.assignment, assignments = _a.assignments;\n        var _b = this.props.task, sendToUrkund = _b.sendToUrkund, templateFile = _b.templateFile;\n        return (React.createElement(React.Fragment, null,\n            React.createElement(\"p\", null, \"H\\u00E4r kan du som l\\u00E4rare se inl\\u00E4mnade arbeten\"),\n            React.createElement(SubmissionListings, { sendToKedbackend: this.sendSubmissionToKedBackend.bind(this), assignments: assignments || [], submissions: assignment ? assignment.submissions : [], hasTemplate: !!templateFile, sendToUrkund: sendToUrkund, courseId: this.props.course.id, taskId: this.props.task.id })));\n    };\n    ClassroomAssignments.prototype.studentView = function () {\n        var _this = this;\n        var _a = this.props.task, sendToUrkund = _a.sendToUrkund, additionalUploads = _a.additionalUploads, templateFile = _a.templateFile;\n        var _b = this.state, assignment = _b.assignment, assignments = _b.assignments, error = _b.error;\n        if (assignment == undefined || assignment.submissions == undefined || assignment.submissions.length == 0) {\n            return React.createElement(\"p\", null, \"Uppgift inte skapad i Classroom \\u00E4nnu. Prova igen om n\\u00E5gra minuter.\");\n        }\n        var submission = assignment ? assignment.submissions[0] : null;\n        var hasTemplate = !!templateFile;\n        var hasAttachments = submission &&\n            submission.assignmentSubmission.attachments &&\n            submission.assignmentSubmission.attachments.length > 0;\n        var turnedIn = submission && submission.state == \"TURNED_IN\";\n        var returned = submission && submission.state == \"RETURNED\";\n        var inKedBackend = turnedIn && hasAttachments\n            ? !!assignments.find(function (ass) { return ass.submissionId == submission.id; })\n            : false;\n        return (React.createElement(React.Fragment, null,\n            turnedIn ? (!sendToUrkund || (inKedBackend && sendToUrkund) ? (React.createElement(\"p\", null, \"Uppgiften \\u00E4r inl\\u00E4mnad.\")) : (React.createElement(\"p\", null, \"Uppgiften \\u00E4r inl\\u00E4mnad men m\\u00E5ste \\u00E4ven skickas till Urkund\"))) : returned ?\n                (React.createElement(\"p\", null, \"Uppgiften \\u00E4r \\u00E5terl\\u00E4mnad av din l\\u00E4rare.\")) :\n                (React.createElement(\"p\", null,\n                    \"Uppgiften \\u00E4r inte inl\\u00E4mnad\",\n                    submission && submission.state == \"RECLAIMED_BY_STUDENT\"\n                        ? \" (Ã¥tertagen)\"\n                        : undefined,\n                    \".\")),\n            hasTemplate ? (React.createElement(React.Fragment, null,\n                React.createElement(\"p\", null, \"Dokumentet nedan ska anv\\u00E4ndas till inl\\u00E4mningen.\"),\n                React.createElement(FileView, { size: \"large\", thumbnail: assignment.templateThumbnail, url: assignment.templateFile, label: assignment.templateTitle, title: assignment.templateTitle }))) : (undefined),\n            React.createElement(React.Fragment, null,\n                React.createElement(\"div\", { className: \"btn-group\" },\n                    hasTemplate || hasAttachments ? (!turnedIn ? (React.createElement(Button, { addClass: \"red\", action: function () { return _this.handInSubmission(submission); }, faIcon: \"fas fa-thumbs-up\", label: \"L\\u00E4mna in\" })) : (React.createElement(Button, { action: function () { return _this.reclaimSubmission(submission); }, faIcon: \"fas fa-thumbs-down\", label: \"\\u00C5terta\" }))) : (undefined),\n                    turnedIn && !inKedBackend && sendToUrkund && (React.createElement(Button, { action: function () { return _this.handInSubmission(submission, true); }, label: \"Skicka till urkund\" })),\n                    (!hasTemplate || additionalUploads) && !turnedIn && (React.createElement(DriveButton, { label: additionalUploads ? \"Bifoga filer\" : \"VÃ¤lj filer\", action: function () {\n                            var picker = new GooglePicker({\n                                upload: true,\n                                multiple: true,\n                                onlyMine: true\n                            });\n                            picker.show().then(function (files) {\n                                _this.addFilesToSubmission(submission, files);\n                                picker.close();\n                            });\n                        } }))),\n                sendToUrkund && (React.createElement(\"p\", null,\n                    \"Uppgiften \",\n                    additionalUploads ? \"och alla bifagde filer \" : \"\",\n                    \"skickas till Urkund.\")),\n                ((additionalUploads &&\n                    submission.assignmentSubmission.attachments.length > 1) ||\n                    (!hasTemplate && hasAttachments)) && (React.createElement(React.Fragment, null,\n                    React.createElement(\"table\", { className: \"task-assignments-table\" },\n                        React.createElement(\"thead\", null,\n                            React.createElement(\"tr\", null,\n                                React.createElement(\"th\", null, \"Bifogade filer\"))),\n                        React.createElement(\"tbody\", null, submission.assignmentSubmission.attachments.map(function (sub, i) {\n                            if (hasTemplate && i == 0)\n                                return undefined;\n                            return (React.createElement(\"tr\", { key: i },\n                                React.createElement(\"td\", null,\n                                    React.createElement(FileView, { size: \"small\", label: sub.driveFile.title, title: sub.driveFile.title, thumbnail: sub.driveFile.thumbnailUrl, url: sub.driveFile.alternateLink }))));\n                        }))),\n                    React.createElement(\"p\", null,\n                        React.createElement(\"em\", null,\n                            \"De bifogade filerna l\\u00E4mnas in samtidigt som uppgiften l\\u00E4mnas in. F\\u00F6r att ta bort bifogade filer m\\u00E5ste du g\\u00E5 via\\u00A0\",\n                            React.createElement(\"a\", { href: submission.alternateLink, target: \"_blank\" }, \"Classroom\"),\n                            \". Obs! Ta inte bort sj\\u00E4lva uppgiftsfilen.\"))))),\n            error && React.createElement(\"p\", { className: \"error\" }, error)));\n    };\n    ClassroomAssignments.prototype.render = function () {\n        if (this.state.loading) {\n            return React.createElement(TimeoutSpinner, { label: this.state.loadingMessage });\n        }\n        var teacherAtThisSchool = isTeacherAtSchool(env.currentUser, this.props.course.school);\n        return teacherAtThisSchool ? this.teacherView() : this.studentView();\n    };\n    return ClassroomAssignments;\n}(React.Component));\nexport { ClassroomAssignments };\n","import * as React from 'react';\nexport var CourseBanner = function (props) {\n    var title = props.title, backgroundImage = props.backgroundImage, tabs = props.tabs, activeTab = props.activeTab;\n    return React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\n        React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\n            React.createElement(\"div\", { className: \"sv-script-portlet sv-portlet sv-skip-spacer\" },\n                backgroundImage && React.createElement(\"style\", null, \"\\n        .pageHeader {\\n          background-image: url('\" + backgroundImage + \"') !important;\\n        }\\n      \"),\n                React.createElement(\"div\", { className: \"pageHeader\" },\n                    React.createElement(\"a\", null,\n                        React.createElement(\"h1\", null, title)),\n                    React.createElement(\"div\", { className: \"buttonsField\" },\n                        React.createElement(\"div\", { className: \"buttonsContainer\" },\n                            React.createElement(\"div\", { className: \"align-horizontal\" }),\n                            React.createElement(\"div\", { className: 'horizontalMenu' },\n                                React.createElement(\"ul\", null, tabs.map(function (_a, idx) {\n                                    var name = _a.name, key = _a.key, link = _a.link;\n                                    var isActive = activeTab === link;\n                                    return React.createElement(\"li\", { key: key || (typeof name === 'string' ? name : idx), className: isActive ? \"activePage\" : \"\" },\n                                        React.createElement(\"a\", { href: link }, name));\n                                })))))))));\n};\n","import { __extends } from \"tslib\";\nimport * as React from 'react';\nimport { arrayToLookup } from '../../../utils/utils';\nimport { KnowledgeRequirementsBox } from \"../subcomponents/knowledge-requirements-table\";\nimport getIncludedIds from '../utils/get-included-ids';\nimport { AbilitiesBox } from \"../subcomponents/abilities-box\";\nimport { CentralContentBox } from \"../subcomponents/central-content-box\";\nimport { LearningGoalsList } from '../subcomponents/learning-goals-list';\nimport { TaskList } from '../subcomponents/task-list';\nimport { getCustomizedTask } from './get-customized-task';\nvar CourseModulePage = /** @class */ (function (_super) {\n    __extends(CourseModulePage, _super);\n    function CourseModulePage(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {};\n        return _this;\n    }\n    CourseModulePage.prototype.render = function () {\n        var _a = this.props, module = _a.module, course = _a.course;\n        var incluedIds = getIncludedIds(module, course);\n        var learningTasks = module.taskIds\n            .map(function (id) { return course.tasks.find(function (t) { return t.id === id; }); })\n            .filter(function (task) { return !!task; })\n            .map(function (task) { return ({\n            id: task.id,\n            task: getCustomizedTask(module, task),\n            course: course,\n            name: task.name,\n            url: \"#\" + encodeURIComponent(module.name.trim()) + \"/\" + task.id,\n            courseName: course.name,\n            learningGoal: task.learningGoal || module.name,\n        }); });\n        var assignmentTasks = learningTasks.filter(function (t) { return t.task && t.task.assignment; });\n        var nonAssignmentTasks = learningTasks.filter(function (t) { return !t.task || !t.task.assignment; });\n        var commonTasks = nonAssignmentTasks.filter(function (t) { return !t.task.learningGoal; });\n        var learningGoals = arrayToLookup(nonAssignmentTasks.filter(function (t) { return !!t.task.learningGoal; }), function (t) { return t.learningGoal; });\n        var includedAbilities = course.abilities.filter(function (a) { return incluedIds[a.id]; });\n        var includedCentralContent = course.centralContent.filter(function (c) { return incluedIds[c.id]; });\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"sv-text-portlet sv-use-margins sv-skip-spacer\" },\n                React.createElement(\"div\", { className: \"sv-text-portlet-content\" },\n                    React.createElement(\"h1\", { className: \"h1\" }, module.name))),\n            React.createElement(\"div\", { className: \"sv-vertical sv-layout\" },\n                React.createElement(\"div\", { dangerouslySetInnerHTML: { __html: module.mandatoryContent } })),\n            (!!module.startWeek || !!module.endWeek) && React.createElement(React.Fragment, null,\n                React.createElement(\"br\", null),\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    React.createElement(\"h3\", null, \"Modulens period\"),\n                    React.createElement(\"div\", { className: \"week-period-div\" },\n                        React.createElement(\"div\", null, \"Startvecka\"),\n                        React.createElement(\"div\", null, module.startWeek || \"--\"),\n                        React.createElement(\"div\", null, \"Slutvecka\"),\n                        React.createElement(\"div\", null, module.endWeek || \"--\")),\n                    React.createElement(\"br\", null))),\n            Object.keys(incluedIds).length > 0 && React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    React.createElement(\"h3\", null, \"Modulens kunskapskrav, f\\u00F6rm\\u00E5gor och centrala inneh\\u00E5ll\"),\n                    React.createElement(\"hr\", null),\n                    Object.keys(incluedIds).length > 0 && React.createElement(KnowledgeRequirementsBox, { title: \"I den h\\u00E4r modulen bed\\u00F6ms f\\u00F6ljande kunskapskrav\", requirements: course.knowledgeRequirements, includedIds: incluedIds }),\n                    includedAbilities.length > 0 && React.createElement(AbilitiesBox, { title: \"Den h\\u00E4r modulen behandlar f\\u00F6ljande f\\u00F6rm\\u00E5gor\", abilities: includedAbilities }),\n                    includedCentralContent.length > 0 && React.createElement(CentralContentBox, { title: \"Den h\\u00E4r modulen behandlar f\\u00F6ljande centrala inneh\\u00E5ll\", centralContent: includedCentralContent }))),\n            module.taskIds.length > 0 && React.createElement(\"div\", { className: \"sv-script-portlet sv-portlet\" },\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    assignmentTasks.length === 0 ? undefined : React.createElement(React.Fragment, null,\n                        React.createElement(\"h2\", null, \"Inl\\u00E4mningsuppgifter\"),\n                        React.createElement(\"hr\", null),\n                        React.createElement(TaskList, { learningTasks: assignmentTasks })),\n                    nonAssignmentTasks.length === 0 ? undefined : React.createElement(React.Fragment, null,\n                        React.createElement(\"h2\", null, \"Uppgifter\"),\n                        React.createElement(\"hr\", null),\n                        React.createElement(LearningGoalsList, { commonTasks: commonTasks, learningGoals: Object.keys(learningGoals).map(function (learningGoal) { return ({\n                                name: learningGoal,\n                                learningTasks: learningGoals[learningGoal]\n                            }); }) })))),\n            module.resources.length > 0 && React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    React.createElement(\"h2\", null, \"Resurser\"),\n                    React.createElement(\"hr\", null),\n                    React.createElement(\"div\", { className: \"taskContainer\" }, module.resources.map(function (r, idx) {\n                        return React.createElement(\"div\", { className: \"align-horizontal\", key: idx },\n                            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                React.createElement(\"a\", { href: r.url }, r.name)));\n                    })))));\n    };\n    return CourseModulePage;\n}(React.Component));\nexport { CourseModulePage };\n","import { __assign } from \"tslib\";\nexport function getCustomizedTask(module, task) {\n    return module.taskCustomizations ? __assign(__assign({}, task), module.taskCustomizations[task.id]) :\n        task;\n}\n","import { __extends, __read } from \"tslib\";\nimport * as React from 'react';\nimport { CourseBanner } from \"./course-banner\";\nimport { CourseModulePage } from './course-module-page';\nimport { RunUpPage } from './run-up-page';\nimport { initManualScrollRestoration, restoreScrollPosition } from '../utils/manual-scroll-restoration';\nimport { hasWriteAccess, preserveImpersonationQuery } from '../../../access-control';\nimport { WeekPlanner } from \"../../weekplanner\";\nimport { TaskPage } from \"./task-page\";\nimport { getCustomizedTask } from './get-customized-task';\nimport env from '../../../globals/KED.env';\nimport { ExtraPageButtons } from '../../utility-components/extra-page-buttons';\ninitManualScrollRestoration();\nvar CoursePage = /** @class */ (function (_super) {\n    __extends(CoursePage, _super);\n    function CoursePage(props) {\n        var _this = _super.call(this, props) || this;\n        _this.onHashChange = _this.onHashChange.bind(_this);\n        var _a = _this.getModuleAndTaskFromHash(), module = _a.module, task = _a.task;\n        _this.state = {\n            module: module,\n            task: task\n        };\n        return _this;\n    }\n    CoursePage.prototype.getModuleAndTaskFromHash = function () {\n        var split = (location.hash.substr(1) || \"\").split('/');\n        if (split.length > 0 && !split[0])\n            split = split.slice(1); // Allow leading slash #/module/task\n        var _a = __read(split.map(function (part) { return decodeURIComponent(part); }), 2), moduleName = _a[0], taskId = _a[1];\n        var module = this.props.course.modules\n            .filter(function (m) { return (m.name || \"\")\n            .trim().toLowerCase() === (moduleName || \"\").trim().toLowerCase(); })[0] || null;\n        var task = taskId ?\n            this.props.course.tasks.find(function (t) { return t.id === taskId; }) || null :\n            null;\n        if (task && !module) {\n            // Resolve module by finding the module that holds the task:\n            module = this.getOrderedModules()\n                .filter(function (m) { return m.taskIds\n                .some(function (taskId) { return task.id === taskId; }); })[0];\n        }\n        if (task && module) {\n            task = getCustomizedTask(module, task);\n        }\n        return { module: module, task: task };\n    };\n    CoursePage.prototype.componentDidMount = function () {\n        window.addEventListener('hashchange', this.onHashChange);\n    };\n    CoursePage.prototype.componentWillUnmount = function () {\n        window.removeEventListener('hashchange', this.onHashChange);\n    };\n    CoursePage.prototype.onHashChange = function () {\n        var _a = this.getModuleAndTaskFromHash(), module = _a.module, task = _a.task;\n        this.setState({\n            module: module,\n            task: task\n        }, function () {\n            var fallbackScrollPosition = undefined;\n            if (task) {\n                var taskAnchor = document.getElementById('ked-task-anchor');\n                if (taskAnchor)\n                    fallbackScrollPosition = (window.pageYOffset + taskAnchor.getBoundingClientRect().top);\n                else\n                    fallbackScrollPosition = 0;\n            }\n            restoreScrollPosition({ fallbackScrollPosition: fallbackScrollPosition });\n        });\n    };\n    CoursePage.prototype.getOrderedModules = function () {\n        var course = this.props.course;\n        var moduleOrder = course.moduleOrder || course.modules.map(function (m) { return m.id; });\n        return moduleOrder\n            // Map ordered id to module\n            .map(function (id) { return course.modules.find(function (m) { return m.id === id && !m.inactive; }); })\n            // Ignore entries that only exists in moduleOrder but not in modules\n            .filter(function (m) { return !!m; })\n            // Append modules at end that are not listed in moduleOrder\n            .concat(course.modules.filter(function (m) { return !moduleOrder.find(function (id) { return m.id === id; }); }));\n    };\n    CoursePage.prototype.render = function () {\n        var _a = this.props, course = _a.course, courseBuilderUrl = _a.courseBuilderUrl;\n        var _b = this.state, module = _b.module, task = _b.task;\n        var orderedModules = this.getOrderedModules();\n        return React.createElement(\"div\", null,\n            React.createElement(CourseBanner, { title: course.name + \" - \" + course.points + \"p\", backgroundImage: (course.images.find(function (img) { return img.id === course.imageId; }) || { url: '' }).url, tabs: [{ name: \"Upptakt\", link: \"#\", key: \"Upptakt\" }]\n                    .concat(orderedModules.map(function (_a) {\n                    var name = _a.name;\n                    return ({ name: name, link: \"#\" + encodeURIComponent(name), key: name });\n                }))\n                    .concat(course.workFlowLink ? [{\n                        name: \"ArbetsgÃ¥ng\",\n                        key: \"workflow\",\n                        link: course.workFlowLink\n                    }] : [])\n                    .concat(hasWriteAccess(env.currentUser, course) ? [{\n                        name: React.createElement(\"span\", null,\n                            React.createElement(\"i\", { className: \"fas fa-pencil-alt\", \"aria-hidden\": \"true\" }),\n                            \" Redigera denna kurs\"),\n                        key: \"edit\",\n                        link: preserveImpersonationQuery(courseBuilderUrl, {}) + \"#/courses/\" + course.id + \"/edit\"\n                    }] : []), activeTab: module ? \"#\" + encodeURIComponent(module.name) : \"#\" }),\n            React.createElement(\"div\", { className: \"sv-row sv-layout\" },\n                React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\n                    React.createElement(\"div\", { className: \"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\" },\n                        React.createElement(\"div\", { className: \"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\" },\n                            React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\n                                React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-7\" },\n                                    React.createElement(ExtraPageButtons, null),\n                                    task ?\n                                        React.createElement(TaskPage, { task: task, course: course }) :\n                                        module ?\n                                            React.createElement(CourseModulePage, { course: course, module: module }) :\n                                            React.createElement(RunUpPage, { course: course })),\n                                React.createElement(\"div\", { className: \"sv-layout sv-column-5\" },\n                                    React.createElement(\"div\", { className: \"sv-vertical sv-layout sv-skip-spacer\" },\n                                        React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                                            React.createElement(WeekPlanner, { viewCourseUrl: '', env: env }))))))))));\n    };\n    return CoursePage;\n}(React.Component));\nexport { CoursePage };\n","import { __extends } from \"tslib\";\nimport * as React from 'react';\n// Views\nimport { AbilitiesBox } from '../subcomponents/abilities-box';\nimport { CentralContentBox } from '../subcomponents/central-content-box';\nimport { KnowledgeRequirementsBox } from '../subcomponents/knowledge-requirements-table';\nimport { ResourceList } from '../subcomponents/resource-list';\nvar RunUpPage = /** @class */ (function (_super) {\n    __extends(RunUpPage, _super);\n    function RunUpPage(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {};\n        return _this;\n    }\n    RunUpPage.prototype.render = function () {\n        var course = this.props.course;\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n                course.runUpText && React.createElement(\"div\", null,\n                    React.createElement(\"h1\", null, \"Upptakt\"),\n                    React.createElement(\"p\", { className: \"normal\", dangerouslySetInnerHTML: { __html: course.runUpText } })),\n                course.responsibleTeachers && course.responsibleTeachers.length > 0 && React.createElement(\"div\", null,\n                    React.createElement(\"h2\", null, \"L\\u00E4rare\"),\n                    course.responsibleTeachers.map(function (teacher, i) {\n                        return React.createElement(\"p\", { key: i },\n                            React.createElement(\"a\", { href: interpretTeacherUrl(teacher.email || teacher.url || '') }, teacher.name));\n                    })),\n                course.workFlowLink && React.createElement(\"a\", { className: \"btn\", href: course.workFlowLink }, \"Arbetsg\\u00E5ng\"),\n                React.createElement(\"br\", null),\n                React.createElement(\"br\", null),\n                course.abilities.length > 0 && React.createElement(AbilitiesBox, { title: \"\\u00C4mnets f\\u00F6rm\\u00E5gor\", subTitle: \"F\\u00F6rm\\u00E5gor\", abilities: course.abilities, className: \"larger\" }),\n                course.centralContent.length > 0 && React.createElement(CentralContentBox, { title: \"Kursens centrala inneh\\u00E5ll\", subTitle: \"Centralt inneh\\u00E5ll\", centralContent: course.centralContent, className: \"larger\" }),\n                course.knowledgeRequirements.length > 0 && React.createElement(KnowledgeRequirementsBox, { title: \"Kursens kunskapskrav\", requirements: course.knowledgeRequirements, className: \"larger\" })),\n            course.resources.length > 0 && React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n                React.createElement(\"div\", { className: \"ked_boxed\" },\n                    React.createElement(\"h2\", null, \"Resurser\"),\n                    React.createElement(\"hr\", null),\n                    React.createElement(ResourceList, { resources: course.resources }))));\n    };\n    return RunUpPage;\n}(React.Component));\nexport { RunUpPage };\nfunction interpretTeacherUrl(url) {\n    if (url.indexOf(':') === -1 && url.indexOf('@') >= 0)\n        return \"mailto:\" + url;\n    return url;\n}\n","import { __awaiter, __extends, __generator, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport { AbilitiesBox } from \"../subcomponents/abilities-box\";\nimport { CentralContentBox } from \"../subcomponents/central-content-box\";\nimport { KnowledgeRequirementsBox } from \"../subcomponents/knowledge-requirements-table\";\nimport { userTasksRepo } from '../../../repos/user-tasks-repo';\nimport { L } from '../../../utils/utils';\nimport { createUUID, DocumentAccess } from 'kedbackend/client';\nimport env from '../../../globals/KED.env';\nimport moment from 'moment';\nimport { TaskAssignments } from './task-assignments';\nimport { isTeacherAtSchool } from '../../../access-control';\nimport { UIAddbox } from '../../utility-components/checkbox';\nimport { ClassroomAssignments } from './classroom-assignments';\nimport { FileView } from '../subcomponents/task-fileview';\nvar TaskPage = /** @class */ (function (_super) {\n    __extends(TaskPage, _super);\n    function TaskPage(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            userTask: undefined,\n            weekPlannerWeek: moment().week()\n        };\n        _this.onUserTasksChanged = _this.onUserTasksChanged.bind(_this);\n        return _this;\n    }\n    TaskPage.prototype.componentDidMount = function () {\n        userTasksRepo.subscribe(this.onUserTasksChanged);\n    };\n    TaskPage.prototype.componentWillUnmount = function () {\n        userTasksRepo.unsubscribe(this.onUserTasksChanged);\n    };\n    TaskPage.prototype.componentWillReceiveProps = function (nextProps) {\n        if (nextProps.task.id !== this.props.task.id) {\n            var userTask = userTasksRepo.mem.items.find(function (ut) { return ut.task && ut.task.length > 0 && ut.task[0].id === nextProps.task.id; }) || null;\n            this.setState({\n                userTask: userTask,\n                weekPlannerWeek: moment(userTasksRepo.persistedState.weekDate).week()\n            });\n        }\n    };\n    TaskPage.prototype.onUserTasksChanged = function (userTasks) {\n        var _this = this;\n        var userTask = userTasks.find(function (ut) { return ut.task && ut.task.length > 0 && ut.task[0].id === _this.props.task.id; }) || null;\n        this.setState({\n            userTask: userTask,\n            weekPlannerWeek: moment(userTasksRepo.persistedState.weekDate).week()\n        });\n    };\n    TaskPage.prototype.toggleTask = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var weekDate, userTask, _a, course, task, module, latestTimeStamp, userTask_1;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        weekDate = userTasksRepo.persistedState.weekDate;\n                        userTask = this.state.userTask;\n                        _a = this.props, course = _a.course, task = _a.task;\n                        module = course.modules.find(function (m) { return m.taskIds.some(function (id) { return id === task.id; }); });\n                        if (!module)\n                            return [2 /*return*/]; // Oh uh!\n                        if (userTask === undefined)\n                            return [2 /*return*/]; // Not yet loaded.\n                        if (!!userTask) return [3 /*break*/, 2];\n                        latestTimeStamp = Math.max.apply(Math.max, [weekDate].concat(userTasksRepo.mem.items.map(function (t) { return t.dateTime; })));\n                        userTask_1 = {\n                            id: createUUID(),\n                            courseName: course.name,\n                            dateTime: latestTimeStamp + 2000,\n                            learningGoal: task.learningGoal || module.name,\n                            name: task.name,\n                            url: task.url,\n                            task: [task],\n                            course: [course],\n                            acl: [\n                                // Default ACL: Let user self have full control over this item:\n                                new DocumentAccess(\"email\", env.currentUser.mail, \"S\"),\n                            ].map(function (ac) { return ac.toString(); })\n                        };\n                        if (task.deadline) {\n                            userTask_1.deadline = task.deadline;\n                        }\n                        return [4 /*yield*/, Promise.all([\n                                userTasksRepo.setWeekPlannerBoxOpen(this.props.course.name, true),\n                                userTasksRepo.insert([userTask_1])\n                            ])];\n                    case 1:\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 2: return [4 /*yield*/, userTasksRepo.delete([userTask.id])];\n                    case 3:\n                        _b.sent();\n                        _b.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TaskPage.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, task = _a.task, course = _a.course;\n        var _b = this.state, userTask = _b.userTask, weekPlannerWeek = _b.weekPlannerWeek;\n        var abilities = task.abilities.map(function (a) { return course.abilities.find(function (ab) { return ab.id === a.id; }); }).filter(function (a) { return !!a; });\n        var centralContent = task.centralContent.map(function (c) { return course.centralContent.find(function (cc) { return cc.id == c.id; }); }).filter(function (c) { return !!c; });\n        var requirements = task.knowledgeRequirements.map(function (k) { return course.knowledgeRequirements.find(function (kr) { return kr.id === k.id; }); }).filter(function (k) { return !!k; });\n        var isWorking = userTask && (userTask.$meta === 'adding' || userTask.$meta === 'deleting');\n        var currentWeek = moment().week();\n        var forWeekString = weekPlannerWeek === currentWeek ? \"loggboken\" :\n            weekPlannerWeek === currentWeek + 1 ? L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"vald vecka (n\\u00E4sta vecka)\"], [\"vald vecka (n\\u00E4sta vecka)\"]))) :\n                weekPlannerWeek === currentWeek - 1 ? L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"vald vecka (f\\u00F6rra veckan)\"], [\"vald vecka (f\\u00F6rra veckan)\"]))) : L(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"vald vecka (v \", \")\"], [\"vald vecka (v \", \")\"])), weekPlannerWeek);\n        var deadlineTooLate = task.deadline && moment(task.deadline).endOf('day') < moment();\n        if (course.googleCreateClassrooms) {\n            // we have google classroom active\n            if (task.templateFile && task.templateFile.mimeType.includes('google-apps')) {\n                // we have a google apps file so this should be in classroom\n            }\n            else {\n                // we have a template file that is not a google apps file -- should never happen\n            }\n        }\n        return React.createElement(React.Fragment, null,\n            React.createElement(\"h1\", null, task.name),\n            task.content && React.createElement(React.Fragment, null,\n                React.createElement(\"div\", { dangerouslySetInnerHTML: { __html: task.content } })),\n            task.learningGoal && React.createElement(\"div\", null,\n                React.createElement(\"h2\", null, \"Uppgiftens l\\u00E4randem\\u00E5l\"),\n                React.createElement(\"p\", null, task.learningGoal)),\n            task.url && React.createElement(\"a\", { href: task.url, className: \"btn btn-large\" }, \"G\\u00E5 till uppgiften\"),\n            React.createElement(\"br\", null),\n            task.assignment &&\n                React.createElement(\"div\", { className: \"card\" + (deadlineTooLate ? \" warning\" : \"\") },\n                    React.createElement(\"div\", { className: \"card-icon\" },\n                        React.createElement(\"i\", { className: \"fas fa-file-alt\" }),\n                        React.createElement(\"p\", { className: \"card-icon-info\" }, task.deadline ? task.deadline : 'Ingen deadline')),\n                    React.createElement(\"h2\", null, \"Inl\\u00E4mningsuppgift\"),\n                    course.googleCreateClassrooms ? React.createElement(React.Fragment, null,\n                        React.createElement(ClassroomAssignments, { course: course, task: task })) : React.createElement(React.Fragment, null,\n                        isTeacherAtSchool(env.currentUser, course.school) ?\n                            React.createElement(\"p\", null, \"H\\u00E4r kan du som l\\u00E4rare se elevernas inl\\u00E4mnade arbeten.\") : task.templateFile ? React.createElement(React.Fragment, null,\n                            React.createElement(\"p\", null, \"Till den h\\u00E4r uppgiften ska du anv\\u00E4dna f\\u00F6ljande mall:\"),\n                            React.createElement(FileView, { thumbnail: task.templateFile.iconUrl, title: task.templateFile.name, url: task.templateFile.url.substr(0, task.templateFile.url.lastIndexOf('/')) + '/copy' })) : React.createElement(React.Fragment, null,\n                            React.createElement(\"p\", null, \"Det h\\u00E4r \\u00E4r en inl\\u00E4mningsuppgift. L\\u00E4mna in ditt arbete som en pdf, doc eller odt fil genom att dra det till f\\u00E4ltet under. Du kan \\u00E4ven ladda up en fil eller v\\u00E4lja en fil fr\\u00E5n din Google Drive.\"),\n                            task.deadline ? React.createElement(\"p\", null,\n                                React.createElement(\"b\", null,\n                                    \"Den h\\u00E4r uppgiften \",\n                                    deadlineTooLate ? 'skulle ha lÃ¤mnats in ' : 'ska vara inlÃ¤mnad ',\n                                    moment(task.deadline).format('YYYY-MM-DD'))) : undefined),\n                        React.createElement(TaskAssignments, { courseId: course.id, taskId: task.id, school: course.school, sendToUrkund: task.sendToUrkund === undefined ? true : task.sendToUrkund, courseStudyGroups: course.studyGroups, taskDeadline: task.deadline }),\n                        React.createElement(\"br\", null))),\n            abilities.length > 0 && React.createElement(AbilitiesBox, { title: \"Den h\\u00E4r uppgiften behandlar f\\u00F6ljande f\\u00F6rm\\u00E5gor\", className: \"larger\", headerOpen: false, abilities: abilities }),\n            centralContent.length > 0 && React.createElement(CentralContentBox, { title: \"Den h\\u00E4r uppgiften behandlar f\\u00F6ljande centrala inneh\\u00E5ll\", className: \"larger\", headerOpen: false, centralContent: centralContent }),\n            requirements.length > 0 && React.createElement(KnowledgeRequirementsBox, { title: \"I den h\\u00E4r uppgiften bed\\u00F6ms f\\u00F6ljande kunskapskrav\", className: \"larger\", headerOpen: false, requirements: requirements }),\n            React.createElement(\"hr\", null),\n            userTask !== undefined && React.createElement(\"div\", { className: \"taskContainer\", style: isWorking ? { opacity: 0.5 } : {} },\n                React.createElement(UIAddbox, { state: userTask && userTask.$meta !== 'deleting' ? 'checked' : '', label: userTask ? L(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"Ta bort uppgiften fr\\u00E5n \", \"\"], [\"Ta bort uppgiften fr\\u00E5n \", \"\"])), forWeekString) : L(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"L\\u00E4gg till uppgiften i \", \"\"], [\"L\\u00E4gg till uppgiften i \", \"\"])), forWeekString), onChange: function () { return !isWorking && _this.toggleTask(); } })),\n            React.createElement(\"hr\", null),\n            task.resources && task.resources.length > 0 && React.createElement(React.Fragment, null,\n                React.createElement(\"h2\", null, \"Resurser kopplade till uppgiften\"),\n                React.createElement(\"div\", { className: \"taskContainer\" }, task.resources.map(function (r, idx) {\n                    return React.createElement(\"div\", { key: idx, className: \"align-horizontal\" },\n                        React.createElement(\"div\", { className: \"horizontalItem top\" },\n                            React.createElement(\"a\", { href: r.url }, r.name)));\n                })),\n                React.createElement(\"br\", null)),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null),\n            React.createElement(\"br\", null));\n    };\n    return TaskPage;\n}(React.Component));\nexport { TaskPage };\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5;\n","import { __awaiter, __extends, __generator } from \"tslib\";\nimport * as React from 'react';\nimport { showError } from '../../utils/utils';\nimport { ErrorSuccessFeedback } from '../../utils/error-success-feedback';\nimport { loadCourse } from \"../course-builder/utils\";\nimport { TimeoutSpinner } from \"../course-builder/sub-components/spinner\";\nimport { CoursePage } from \"./course-page\";\nimport { parseQueryString } from \"../../utils/query-string\";\nimport { ListCoursesPage } from '../list-courses/list-courses-page';\nimport { preserveImpersonationQuery } from '../../access-control';\nvar CourseViewer = /** @class */ (function (_super) {\n    __extends(CourseViewer, _super);\n    function CourseViewer(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            course: null,\n            isLoading: true\n        };\n        return _this;\n    }\n    CourseViewer.prototype.componentWillMount = function () {\n        var _this = this;\n        this.load().catch(showError)\n            .then(function () { return _this.setState({ isLoading: false }); });\n    };\n    CourseViewer.prototype.load = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, courseId, taskId, moduleName, encModuleName, encTaskId, newUrlWithoutCourseId, newUrlWithCourseId, course, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        query = parseQueryString(location.search);\n                        courseId = query[\"courseId\"];\n                        taskId = query[\"taskId\"];\n                        moduleName = query[\"module\"];\n                        if (taskId && moduleName) {\n                            encModuleName = encodeURIComponent(moduleName);\n                            encTaskId = encodeURIComponent(taskId);\n                            newUrlWithoutCourseId = location.protocol + \"//\" + location.host + location.pathname + \"#\" + encModuleName + \"/\" + encTaskId;\n                            newUrlWithCourseId = preserveImpersonationQuery(newUrlWithoutCourseId, { courseId: courseId });\n                            location.replace(newUrlWithCourseId);\n                        }\n                        if (!courseId) return [3 /*break*/, 2];\n                        return [4 /*yield*/, loadCourse(courseId)];\n                    case 1:\n                        _a = _b.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        _a = null;\n                        _b.label = 3;\n                    case 3:\n                        course = _a;\n                        this.setState({ course: course });\n                        document.title =\n                            course ?\n                                course.name + \" - \" + course.points + \"p\" :\n                                \"Kurser\";\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CourseViewer.prototype.render = function () {\n        return React.createElement(\"div\", { className: \"course-viewer\" },\n            this.state.isLoading ?\n                React.createElement(TimeoutSpinner, null) :\n                this.state.course ?\n                    React.createElement(CoursePage, { course: this.state.course, courseBuilderUrl: this.props.courseBuilderUrl }) :\n                    React.createElement(ListCoursesPage, null),\n            React.createElement(ErrorSuccessFeedback, null));\n    };\n    return CourseViewer;\n}(React.Component));\nexport { CourseViewer };\n","import { __assign, __awaiter, __extends, __generator } from \"tslib\";\nimport * as React from \"react\";\nimport { OpenCloseBox } from \"../../utility-components/open-close-box\";\nimport { FileView } from \"./task-fileview\";\nimport { getUrkundHoverText, getUrkundSignificanceClass, getUrkundStatusClass } from \"../course-page/urkund-utils\";\nimport { Button } from \"../../../apis/buttons\";\nimport { env } from \"../../../globals/KED.env\";\nimport { HttpError } from \"kedbackend/client\";\nimport { GoogleClassroom } from \"../../../apis/google-classroom\";\nvar stateMap = {\n    TURNED_IN: \"inlÃ¤mnad\",\n    RECLAIMED_BY_STUDENT: \"Ã¥tertagen\",\n    RETURNED: \"Ã¥terlÃ¤mnad\",\n    CREATED: \"ej inlÃ¤mnad\",\n    NEW: \"ej inlÃ¤mnad\"\n};\nexport var SubmissionListings = function (_a) {\n    var submissions = _a.submissions, assignments = _a.assignments, sendToKedbackend = _a.sendToKedbackend, hasTemplate = _a.hasTemplate, sendToUrkund = _a.sendToUrkund, courseId = _a.courseId, taskId = _a.taskId;\n    var subGroups = {};\n    var assGroups = {};\n    submissions.forEach(function (s) {\n        if (subGroups[s.group])\n            subGroups[s.group].push(s);\n        else\n            subGroups[s.group] = [s];\n    });\n    assignments.forEach(function (a) {\n        var submission = submissions.find(function (sub) { return sub.id == a.submissionId; });\n        if (submission) {\n            if (assGroups[submission.group])\n                assGroups[submission.group].push(a);\n            else\n                assGroups[submission.group] = [a];\n        }\n    });\n    var ClassroomLink = submissions.length > 0 ? submissions[0].crLink.replace('details', 'submissions/by-status/and-sort-last-name/all') : '';\n    return (React.createElement(\"div\", { className: \"stopFloats\" }, Object.keys(subGroups)\n        .sort()\n        .map(function (group, i) {\n        return (React.createElement(OpenCloseBox, { key: i, title: group, children: React.createElement(React.Fragment, null,\n                ClassroomLink !== '' && React.createElement(\"div\", { className: \"pullRight\" },\n                    React.createElement(Button, { url: ClassroomLink, label: 'Visa i Classroom', faIcon: 'fas fa-graduation-cap' })),\n                React.createElement(SubmissionTables, { assignments: assGroups[group] ? assGroups[group] : [], submissions: subGroups[group], hasTemplate: hasTemplate, sendToKedbackend: sendToKedbackend, sendToUrkund: sendToUrkund, courseId: courseId, taskId: taskId })) }));\n    })));\n};\nvar SubmissionTables = /** @class */ (function (_super) {\n    __extends(SubmissionTables, _super);\n    function SubmissionTables(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            submissions: _this.props.submissions,\n            assignments: _this.props.assignments\n        };\n        return _this;\n    }\n    SubmissionTables.prototype.render = function () {\n        var _this = this;\n        var namesort = function (a, b) {\n            var lnCmp = a.name.lastName.localeCompare(b.name.lastName);\n            return lnCmp == 0\n                ? a.name.firstName.localeCompare(b.name.firstName)\n                : lnCmp;\n        };\n        var _a = this.state, submissions = _a.submissions, assignments = _a.assignments;\n        var complete = submissions\n            .filter(function (sub) { return sub.state === \"TURNED_IN\" || sub.state === 'RETURNED'; })\n            .sort(namesort);\n        var incomplete = submissions\n            .filter(function (sub) { return !(sub.state === \"TURNED_IN\" || sub.state === 'RETURNED'); })\n            .sort(namesort);\n        return (React.createElement(React.Fragment, null,\n            \" \",\n            complete.length > 0 && (React.createElement(React.Fragment, null,\n                React.createElement(\"p\", null, \"Inl\\u00E4mnade uppgifter:\"),\n                React.createElement(\"table\", { className: \"task-assignments-table\" },\n                    React.createElement(\"thead\", null,\n                        React.createElement(\"tr\", null,\n                            React.createElement(\"th\", null, \"Elev\"),\n                            React.createElement(\"th\", null, \"Inl\\u00E4mingsdatum\"),\n                            React.createElement(\"th\", null, \"Inl\\u00E4mning\"),\n                            React.createElement(\"th\", { className: \"actions\" },\n                                React.createElement(\"i\", { className: \"fas fa-cogs\" })))),\n                    React.createElement(\"tbody\", null, complete.map(function (submission, i) { return (React.createElement(SubmissionRow, { key: i, submission: submission, files: assignments.filter(function (file) { return file.submissionId === submission.id; }), hasTemplate: _this.props.hasTemplate, sendToKedbackend: _this.props.sendToKedbackend, sendToUrkund: _this.props.sendToUrkund, courseId: _this.props.courseId, taskId: _this.props.taskId })); }))))),\n            incomplete.length > 0 && (React.createElement(React.Fragment, null,\n                React.createElement(\"p\", null, \"Ej inl\\u00E4mnade:\"),\n                React.createElement(\"table\", { className: \"task-assignments-table\" },\n                    React.createElement(\"thead\", null,\n                        React.createElement(\"tr\", null,\n                            React.createElement(\"th\", null, \"Elev\"),\n                            React.createElement(\"th\", null, \"Status\"),\n                            React.createElement(\"th\", null, \"Inl\\u00E4mning\"),\n                            React.createElement(\"th\", { className: \"actions\" },\n                                React.createElement(\"i\", { className: \"fas fa-cogs\" })))),\n                    React.createElement(\"tbody\", null, incomplete.map(function (submission, i) { return (React.createElement(SubmissionRow, { key: i, submission: submission, files: assignments.filter(function (file) { return file.submissionId === submission.id; }), hasTemplate: _this.props.hasTemplate, sendToKedbackend: _this.props.sendToKedbackend, sendToUrkund: false })); })))))));\n    };\n    return SubmissionTables;\n}(React.Component));\nvar SubmissionRow = /** @class */ (function (_super) {\n    __extends(SubmissionRow, _super);\n    function SubmissionRow(props) {\n        var _this = _super.call(this, props) || this;\n        _this.classroom = new GoogleClassroom();\n        _this.state = {\n            files: _this.props.files,\n            submission: _this.props.submission,\n            loading: false,\n            loadingMessage: 'Laddar inlÃ¤mning...'\n        };\n        return _this;\n    }\n    SubmissionRow.prototype.transformUrl = function (url) {\n        // Transforms alternateLink for submission to link to Classroom-interface for correcting submission\n        var parts = url.split(\"/\");\n        parts.splice(3, 1, \"u\", \"0\", \"g\", \"tg\");\n        parts[8] = parts[9] + \"?authuser=0#u=\" + parts[12];\n        return parts.slice(0, 9).join(\"/\");\n    };\n    SubmissionRow.prototype.sendToKedbackend = function (submission) {\n        return __awaiter(this, void 0, void 0, function () {\n            var assignments;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.setState({ loading: true, loadingMessage: 'Skickar filer...' });\n                        return [4 /*yield*/, this.props.sendToKedbackend(submission)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, env.kedBackendClient.http.get(\"assignments/\" + env.currentUser.school + \"/\" + this.props.courseId + \"/\" + this.props.taskId + \"/\" + submission.userEmail).then(function (resp) {\n                                if (resp.ok)\n                                    return resp.json();\n                                return [];\n                            })\n                                .then(function (res) {\n                                return res.map(function (assignment) {\n                                    if (!assignment.metadata || !assignment.metadata.driveFileId)\n                                        return assignment;\n                                    if (!submission.assignmentSubmission.attachments)\n                                        return assignment;\n                                    // add submission data\n                                    submission.assignmentSubmission.attachments.forEach(function (attachment) {\n                                        if (attachment.driveFile.id == assignment.metadata.driveFileId) {\n                                            assignment.submissionId = submission.id;\n                                        }\n                                    });\n                                    return assignment;\n                                });\n                            })];\n                    case 2:\n                        assignments = _a.sent();\n                        this.setState({\n                            loading: false, files: assignments\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SubmissionRow.prototype.refreshAssignment = function (assignment) {\n        return __awaiter(this, void 0, void 0, function () {\n            var req, _a, _b, resJson, files;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        this.setState({ loading: true, loadingMessage: \"VÃ¤ntar pÃ¥ svar...\" });\n                        return [4 /*yield*/, env.kedBackendClient.http.get(\"assignments/urkund/\" + env.currentUser.school + \"/\" + this.props.courseId + \"/\" + this.props.taskId + \"/\" + assignment.user + \"/\" + assignment.filename)];\n                    case 1:\n                        req = _c.sent();\n                        if (!(req.status >= 400)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, req.status];\n                        return [4 /*yield*/, req.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, req.text()];\n                    case 4:\n                        resJson = _c.sent();\n                        files = this.state.files.map(function (f) {\n                            if (f.metadata.driveFileId == assignment.metadata.driveFileId) {\n                                f.metadata.urkundResponse = resJson;\n                            }\n                            return f;\n                        });\n                        this.setState({ loading: false, files: files });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SubmissionRow.prototype.returnSubmission = function (submission) {\n        return __awaiter(this, void 0, void 0, function () {\n            var updated;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.setState({ loading: true, loadingMessage: \"Returnerar inlÃ¤mning...\" });\n                        return [4 /*yield*/, this.classroom.returnSubmission(submission)];\n                    case 1:\n                        updated = _a.sent();\n                        this.setState({ loading: false, submission: __assign(__assign({}, submission), { state: 'RETURNED' }) });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SubmissionRow.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, hasTemplate = _a.hasTemplate, sendToUrkund = _a.sendToUrkund;\n        if (this.state.loading) {\n            return React.createElement(\"tr\", null,\n                React.createElement(\"td\", { colSpan: 4 }, this.state.loadingMessage));\n        }\n        var _b = this.state, files = _b.files, submission = _b.submission;\n        var file = submission.assignmentSubmission.attachments\n            ? submission.assignmentSubmission.attachments[0].driveFile\n            : undefined;\n        var name = submission.name, state = submission.state, userEmail = submission.userEmail, late = submission.late, updateTime = submission.updateTime;\n        var turnedIn = state == \"TURNED_IN\";\n        var returned = state == 'RETURNED';\n        var crUrl = turnedIn ? this.transformUrl(submission.alternateLink) : \"\";\n        if (file && hasTemplate && crUrl !== \"\")\n            file.alternateLink = crUrl;\n        var appendedFiles = file\n            ? hasTemplate\n                ? submission.assignmentSubmission.attachments.slice(1)\n                : submission.assignmentSubmission.attachments\n            : [];\n        var showUrkundBtn = sendToUrkund &&\n            file && (files.length == 0 ||\n            files.filter(function (f) { return f.metadata.driveFileId == file.id; }).length == 0);\n        // console.table({\n        //   showUrkundBtn, sendToUrkund, file, files, filtered: files.filter(f => f.metadata.driveFileId == file.id)\n        // });\n        return (React.createElement(\"tr\", { className: late && turnedIn ? \"late\" : undefined },\n            React.createElement(\"td\", null,\n                React.createElement(\"a\", { href: \"mailto:\" + userEmail },\n                    name.firstName,\n                    \" \",\n                    name.lastName)),\n            React.createElement(\"td\", null,\n                turnedIn || returned\n                    ? new Date(updateTime)\n                        .toLocaleString()\n                        .split(\" \")\n                        .join(\" kl. \")\n                    : stateMap[state],\n                returned ? ' (Ã¥terlÃ¤mnad)' : ''),\n            React.createElement(\"td\", null, file && (turnedIn || returned)\n                ? [\n                    !hasTemplate && appendedFiles.length > 1 && (React.createElement(\"p\", null,\n                        React.createElement(Button, { label: \"Bed\\u00F6m i Classroom\", url: crUrl, faIcon: \"fas fa-highlighter\" }))),\n                    (hasTemplate ||\n                        (!hasTemplate && appendedFiles.length == 1)) && (React.createElement(StatusView, { key: 0, file: file, data: files.find(function (f) { return f.metadata.driveFileId === file.id; }), refreshAssignment: this.refreshAssignment.bind(this) })),\n                    (!hasTemplate && appendedFiles.length > 1) ||\n                        (hasTemplate && appendedFiles.length) ? (React.createElement(OpenCloseBox, { key: 1, title: \"Bifogade filer (\" + appendedFiles.length + \")\" }, appendedFiles.map(function (sub, i) {\n                        return (React.createElement(StatusView, { key: i, file: sub.driveFile, data: files.find(function (f) { return f.metadata.driveFileId === sub.driveFile.id; }), refreshAssignment: _this.refreshAssignment.bind(_this) }));\n                    }))) : (undefined)\n                ]\n                : file && [\n                    hasTemplate && (React.createElement(FileView, { key: 0, thumbnail: file.thumbnailUrl, url: file.alternateLink, title: file.title })),\n                    appendedFiles.length ? (React.createElement(OpenCloseBox, { key: 1, title: \"Bifogade filer (\" + appendedFiles.length + \")\" }, appendedFiles.map(function (sub, i) {\n                        var file = files.find(function (file) { return file.metadata.driveFileId === sub.driveFile.id; });\n                        return (React.createElement(FileView, { key: i, thumbnail: sub.driveFile.thumbnailUrl, url: sub.driveFile.alternateLink, title: sub.driveFile.title }));\n                    }))) : (undefined)\n                ]),\n            React.createElement(\"td\", { className: \"actions\" },\n                showUrkundBtn && (React.createElement(Button, { label: \"Skicka till Urkund\", action: function () {\n                        console.table(submission);\n                        _this.sendToKedbackend(submission);\n                    } })),\n                turnedIn && (React.createElement(Button, { label: \"\\u00C5terl\\u00E4mna\", action: function () {\n                        _this.returnSubmission(submission);\n                        console.log('return submission');\n                    } })))));\n    };\n    return SubmissionRow;\n}(React.Component));\nvar StatusView = function (_a) {\n    var file = _a.file, data = _a.data, refreshAssignment = _a.refreshAssignment;\n    var sentToUrkund = !!data && data.metadata.urkundExternalId;\n    var urkundResponse = !!data && data.metadata.urkundResponse\n        ? JSON.parse(data.metadata.urkundResponse)[0]\n        : false;\n    return (React.createElement(\"div\", { className: \"stats-view\" },\n        React.createElement(FileView, { thumbnail: file.thumbnailUrl, url: file.alternateLink, title: file.title }),\n        React.createElement(\"div\", { className: \"urkund-stats urkund-status-col\" }, urkundResponse ? (React.createElement(React.Fragment, null,\n            React.createElement(\"p\", null, \"Urkund\"),\n            React.createElement(\"a\", { href: urkundResponse.Report && urkundResponse.Report.ReportUrl, onClick: function (ev) {\n                    if ([\"Accepted\", \"Submitted\"].indexOf(urkundResponse.Status.State) === -1)\n                        return; // Follow HREF instead.\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                    refreshAssignment(data);\n                }, target: \"_blank\", title: getUrkundHoverText(urkundResponse) },\n                React.createElement(\"div\", { className: getUrkundStatusClass(urkundResponse) })),\n            React.createElement(\"div\", { className: getUrkundSignificanceClass(urkundResponse) }, urkundResponse.Report &&\n                typeof urkundResponse.Report.Significance === \"number\"\n                ? urkundResponse.Report.Significance.toFixed() + \"%\"\n                : \" \"))) : sentToUrkund ? (React.createElement(React.Fragment, null,\n            React.createElement(\"p\", null, \"Urkund\"),\n            React.createElement(\"a\", { href: \"#\", onClick: function (ev) {\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                    refreshAssignment(data);\n                }, target: \"_blank\", title: 'Filen \\u00E4r uppladdad till Urkund. Klicka f\\u00F6r att uppdatera status.' },\n                React.createElement(\"div\", { className: 'urkund-status urkund-status-submitted' })))) : (React.createElement(\"p\", null, \"Ej skickad till Urkund\")))));\n};\n","import { __extends } from \"tslib\";\nimport * as React from 'react';\nvar ResourceList = /** @class */ (function (_super) {\n    __extends(ResourceList, _super);\n    function ResourceList(props) {\n        return _super.call(this, props) || this;\n    }\n    ResourceList.prototype.render = function () {\n        var resources = this.props.resources;\n        return React.createElement(\"div\", null,\n            React.createElement(\"div\", { className: \"taskContainer\" }, resources.map(function (resource, idx) {\n                return React.createElement(\"div\", { className: \"align-horizontal\", key: idx },\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"a\", { href: resource.url }, resource.name)));\n            })));\n    };\n    return ResourceList;\n}(React.Component));\nexport { ResourceList };\n","export default function getIncludedIds(module, course) {\n    var result = {};\n    course.tasks.filter(function (t) { return module.taskIds.indexOf(t.id) !== -1; }).forEach(function (task) {\n        task.abilities.forEach(function (_a) {\n            var id = _a.id;\n            return result[id] = true;\n        });\n        task.centralContent.forEach(function (_a) {\n            var id = _a.id;\n            return result[id] = true;\n        });\n        task.knowledgeRequirements.forEach(function (_a) {\n            var id = _a.id;\n            return result[id] = true;\n        });\n    });\n    return result;\n}\n","var initialized = false;\nexport function initManualScrollRestoration() {\n    if (!initialized) {\n        initialized = true;\n        document.documentElement.addEventListener('click', function (ev) {\n            var target = ev.target;\n            if (target && target.tagName === 'A') {\n                history.replaceState({ pageYOffset: window.pageYOffset }, null, null);\n            }\n        });\n        if (history.scrollRestoration)\n            history.scrollRestoration = 'manual';\n    }\n}\nexport function restoreScrollPosition(_a) {\n    var fallbackScrollPosition = _a.fallbackScrollPosition;\n    if (history.state && history.state.pageYOffset !== undefined) {\n        window.scrollTo(0, history.state.pageYOffset);\n    }\n    else if (fallbackScrollPosition !== undefined) {\n        window.scrollTo(0, fallbackScrollPosition);\n    }\n}\n","import * as React from 'react';\nimport { CourseBanner } from \"../course-viewer/course-page/course-banner\";\nimport { ListCourses } from './list-courses';\nimport env from '../../globals/KED.env';\nexport function ListCoursesPage() {\n    return React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet\" },\n        React.createElement(CourseBanner, { title: env.currentUser.school, backgroundImage: \"\", tabs: [{ name: \"Skolans kurser\", link: \"#\" }], activeTab: \"#\" }),\n        React.createElement(\"div\", { className: \"sv-row sv-layout\" },\n            React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\n                React.createElement(\"div\", { className: \"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\" },\n                    React.createElement(ListCourses, null)))));\n}\n","import { __assign, __awaiter, __extends, __generator, __makeTemplateObject } from \"tslib\";\nimport * as React from 'react';\nimport cfg from '../../globals/KED.cfg';\nimport { showInfo, L } from \"../../utils/utils\";\nimport { TimeoutSpinner } from \"../course-builder/sub-components/spinner\";\nimport { parseQueryString, generateQueryString } from \"../../utils/query-string\";\nimport { preserveImpersonationQuery } from '../../access-control/index';\nimport { hiddenCoursesRepo } from '../../repos/hidden-courses-repo';\nvar ListCourses = /** @class */ (function (_super) {\n    __extends(ListCourses, _super);\n    function ListCourses(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            isLoading: true,\n            courses: [],\n            headerOpen: false\n        };\n        _this.updateHiddenCourses = _this.updateHiddenCourses.bind(_this);\n        return _this;\n    }\n    ListCourses.prototype.componentWillMount = function () {\n        hiddenCoursesRepo.subscribe(this.updateHiddenCourses, { fullCourse: true });\n    };\n    ListCourses.prototype.componentWillUnmount = function () {\n        hiddenCoursesRepo.unsubscribe(this.updateHiddenCourses);\n    };\n    ListCourses.prototype.updateHiddenCourses = function (courses) {\n        this.setState({ courses: courses, isLoading: false });\n    };\n    ListCourses.prototype.hideCourse = function (course) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        showInfo(L(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"Sparar...\"], [\"Sparar...\"]))));\n                        return [4 /*yield*/, hiddenCoursesRepo.hideCourse(course)];\n                    case 1:\n                        _a.sent();\n                        showInfo(\"\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ListCourses.prototype.showCourse = function (course) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        showInfo(L(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"Sparar...\"], [\"Sparar...\"]))));\n                        return [4 /*yield*/, hiddenCoursesRepo.showCourse(course)];\n                    case 1:\n                        _a.sent();\n                        showInfo(\"\");\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ListCourses.prototype.render = function () {\n        var _this = this;\n        if (this.state.isLoading)\n            return React.createElement(TimeoutSpinner, null);\n        var courses = this.state.courses;\n        var visibleCourses = courses.filter(function (course) { return course.visible; });\n        var hiddenCourses = courses.filter(function (course) { return !course.visible; });\n        var query = parseQueryString(location.search);\n        var viewCourseUrl = cfg.KED_COURSE_VIEWER_URL;\n        return React.createElement(\"div\", { className: \"ked_boxed\" },\n            React.createElement(\"h3\", null, \"Skolans kurser\"),\n            React.createElement(\"div\", { className: \"taskContainer odd-even\" }, visibleCourses.map(function (course) {\n                return React.createElement(\"div\", { className: \"studentCourse\", key: course.id },\n                    React.createElement(\"div\", { className: \"align-horizontal\" },\n                        React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\n                            React.createElement(\"a\", { className: \"hideItem\", onClick: function () { return _this.hideCourse(course); } })),\n                        React.createElement(\"div\", { className: \"horizontalItem top\" },\n                            React.createElement(\"a\", { href: preserveImpersonationQuery(viewCourseUrl, { courseId: course.id }) }, course.name))),\n                    React.createElement(\"div\", { className: \"horizontalItem top\" },\n                        React.createElement(\"p\", { className: \"small\" }, course.description)));\n            })),\n            React.createElement(\"div\", { className: \"openClose\" + (this.state.headerOpen ? \" open\" : \"\") },\n                React.createElement(\"div\", { className: \"openHeader\", onClick: function () { return _this.setState({ headerOpen: !_this.state.headerOpen }); } },\n                    React.createElement(\"h5\", null, \"Dolda kurser\")),\n                React.createElement(\"div\", { className: \"openContent\" },\n                    React.createElement(\"div\", { className: \"taskContainer odd-even\" }, hiddenCourses.map(function (course) {\n                        return React.createElement(\"div\", { className: \"studentCourse\", key: course.id },\n                            React.createElement(\"div\", { className: \"align-horizontal\" },\n                                React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\n                                    React.createElement(\"a\", { className: \"showItem\", onClick: function () { return _this.showCourse(course); } })),\n                                React.createElement(\"a\", { href: generateQueryString(__assign(__assign({}, query), { courseId: course.id })) }, course.name)),\n                            React.createElement(\"div\", { className: \"horizontalItem top\" },\n                                React.createElement(\"p\", { className: \"small\" }, course.description)));\n                    })))));\n    };\n    return ListCourses;\n}(React.Component));\nexport { ListCourses };\nvar templateObject_1, templateObject_2;\n","export { WeekPlanner } from './weekplanner';\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3gBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtFA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChTA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClBA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjGA;AAAA;AAAA;AAAA;AAAA;;;;;A","sourceRoot":""}