{"version":3,"file":"kedappteacherview.js","sources":["webpack://[name]/webpack/bootstrap","webpack://[name]/./kedbackend/client.js","webpack://[name]/./kedbackend/clientweb.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client-web/bearer-storage-sessionstorage.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client-web/hash-restorer.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client-web/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/access-control.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/http-error.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/ked-bearer-provider.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/restclient.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/utils.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/cache-bust.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-collection/apply-mutations-on-deltas.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-collection/delta-cache.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-collection/delta-collection.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-merge.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-collection.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-query.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-repo.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-subscription.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-writer.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/mutation-queue.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/query-set.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/utils.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/migrate-course.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/migrate-task.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/migrate.js","webpack://[name]/./kedbackend/js/dist/js/observable/collection.js","webpack://[name]/./kedbackend/js/dist/js/observable/emitter.js","webpack://[name]/./kedbackend/js/dist/js/observable/fiber-context.js","webpack://[name]/./kedbackend/js/dist/js/observable/index.js","webpack://[name]/./kedbackend/js/dist/js/observable/map.js","webpack://[name]/./kedbackend/js/dist/js/observable/mixin.js","webpack://[name]/./kedbackend/js/dist/js/observable/observable.js","webpack://[name]/./kedbackend/js/dist/js/observable/value.js","webpack://[name]/./kedbackend/observable.js","webpack://[name]/./kedbackend/repo.js","webpack://[name]/./src/access-control/get-user-claims.ts","webpack://[name]/./src/access-control/index.ts","webpack://[name]/./src/apis/buttons.tsx","webpack://[name]/./src/apis/edsclient.ts","webpack://[name]/./src/apis/mock/mock-classroom-data.ts","webpack://[name]/./src/components/charts/goal-progress.tsx","webpack://[name]/./src/components/course-builder-ks/common/two-columns-page.tsx","webpack://[name]/./src/components/course-builder/sub-components/ellipsis-loader.tsx","webpack://[name]/./src/components/course-builder/sub-components/remove-item.tsx","webpack://[name]/./src/components/course-builder/sub-components/spinner.tsx","webpack://[name]/./src/components/course-viewer/course-page/task-assignments-utils.tsx","webpack://[name]/./src/components/course-viewer/course-page/urkund-utils.ts","webpack://[name]/./src/components/teacher-view/assignments-view/course-module.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/course-task-not-handed-users.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/course-task.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/course-tasks-assignments.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/index.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/task-assignment.tsx","webpack://[name]/./src/components/teacher-view/courses-view/index.tsx","webpack://[name]/./src/components/teacher-view/digest-view.tsx","webpack://[name]/./src/components/teacher-view/email-templates/index.tsx","webpack://[name]/./src/components/teacher-view/index.tsx","webpack://[name]/./src/components/teacher-view/shared/notification-icon.tsx","webpack://[name]/./src/components/utility-components/LanguageContext.tsx","webpack://[name]/./src/components/utility-components/SetupLanguageIntl.tsx","webpack://[name]/./src/components/utility-components/extra-page-buttons.tsx","webpack://[name]/./src/components/utility-components/lazy-content.tsx","webpack://[name]/./src/components/utility-components/live-query-view.tsx","webpack://[name]/./src/components/utility-components/observe.tsx","webpack://[name]/./src/components/utility-components/open-close-box.tsx","webpack://[name]/./src/components/utility-components/wysiwyg/actions.ts","webpack://[name]/./src/components/utility-components/wysiwyg/exec.ts","webpack://[name]/./src/components/utility-components/wysiwyg/html-patch-policy.ts","webpack://[name]/./src/components/utility-components/wysiwyg/image-edit-actions.ts","webpack://[name]/./src/components/utility-components/wysiwyg/index.tsx","webpack://[name]/./src/components/utility-components/wysiwyg/wash-html.ts","webpack://[name]/./src/elements/KEDAppTeacherView/app.teacherview.client.tsx","webpack://[name]/./src/elements/KEDAppTeacherView/webpack-entry.ts","webpack://[name]/./src/global-setters/configure.ts","webpack://[name]/./src/global-setters/set-all.ts","webpack://[name]/./src/global-setters/set-bearer-providers.ts","webpack://[name]/./src/global-setters/set-eds-client.ts","webpack://[name]/./src/global-setters/set-ked-backend-client.ts","webpack://[name]/./src/globals/KED.cfg.ts","webpack://[name]/./src/globals/KED.env.ts","webpack://[name]/./src/globals/KED.ts","webpack://[name]/./src/globals/current-user.ts","webpack://[name]/./src/globals/db.ts","webpack://[name]/./src/globals/ked.ts","webpack://[name]/./src/utils/error-success-feedback.tsx","webpack://[name]/./src/utils/make-suspense-api.ts","webpack://[name]/./src/utils/query-string.ts","webpack://[name]/./src/utils/school-moment.ts","webpack://[name]/./src/utils/school-term.ts","webpack://[name]/./src/utils/utils.ts"],"sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"kedappteacherview\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp_name_\"] = window[\"webpackJsonp_name_\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"./src/elements/KEDAppTeacherView/webpack-entry.ts\",\"vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from './js/dist/js/ked-backend-client';","export * from './js/dist/js/ked-backend-client-web';","var BearerStorageSessionStorage = /** @class */ (function () {\n    function BearerStorageSessionStorage() {\n    }\n    BearerStorageSessionStorage.prototype.save = function (id, tokenInfo) {\n        sessionStorage.setItem(\"bearer-\" + id, JSON.stringify(tokenInfo));\n    };\n    BearerStorageSessionStorage.prototype.load = function (id) {\n        try {\n            var json = sessionStorage.getItem(\"bearer-\" + id);\n            return Promise.resolve(json ? JSON.parse(json) : { token: null, expires: 0 });\n        }\n        catch (ex) {\n            return Promise.resolve({ token: null, expires: 0 });\n        }\n    };\n    return BearerStorageSessionStorage;\n}());\nexport { BearerStorageSessionStorage };\n//# sourceMappingURL=bearer-storage-sessionstorage.js.map","var redirHash = sessionStorage.getItem(\"redir-hash\");\nif (redirHash)\n    try {\n        var _a = JSON.parse(redirHash), time = _a.time, hash = _a.hash;\n        if (time && time > Date.now() - 60000) {\n            sessionStorage.removeItem(\"redir-hash\");\n            location.hash = hash;\n        }\n    }\n    catch (_) { }\nexport function rememberHashLocation() {\n    sessionStorage.setItem(\"redir-hash\", JSON.stringify({ time: Date.now(), hash: location.hash }));\n}\n//# sourceMappingURL=hash-restorer.js.map","import * as tslib_1 from \"tslib\";\nimport { KedBackendClient, HttpError } from '../ked-backend-client';\nimport { BearerStorageSessionStorage } from \"./bearer-storage-sessionstorage\";\nimport { avoidSimultanousCalls } from '../ked-backend-client/utils';\nimport { KedModelMigratorMixin } from '../ked-model-migrator';\nimport './hash-restorer';\nimport { rememberHashLocation } from './hash-restorer';\nKedModelMigratorMixin(KedBackendClient.prototype);\nexport var storage = new BearerStorageSessionStorage();\nvar timeOfPageLoad = Date.now();\nvar WebServerBearerProvider = /** @class */ (function () {\n    function WebServerBearerProvider(tokenPath, tokenResponseMapper, tokenId) {\n        this.tokenPath = tokenPath;\n        this.tokenResponseMapper = tokenResponseMapper;\n        this.tokenId = tokenId;\n        this.tokenInfo = { token: null, expires: 0 };\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\n    }\n    WebServerBearerProvider.prototype.getBearer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!!this.tokenInfo.token) return [3 /*break*/, 2];\n                        if (!this.tokenId) return [3 /*break*/, 2];\n                        _a = this;\n                        return [4 /*yield*/, storage.load(this.tokenId)];\n                    case 1:\n                        _a.tokenInfo = _b.sent();\n                        _b.label = 2;\n                    case 2:\n                        if (!(this.tokenInfo.expires < Date.now())) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.refreshBearer()];\n                    case 3:\n                        _b.sent();\n                        _b.label = 4;\n                    case 4: return [2 /*return*/, this.tokenInfo];\n                }\n            });\n        });\n    };\n    WebServerBearerProvider.prototype.refreshBearer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, _c, _d;\n            return tslib_1.__generator(this, function (_e) {\n                switch (_e.label) {\n                    case 0: return [4 /*yield*/, fetch(this.tokenPath, {\n                            headers: { Accept: \"text/plain; application/json\" },\n                            redirect: 'manual',\n                            cache: 'no-cache',\n                            credentials: \"same-origin\"\n                        })];\n                    case 1:\n                        res = _e.sent();\n                        if (res.status === 302 || (!res.status && res.type === \"opaqueredirect\")) {\n                            // User session timed out and server wants to redirect entire page to login page\n                            // Time to reload current page to force a redirect of the entire page instead for\n                            // just redirecting to /api/token or whatever.\n                            if (Date.now() - timeOfPageLoad > 60000) { // prohibit endless loop of reloading self.\n                                this.wantsRedirect = true; // So that listeners to onbeforeunload could show alternate message.\n                                console.log(\"Redirect wanted. Reload page.\");\n                                rememberHashLocation();\n                                window.location.reload(true);\n                                throw new HttpError(302, \"Redirected\");\n                            }\n                        }\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = Error.bind;\n                        _b = \"HTTP\" + res.status + \" \";\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(Error, [void 0, _b + (_e.sent())]))();\n                    case 3:\n                        _c = this;\n                        _d = this.tokenResponseMapper;\n                        return [4 /*yield*/, res.text()];\n                    case 4:\n                        _c.tokenInfo = _d.apply(this, [_e.sent()]);\n                        storage.save(this.tokenId, this.tokenInfo);\n                        return [2 /*return*/, this.tokenInfo];\n                }\n            });\n        });\n    };\n    return WebServerBearerProvider;\n}());\nexport { WebServerBearerProvider };\nexport var isomorphic = { fetch: fetch.bind(self), btoa: btoa.bind(self) };\nvar KedBackendClientWeb = /** @class */ (function (_super) {\n    tslib_1.__extends(KedBackendClientWeb, _super);\n    function KedBackendClientWeb(apiBaseUrl, providerOrTokenPath, options) {\n        var _this = this;\n        var bearerProvider = typeof providerOrTokenPath !== 'string' ?\n            providerOrTokenPath :\n            new WebServerBearerProvider(providerOrTokenPath, (options && options.tokenResponseMapper) || (function (x) { return ({ token: x, expires: Date.now() + 59 * 60 * 60 }); }), options && options.tokenId);\n        _this = _super.call(this, isomorphic, bearerProvider, apiBaseUrl) || this;\n        return _this;\n    }\n    return KedBackendClientWeb;\n}(KedBackendClient));\nexport { KedBackendClientWeb };\n//# sourceMappingURL=index.js.map","var DocumentAccess = /** @class */ (function () {\n    function DocumentAccess(accessClaimType, accessClaimValue, right) {\n        this.accessClaimType = accessClaimType;\n        this.accessClaimValue = accessClaimValue;\n        this.right = right;\n    }\n    DocumentAccess.fromString = function (ac) {\n        if (!ac)\n            return null;\n        var split = ac.split(':');\n        if (split.length < 3)\n            throw new Error(\"Invalid access string: \" + ac);\n        var claimType = DocumentAccess.unescape(split[0]);\n        var claimValue = DocumentAccess.unescape(split[1]);\n        var right = split[2];\n        if (right !== 'R' && right !== 'W' && right !== 'S')\n            throw new Error(\"Invalid access string: \" + ac);\n        return new DocumentAccess(claimType, claimValue, right);\n    };\n    DocumentAccess.escape = function (accessComponent) {\n        return accessComponent.replace(/\\%/g, \"%25\").replace(/\\:/g, \"%3A\");\n    };\n    DocumentAccess.unescape = function (accessComponent) {\n        return accessComponent.replace(/\\%3A/g, \":\").replace(/\\%25/g, \"%\");\n    };\n    DocumentAccess.prototype.toString = function () {\n        return DocumentAccess.escape(this.accessClaimType) + \":\" +\n            DocumentAccess.escape(this.accessClaimValue) + \":\" +\n            this.right;\n    };\n    DocumentAccess.fromStringArray = function (acl) {\n        return acl\n            .map(function (ac) { return DocumentAccess.fromString(ac); })\n            .filter(function (ac) { return ac; });\n    };\n    DocumentAccess.toStringArray = function (acl) {\n        return acl.map(function (ac) { return ac.toString(); });\n    };\n    return DocumentAccess;\n}());\nexport { DocumentAccess };\nexport function hasAccess(acl, userClaims, requestedRight) {\n    if (userClaims.some(function (claim) { return claim.type === 'role' && claim.value === \"ADMIN\"; }))\n        return true;\n    return acl.some(function (a) {\n        return userClaims.some(function (c) {\n            return a.accessClaimType === c.type &&\n                a.accessClaimValue === c.value && ((a.right === 'R' && requestedRight === 'R') ||\n                (a.right === 'W' && ['R', 'W'].indexOf(requestedRight) >= 0) ||\n                (a.right === 'S'));\n        });\n    });\n}\n//# sourceMappingURL=access-control.js.map","import * as tslib_1 from \"tslib\";\nvar HttpError = /** @class */ (function (_super) {\n    tslib_1.__extends(HttpError, _super);\n    function HttpError(code, message) {\n        var _this = _super.call(this, \"HTTP\" + code + \" \" + message) || this;\n        _this.code = code;\n        _this.message = message;\n        _this.name = \"http\" + code;\n        _this.message = \"HTTP\" + code + \" \" + message;\n        return _this;\n    }\n    return HttpError;\n}(Error));\nexport { HttpError };\n//# sourceMappingURL=http-error.js.map","import * as tslib_1 from \"tslib\";\nimport { RestClient } from './restclient';\nexport * from './utils';\nexport { KedBearerProvider } from './ked-bearer-provider';\nexport * from './access-control';\nexport { RestClient };\nimport { HttpError } from './http-error';\nexport { HttpError };\nexport * from './restclient';\n;\n// | 'otherFlag' | 'thirdFlag';...\nvar KedBackendClient = /** @class */ (function () {\n    function KedBackendClient(isomorphic, bearerProvider, baseUrl) {\n        this.http = new RestClient(isomorphic, baseUrl, { bearerProvider: bearerProvider });\n    }\n    KedBackendClient.prototype.getMyClaims = function (table, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"me/claims/\" + (table || \"\"), null, fetchOptions)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.get = function (table, id, options, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(table + \"/\" + id, options, fetchOptions)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.list = function (table, options, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var query, res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        query = tslib_1.__assign({}, options);\n                        if (typeof location !== 'undefined' && location.search.includes('useSP')) {\n                            if (!options.from &&\n                                !options.to &&\n                                (!options.include || !options.include.includes(\"acl\")) &&\n                                !options.role &&\n                                !options.name &&\n                                [options.hasEdgesFrom, options.hasEdgesTo, options.ids, options.tags].filter(function (x) { return !!x; }).length === 1) {\n                                query.flags = (query.flags || []).concat(['useSP']);\n                            }\n                        }\n                        if (options && options.mutationsOnEmpty)\n                            query.mutationsOnEmpty = JSON.stringify(options.mutationsOnEmpty);\n                        return [4 /*yield*/, this.http.get(\"\" + table, query, fetchOptions)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.batch = function (reqs, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        // Reorder operations so that 'add's come first and 'delete's come last:\n                        reqs = reqs.slice().sort(function (req1, req2) {\n                            return req1.op === 'add' ? -1 : req2.op === 'add' ? 1 :\n                                req1.op === 'delete' ? 1 : req2.op === 'delete' ? -1 : 0;\n                        });\n                        return [4 /*yield*/, this.http.post(\"batch\", reqs, fetchOptions)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.do = function (scopeFn) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var runner;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        runner = new BatchRunner();\n                        scopeFn(runner);\n                        return [4 /*yield*/, this.batch(runner.mutationRequests)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.deleteRealm = function (realm) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.delete(\"realms/\" + realm)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    KedBackendClient.prototype.add = function (table, doc, branchId) {\n        return this.do(function (r) { return r.add(table, doc); });\n    };\n    KedBackendClient.prototype.put = function (table, doc) {\n        return this.do(function (r) { return r.put(table, doc); });\n    };\n    KedBackendClient.prototype.update = function (table, id, deltaDoc, branchId) {\n        return this.do(function (r) { return r.update(table, id, deltaDoc, branchId); });\n    };\n    KedBackendClient.prototype.merge = function (branchId, targetBranchId) {\n        return this.do(function (r) { return r.merge(branchId, targetBranchId); });\n    };\n    KedBackendClient.prototype.clearBranch = function (branchId) {\n        return this.do(function (r) { return r.clearBranch(branchId); });\n    };\n    KedBackendClient.prototype.delete = function (table, id) {\n        return this.do(function (r) { return r.delete(table, id); });\n    };\n    KedBackendClient.prototype.share = function (table, id, acl) {\n        return this.do(function (r) { return r.share(table, id, acl); });\n    };\n    KedBackendClient.prototype.unshare = function (table, id, acl) {\n        return this.do(function (r) { return r.unshare(table, id, acl); });\n    };\n    KedBackendClient.prototype.link = function (sourceTable, sourceId, targetTable, targetId, label) {\n        return this.do(function (r) { return r.link(sourceTable, sourceId, targetTable, targetId, label); });\n    };\n    KedBackendClient.prototype.link2 = function (sourceTable, sourceId, targetId, label, branchId) {\n        return this.do(function (r) { return r.link2(sourceTable, sourceId, label, targetId, branchId); });\n    };\n    KedBackendClient.prototype.unlink = function (sourceTable, sourceId, targetTable, targetId, label) {\n        return this.do(function (r) { return r.unlink(sourceTable, sourceId, targetTable, targetId, label); });\n    };\n    KedBackendClient.prototype.unlink2 = function (sourceTable, sourceId, targetId, label, branchId) {\n        return this.do(function (r) { return r.unlink2(sourceTable, sourceId, label, targetId, branchId); });\n    };\n    KedBackendClient.prototype.undoLink = function (sourceTable, sourceId, targetId, label, branchId) {\n        return this.do(function (r) { return r.undoLink(sourceTable, sourceId, label, targetId, branchId); });\n    };\n    return KedBackendClient;\n}());\nexport { KedBackendClient };\nvar BatchRunner = /** @class */ (function () {\n    function BatchRunner() {\n        this.mutationRequests = [];\n    }\n    BatchRunner.prototype.add = function (table, doc, branchId) {\n        this.mutationRequests.push({ op: 'add', table: table, doc: doc, branchId: branchId });\n        return this;\n    };\n    BatchRunner.prototype.put = function (table, doc) {\n        doc = tslib_1.__assign({}, doc);\n        delete doc.acl; // Forbidden to send acl with put() calls.\n        this.mutationRequests.push({ op: 'put', table: table, doc: doc });\n        return this;\n    };\n    BatchRunner.prototype.update = function (table, id, deltaDoc, branchId) {\n        deltaDoc = tslib_1.__assign({}, deltaDoc);\n        this.mutationRequests.push({ op: 'update', table: table, id: id, deltaDoc: deltaDoc, branchId: branchId });\n    };\n    BatchRunner.prototype.merge = function (branchId, targetBranchId) {\n        this.mutationRequests.push({ op: 'merge', branchId: branchId, targetBranchId: targetBranchId });\n    };\n    BatchRunner.prototype.clearBranch = function (branchId) {\n        this.mutationRequests.push({ op: 'clear-branch', branchId: branchId });\n    };\n    BatchRunner.prototype.delete = function (table, id) {\n        this.mutationRequests.push({ op: 'delete', table: table, id: id });\n        return this;\n    };\n    BatchRunner.prototype.share = function (table, id, acl) {\n        this.mutationRequests.push({ op: 'share', table: table, id: id, acl: acl });\n        return this;\n    };\n    BatchRunner.prototype.unshare = function (table, id, acl) {\n        this.mutationRequests.push({ op: 'unshare', table: table, id: id, acl: acl });\n        return this;\n    };\n    BatchRunner.prototype.link = function (sourceTable, sourceId, targetTable, targetId, label) {\n        this.mutationRequests.push({ op: 'link', sourceTable: sourceTable, sourceId: sourceId, targetTable: targetTable, targetId: targetId, label: label });\n        return this;\n    };\n    BatchRunner.prototype.link2 = function (sourceTable, sourceId, label, targetId, branchId) {\n        this.mutationRequests.push({ op: 'link', sourceTable: sourceTable, sourceId: sourceId, targetId: targetId, label: label, branchId: branchId });\n    };\n    BatchRunner.prototype.unlink = function (sourceTable, sourceId, targetTable, targetId, label) {\n        this.mutationRequests.push({ op: 'unlink', sourceTable: sourceTable, sourceId: sourceId, targetTable: targetTable, targetId: targetId, label: label });\n        return this;\n    };\n    BatchRunner.prototype.unlink2 = function (sourceTable, sourceId, label, targetId, branchId) {\n        this.mutationRequests.push({ op: 'unlink', sourceTable: sourceTable, sourceId: sourceId, targetId: targetId, label: label, branchId: branchId });\n        return this;\n    };\n    BatchRunner.prototype.undoLink = function (sourceTable, sourceId, label, targetId, branchId) {\n        this.mutationRequests.push({ op: 'undo-link', sourceTable: sourceTable, sourceId: sourceId, targetId: targetId, label: label, branchId: branchId });\n    };\n    return BatchRunner;\n}());\nexport { BatchRunner };\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\nimport { RestClient } from './restclient';\nimport { avoidSimultanousCalls } from './utils';\nvar KedBearerProvider = /** @class */ (function () {\n    function KedBearerProvider(isomorphic, storage, tokenId, clientId, clientSecret, tokenUrl, tokenQuery) {\n        this.isomorphic = isomorphic;\n        this.storage = storage;\n        this.tokenId = tokenId;\n        this.clientId = clientId;\n        this.clientSecret = clientSecret;\n        this.tokenUrl = tokenUrl;\n        this.tokenQuery = tokenQuery;\n        this.tokenInfo = { token: null, expires: 0 };\n        this.client = new RestClient(isomorphic, \"\", {\n            username: this.clientId,\n            password: this.clientSecret\n        });\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\n    }\n    KedBearerProvider.prototype.getBearer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _a, token, expires, _b, e_1;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = this.tokenInfo, token = _a.token, expires = _a.expires;\n                        if (token && expires >= Date.now())\n                            return [2 /*return*/, this.tokenInfo];\n                        _c.label = 1;\n                    case 1:\n                        _c.trys.push([1, 4, , 6]);\n                        _b = this;\n                        return [4 /*yield*/, this.storage.load(this.clientId + \"/\" + this.tokenId)];\n                    case 2:\n                        _b.tokenInfo = _c.sent();\n                        if (this.tokenInfo.token && this.tokenInfo.expires >= Date.now())\n                            return [2 /*return*/, this.tokenInfo];\n                        return [4 /*yield*/, this.refreshBearer()];\n                    case 3:\n                        _c.sent();\n                        return [2 /*return*/, this.tokenInfo];\n                    case 4:\n                        e_1 = _c.sent();\n                        return [4 /*yield*/, this.refreshBearer()];\n                    case 5:\n                        _c.sent();\n                        return [2 /*return*/, this.tokenInfo];\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBearerProvider.prototype.refreshBearer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, retries, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        retries = 0;\n                        _c.label = 1;\n                    case 1:\n                        if (!(retries < 6)) return [3 /*break*/, 5];\n                        console.log(\"Retrieving token for \" + this.tokenId);\n                        return [4 /*yield*/, this.client.get(this.tokenUrl, this.tokenQuery, { cache: 'reload' })];\n                    case 2:\n                        res = _c.sent();\n                        if (res.status !== 200) {\n                            console.warn(\"Got \" + res.status + \" \" + res.statusText);\n                            return [3 /*break*/, 4];\n                        }\n                        _a = this;\n                        _b = {};\n                        return [4 /*yield*/, res.text()];\n                    case 3:\n                        _a.tokenInfo = (_b.token = _c.sent(), _b.expires = Date.now() + 59 * 60 * 1000, _b);\n                        console.log(\"Got token for \" + this.tokenId + \": \" + JSON.stringify(this.tokenInfo));\n                        this.storage.save(this.clientId + \"/\" + this.tokenId, this.tokenInfo);\n                        return [2 /*return*/, this.tokenInfo];\n                    case 4:\n                        ++retries;\n                        return [3 /*break*/, 1];\n                    case 5: throw new Error(\"Failed to retrieve token for \" + JSON.stringify(this.tokenId));\n                }\n            });\n        });\n    };\n    return KedBearerProvider;\n}());\nexport { KedBearerProvider };\n//# sourceMappingURL=ked-bearer-provider.js.map","/*\ndeclare var Buffer; // node built-in\n\n\nfunction basicAuthHeader(username, password) {\n    return \"Basic \" + new Buffer(username + \":\" + password).toString(\"base64\");\n}\n*/\nimport * as tslib_1 from \"tslib\";\nimport { createUUID } from \"./utils\";\nimport { Emitter } from '../observable/emitter';\nvar RestClient = /** @class */ (function () {\n    function RestClient(isomorphic, baseUrl, options) {\n        this.isomorphic = isomorphic;\n        this.baseUrl = baseUrl;\n        this.options = options;\n        this.numOutstandingOperations = 0;\n        this.cache = {}; //, timeout: number}};\n        this._status = new Emitter(this);\n        this.fetchOptions = { mode: 'cors' };\n        this.authHeader = options.bearer ?\n            \"Bearer \" + options.bearer :\n            options.username ?\n                \"Basic \" + isomorphic.btoa(options.username + \":\" + (options.password || \"\")) :\n                null;\n        this.bearerProvider = options.bearerProvider || null;\n    }\n    Object.defineProperty(RestClient.prototype, \"status\", {\n        get: function () {\n            return this._status;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    RestClient.prototype.suspenseFetch = function (path, method, headers, query, fetchOptions) {\n        var _this = this;\n        var key = method + \" \" + path + \" \" + JSON.stringify(headers) + \" \" + JSON.stringify(query) + \" \" + JSON.stringify(fetchOptions);\n        var entry = this.cache[key];\n        if (entry) {\n            // Entry found. Is it still being fetched?\n            if ('promise' in entry)\n                throw entry.promise; // Still being fetched. Multiple parallell fetches should work on same promise!\n            // Promise has resolved. Return result.\n            return entry.result;\n        }\n        else {\n            // We are the first to do this request. Start doing it:\n            var promise = this.fetch(path, method, headers, query, fetchOptions).then(function (res) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var status, text;\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            status = res.status;\n                            return [4 /*yield*/, res.text()];\n                        case 1:\n                            text = _a.sent();\n                            this.cache[key] = {\n                                result: {\n                                    status: status,\n                                    text: function () { return text; },\n                                    json: function () { return JSON.parse(text); }\n                                }\n                            };\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n            // Immediately put the promise in the cache. Multiple parallell fetches should work on the same promise!\n            this.cache[key] = { promise: promise };\n            // Suspend until promise is resolved. At that time, the cache will contain an answer!\n            throw promise;\n        }\n    };\n    RestClient.prototype.fetch = function (path, method, headers, query, fetchOptions) {\n        var _this = this;\n        ++this.numOutstandingOperations;\n        this._status.dispatch(this);\n        return this._fetch(path, method, headers, query, fetchOptions)\n            .then(function (res) {\n            --_this.numOutstandingOperations;\n            _this._status.dispatch(_this);\n            return res;\n        }).catch(function (err) {\n            --_this.numOutstandingOperations;\n            _this._status.dispatch(_this);\n            return Promise.reject(err);\n        });\n    };\n    RestClient.prototype._fetch = function (path, method, headers, query, fetchOptions) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var queryStr, _a, authHeader, tokenInfo, bearerProvider, _b, _c, url, res, wwwauth, _d;\n            return tslib_1.__generator(this, function (_e) {\n                switch (_e.label) {\n                    case 0:\n                        if (fetchOptions && fetchOptions.cache === 'no-cache') {\n                            // Workaround for back-button not respecting cache control in Chrome/Opera.\n                            // Append a query parameter to force a cache entry\n                            query = tslib_1.__assign({}, query, { nocache: createUUID() });\n                        }\n                        queryStr = query && Object.keys(query).filter(function (key) { return query[key] !== undefined; }).map(function (key) {\n                            return encodeURIComponent(key) +\n                                \"=\" +\n                                encodeURIComponent(query[key]);\n                        })\n                            .join('&');\n                        _a = this, authHeader = _a.authHeader, tokenInfo = _a.tokenInfo, bearerProvider = _a.bearerProvider;\n                        if (!(!authHeader && !tokenInfo && bearerProvider)) return [3 /*break*/, 2];\n                        _b = this;\n                        return [4 /*yield*/, bearerProvider.getBearer()];\n                    case 1:\n                        _b.tokenInfo = tokenInfo = _e.sent();\n                        _e.label = 2;\n                    case 2:\n                        if (!tokenInfo) return [3 /*break*/, 5];\n                        if (!(tokenInfo.expires < Date.now())) return [3 /*break*/, 4];\n                        console.log(\"Token expired. Refresh it:\");\n                        _c = this;\n                        return [4 /*yield*/, bearerProvider.refreshBearer()];\n                    case 3:\n                        _c.tokenInfo = tokenInfo = _e.sent();\n                        _e.label = 4;\n                    case 4:\n                        authHeader = \"Bearer \" + tokenInfo.token;\n                        _e.label = 5;\n                    case 5:\n                        // In one way or another, we've concluded an Authorization header to use:\n                        if (authHeader) {\n                            headers.Authorization = authHeader;\n                        }\n                        url = this.baseUrl + path + (queryStr ? \"?\" + queryStr : \"\");\n                        return [4 /*yield*/, this.isomorphic.fetch(url, tslib_1.__assign({}, this.fetchOptions, { headers: headers, method: method }, fetchOptions))];\n                    case 6:\n                        res = _e.sent();\n                        if (!(res.status == 401 && this.bearerProvider)) return [3 /*break*/, 9];\n                        wwwauth = res.headers.get(\"www-authenticate\");\n                        console.log(\"Got \" + res.status + \" from \" + (this.baseUrl + path));\n                        if (!(wwwauth && /Bearer/i.test(wwwauth))) return [3 /*break*/, 9];\n                        _d = this;\n                        return [4 /*yield*/, this.bearerProvider.refreshBearer()];\n                    case 7:\n                        _d.tokenInfo = _e.sent();\n                        headers.Authorization = \"Bearer \" + this.tokenInfo.token;\n                        return [4 /*yield*/, this.isomorphic.fetch(url, tslib_1.__assign({}, this.fetchOptions, { headers: headers, method: method }, fetchOptions))];\n                    case 8:\n                        res = _e.sent();\n                        _e.label = 9;\n                    case 9: return [2 /*return*/, res];\n                }\n            });\n        });\n    };\n    RestClient.prototype.get = function (path, query, fetchOptions) {\n        return this.fetch(path, \"GET\", { Accept: \"application/json; text/plain\" }, query, fetchOptions);\n    };\n    RestClient.prototype.suspenseGet = function (path, query, fetchOptions) {\n        return this.suspenseFetch(path, \"GET\", { Accept: \"application/json; text/plain\" }, query, fetchOptions);\n    };\n    RestClient.prototype.post = function (path, data, fetchOptions) {\n        return this.fetch(path, \"POST\", {\n            \"Content-Type\": \"application/json\",\n            \"Accept\": \"application/json\"\n        }, null, tslib_1.__assign({}, fetchOptions, { body: JSON.stringify(data) }));\n    };\n    RestClient.prototype.delete = function (path, query, body, fetchOptions) {\n        return this.fetch(path, \"DELETE\", { Accept: \"application/json; text/plain\" }, query, tslib_1.__assign({}, fetchOptions, { body: body }));\n    };\n    return RestClient;\n}());\nexport { RestClient };\n//# sourceMappingURL=restclient.js.map","import * as tslib_1 from \"tslib\";\nexport function createUUID() {\n    // Decent solution from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n    var d = Date.now();\n    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        var r = (d + Math.random() * 16) % 16 | 0;\n        d = Math.floor(d / 16);\n        return (c === 'x' ? r : (r & 0x7 | 0x8)).toString(16);\n    });\n    return uuid;\n}\nexport function avoidSimultanousCalls(method) {\n    var ongoingPromise = null;\n    return function () {\n        if (!ongoingPromise) {\n            ongoingPromise = method.apply(this, arguments).then(function (result) {\n                ongoingPromise = null;\n                return result;\n            });\n        }\n        return ongoingPromise;\n    };\n}\nexport function getGlobalId(realm) {\n    var prefix = 'ec96b3be-45fc-41d3-b69e-';\n    var pad = ['50', '08', 'e1', '40', 'e4', 'e7'];\n    if (realm.length > 6)\n        throw new Error(\"Too long realm\");\n    for (var i = 0; i < realm.length; ++i) {\n        var hex = realm.charCodeAt(i).toString(16);\n        pad[i] = hex.length === 2 ?\n            hex :\n            '0' + hex;\n    }\n    return prefix + pad.join('');\n}\nexport function computePredestinatedId(input) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n        var encoder, data, digest, _a, i;\n        return tslib_1.__generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    encoder = new TextEncoder();\n                    data = encoder.encode(input);\n                    _a = Uint8Array.bind;\n                    return [4 /*yield*/, crypto.subtle.digest('SHA-256', data)];\n                case 1:\n                    digest = new (_a.apply(Uint8Array, [void 0, _b.sent()]))();\n                    i = 0;\n                    return [2 /*return*/, 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n                            var nibble = digest[i++] % 16 | 0;\n                            var washedNibble = c === 'x' ?\n                                nibble :\n                                nibble & 0x7 | 0x8;\n                            return washedNibble.toString(16);\n                        })];\n            }\n        });\n    });\n}\nexport function simpleDigest(input) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n        var encoder, inputBytes, digestBytes, _a;\n        return tslib_1.__generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    encoder = new TextEncoder();\n                    inputBytes = encoder.encode(input);\n                    _a = Uint8Array.bind;\n                    return [4 /*yield*/, crypto.subtle.digest('SHA-256', inputBytes)];\n                case 1:\n                    digestBytes = new (_a.apply(Uint8Array, [void 0, _b.sent(), 0, 16]))();\n                    return [2 /*return*/, buf2hex(digestBytes)];\n            }\n        });\n    });\n}\nvar simpleDigestCache = {};\nexport function simpleDigestSuspense(inputs) {\n    var results = inputs.map(function (input) { return simpleDigestCache[input]; });\n    var unresolvedInputs = [];\n    results.forEach(function (result, index) {\n        if (!result)\n            unresolvedInputs.push(inputs[index]);\n    });\n    if (unresolvedInputs.length === 0)\n        return results;\n    throw Promise.all(unresolvedInputs.map(function (input) { return simpleDigest(input).then(function (result) { return simpleDigestCache[input] = result; }); }));\n}\nexport function buf2hex(buffer) {\n    return Array.prototype.map.call(buffer, function (x) { return ('00' + x.toString(16)).slice(-2); }).join('');\n}\nexport function updateArray(a, mapper) {\n    var retval = a;\n    for (var i = 0, l = a.length; i < l; ++i) {\n        var t = a[i];\n        var mapped = mapper(t);\n        if (mapped !== t) {\n            if (retval === a)\n                retval = a.slice();\n            retval[i] = mapped;\n        }\n    }\n    return retval;\n}\n/*\nexport function updateArray<T>(a: T[], mapper: (t: T) => T | false): T[] {\n  let retval = a;\n  let j = 0;\n  for (let i=0,l=a.length; i<l; ++i, ++j) {\n    const t = a[i];\n    const mapped = mapper(t);\n    if (mapped === false) {\n      // Mapper wants to delete this doc.\n      if (retval === a) retval = a.slice();\n      retval.splice(j, 1);\n      --j; // compensate for ++j\n    } else if (mapped !== t) {\n      if (retval === a) retval = a.slice();\n      retval[j] = mapped;\n    }\n  }\n  return retval;\n}\n*/ \n//# sourceMappingURL=utils.js.map","import * as JsonSchema from \"kedbackend-schema/schema.json\";\nimport { getTableFromLabel } from \"./utils\";\nvar CacheBust = /** @class */ (function () {\n    function CacheBust() {\n    }\n    CacheBust.getCacheBust = function (table, query, user, includes) {\n        var involvedItems = CacheBust.getInvolvedItems(table, query, includes);\n        return involvedItems\n            .map(function (item) { return localStorage.getItem(\"cache-bust-\" + user + \"-\" + item); })\n            .filter(function (value) { return !!value; })\n            .join('/') || 'static';\n    };\n    CacheBust.invalidateCache = function (reqs, user) {\n        for (var _i = 0, _a = CacheBust.getCacheInvalidations(reqs); _i < _a.length; _i++) {\n            var item = _a[_i];\n            localStorage.setItem(\"cache-bust-\" + user + \"-\" + item, '' + Date.now());\n        }\n    };\n    CacheBust.getInvolvedItems = function (table, query, includes) {\n        var hasEdgesFrom = query.hasEdgesFrom;\n        var relatedTables = includes\n            .map(function (label) { return JsonSchema.tables[table].relationships[label]; })\n            .filter(function (table) { return !!table; });\n        if (hasEdgesFrom)\n            relatedTables.push(\"hef\" + table);\n        return [table, 'master', query.branchId].filter(function (x) { return !!x; }).concat(relatedTables).sort();\n    };\n    CacheBust.getCacheInvalidations = function (reqs) {\n        var invalidationSet = {};\n        reqs.forEach(function (req) {\n            switch (req.op) {\n                case 'add':\n                case 'put':\n                case 'delete':\n                case 'update':\n                    invalidationSet[req.table] = true;\n                    break;\n                case 'link':\n                case 'unlink':\n                case 'undo-link':\n                    invalidationSet[req.sourceTable] = true;\n                    invalidationSet[\"hef-\" + getTableFromLabel(req.sourceTable, req.label)] = true;\n                    break;\n                case 'clear-branch':\n                    invalidationSet[req.branchId] = true;\n                    break;\n                case 'merge':\n                    invalidationSet[req.branchId] = true;\n                    invalidationSet[req.targetBranchId || \"master\"] = true;\n                    break;\n            }\n        });\n        return Object.keys(invalidationSet);\n    };\n    return CacheBust;\n}());\nexport { CacheBust };\n//# sourceMappingURL=cache-bust.js.map","import * as tslib_1 from \"tslib\";\nimport { mergeDeltas } from '../delta-merge';\nexport function applyMutationsOnDeltas(branchId, deltas, mutations, optimistic, userDisplayName, hasAdditionalFilter) {\n    var _loop_1 = function (m) {\n        switch (m.op) {\n            case 'add-related':\n                //\n                // AddRelated RepoMutation\n                //\n                if (!hasAdditionalFilter && m.branchId === branchId) {\n                    deltas = [{\n                            type: 'add',\n                            sourceId: m.id,\n                            targetId: m.relatedDoc.id,\n                            label: m.graphProp,\n                            sourceTable: m.table,\n                            $meta: optimistic ? 'adding' : 'persisted',\n                            dateTime: Date.now(),\n                            targetName: m.relatedDoc.name,\n                            contributor: userDisplayName\n                        }].concat(deltas);\n                }\n                break;\n            case 'clear-branch':\n                //\n                // ClearBranch RepoMutation\n                //\n                if (m.branchId === branchId) {\n                    deltas = [];\n                }\n                break;\n            case 'delete':\n                //\n                // Delete RepoMutation\n                //\n                // This type of mutation can not be performed onto branches. There's no branchId property on m.\n                break;\n            case 'merge':\n                //\n                // Merge RepoMutation\n                //\n                if (m.branchId === branchId) {\n                    deltas = [];\n                }\n                else if (m.targetBranchId === branchId) {\n                    // This change will append new deltas to our deltas array but we don't know what would come.\n                    // Need to refetch from server.\n                    if (!optimistic)\n                        return { value: null }; // Caller should check for null and re-fetch data from server.\n                }\n                break;\n            case 'remove-related':\n                //\n                // Remove-Related RepoMutation\n                //\n                if (hasAdditionalFilter || m.branchId !== branchId)\n                    return \"continue\";\n                deltas = [{\n                        type: 'remove',\n                        sourceId: m.id,\n                        targetId: m.relatedDoc.id,\n                        targetName: m.relatedDoc.name,\n                        label: m.graphProp,\n                        sourceTable: m.table,\n                        contributor: userDisplayName,\n                        dateTime: Date.now(),\n                        $meta: optimistic ? 'adding' : 'persisted'\n                    }].concat(deltas);\n                break;\n            case 'undo-link':\n                //\n                // Undo-Link RepoMutation\n                //\n                if (m.branchId !== branchId)\n                    return \"continue\";\n                {\n                    var idx = deltas.findIndex(function (d) {\n                        return (d.type === 'add' || d.type === 'remove' || d.type === 'undo-link') &&\n                            d.sourceId === m.id &&\n                            d.targetId === m.relatedId;\n                    });\n                    if (idx < 0)\n                        return \"continue\";\n                    // Found an \"add\" or \"remove\" delta to change:\n                    if (optimistic) {\n                        var deltaRelation = deltas[idx];\n                        // Mark the existing add/remove delta as currenlty being deleted\n                        deltas = deltas.slice(0, idx).concat([\n                            tslib_1.__assign({}, deltaRelation, { $meta: optimistic ? 'removing' : 'persisted' })\n                        ], deltas.slice(idx + 1));\n                    }\n                    else {\n                        // Persisted. Just remove it:\n                        deltas = deltas.slice(0, idx).concat(deltas.slice(idx + 1));\n                    }\n                }\n                break;\n            case 'update':\n                //\n                // Update RepoMutation\n                //\n                if (m.branchId !== branchId)\n                    return \"continue\";\n                {\n                    var idx = deltas.findIndex(function (delta) {\n                        return delta.type === 'modify' &&\n                            delta.targetId === m.id;\n                    });\n                    if (idx < 0 && !hasAdditionalFilter) {\n                        deltas = [{\n                                type: 'modify',\n                                table: m.table,\n                                targetId: m.id,\n                                targetName: m.targetName,\n                                data: m.deltaDoc,\n                                dateTime: Date.now(),\n                                contributors: [userDisplayName],\n                                $meta: optimistic ? 'adding' : 'persisted',\n                            }].concat(deltas);\n                    }\n                    else {\n                        var existingDeltaDoc = deltas[idx];\n                        var contributors = existingDeltaDoc.contributors.slice();\n                        if (!contributors.includes(userDisplayName)) {\n                            contributors.push(userDisplayName);\n                        }\n                        var newData = mergeDeltas(existingDeltaDoc.data, m.deltaDoc, { removeUnsetProps: true });\n                        if (!optimistic && Object.keys(newData).length === 0) {\n                            // Committed mutation that resets a deltaDoc. Remove the deltaDoc entirely:\n                            deltas = deltas.slice(0, idx).concat(deltas.slice(idx + 1));\n                        }\n                        else {\n                            // \n                            deltas = [\n                                {\n                                    type: 'modify',\n                                    table: m.table,\n                                    targetId: m.id,\n                                    targetName: m.targetName,\n                                    data: newData,\n                                    dateTime: Date.now(),\n                                    contributors: contributors,\n                                    $meta: optimistic ? 'updating' : 'persisted',\n                                }\n                            ].concat(deltas.slice(0, idx), deltas.slice(idx + 1));\n                        }\n                    }\n                }\n                break;\n        }\n    };\n    for (var _i = 0, mutations_1 = mutations; _i < mutations_1.length; _i++) {\n        var m = mutations_1[_i];\n        var state_1 = _loop_1(m);\n        if (typeof state_1 === \"object\")\n            return state_1.value;\n    }\n    return deltas;\n}\n//# sourceMappingURL=apply-mutations-on-deltas.js.map","import * as tslib_1 from \"tslib\";\nimport { HttpError } from '../../ked-backend-client';\nimport { applyMutationsOnDeltas } from './apply-mutations-on-deltas';\nvar DeltaCache = /** @class */ (function () {\n    function DeltaCache(getClient, getUser, getUserDisplayName) {\n        this.getClient = getClient;\n        this.getUser = getUser;\n        this.getUserDisplayName = getUserDisplayName;\n        this.lookup = {};\n    }\n    DeltaCache.prototype.applyMutations = function (mutations, _a) {\n        var optimistic = (_a === void 0 ? { optimistic: false } : _a).optimistic;\n        // Apply mutations locally onto the DeltaCache and notify their subscribers\n        for (var _i = 0, _b = Object.keys(this.lookup); _i < _b.length; _i++) {\n            var queryKey = _b[_i];\n            var cacheEntry = this.lookup[queryKey];\n            if (cacheEntry.value) {\n                // Instead here: Store the mutations on cacheEntry. No matter if it yet has value or not.\n                // Then apply mutation whenever subscribing! (Better handling of mutations that arrives before fetch() is done)\n                // (See how I handle this in query-set.ts)\n                var newValue = applyMutationsOnDeltas(cacheEntry.query.branchId, cacheEntry.value, mutations, optimistic, this.getUserDisplayName(), !!cacheEntry.query.tags);\n                if (newValue === null) {\n                    // The mutation requires cacheEntry to be refetched from server\n                    if (!optimistic) {\n                        // Caller has successfully performed the mutations and got success back from server.\n                        // It's ok to refetch the deltas from server now:\n                        cacheEntry.fetch();\n                        // After fetch completes, it will notify the subscribers.\n                    }\n                }\n                if (newValue !== cacheEntry.value) {\n                    cacheEntry.optimisticValue = newValue;\n                    if (!optimistic)\n                        cacheEntry.value = newValue;\n                    cacheEntry.notify(newValue);\n                }\n            }\n        }\n    };\n    DeltaCache.prototype.subscribe = function (query, observer) {\n        var _this = this;\n        var cacheEntry = this.lookup[query.branchId + query.tags];\n        if (!cacheEntry) {\n            cacheEntry = new DeltaCacheEntry(this.getClient(), query);\n            this.lookup[query.branchId + query.tags] = cacheEntry;\n        }\n        if (cacheEntry.cleanupTimer) {\n            clearTimeout(cacheEntry.cleanupTimer);\n            cacheEntry.cleanupTimer = null;\n        }\n        var subscription = {\n            unsubscribe: function () {\n                cacheEntry.subscribers = cacheEntry.subscribers.filter(function (_a) {\n                    var o = _a.observer;\n                    return o !== observer;\n                });\n                if (cacheEntry.subscribers.length === 0) {\n                    cacheEntry.cleanupTimer = setTimeout(function () {\n                        if (cacheEntry.subscribers.length === 0) {\n                            delete _this.lookup[query.branchId + query.tags];\n                        }\n                    }, 100);\n                }\n            }\n        };\n        cacheEntry.subscribers.push({ observer: observer, subscription: subscription });\n        if (cacheEntry.value) {\n            // Value has been successfully retrieved already. Pick from cache.\n            observer(cacheEntry.optimisticValue || cacheEntry.value, null, subscription);\n        }\n        else if (cacheEntry.isFetching) {\n            // A value is on its way. Sit back and relax. All registered\n            // observers (including this one) will be notified when data arrives\n            // or fails.\n        }\n        else if (cacheEntry.error) {\n            observer(null, cacheEntry.error, subscription);\n        }\n        else {\n            cacheEntry.fetch();\n        }\n        return subscription;\n    };\n    return DeltaCache;\n}());\nexport { DeltaCache };\nvar DeltaCacheEntry = /** @class */ (function () {\n    function DeltaCacheEntry(client, query) {\n        this.fetchOperationId = 0; // Makes sure a re-fetch will discard the result from any ongoing fetch.\n        this.client = client;\n        this.query = query;\n        this.value = null;\n        this.error = null;\n        this.optimisticValue = null;\n        this.subscribers = [];\n        this.isFetching = false;\n        this.cleanupTimer = null;\n    }\n    DeltaCacheEntry.prototype.fetch = function () {\n        var _this = this;\n        var fetchOperationId = ++this.fetchOperationId;\n        this.isFetching = true;\n        this.fetchFromServer().then(function (value) {\n            // Success\n            if (fetchOperationId === _this.fetchOperationId) {\n                _this.isFetching = false;\n                value.sort(function (a, b) { return b.dateTime - a.dateTime; }); // Latest first\n                _this.value = value;\n                _this.optimisticValue = value;\n                _this.notify(value);\n            }\n        }).catch(function (error) {\n            // Fail\n            if (fetchOperationId === _this.fetchOperationId) {\n                _this.isFetching = false;\n                _this.error = error;\n                _this.fail(error);\n            }\n        });\n    };\n    DeltaCacheEntry.prototype.fetchFromServer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (!this.query.branchId)\n                            throw new Error('Deltas only available on branches');\n                        return [4 /*yield*/, this.client.http.get('deltas', this.query)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status >= 300 || res.status < 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4: return [2 /*return*/, _c.sent()];\n                }\n            });\n        });\n    };\n    DeltaCacheEntry.prototype.notify = function (value) {\n        for (var _i = 0, _a = this.subscribers; _i < _a.length; _i++) {\n            var _b = _a[_i], observer = _b.observer, subscription = _b.subscription;\n            observer(value, null, subscription);\n        }\n    };\n    DeltaCacheEntry.prototype.fail = function (error) {\n        var copy = this.subscribers.slice();\n        this.subscribers = [];\n        for (var _i = 0, copy_1 = copy; _i < copy_1.length; _i++) {\n            var _a = copy_1[_i], observer = _a.observer, subscription = _a.subscription;\n            observer(null, error, subscription);\n        }\n    };\n    return DeltaCacheEntry;\n}());\n//# sourceMappingURL=delta-cache.js.map","import * as tslib_1 from \"tslib\";\nimport { Collection } from '../../observable';\nvar DeltaCollection = /** @class */ (function (_super) {\n    tslib_1.__extends(DeltaCollection, _super);\n    function DeltaCollection(deltaCache, query) {\n        var _this = _super.call(this, function (observer) { return _this.deltaCache.subscribe(query, observer); }) || this;\n        _this.deltaCache = deltaCache;\n        _this.query = query;\n        return _this;\n    }\n    DeltaCollection.prototype.tags = function () {\n        var tags = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tags[_i] = arguments[_i];\n        }\n        return new DeltaCollection(this.deltaCache, tslib_1.__assign({}, this.query, { tags: tags }));\n    };\n    return DeltaCollection;\n}(Collection));\nexport { DeltaCollection };\n//# sourceMappingURL=delta-collection.js.map","import * as tslib_1 from \"tslib\";\nexport function applyDelta(doc, delta) {\n    var keys = Object.keys(delta);\n    var targetDoc = doc;\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n        var key = keys_1[_i];\n        if (targetDoc === doc)\n            targetDoc = tslib_1.__assign({}, doc);\n        var val = delta[key];\n        if (val && typeof val === 'object') {\n            var metaInstructions = Object.keys(val)\n                .filter(function (key) { return key.startsWith('$'); });\n            if (metaInstructions.length > 0) {\n                var _loop_1 = function (mi) {\n                    var miValue = val[mi];\n                    switch (mi) {\n                        case \"$unset\": {\n                            // Do nothing on target doc!\n                            targetDoc.$wasUnset = true; // Just mark it for re-retrieval after successful posting changes.\n                            break;\n                        }\n                        case \"$add\": {\n                            var valuesToAdd = miValue;\n                            if (!Array.isArray(valuesToAdd)) {\n                                throw new Error(\"$add instruction must contain array\");\n                            }\n                            var targetArray = targetDoc[key];\n                            if (!Array.isArray(targetArray)) {\n                                targetArray = [];\n                            }\n                            else {\n                                targetArray = targetArray.slice(); // On JS side, we must be immutable\n                            }\n                            targetDoc[key] = targetArray;\n                            for (var _i = 0, valuesToAdd_1 = valuesToAdd; _i < valuesToAdd_1.length; _i++) {\n                                var v = valuesToAdd_1[_i];\n                                if (!targetArray.includes(v)) { // avoid dups\n                                    targetArray.push(v);\n                                }\n                            }\n                            break;\n                        }\n                        case \"$remove\": {\n                            var valuesToRemove_1 = miValue;\n                            if (!Array.isArray(valuesToRemove_1)) {\n                                throw new Error(\"$remove instruction must contain array\");\n                            }\n                            var targetArray = targetDoc[key];\n                            if (!Array.isArray(targetArray)) {\n                                targetArray = [];\n                            }\n                            targetDoc[key] = targetArray.filter(function (t) { return !valuesToRemove_1.includes(t); });\n                            break;\n                        }\n                    }\n                };\n                for (var _a = 0, metaInstructions_1 = metaInstructions; _a < metaInstructions_1.length; _a++) {\n                    var mi = metaInstructions_1[_a];\n                    _loop_1(mi);\n                }\n                continue;\n            }\n        }\n        targetDoc[key] = val;\n    }\n    return targetDoc;\n}\n// {name: \"Ulla\"}, {name: {$unset:0}\n// {tags: {$add: \"hej\"}}, {tags: {$unset:0}\"}\nexport function mergeDeltas(delta1, delta2, _a) {\n    var removeUnsetProps = (_a === void 0 ? { removeUnsetProps: false } : _a).removeUnsetProps;\n    //return {...delta1, ...delta2};\n    var keys = Object.keys(delta2);\n    var targetDelta = tslib_1.__assign({}, delta1);\n    for (var _i = 0, keys_2 = keys; _i < keys_2.length; _i++) {\n        var key = keys_2[_i];\n        var val = delta2[key];\n        if (val && typeof val === 'object') {\n            var metaInstructions = Object.keys(val)\n                .filter(function (key) { return key.startsWith('$'); });\n            if (metaInstructions.length > 0) {\n                var _loop_2 = function (mi) {\n                    var miValue = val[mi];\n                    switch (mi) {\n                        case \"$unset\": {\n                            if (removeUnsetProps) {\n                                delete targetDelta[key];\n                            }\n                            else {\n                                // No matter if targetDelta is empty or has value. Set it to {$unset:0}\n                                // to make sure the very end result will have {$unset:0}\n                                targetDelta[key] = { $unset: 0 };\n                            }\n                            break;\n                        }\n                        case \"$add\": {\n                            var valuesToAdd_2 = miValue;\n                            if (!Array.isArray(valuesToAdd_2)) {\n                                throw new Error(\"$add instruction must contain array\");\n                            }\n                            var targetMetaProp = targetDelta[key];\n                            targetMetaProp = targetMetaProp ? tslib_1.__assign({}, targetMetaProp) : {};\n                            targetDelta[key] = targetMetaProp;\n                            // First, just check if target metaProp has {$remove: [...items]}\n                            // If so, remove any equal items from there before merging the {$add: [...]} arrays.\n                            var targetRemoveArray = targetMetaProp.$remove;\n                            if (Array.isArray(targetRemoveArray)) {\n                                targetMetaProp.$remove =\n                                    targetRemoveArray.filter(function (t) { return !valuesToAdd_2.includes(t); });\n                                if (targetMetaProp.$remove.length === 0) {\n                                    // If $remove array became emtpy. Remove the $remove prop.\n                                    delete targetMetaProp.$remove;\n                                }\n                            }\n                            // Now it's time to merge or create target $add array.\n                            var targetAddArray = targetMetaProp.$add;\n                            targetAddArray = targetAddArray ? targetAddArray.concat(valuesToAdd_2) : valuesToAdd_2.slice();\n                            targetMetaProp.$add = targetAddArray;\n                            break;\n                        }\n                        case \"$remove\": {\n                            var valuesToRemove_2 = miValue;\n                            if (!Array.isArray(valuesToRemove_2)) {\n                                throw new Error(\"$remove instruction must contain array\");\n                            }\n                            var targetMetaProp = targetDelta[key];\n                            targetMetaProp = targetMetaProp ? tslib_1.__assign({}, targetMetaProp) : {};\n                            targetDelta[key] = targetMetaProp;\n                            // First, just check if target metaProp has {$add: [...items]}\n                            // If so, remove any equal items from there before merging the {$remove: [...]} arrays.\n                            var targetAddArray = targetMetaProp.$remove;\n                            if (Array.isArray(targetAddArray)) {\n                                targetMetaProp.$add =\n                                    targetAddArray.filter(function (t) { return !valuesToRemove_2.includes(t); });\n                                if (targetMetaProp.$add.length === 0) {\n                                    // If $add array became emtpy. Remove the $add prop.\n                                    delete targetMetaProp.$add;\n                                }\n                            }\n                            // Now it's time to merge or create target $remove array.\n                            var targetRemoveArray = targetMetaProp.$remove;\n                            targetRemoveArray = targetRemoveArray ? targetRemoveArray.concat(valuesToRemove_2) : valuesToRemove_2.slice();\n                            targetMetaProp.$remove = targetRemoveArray;\n                            break;\n                        }\n                    }\n                };\n                for (var _b = 0, metaInstructions_2 = metaInstructions; _b < metaInstructions_2.length; _b++) {\n                    var mi = metaInstructions_2[_b];\n                    _loop_2(mi);\n                }\n                continue;\n            }\n        }\n        targetDelta[key] = val;\n    }\n    return targetDelta;\n}\n//# sourceMappingURL=delta-merge.js.map","export * from './kedbackend-collection';\nexport * from './kedbackend-query';\nexport * from './kedbackend-repo';\nexport * from './kedbackend-subscription';\nexport * from './kedbackend-writer';\nexport * from './mutation-queue';\nexport * from './query-set';\nexport * from '../observable/mixin';\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\nimport { BatchRunner } from '../ked-backend-client';\nimport { KedBackendSubscription } from \"./kedbackend-subscription\";\nimport { CacheBust } from './cache-bust';\nimport { KedBackendQuery } from './kedbackend-query';\nimport { Collection } from '../observable/collection';\n/**\n * Represents a \"live\" query against a table or filtered table.\n */\nvar KedBackendCollection = /** @class */ (function (_super) {\n    tslib_1.__extends(KedBackendCollection, _super);\n    function KedBackendCollection(repo, table, query) {\n        var _this = _super.call(this, function (observer) {\n            var subscription = new KedBackendSubscription(observer, _this);\n            _this.repo.querySet.subscribe(subscription);\n            return subscription;\n        }) || this;\n        _this.repo = repo;\n        _this.table = table;\n        _this.query = query;\n        return _this;\n    }\n    Object.defineProperty(KedBackendCollection.prototype, \"queryKey\", {\n        get: function () {\n            return KedBackendQuery.queryKey(this.table, this.query);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(KedBackendCollection.prototype, \"includes\", {\n        get: function () {\n            return this._includes || (this._includes = [].concat(this.query.include || []));\n        },\n        enumerable: true,\n        configurable: true\n    });\n    KedBackendCollection.prototype.applyQuery = function (query) {\n        return new KedBackendCollection(this.repo, this.table, tslib_1.__assign({}, this.query, query));\n    };\n    KedBackendCollection.prototype.addToQueryArrayProp = function (arrayProp, entries) {\n        var _a;\n        return this.applyQuery((_a = {}, _a[arrayProp] = (this.query[arrayProp] || []).concat(entries), _a));\n    };\n    KedBackendCollection.prototype.addFlags = function () {\n        var flags = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            flags[_i] = arguments[_i];\n        }\n        return this.addToQueryArrayProp(\"flags\", flags);\n    };\n    KedBackendCollection.prototype.debug = function () {\n        return this.applyQuery({ debug: true });\n    };\n    KedBackendCollection.prototype.idsOnly = function () {\n        return this.addFlags(\"idsOnly\");\n    };\n    KedBackendCollection.prototype.idsAndNamesOnly = function () {\n        return this.addFlags(\"idsAndNamesOnly\");\n    };\n    KedBackendCollection.prototype.includeIdsOnly = function () {\n        return this.addFlags(\"includeIdsOnly\");\n    };\n    KedBackendCollection.prototype.includeIdsAndNamesOnly = function () {\n        return this.addFlags(\"includeIdsAndNamesOnly\");\n    };\n    KedBackendCollection.prototype.between = function (from, to) {\n        return this.applyQuery({ from: from, to: to });\n    };\n    KedBackendCollection.prototype.role = function (role) {\n        return this.applyQuery({ role: role });\n    };\n    KedBackendCollection.prototype.hasEdgesFrom = function (ids) {\n        if (ids.length === 0 || ids.some(function (id) { return !id; }))\n            throw new Error(\"Invalid id list given to Collection.hasEdgesFrom(\" + JSON.stringify(ids) + \")\");\n        var hef = this.addToQueryArrayProp(\"hasEdgesFrom\", ids);\n        return hef;\n    };\n    KedBackendCollection.prototype.hasEdgesTo = function (ids) {\n        if (ids.length === 0 || ids.some(function (id) { return !id; }))\n            throw new Error(\"Invalid id list given to Collection.hasEdgesTo(\" + JSON.stringify(ids) + \")\");\n        var het = this.addToQueryArrayProp(\"hasEdgesTo\", ids);\n        return het;\n    };\n    KedBackendCollection.prototype.id = function (id) {\n        var _this = this;\n        return this.applyQuery({ ids: [id] }).single({\n            onZero: function () { throw new Error(\"Could not find entity in \" + _this.table + \" with id \" + id); },\n            onMany: function () { throw new Error(\"Multiple entries in \" + _this.table + \" with id \" + id); },\n        });\n    };\n    KedBackendCollection.prototype.ids = function (ids) {\n        return this.applyQuery({ ids: ids });\n    };\n    KedBackendCollection.prototype.name = function (name) {\n        return this.applyQuery({ name: name });\n    };\n    KedBackendCollection.prototype.tags = function () {\n        var tags = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tags[_i] = arguments[_i];\n        }\n        return this.applyQuery({ tags: tags });\n    };\n    KedBackendCollection.prototype.branchId = function (branchId) {\n        return this.applyQuery({ branchId: branchId });\n    };\n    KedBackendCollection.prototype.include = function () {\n        var graphs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            graphs[_i] = arguments[_i];\n        }\n        return this.addToQueryArrayProp(\"include\", graphs);\n    };\n    KedBackendCollection.prototype.cacheOptimized = function (onOrOff) {\n        return onOrOff === undefined || onOrOff === true ?\n            this.applyQuery({ cacheBust: CacheBust.getCacheBust(this.table, this.query, this.repo.getUser(), this.includes) }) :\n            this.applyQuery({ cacheBust: undefined });\n    };\n    KedBackendCollection.prototype.mutationsOnEmpty = function (mutationFactory) {\n        var tx = new BatchRunner();\n        mutationFactory(tx);\n        return this.applyQuery({ mutationsOnEmpty: tx.mutationRequests });\n    };\n    KedBackendCollection.prototype.single = function (throwers) {\n        var _this = this;\n        var _a = throwers || {}, onZero = _a.onZero, onMany = _a.onMany;\n        return this.toValue().map(function (items) {\n            if (items.length === 0) {\n                if (onZero)\n                    onZero();\n                else\n                    throw new Error(\"Single item of \" + _this.table + \" expected to be returned by query \" + JSON.stringify(_this.query) + \" but none was found.\");\n            }\n            if (items.length > 1) {\n                debugger;\n                if (onMany)\n                    onMany();\n                else\n                    console.log(\"Single item of \" + _this.table + \" expected to be returned by query \" + JSON.stringify(_this.query) + \" but \" + items.length + \" was found.\");\n            }\n            return items[0];\n        });\n    };\n    /*combineLatest<TOther>(other: QueryObservable<TOther>) {\n      return this.render(x => x).combineLatest(other);\n    }*/\n    KedBackendCollection.prototype.update = function (doc, changes, debounce) {\n        if (debounce === void 0) { debounce = 1000; }\n        this.repo.writer.mutate([{\n                op: 'update',\n                table: this.table,\n                branchId: this.query.branchId,\n                id: doc.id,\n                deltaDoc: changes,\n                targetName: doc.name\n            }], debounce);\n    };\n    KedBackendCollection.prototype.addRelated = function (id, label, relatedDoc) {\n        this.repo.writer.mutate([{\n                op: 'add-related',\n                table: this.table,\n                branchId: this.query.branchId,\n                id: id,\n                graphProp: label,\n                relatedDoc: relatedDoc\n            }], 0);\n    };\n    KedBackendCollection.prototype.add = function (doc) {\n        this.repo.writer.mutate([{\n                op: 'add',\n                id: doc.id,\n                table: this.table,\n                doc: doc\n            }], 0);\n    };\n    KedBackendCollection.prototype.removeRelated = function (id, label, relatedDoc) {\n        this.repo.writer.mutate([{\n                op: 'remove-related',\n                table: this.table,\n                branchId: this.query.branchId,\n                id: id,\n                graphProp: label,\n                relatedDoc: relatedDoc\n            }], 0);\n    };\n    KedBackendCollection.prototype.undoLink = function (id, label, relatedId) {\n        if (!this.query.branchId)\n            throw new Error(\"undo links can only be performed on branches\");\n        this.repo.writer.mutate([{\n                op: 'undo-link',\n                table: this.table,\n                branchId: this.query.branchId,\n                id: id,\n                graphProp: label,\n                relatedId: relatedId\n            }], 0);\n    };\n    KedBackendCollection.prototype.delete = function () {\n        var _this = this;\n        var ids = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            ids[_i] = arguments[_i];\n        }\n        this.repo.writer.mutate(ids.map(function (id) { return ({\n            op: 'delete',\n            table: _this.table,\n            id: id\n        }); }), 0);\n    };\n    KedBackendCollection.prototype.unsubscribe = function (subscription) {\n        this.repo.querySet.unsubscribe(subscription);\n    };\n    return KedBackendCollection;\n}(Collection));\nexport { KedBackendCollection };\n/*mixin(\n  KedBackendCollection.prototype,\n  MappedCollection.prototype,\n  \"map\", \"flat\", \"concat\", \"render\", \"load\");*/\n//# sourceMappingURL=kedbackend-collection.js.map","import * as tslib_1 from \"tslib\";\nimport { updateArray } from '../ked-backend-client/utils';\nimport { branchSensitive, getTableFromLabel } from './utils';\nimport { applyDelta } from './delta-merge';\nvar KedBackendQuery = /** @class */ (function () {\n    function KedBackendQuery(table, query, user, repo, mutationQueue) {\n        this.table = table;\n        this.query = query;\n        this.user = user;\n        this.repo = repo;\n        this.mutationQueue = mutationQueue;\n        this.subscriptions = [];\n        this.data = [];\n        this.gotInitialResponse = false;\n        this.invalid = false;\n        this.loadedVersion = 0;\n        this._loadPromise = null;\n        this.includes = query.include ?\n            typeof query.include === 'string' ?\n                [query.include] :\n                query.include :\n            [];\n    }\n    KedBackendQuery.queryKey = function (table, query) {\n        var mutationsOnEmpty = query.mutationsOnEmpty, comparableProps = tslib_1.__rest(query, [\"mutationsOnEmpty\"]);\n        return table + JSON.stringify(comparableProps);\n    };\n    Object.defineProperty(KedBackendQuery.prototype, \"queryKey\", {\n        get: function () {\n            return KedBackendQuery.queryKey(this.table, this.query);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    KedBackendQuery.prototype.subscribe = function (subscription) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var data, data;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.subscriptions.push(subscription);\n                        if (!(this.gotInitialResponse && !this.invalid)) return [3 /*break*/, 1];\n                        data = this.getDataWithMutationsApplied(this.mutationQueue.get(), true, this.data);\n                        subscription.notifySubscriber(data, this.error);\n                        return [3 /*break*/, 4];\n                    case 1:\n                        data = this.queryLocally();\n                        if (!data) return [3 /*break*/, 2];\n                        this.data = data;\n                        this.error = null;\n                        subscription.notifySubscriber(data, this.error);\n                        return [3 /*break*/, 4];\n                    case 2: return [4 /*yield*/, this.load()];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.load = function (version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var loadPromise;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.gotInitialResponse) {\n                            // mutationsOnEmpty should never be used twice.\n                            delete this.query.mutationsOnEmpty;\n                        }\n                        if (!(!version && this._loadPromise)) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this._loadPromise];\n                    case 1: \n                    // loading is ongoing, and caller does not require a recent refresh.\n                    // wait for the ongoing load to complete\n                    return [2 /*return*/, _a.sent()];\n                    case 2:\n                        version = version || this.repo.writer.persistedVersion.value;\n                        loadPromise = this._loadPromise = this._load(version).then(function (data) {\n                            if (_this._loadPromise === loadPromise) {\n                                _this.data = data;\n                                _this.loadedVersion = Math.max(_this.loadedVersion, version);\n                            }\n                        }).catch(function (error) {\n                            if (_this._loadPromise === loadPromise) {\n                                // Noone has refreshed our load. The error is the final result. Set it.\n                                _this.error = error;\n                            }\n                        }).then(function () {\n                            if (_this._loadPromise === loadPromise) {\n                                // Noone has refreshed our load. We're finished. Data or error is already set.\n                                // Mark gotInitialResponse to true and notify subscribers.\n                                _this._loadPromise = null;\n                                _this.gotInitialResponse = true;\n                                _this.notifySubscribers(_this.mutationQueue.get());\n                            }\n                            else {\n                                // A more recent call to load() is ongoing, OR was ongoing but responded\n                                // before us.\n                                // In any case return this._loadPromise. If it's ongoing we'll wait for it\n                                // to finish. If it's null, we'll be returning finally here without\n                                // any action, because the action was taken by the refresher.\n                                return _this._loadPromise; // Wait for the refreshed load to complete\n                            }\n                        });\n                        return [4 /*yield*/, loadPromise];\n                    case 3:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype._load = function (version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.mutationQueue.affectsQuery(this.table, this.query, this.includes)) return [3 /*break*/, 2];\n                        // There are outgoing mutations that affects this query.\n                        // Need to wait till they reach server and server responds with OK before querying\n                        // the server. Otherwise, we may get inaccurate data from server.\n                        return [4 /*yield*/, this.repo.writer.waitForVersionToPersist(version)];\n                    case 1:\n                        // There are outgoing mutations that affects this query.\n                        // Need to wait till they reach server and server responds with OK before querying\n                        // the server. Otherwise, we may get inaccurate data from server.\n                        _a.sent();\n                        _a.label = 2;\n                    case 2: return [4 /*yield*/, this.queryServer()];\n                    case 3: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.unsubscribe = function (subscription) {\n        this.subscriptions = this.subscriptions.filter(function (s) { return s !== subscription; });\n    };\n    KedBackendQuery.prototype.commitMutations = function (mutations, version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var _i, mutations_1, m, data;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.data) return [3 /*break*/, 9];\n                        _i = 0, mutations_1 = mutations;\n                        _a.label = 1;\n                    case 1:\n                        if (!(_i < mutations_1.length)) return [3 /*break*/, 8];\n                        m = mutations_1[_i];\n                        if (!(m.op === 'clear-branch' && (m.branchId === this.query.branchId))) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.refreshOrInvalidate(version)];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 3:\n                        if (!(m.op === 'merge' && (!m.targetBranchId ||\n                            m.branchId === this.query.branchId ||\n                            m.targetBranchId === this.query.branchId))) return [3 /*break*/, 5];\n                        return [4 /*yield*/, this.refreshOrInvalidate(version)];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 5:\n                        if (!(m.op === 'update' && ((m.deltaDoc.tags && this.query.tags) ||\n                            (m.deltaDoc.name && this.query.name)))) return [3 /*break*/, 7];\n                        // A tag may have been added, or renamed, and\n                        // the query is dependent on the same property.\n                        // The query must be refreshed from server as we cannot\n                        // commit the mutations locally as we don't have all info.\n                        return [4 /*yield*/, this.refreshOrInvalidate(version)];\n                    case 6:\n                        // A tag may have been added, or renamed, and\n                        // the query is dependent on the same property.\n                        // The query must be refreshed from server as we cannot\n                        // commit the mutations locally as we don't have all info.\n                        _a.sent();\n                        return [2 /*return*/];\n                    case 7:\n                        _i++;\n                        return [3 /*break*/, 1];\n                    case 8:\n                        data = this.getDataWithMutationsApplied(mutations, false, this.data);\n                        this.data = data;\n                        _a.label = 9;\n                    case 9: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.refreshOrInvalidate = function (version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(this.subscriptions.length === 0)) return [3 /*break*/, 1];\n                        this.invalid = true;\n                        return [3 /*break*/, 3];\n                    case 1: return [4 /*yield*/, this.load(version)];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.notifySubscribers = function (optimisticMutations) {\n        var _this = this;\n        if (this.data && this.gotInitialResponse) {\n            var data_1 = this.getDataWithMutationsApplied(optimisticMutations, true, this.data);\n            this.subscriptions.forEach(function (s) {\n                s.notifySubscriber(data_1, _this.error);\n            });\n        }\n    };\n    KedBackendQuery.prototype.queryLocally = function () {\n        return this.repo.querySet.queryLocally(this.table, this.query, this.includes);\n    };\n    KedBackendQuery.prototype.queryServer = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var data;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.repo.getClient().list(this.table, tslib_1.__assign({}, this.query))];\n                    case 1:\n                        data = _a.sent();\n                        return [2 /*return*/, data];\n                }\n            });\n        });\n    };\n    KedBackendQuery.prototype.getDataWithMutationsApplied = function (mutations, optimistic, data) {\n        var _this = this;\n        mutations.forEach(function (mutation) {\n            data = _this.applyMutationsOnData(data, mutation, optimistic);\n        });\n        return data;\n    };\n    KedBackendQuery.prototype.applyMutationsOnData = function (data, m, optimistic) {\n        if (branchSensitive(m) && m.branchId != this.query.branchId)\n            return data;\n        var _a = this, table = _a.table, includes = _a.includes, listOptions = _a.query;\n        var sourceIds = listOptions.hasEdgesFrom ? [].concat(listOptions.hasEdgesFrom || []) : [];\n        var requestedTags = listOptions.tags ? [].concat(listOptions.tags || []) : [];\n        switch (m.op) {\n            case 'update': {\n                return updateArray(data, function (doc) {\n                    if (doc.id === m.id) {\n                        // Apply delta on updated document\n                        var updatedDoc = applyDelta(doc, m.deltaDoc);\n                        if (optimistic)\n                            updatedDoc.$meta = 'updating';\n                        return updatedDoc;\n                    }\n                    // If id does not apply to this doc, search in graphs the id is found\n                    // among graph included docs, and if so, update that one:\n                    includes.forEach(function (label) {\n                        var _a;\n                        var includedDocs = doc[label];\n                        if (includedDocs) {\n                            var updatedArray = updateArray(includedDocs, function (related) {\n                                if (related.id !== m.id)\n                                    return related;\n                                var updatedRelated = applyDelta(related, m.deltaDoc);\n                                if (optimistic)\n                                    updatedRelated.$meta = 'updating';\n                                return updatedRelated;\n                            });\n                            if (updatedArray !== includedDocs) {\n                                doc = tslib_1.__assign({}, doc, (_a = {}, _a[label] = updatedArray, _a));\n                            }\n                        }\n                    });\n                    return doc;\n                });\n            }\n            case 'add':\n                if (table === m.table) {\n                    if (listOptions.tags) {\n                        var queriedTags_1 = [].concat(listOptions.tags); // tag can be either string or string[]. Make is string[] always.\n                        if (m.doc.tags && m.doc.tags.some(function (tag) { return queriedTags_1.includes(tag); })) {\n                            return data.concat([m.doc]); // Make the added doc appear in the result (optimistic mutation)\n                        }\n                    }\n                    // Todo, apply also for other list options, like ids:\n                    // The above code for 'add' was only written to cover the use case of teachers-page notifications!\n                }\n                return data; // fallback case - query was not affected.\n            case 'add-related':\n                if (table === m.table && includes.indexOf(m.graphProp) !== -1) {\n                    // If expression is `db.courseBlocks....whatever.. .include(\"abilities\")`, detect: db.courseBlocks.addRelated(blockId, 'abilities', ...)\n                    // ...because table = 'courseBlocks' and includes has \"abilities\".\n                    return updateArray(data, function (doc) {\n                        var _a;\n                        if (doc.id !== m.id)\n                            return doc;\n                        var relatedDoc = tslib_1.__assign({}, m.relatedDoc);\n                        if (optimistic)\n                            relatedDoc.$meta = 'adding';\n                        return tslib_1.__assign({}, doc, (_a = {}, _a[m.graphProp] = doc[m.graphProp].concat([relatedDoc]), _a));\n                    });\n                }\n                if (listOptions.hasEdgesFrom) {\n                    if (sourceIds.includes(m.id)) {\n                        // If expression is:\n                        //   `db.courseBlocks.hasEdgesFrom([courseId])`  (meaning table='courseBlocks' and sourceIds includes courseId)\n                        // , detect: db.courseInstances.addRelated(courseId, 'courseBlocks', ....) // m.graphProp === 'blocks'--> getTableFromLabel --> 'courseBlocks'\n                        if (table === getTableFromLabel(m.table, m.graphProp)) {\n                            if (!listOptions.tags)\n                                return data.concat(this.setGraphProps(m.relatedDoc));\n                            if (m.relatedDoc.tags && requestedTags.some(function (tag) { return m.relatedDoc.tags.includes(tag); })) {\n                                return data.concat(this.setGraphProps(m.relatedDoc));\n                            }\n                        }\n                    }\n                }\n                if (listOptions.ids && listOptions.ids.some(function (id) { return id === m.relatedDoc.id; })) {\n                    // A certain ID is observed. A doc with this id is being added.\n                    // Add the doc to the result. Exactly this WILL happen in the following typical scenario:\n                    // 1. User adds a related document to a list.\n                    // 2. Document remains within the MutationQueue while batch-request is being processed by server.\n                    // 3. User clicks the added item to edit or view it (or our component redirects to its editor)\n                    // 4. A new query of that particular ID is subscribed to {ids=[theId]}\n                    //    KedBackendQuery.subscribe then does this:\n                    //      1. Call queryLocally() before querying server\n                    //      2. queryLocally() inspects mutations and finds a match, returning an empty list\n                    //         (assumes as we are adding it, it can't exist on the server anyway)\n                    //      3. KedBackendQUery applies mutations onto the empty list, and ends up here to add\n                    //         it optimistically.\n                    //      4. When server responds with 200 OK, calls us here again with optimistic=false\n                    //         to \"persist\" it in the query's data array.\n                    //      4B: If not 200 OK, mutation may be gone and the subscriber will se an error page\n                    //         \"Could not find entity with id X.\" along with a red error message on the screen\n                    //         about that it failed to save on server.\n                    return data.concat(this.setGraphProps(m.relatedDoc));\n                }\n                return data;\n            case 'remove-related':\n                if (table === m.table && includes.indexOf(m.graphProp) !== -1) {\n                    return updateArray(data, function (doc) {\n                        var _a;\n                        var includedDocs = doc[m.graphProp];\n                        if (!includedDocs)\n                            return doc;\n                        if (doc.id !== m.id)\n                            return doc;\n                        return tslib_1.__assign({}, doc, (_a = {}, _a[m.graphProp] = optimistic ?\n                            // Mark related-doc-to-remove with $meta: 'deleting'\n                            includedDocs.map(function (d) { return d.id !== m.relatedDoc.id ?\n                                d : tslib_1.__assign({}, d, { $meta: 'deleting' }); }) :\n                            // Delete related-doc-to-remove from doc[grapProp]:\n                            includedDocs.filter(function (d) { return d.id !== m.relatedDoc.id; }), _a));\n                    });\n                }\n                if (listOptions.hasEdgesFrom) {\n                    if (sourceIds.includes(m.id))\n                        return optimistic ?\n                            data.map(function (d) { return d.id === m.relatedDoc.id ? tslib_1.__assign({}, d, { $meta: 'deleting' }) : d; }) :\n                            data.filter(function (d) { return d.id !== m.relatedDoc.id; });\n                }\n                return data;\n            case 'delete':\n                if (table === m.table) {\n                    return data.filter(function (d) { return d.id !== m.id; });\n                }\n                else if (listOptions.include) {\n                    var includedTables = includes\n                        .map(function (label) { return ({ label: label, table: getTableFromLabel(table, label) }); });\n                    var labels_1 = includedTables.filter(function (_a) {\n                        var table = _a.table;\n                        return table === m.table;\n                    });\n                    if (labels_1.length > 0) {\n                        return updateArray(data, function (doc) {\n                            labels_1.forEach(function (_a) {\n                                var _b;\n                                var label = _a.label;\n                                var relatedDocs = doc[label];\n                                if (relatedDocs) {\n                                    doc = tslib_1.__assign({}, doc, (_b = {}, _b[label] = optimistic ?\n                                        relatedDocs.map(function (d) { return d.id === m.id ? tslib_1.__assign({}, d, { $meta: 'deleting' }) : d; }) :\n                                        relatedDocs.filter(function (_a) {\n                                            var id = _a.id;\n                                            return id !== m.id;\n                                        }), _b));\n                                }\n                            });\n                            return doc;\n                        });\n                    }\n                }\n                return data;\n            default:\n                return data;\n        }\n    };\n    KedBackendQuery.prototype.setGraphProps = function (doc) {\n        var copy = tslib_1.__assign({}, doc);\n        this.includes.forEach(function (label) { return copy[label] = copy[label] || []; });\n        return copy;\n    };\n    return KedBackendQuery;\n}());\nexport { KedBackendQuery };\n//# sourceMappingURL=kedbackend-query.js.map","import * as tslib_1 from \"tslib\";\nimport { tables } from 'kedbackend-schema/schema.json';\nimport { KedBackendCollection } from './kedbackend-collection';\nimport { QuerySet } from './query-set';\nimport { MutationQueue } from './mutation-queue';\nimport { KedBackendWriter } from './kedbackend-writer';\nimport { DeltaCollection } from './delta-collection/delta-collection';\nvar KedBackendRepo = /** @class */ (function () {\n    function KedBackendRepo(getClient, getUser, getUserDisplayName, defaultQueryOptions, mutationQueue, querySet, writer, cacheOptimized) {\n        var _this = this;\n        this.getClient = getClient;\n        this.getUser = getUser;\n        this.getUserDisplayName = getUserDisplayName;\n        this.defaultQueryOptions = defaultQueryOptions;\n        this.mutationQueue = mutationQueue;\n        this.querySet = querySet;\n        this.writer = writer;\n        this.cacheOptimized = cacheOptimized;\n        if (!defaultQueryOptions)\n            this.defaultQueryOptions = {};\n        if (!mutationQueue)\n            this.mutationQueue = new MutationQueue();\n        if (!querySet)\n            this.querySet = new QuerySet(this.mutationQueue);\n        if (!writer)\n            this.writer = new KedBackendWriter(this.mutationQueue, this.querySet, getClient, getUser, getUserDisplayName);\n        Object.keys(tables).forEach(function (table) {\n            var collection = new KedBackendCollection(_this, table, defaultQueryOptions || {});\n            if (cacheOptimized) {\n                collection = collection.cacheOptimized();\n            }\n            _this[table] = collection;\n        });\n        this.deltas = new DeltaCollection(this.writer.deltaCache, {\n            branchId: this.defaultQueryOptions.branchId // If branchId is undefined. DeltaCollection will respond with Error on subscribe()\n        });\n    }\n    KedBackendRepo.prototype.table = function (tableName) {\n        var collection = new KedBackendCollection(this, tableName, this.defaultQueryOptions);\n        if (this.cacheOptimized)\n            collection = collection.cacheOptimized();\n        return collection;\n    };\n    KedBackendRepo.prototype._clone = function (queryOptions, cacheOptimized) {\n        var clone = new KedBackendRepo(this.getClient, this.getUser, this.getUserDisplayName, tslib_1.__assign({}, this.defaultQueryOptions, queryOptions), this.mutationQueue, this.querySet, this.writer, cacheOptimized === undefined ? this.cacheOptimized : cacheOptimized);\n        return clone;\n    };\n    KedBackendRepo.prototype.branch = function (branchId) {\n        return this._clone({ branchId: branchId });\n    };\n    KedBackendRepo.prototype.role = function (role) {\n        return this._clone({ role: role });\n    };\n    KedBackendRepo.prototype.optimizeCache = function () {\n        return this._clone({}, true);\n    };\n    KedBackendRepo.prototype.clearBranch = function () {\n        if (!this.defaultQueryOptions.branchId)\n            throw new Error(\"Cannot clear master branch\");\n        this.writer.mutate([{ op: 'clear-branch', branchId: this.defaultQueryOptions.branchId }], 0);\n    };\n    KedBackendRepo.prototype.merge = function (targetBranchId) {\n        if (!this.defaultQueryOptions.branchId)\n            throw new Error(\"Cannot merge from master branch\");\n        this.writer.mutate([{ op: 'merge', branchId: this.defaultQueryOptions.branchId, targetBranchId: targetBranchId }], 0);\n    };\n    KedBackendRepo.prototype.saveNow = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.writer.waitForVersionToPersist(this.writer.currentVersion)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return KedBackendRepo;\n}());\nexport { KedBackendRepo };\n//# sourceMappingURL=kedbackend-repo.js.map","var KedBackendSubscription = /** @class */ (function () {\n    function KedBackendSubscription(subscriber, collection) {\n        this.subscriber = subscriber;\n        this.collection = collection;\n    }\n    KedBackendSubscription.prototype.notifySubscriber = function (data, error) {\n        try {\n            if (error)\n                this.subscriber([], error, this);\n            else if (data !== this.lastNotifiedData) { // Will in-fact be equal by reference if data is same as last notification (as we use an immutable approach on data)\n                this.lastNotifiedData = data;\n                this.subscriber(data, error, this);\n            }\n        }\n        catch (ex) {\n            try {\n                this.subscriber([], ex, this);\n            }\n            catch (ex2) {\n                console.error(\"Error while notifying KedBackendSubscriber:\", ex2, 'originally notified error:', ex);\n            }\n        }\n    };\n    KedBackendSubscription.prototype.unsubscribe = function () {\n        this.collection.unsubscribe(this);\n    };\n    return KedBackendSubscription;\n}());\nexport { KedBackendSubscription };\n//# sourceMappingURL=kedbackend-subscription.js.map","import * as tslib_1 from \"tslib\";\nimport { MutationQueue } from './mutation-queue';\nimport { BatchRunner } from '../ked-backend-client';\nimport { tables } from 'kedbackend-schema/schema.json';\nimport { CacheBust } from './cache-bust';\nimport { Emitter } from '../observable';\nimport { DeltaCache } from './delta-collection/delta-cache';\nvar KedBackendWriter = /** @class */ (function () {\n    function KedBackendWriter(mutationQueue, querySet, getClient, getUser, getUserDisplayName) {\n        this.mutationQueue = mutationQueue;\n        this.querySet = querySet;\n        this.getClient = getClient;\n        this.getUser = getUser;\n        this.getUserDisplayName = getUserDisplayName;\n        this._timeoutId = null;\n        this._isSavingPromise = null;\n        this.currentVersion = 0;\n        this.persistedVersion = new Emitter(0);\n        this.errorSubscribers = [];\n        this.stateSubscribers = [];\n        this.deltaCache = new DeltaCache(getClient, getUser, getUserDisplayName);\n    }\n    Object.defineProperty(KedBackendWriter.prototype, \"isSaving\", {\n        get: function () { return !!this._isSavingPromise; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(KedBackendWriter.prototype, \"isEdited\", {\n        get: function () { return this.mutationQueue.get().length > 0; },\n        enumerable: true,\n        configurable: true\n    });\n    KedBackendWriter.prototype.onError = function (callback) {\n        this.errorSubscribers.push(callback);\n    };\n    KedBackendWriter.prototype.onStateChange = function (callback) {\n        this.stateSubscribers.push(callback);\n    };\n    KedBackendWriter.prototype.off = function (callback) {\n        this.errorSubscribers = this.errorSubscribers.filter(function (s) { return s !== callback; });\n        this.stateSubscribers = this.stateSubscribers.filter(function (s) { return s !== callback; });\n    };\n    KedBackendWriter.prototype.dispatchError = function (error, retryable) {\n        var _this = this;\n        this.errorSubscribers.forEach(function (callback) {\n            try {\n                callback(error, retryable, _this);\n            }\n            catch (_) { }\n        });\n    };\n    KedBackendWriter.prototype.dispatchStateChange = function () {\n        var _this = this;\n        this.stateSubscribers.forEach(function (callback) {\n            try {\n                callback(_this);\n            }\n            catch (_) { }\n        });\n    };\n    KedBackendWriter.prototype.mutate = function (mutations, debounce) {\n        this.mutationQueue.add(mutations);\n        ++this.currentVersion;\n        this.dispatchStateChange();\n        this.querySet.notifySubscribers();\n        this.deltaCache.applyMutations(this.mutationQueue.get(), { optimistic: true });\n        if (!this._isSavingPromise) {\n            if (this._timeoutId)\n                clearTimeout(this._timeoutId);\n            this._timeoutId = setTimeout(this.save.bind(this), debounce);\n        }\n        // If isSaving, we don't need to do anything, becase it will re-check if additional\n        // mutations have come, when saving is done.\n    };\n    KedBackendWriter.prototype.retrySave = function () {\n        return this.save();\n    };\n    KedBackendWriter.prototype.waitForVersionToPersist = function (version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var persistedVersion;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.persistedVersion.load()];\n                    case 1:\n                        persistedVersion = _a.sent();\n                        if (!(persistedVersion < version)) return [3 /*break*/, 3];\n                        this.save(); // Be more eager to save\n                        return [4 /*yield*/, this.persistedVersion.filter(function (persistedVersion) { return persistedVersion >= version; }).load()];\n                    case 2:\n                        _a.sent();\n                        _a.label = 3;\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendWriter.prototype.save = function () {\n        var _this = this;\n        if (this._timeoutId)\n            clearTimeout(this._timeoutId);\n        if (this._isSavingPromise)\n            return this._isSavingPromise;\n        if (!this.isEdited)\n            return Promise.resolve();\n        this._timeoutId = null;\n        this._isSavingPromise = this._save();\n        this._isSavingPromise.catch(function () { }).then(function () { return _this._isSavingPromise = null; });\n        return this._isSavingPromise;\n    };\n    KedBackendWriter.prototype._save = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var mutations, version, mutationRequests, res_1, etagMutations, error_1;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.dispatchStateChange();\n                        mutations = this.mutationQueue.get();\n                        version = this.currentVersion;\n                        this.mutationQueue.moveToSavingQueue();\n                        mutationRequests = this.mapMutations(mutations);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 6, 11, 12]);\n                        return [4 /*yield*/, this.getClient().batch(mutationRequests)];\n                    case 2:\n                        res_1 = _a.sent();\n                        etagMutations = Object.keys(res_1.newEtags).map(function (id) { return ({\n                            op: 'update',\n                            table: null,\n                            id: id,\n                            deltaDoc: { $etag: res_1.newEtags[id] },\n                            targetName: null // We don't have the target name. But this mutation won't be visible in a DeltaCollection anyway, so it wont be used.\n                        }); });\n                        // Invalidate cache\n                        CacheBust.invalidateCache(mutationRequests, this.getUser());\n                        // Commmit mutations along with etagMutations into queries cached data\n                        this.persistedVersion.dispatch(version);\n                        this.deltaCache.applyMutations(mutations, { optimistic: false });\n                        return [4 /*yield*/, this.querySet.commitMutations(MutationQueue.merge(mutations, etagMutations), version)];\n                    case 3:\n                        _a.sent();\n                        // On success, clear saving queue as the mutations will now be committed to all query's data instead.\n                        this.mutationQueue.clearSavingQueue();\n                        this.dispatchStateChange(); // isEdited may have turned to false\n                        // Finally, notify subscribers so that views get updated with committed results\n                        this.querySet.notifySubscribers();\n                        if (!(this.mutationQueue.get().length > 0)) return [3 /*break*/, 5];\n                        // Additional mutations happend while we were saving. Handle them as well.\n                        return [4 /*yield*/, this._save()];\n                    case 4:\n                        // Additional mutations happend while we were saving. Handle them as well.\n                        _a.sent();\n                        _a.label = 5;\n                    case 5: return [3 /*break*/, 12];\n                    case 6:\n                        error_1 = _a.sent();\n                        this.persistedVersion.dispatchError(error_1);\n                        if (!(error_1 && error_1.name && error_1.name.startsWith(\"http4\"))) return [3 /*break*/, 9];\n                        // Access Control denied, bad request or similar. Throw mutations away.\n                        this.dispatchError(error_1, false);\n                        this.mutationQueue.clearSavingQueue();\n                        this.dispatchStateChange(); // isEdited may have turned to false\n                        this.querySet.notifySubscribers();\n                        if (!(this.mutationQueue.get().length > 0)) return [3 /*break*/, 8];\n                        // Ho ho! Additional mutations happend while we were saving. Handle them alone. THey might be more lucky.\n                        return [4 /*yield*/, this._save()];\n                    case 7:\n                        // Ho ho! Additional mutations happend while we were saving. Handle them alone. THey might be more lucky.\n                        _a.sent();\n                        _a.label = 8;\n                    case 8: return [3 /*break*/, 10];\n                    case 9:\n                        this.dispatchError(error_1, true);\n                        _a.label = 10;\n                    case 10: return [3 /*break*/, 12];\n                    case 11:\n                        this.dispatchStateChange();\n                        return [7 /*endfinally*/];\n                    case 12: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    KedBackendWriter.prototype.mapMutations = function (mutations) {\n        var br = new BatchRunner();\n        mutations.forEach(function (m) {\n            switch (m.op) {\n                case 'update':\n                    br.update(m.table, m.id, m.deltaDoc, m.branchId);\n                    break;\n                case 'add':\n                    br.add(m.table, m.doc);\n                    break;\n                case 'add-related':\n                    if (!m.relatedDoc.$etag) {\n                        // No $etag means this is a new document. Add it before linking to it:\n                        br.add(tables[m.table].relationships[m.graphProp], m.relatedDoc, m.branchId);\n                    }\n                    br.link2(m.table, m.id, m.graphProp, m.relatedDoc.id, m.branchId);\n                    break;\n                case 'remove-related':\n                    br.unlink2(m.table, m.id, m.graphProp, m.relatedDoc.id, m.branchId);\n                    break;\n                case 'undo-link':\n                    br.undoLink(m.table, m.id, m.graphProp, m.relatedId, m.branchId);\n                    break;\n                case 'delete':\n                    br.delete(m.table, m.id);\n                    break;\n                case 'clear-branch':\n                    br.clearBranch(m.branchId);\n                    break;\n                case 'merge':\n                    br.merge(m.branchId, m.targetBranchId);\n                    break;\n            }\n        });\n        return br.mutationRequests;\n    };\n    return KedBackendWriter;\n}());\nexport { KedBackendWriter };\n//# sourceMappingURL=kedbackend-writer.js.map","import * as tslib_1 from \"tslib\";\nimport { getTableFromLabel, branchSensitive, globalOp } from './utils';\nimport { mergeDeltas } from './delta-merge';\nvar MutationQueue = /** @class */ (function () {\n    function MutationQueue() {\n        this.queue = [];\n        this.savingQueue = [];\n    }\n    MutationQueue.prototype.add = function (mutations) {\n        this.queue = MutationQueue.merge(this.queue, mutations);\n    };\n    MutationQueue.prototype.moveToSavingQueue = function () {\n        this.savingQueue = MutationQueue.merge(this.savingQueue, this.queue);\n        this.queue = [];\n    };\n    MutationQueue.prototype.clearSavingQueue = function () {\n        this.savingQueue = [];\n    };\n    MutationQueue.prototype.get = function () {\n        return this.savingQueue.concat(this.queue);\n    };\n    MutationQueue.prototype.affectsQuery = function (table, query, includes) {\n        var mutations = this.get();\n        if (mutations.some(function (m) { return m.op === 'merge' || m.op === 'clear-branch'; }))\n            return true;\n        if (query.ids) {\n            // A query with \"ids\" filter will be easy to detect a no-match on:\n            return mutations.some(function (m) { return globalOp(m) || (!branchSensitive(m) || m.branchId === query.branchId) &&\n                query.ids.includes(m.id); });\n        }\n        // Otherwise, check if mutations affect same branch and table. Could be done more fine grained,\n        // but that would only be a suboptimization.\n        return mutations.some(function (m) {\n            return m.op === 'add' ?\n                m.table === table :\n                m.op === 'delete' ?\n                    m.table === table || (includes.some(function (label) { return getTableFromLabel(table, label) === m.table; })) :\n                    globalOp(m) ? true :\n                        m.branchId == query.branchId &&\n                            (m.table === table || (m.op !== 'update' && ([table].concat(includes.map(function (label) { return getTableFromLabel(table, label); })).some(function (table) { return getTableFromLabel(m.table, m.graphProp) === table; }))));\n        });\n    };\n    MutationQueue.merge = function (queue1, queue2) {\n        var mutableQueue1 = queue1.slice();\n        var mutableQueue2 = queue2.slice();\n        //if (mutableQueue1.length > 0) debugger;\n        var len = queue1.length;\n        var _loop_1 = function (i) {\n            var m = queue1[i];\n            if (m.op === 'update') {\n                var overlappingIdOpIdx = mutableQueue2.findIndex(function (newMut) {\n                    return newMut.op === 'update' &&\n                        newMut.branchId === m.branchId &&\n                        newMut.id === m.id;\n                });\n                if (overlappingIdOpIdx >= 0) {\n                    mutableQueue1[i] = tslib_1.__assign({}, m, { deltaDoc: mergeDeltas(m.deltaDoc, mutableQueue2[overlappingIdOpIdx].deltaDoc) });\n                    mutableQueue2.splice(overlappingIdOpIdx, 1);\n                }\n            }\n        };\n        for (var i = 0; i < len; ++i) {\n            _loop_1(i);\n        }\n        return mutableQueue1.concat(mutableQueue2);\n    };\n    return MutationQueue;\n}());\nexport { MutationQueue };\n//# sourceMappingURL=mutation-queue.js.map","import * as tslib_1 from \"tslib\";\nimport { KedBackendQuery } from './kedbackend-query';\nimport * as JsonSchema from 'kedbackend-schema/schema.json';\nimport { queryArray } from './utils';\nvar QuerySet = /** @class */ (function () {\n    function QuerySet(mutationQueue) {\n        this.mutationQueue = mutationQueue;\n        this.queries = [];\n    }\n    QuerySet.prototype.commitMutations = function (mutations, version) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, Promise.all(this.queries.map(function (q) { return q.commitMutations(mutations, version); }))];\n                    case 1:\n                        _a.sent();\n                        this.cleanupInvalidQueries();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    QuerySet.prototype.cleanupInvalidQueries = function () {\n        this.queries = this.queries.filter(function (q) {\n            if (q.invalid) {\n                if (q.timeoutHandle) {\n                    clearTimeout(q.timeoutHandle);\n                    q.timeoutHandle = null;\n                }\n                return false;\n            }\n            return true;\n        });\n    };\n    QuerySet.prototype.notifySubscribers = function () {\n        var optimisticMutations = this.mutationQueue.get();\n        this.queries.forEach(function (q) {\n            q.notifySubscribers(optimisticMutations);\n        });\n    };\n    QuerySet.prototype.findQuery = function (table, query) {\n        return this.queries.find(function (q) { return q.queryKey === KedBackendQuery.queryKey(table, query); });\n    };\n    QuerySet.prototype.queryLocally = function (table, query, includes) {\n        // For now, only handle this very common and special case (which\n        // will save a lot of unnescessary network traffic if I am thinking right...)\n        var mutations = this.mutationQueue.get();\n        // Check if the query wants to get a single entity by its ID:\n        if (query.ids && query.ids.length === 1) {\n            // And if so, if we have an outgoing mutation to create that entity:\n            if (mutations.some(function (m) { return m.op === 'add-related' && m.relatedDoc.id === query.ids[0]; })) {\n                // Then return an EMPTY response, signalling that we can resolve this locally,\n                // but let the optistic feature of KedBackendQuery apply the mutation before\n                // notifying subscribers (we don't want it to be persistent before the server\n                // has accepted the mutation)\n                return [];\n            }\n        }\n        // OK, another quite common case is when we ask for a certain ID and that ID replies\n        // within another query\n        if (query.hasEdgesFrom || query.hasEdgesTo)\n            return null; // Not possible to handle\n        if (!query.ids)\n            return null; // For now, just take hight for this particular and most common case!\n        var _loop_1 = function (q) {\n            if (!q.gotInitialResponse)\n                return \"continue\";\n            if (q.query.branchId !== query.branchId)\n                return \"continue\";\n            if (q.query.flags)\n                return \"continue\"; // It would be complex to support various flags. Query's data may include ids only. Can't rely on the query.\n            var qIncludes = q.includes;\n            if (qIncludes.length > 0 && (!query.include || query.include.length === 0)) {\n                // We don't include, but this query does. Check if we can find our result within it.\n                var label = qIncludes.find(function (l) { return JsonSchema.tables[q.table][\"relationships\"][l] === table; });\n                if (label) {\n                    var res_1 = {};\n                    for (var _i = 0, _a = q.data; _i < _a.length; _i++) {\n                        var entity = _a[_i];\n                        var subData = queryArray(query, entity[label]);\n                        subData.forEach(function (r) { return res_1[r.id] = r; });\n                    }\n                    var result_1 = Object.keys(res_1).map(function (id) { return res_1[id]; });\n                    // Only return result if we could look up every requested ID:\n                    if (!query.ids.every(function (id) { return result_1.some(function (x) { return x.id === id; }); }))\n                        return \"continue\";\n                    return { value: result_1 };\n                }\n            }\n            if (!includes.every(function (label) { return qIncludes.includes(label); }))\n                return \"continue\";\n            // Lastly, if the query includes all graphs that we do, pick the subset from that query.\n            // Concrete example: We observe a certain Task by ID and want its knowledgeRequirements along with it,\n            // and there's another query of all tasks that also includes knowledgeRequirements. Use it. \n            if (q.table === table) {\n                var result_2 = queryArray(query, q.data);\n                // Only return result if we could look up every requested ID:\n                if (!query.ids.every(function (id) { return result_2.some(function (x) { return x.id === id; }); }))\n                    return \"continue\";\n                return { value: result_2 };\n            }\n        };\n        for (var _i = 0, _a = this.queries; _i < _a.length; _i++) {\n            var q = _a[_i];\n            var state_1 = _loop_1(q);\n            if (typeof state_1 === \"object\")\n                return state_1.value;\n        }\n    };\n    QuerySet.prototype.subscribe = function (subscription) {\n        var _a = subscription.collection, table = _a.table, query = _a.query, repo = _a.repo;\n        var kbQuery = this.findQuery(table, query);\n        if (!kbQuery) {\n            kbQuery = new KedBackendQuery(table, query, repo.getUser(), repo, this.mutationQueue);\n            this.queries.push(kbQuery);\n        }\n        else {\n            if (kbQuery.timeoutHandle) {\n                clearTimeout(kbQuery.timeoutHandle);\n                kbQuery.timeoutHandle = null;\n            }\n        }\n        kbQuery.subscribe(subscription);\n    };\n    QuerySet.prototype.unsubscribe = function (subscription) {\n        var _this = this;\n        var _a = subscription.collection, table = _a.table, query = _a.query, repo = _a.repo;\n        var kbQuery = this.findQuery(table, query);\n        if (kbQuery) {\n            // Prohibit further notifications to this subscription:\n            kbQuery.unsubscribe(subscription);\n            // Release unnescessary memory when there are no more subscriptions of this query, by removing the query itself\n            // To that in a delayed manner, so that an unsubscribe() followed by an immediate subscribe() don't have to re-query the server:\n            if (kbQuery.subscriptions.length === 0) {\n                // Schedule for garbage collection in 5 minutes:\n                kbQuery.timeoutHandle = setTimeout(function () {\n                    // Check if kbQuery still has no subscriptions (not certain! A new subscriber may have come along...)\n                    if (kbQuery.subscriptions.length === 0) {\n                        // Still no subscriptions on it, time to release some memory and forget the in-memory cache of the query result\n                        _this.queries = _this.queries.filter(function (q) { return q !== kbQuery; });\n                    }\n                }, this.queries.length > 50 ?\n                    500 : // Don't host too many queries. Garbage collect this within 500 ms\n                    5 * 60000); // Allow query in memory for another 5 minutes\n            }\n        }\n    };\n    return QuerySet;\n}());\nexport { QuerySet };\n//# sourceMappingURL=query-set.js.map","import { tables } from 'kedbackend-schema/schema.json';\nexport function getTableFromLabel(table, label) {\n    return tables[table].relationships[label];\n}\nexport function queryArray(query, data) {\n    var filter = getFilterFromQuery(query);\n    return data.filter(filter);\n}\nexport function AND(filter1, filter2) {\n    return function (x) { return filter1(x) && filter2(x); };\n}\nexport function getFilterFromQuery(query) {\n    var filter = function (x) { return true; };\n    if (query.from)\n        return AND(filter, function (x) { return x.dateTime >= query.from; });\n    if (query.to)\n        return AND(filter, function (x) { return x.dateTime < query.to; });\n    if (query.ids)\n        return AND(filter, function (x) { return query.ids.includes(x.id); });\n    if (query.name)\n        return AND(filter, function (x) { return x.name === query.name; });\n    if (query.tags)\n        return AND(filter, function (x) { return x.tags && [].concat(query.tags || []).some(function (tag) { return x.tags.includes(tag); }); });\n    // query.hasEdgesFrom and query.hasEdgesTo cannot by filtered here\n    return filter;\n}\nexport function branchSensitive(m) {\n    return m.op !== 'delete';\n}\nexport function globalOp(m) {\n    return m.op === 'clear-branch' || m.op === 'merge';\n}\n//# sourceMappingURL=utils.js.map","import migrate from './migrate';\nexport var KedModelMigratorMixin = function (client) {\n    if (client.__migrator_mixed_in)\n        return;\n    client.__migrator_mixed_in = true;\n    var get = client.get;\n    var list = client.list;\n    client.get = function (table, id, options) {\n        var include = options && options.include;\n        return get.apply(this, arguments).then(function (result) {\n            migrate(result, table, include && include.toString().split(','));\n            return result;\n        });\n    };\n    client.list = function (table, options) {\n        var include = options && options.include;\n        return list.apply(this, arguments).then(function (result) {\n            result.forEach(function (doc) { return migrate(doc, table, include && include.toString().split(',')); });\n            return result;\n        });\n    };\n    return client;\n};\n//# sourceMappingURL=index.js.map","import migrateTask from './migrate-task';\nexport default function migrateCourse(course, graphs) {\n    if (!course.modules)\n        course.modules = [];\n    course.modules.forEach(function (module) {\n        if (!module.resources) {\n            module.resources = [];\n        }\n        if (!module.taskIds) {\n            module.taskIds = [];\n        }\n    });\n    if (!course.responsibleTeachers) {\n        course.responsibleTeachers = [];\n    }\n    // Earlier wrong spelling of resources\n    if ('resourses' in course && !('resources' in course)) {\n        course.resources = course.resourses;\n        delete course.resourses;\n    }\n    if (!course.resources) {\n        course.resources = [];\n    }\n    if (graphs) {\n        graphs.forEach(function (label) {\n            switch (label) {\n                case 'tasks':\n                    course.tasks.forEach(function (task) { return migrateTask(task); });\n                    break;\n            }\n        });\n    }\n}\n//# sourceMappingURL=migrate-course.js.map","export default function migrateTask(task) {\n    if (!task.resources)\n        task.resources = [];\n}\n//# sourceMappingURL=migrate-task.js.map","import migrateCourse from './migrate-course';\nimport migrateTask from './migrate-task';\nexport default function migrate(doc, table, graphs) {\n    switch (table) {\n        case \"courses\":\n            migrateCourse(doc, graphs);\n            break;\n        case \"tasks\":\n            migrateTask(doc);\n            break;\n    }\n}\n//# sourceMappingURL=migrate.js.map","import * as tslib_1 from \"tslib\";\nimport { Observable } from \"./observable\";\nimport { initMapMethod } from \"./map\";\nimport { Value } from \"./value\";\nimport { Emitter } from \"./emitter\";\nvar Collection = /** @class */ (function (_super) {\n    tslib_1.__extends(Collection, _super);\n    function Collection(subscribe) {\n        return _super.call(this, subscribe) || this;\n    }\n    Collection.prototype._map = function (mapper) {\n        throw \"mixedin\";\n    };\n    Collection.from = function (x) {\n        if (x.subscribe)\n            return new Collection(function (s) { return x.subscribe(s); });\n        if (Array.isArray(x)) {\n            var emitter_1 = new Emitter(x);\n            return new Collection(function (s) { return emitter_1.subscribe(s); });\n        }\n        throw new Error(\"ObservableCollection.from() can only take arrays or observables\");\n    };\n    Collection.prototype.map = function (mapper) {\n        return this._map(function (items) { return items.map(function (item) { return mapper(item); }); });\n    };\n    Collection.prototype.flat = function () {\n        return this._map(function (items) { return [].concat.apply([], items); });\n    };\n    Collection.prototype.filter = function (filter) {\n        return this._map(function (items) { return items.filter(filter); });\n    };\n    Collection.prototype.concat = function (other) {\n        return Collection.from(this.toValue().combineLatest(other).map(function (_a) {\n            var me = _a[0], other = _a[1];\n            return me.concat(other);\n        }));\n    };\n    Collection.prototype.orderBy = function (prop) {\n        return this.toValue().map(function (array) { return array.slice().sort(function (a, b) {\n            var aProp = a && a[prop];\n            var bProp = b && b[prop];\n            return aProp > bProp ? 1 : aProp < bProp ? -1 : 0;\n        }); }).toCollection(function (x) { return x; });\n    };\n    Collection.prototype.toValue = function () {\n        var _this = this;\n        return new Value(function (s) { return _this.subscribe(s); });\n    };\n    Collection.prototype.groupBy = function (prop) {\n        return this.toValue().map(function (items) {\n            var rv = {};\n            items.forEach(function (item) {\n                var list = rv[item[prop]] || (rv[item[prop]] = []);\n                list.push(item);\n            });\n            return rv;\n        });\n    };\n    Collection.prototype.first = function () {\n        return this.toValue().map(function (arr) { return arr[0]; });\n    };\n    return Collection;\n}(Observable));\nexport { Collection };\nCollection.prototype._map = initMapMethod(Collection);\n//# sourceMappingURL=collection.js.map","import * as tslib_1 from \"tslib\";\nimport { Value } from \"./value\";\nvar Emitter = /** @class */ (function (_super) {\n    tslib_1.__extends(Emitter, _super);\n    function Emitter(initialValue) {\n        var _this = _super.call(this, function (observer) {\n            var subscription = {\n                unsubscribe: function () { return _this.subscribers = _this.subscribers.filter(function (_a) {\n                    var s = _a[0];\n                    return s !== observer;\n                }); },\n            };\n            _this.subscribers.push([observer, subscription]);\n            if (_this.error)\n                observer(null, _this.error, subscription);\n            else\n                observer(_this.value, undefined, subscription);\n            return subscription;\n        }) || this;\n        _this.subscribers = [];\n        _this.value = initialValue;\n        return _this;\n    }\n    Emitter.prototype.dispatch = function (value) {\n        this.value = value;\n        this.error = undefined;\n        this._dispatch();\n    };\n    Emitter.prototype.dispatchError = function (error) {\n        this.error = error;\n        this._dispatch();\n    };\n    Emitter.prototype._dispatch = function () {\n        var _this = this;\n        this.subscribers.forEach(function (_a) {\n            var observer = _a[0], subscription = _a[1];\n            try {\n                observer(_this.value, _this.error, subscription);\n            }\n            catch (err) {\n                observer(null, err, subscription);\n            }\n        });\n    };\n    return Emitter;\n}(Value));\nexport { Emitter };\n//# sourceMappingURL=emitter.js.map","var stack = [];\nvar currentFiber = null;\nvar providers = [function () { return currentFiber; }];\nfunction pushFiber(fiber) {\n    stack.push(currentFiber);\n    currentFiber = fiber;\n}\nfunction popFiber() {\n    currentFiber = stack.pop();\n}\nvar _FiberContext = {\n    get current() { return currentFiber; },\n    /*run: function rerun<R>(fiber: Fiber, fn: ()=>R): R | Promise<R> {\n      pushFiber(fiber);\n      try {\n        return Promise.resolve(fn());\n      } catch (p) {\n        if (p && typeof p.then === 'function') {\n          return p.then(()=>rerun(fiber, fn));\n        } else {\n          return Promise.reject(p);\n        }\n      } finally {\n        popFiber();\n      }\n    },*/\n    addProvider: function (getCurrentFiber) {\n        providers.push(getCurrentFiber);\n        setCurrentGetterFromProviders();\n    },\n    removeProvider: function (getCurrentFiber) {\n        providers = providers.filter(function (p) { return p !== getCurrentFiber; });\n        setCurrentGetterFromProviders();\n    }\n};\nfunction setCurrentGetterFromProviders() {\n    Object.defineProperty(_FiberContext, \"current\", {\n        get: providers.reduce(function (p, c) { return function () { return p() || c(); }; }),\n        set: function () { throw new Error(\"Use FiberContext.push() to change current fiber\"); }\n    });\n}\nvar _global = (typeof self === 'undefined' ? global : self);\nif (!_global[\"KEDFiberContext\"]) {\n    _global[\"KEDFiberContext\"] = _FiberContext;\n}\nexport var FiberContext = _global[\"KEDFiberContext\"];\n//# sourceMappingURL=fiber-context.js.map","export * from './observable';\nexport * from './value';\nexport * from './collection';\nexport * from './emitter';\nexport * from './fiber-context';\n//# sourceMappingURL=index.js.map","export function initMapMethod(ctor) {\n    return function (mapper) {\n        var _this = this;\n        return new ctor(function (observer) { return _this.subscribe(function (value, error, subscription) {\n            if (error)\n                observer(null, error, subscription);\n            else\n                try {\n                    observer(mapper(value), error, subscription);\n                }\n                catch (err) {\n                    observer(null, err, subscription);\n                }\n        }); });\n    };\n}\n//# sourceMappingURL=map.js.map","export function mixin(targetProto, mixinProto) {\n    var props = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        props[_i - 2] = arguments[_i];\n    }\n    props.forEach(function (prop) { return targetProto[prop] = mixinProto[prop]; });\n}\n//# sourceMappingURL=mixin.js.map","var Observable = /** @class */ (function () {\n    //static get [Symbol.species]() { return this; }\n    function Observable(_subscribe) {\n        this._subscribe = _subscribe;\n    }\n    Observable.prototype.subscribe = function (observer) {\n        try {\n            return this._subscribe(function (items, error, subscription) {\n                try {\n                    observer(items, error, subscription);\n                }\n                catch (err) {\n                    observer(null, err, subscription);\n                }\n            });\n        }\n        catch (error) {\n            observer(null, error, { unsubscribe: function () { } });\n        }\n    };\n    return Observable;\n}());\nexport { Observable };\n//# sourceMappingURL=observable.js.map","import * as tslib_1 from \"tslib\";\nimport { Observable } from \"./observable\";\nimport { initMapMethod } from \"./map\";\nimport { Collection } from \"./collection\";\nimport { FiberContext } from './fiber-context';\nvar Value = /** @class */ (function (_super) {\n    tslib_1.__extends(Value, _super);\n    function Value(subscribe) {\n        return _super.call(this, subscribe) || this;\n    }\n    Value.from = function (x) {\n        if (x.subscribe)\n            return new Value(function (s) { return x.subscribe(s); });\n        throw new Error(\"Value.from() can only take observables\");\n    };\n    Value.prototype.read = function () {\n        var resolved = false, result, err, notify;\n        var subscription = this.subscribe(function (value, error, subsciption) {\n            resolved = true;\n            result = value;\n            err = error;\n            if (error && notify)\n                notify(null, error, subsciption);\n            else if (notify)\n                notify(value, null, subsciption);\n        });\n        if (resolved) {\n            var currentFiber = FiberContext.current;\n            if (!currentFiber) {\n                subscription.unsubscribe();\n                throw new Error(\"Invalid Fiber Context\");\n            }\n            if (err) {\n                subscription.unsubscribe();\n                throw err;\n            }\n            var subscriptions = currentFiber.subscriptions, observer = currentFiber.observer;\n            subscriptions.push(subscription);\n            notify = observer;\n            return result;\n        }\n        throw new Promise(function (resolve, reject) {\n            notify = function (value, error, subscription) {\n                subscription.unsubscribe();\n                if (error)\n                    reject(error);\n                else\n                    resolve(value);\n            };\n        });\n    };\n    Value.prototype.load = function () {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            _this.subscribe(function (value, error, subsciption) {\n                if (error)\n                    reject(error);\n                else\n                    resolve(value);\n                subsciption.unsubscribe();\n            });\n        });\n    };\n    Value.prototype.filter = function (fn) {\n        var _this = this;\n        return new Value(function (observer) { return _this.subscribe(function (value, error, subscription) {\n            if (error)\n                observer(null, error, subscription);\n            else if (fn(value))\n                observer(value, error, subscription);\n        }); });\n    };\n    Value.prototype.log = function (prefix) {\n        return this.map(function (x) {\n            console.log(prefix, x);\n            return x;\n        });\n    };\n    Value.prototype.toCollection = function (mapper) {\n        var _this = this;\n        return new Collection(function (s) { return _this.map(mapper).subscribe(s); });\n    };\n    Value.prototype.combineLatest = function (other) {\n        var _this = this;\n        return new Value(function (observer) {\n            var values = [null, null];\n            var mySubscription, otherSubscription;\n            var subscription = {\n                unsubscribe: function () {\n                    mySubscription.unsubscribe();\n                    otherSubscription.unsubscribe();\n                }\n            };\n            mySubscription = _this.subscribe(function (items, error, s) {\n                if (error) {\n                    s.unsubscribe();\n                    observer(null, error, subscription);\n                }\n                values[0] = items;\n                if (values[1] !== null)\n                    observer(values, null, subscription);\n            });\n            otherSubscription = other.subscribe(function (value, error, s) {\n                if (error) {\n                    s.unsubscribe();\n                    observer(null, error, subscription);\n                }\n                values[1] = value;\n                if (values[0] !== null)\n                    observer(values, null, subscription);\n            });\n            return subscription;\n        });\n    };\n    Value.prototype.switchMap = function (mapper) {\n        var _this = this;\n        return new Value(function (observer) {\n            var mappedSubscription = null;\n            var subscription = null;\n            var returnedSubscription = {\n                unsubscribe: function () {\n                    subscription.unsubscribe();\n                    if (mappedSubscription) {\n                        mappedSubscription.unsubscribe();\n                        mappedSubscription = null;\n                    }\n                }\n            };\n            subscription = _this.subscribe(function (item, error, s) {\n                subscription = s;\n                if (mappedSubscription) {\n                    mappedSubscription.unsubscribe();\n                    mappedSubscription = null;\n                }\n                if (error)\n                    observer(null, error, returnedSubscription);\n                else {\n                    try {\n                        var observableOrValue = mapper(item);\n                        if (observableOrValue && typeof observableOrValue.subscribe === 'function') {\n                            mappedSubscription = observableOrValue.subscribe(function (value, error, s) {\n                                mappedSubscription = s;\n                                observer(value, error, returnedSubscription);\n                            });\n                        }\n                        else {\n                            observer(observableOrValue, null, subscription);\n                        }\n                    }\n                    catch (error) {\n                        observer(null, error, subscription);\n                    }\n                }\n            });\n            return returnedSubscription;\n        });\n    };\n    return Value;\n}(Observable));\nexport { Value };\nValue.prototype.map = initMapMethod(Value);\n//# sourceMappingURL=value.js.map","export * from './js/dist/js/observable';\n","export * from './js/dist/js/ked-backend-repo';\n","export default function getUserClaims(user) {\n    return [{\n            type: \"email\",\n            value: user.mail\n        }, {\n            type: \"school\",\n            value: user.school\n        }].concat(user.roles.map(function (role) { return ({\n        type: \"role\",\n        value: role\n    }); })).concat(user.roles.map(function (role) { return ({\n        type: \"schoolRole\",\n        value: user.school + \"/\" + role\n    }); }));\n}\n","import * as tslib_1 from \"tslib\";\nimport { DocumentAccess, hasAccess as _hasAccess } from 'kedbackend/client';\nimport getUserClaims from './get-user-claims';\nimport { parseQueryString, generateQueryString } from \"../utils/query-string\";\nexport { getUserClaims };\nexport var IMPERSONATION_QUERY_PARAMS = [\n    \"user\",\n    \"role\",\n    \"school\",\n    \"debug\",\n    \"testVersion\",\n    \"testversion\",\n    \"features\",\n    \"schoolGrade\",\n    \"schoolgrade\",\n    \"schoolType\",\n    \"schooltype\"\n];\nexport function hasAccess(user, doc, requestedRight) {\n    var claims = getUserClaims(user);\n    if (requestedRight !== 'R' && user.tutorFor) {\n        claims = claims.filter(function (claim) { return claim.type !== 'email'; });\n    }\n    var result = _hasAccess(DocumentAccess.fromStringArray(doc.acl || []), claims, requestedRight);\n    //console.log(`Has ${requestedRight} access to ${doc.name}/${doc.id}: ${result}`);\n    return result;\n}\nexport function hasReadAccess(user, doc) {\n    return hasAccess(user, doc, 'R');\n}\nexport function hasWriteAccess(user, doc) {\n    return hasAccess(user, doc, 'W');\n}\nexport function hasShareAccess(user, doc) {\n    return hasAccess(user, doc, 'S');\n}\nexport function isTeacherAtSchool(user, school) {\n    var isTeacher = user.roles.some(function (role) { return role === 'EMPLOYEE' || role === 'ADMIN'; });\n    var belongsToSchool = (school || \"\").toLowerCase() === user.school.toLowerCase();\n    return (isTeacher && belongsToSchool);\n}\nexport function isAdminOrTeacherAtSchool(user, school) {\n    return user.roles.includes(\"ADMIN\") || isTeacherAtSchool(user, school);\n}\nexport var impersonationEnv = {\n    actAs: function (options) {\n        var role = options.role, school = options.school, url = options.url;\n        var currentQuery = parseQueryString(location.search);\n        var newQuery = tslib_1.__assign({}, currentQuery, { role: role, school: school });\n        var newQueryString = generateQueryString(newQuery);\n        if (url) {\n            location.href = \"\" + url + newQueryString;\n        }\n        else {\n            location.hash = \"#\";\n            location.search = newQueryString;\n        }\n    }\n};\nexport function actAs(options) {\n    impersonationEnv.actAs(options);\n}\nexport function preserveImpersonationQuery(url, query) {\n    var e_1, _a;\n    var currentQuery = parseQueryString(location.search);\n    var preservedQuery = {};\n    try {\n        for (var IMPERSONATION_QUERY_PARAMS_1 = tslib_1.__values(IMPERSONATION_QUERY_PARAMS), IMPERSONATION_QUERY_PARAMS_1_1 = IMPERSONATION_QUERY_PARAMS_1.next(); !IMPERSONATION_QUERY_PARAMS_1_1.done; IMPERSONATION_QUERY_PARAMS_1_1 = IMPERSONATION_QUERY_PARAMS_1.next()) {\n            var param = IMPERSONATION_QUERY_PARAMS_1_1.value;\n            if (currentQuery[param])\n                preservedQuery[param] = currentQuery[param];\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (IMPERSONATION_QUERY_PARAMS_1_1 && !IMPERSONATION_QUERY_PARAMS_1_1.done && (_a = IMPERSONATION_QUERY_PARAMS_1.return)) _a.call(IMPERSONATION_QUERY_PARAMS_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    var newQueryString = generateQueryString(tslib_1.__assign({}, preservedQuery, query));\n    var pHash = url.indexOf('#');\n    return pHash >= 0 ?\n        \"\" + url.substr(0, pHash) + newQueryString + url.substr(pHash) :\n        \"\" + url + newQueryString;\n}\n","import React from \"react\";\nexport var Button = function (_a) {\n    var label = _a.label, addClass = _a.addClass, faIcon = _a.faIcon, action = _a.action, url = _a.url;\n    var className = addClass ? \"btn \" + addClass : 'btn';\n    if (!!url && !action)\n        return React.createElement(\"a\", { className: className, href: url, target: \"_blank\" },\n            faIcon && React.createElement(\"i\", { className: faIcon }),\n            \" \",\n            label);\n    return React.createElement(\"a\", { className: className, onClick: action },\n        faIcon && React.createElement(\"i\", { className: faIcon }),\n        \" \",\n        label);\n};\nexport var DriveButton = function (_a) {\n    var _b = _a.label, label = _b === void 0 ? 'Google Drive' : _b, action = _a.action;\n    return React.createElement(Button, { label: label, faIcon: \"fab fa-google-drive\", action: action });\n};\n","import * as tslib_1 from \"tslib\";\nimport { RestClient } from 'kedbackend/client';\nimport { HttpError } from 'kedbackend/client';\nimport { getTermStarEndDate } from '../utils/school-moment';\nimport { SchoolTerm } from '../utils/school-term';\nimport { dateTimeReviver, L } from '../utils/utils';\nimport mockJsonFile from './mock/mock-eds-data.json';\nimport moment from 'moment';\nimport { makeSuspenseApi } from '../utils/make-suspense-api';\nvar EdsClient = /** @class */ (function () {\n    function EdsClient(isomorphic, baseUrl, bearerProvider, userEmailGetter) {\n        var _this = this;\n        this.http = new RestClient(isomorphic, baseUrl, { bearerProvider: bearerProvider });\n        this.userEmailGetter = userEmailGetter;\n        var isApiMethod = function (m) {\n            return typeof _this[m] === 'function' &&\n                m !== 'constructor' && // Since makeSuspenseApi() walks prototype chain\n                m !== 'privatizingCacheBust' &&\n                m !== 'userEmailGetter';\n        } // List non-API methods here...\n        ;\n        Object.keys(EdsClient.prototype).forEach(function (method) {\n            if (isApiMethod(method)) {\n                _this[method] = avoidSimultanousCalls(_this[method]);\n            }\n        });\n        this.suspense = makeSuspenseApi(this, { isApiMethod: isApiMethod });\n    }\n    EdsClient.prototype.privatizingCacheBust = function () {\n        return { user: this.userEmailGetter() };\n    };\n    /**\n       * Retrieve active courses for current logged in student.\n       *\n       * @param courseCode Short-name of the course. Optional.\n       */\n    EdsClient.prototype.getActiveCourses = function (q) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var query, res, _a, _b, json, ex_1;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _c.trys.push([0, 5, , 6]);\n                        query = this.privatizingCacheBust();\n                        if (q) {\n                            if (q.courseCode)\n                                query.CourseCode = q.courseCode;\n                            if (q.periodName)\n                                query.PeriodName = q.periodName;\n                        }\n                        return [4 /*yield*/, this.http.get(\"studentactivecourses\", query)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.courses];\n                    case 5:\n                        ex_1 = _c.sent();\n                        console.error(\"Error from EDS: \" + ex_1);\n                        throw new Error(L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"Kunde tyv\\u00E4rr inte ladda terminsm\\u00E5l eller avklarade steg fr\\u00E5n EDS. F\\u00F6rs\\u00F6k igen senare...\"], [\"Kunde tyv\\u00E4rr inte ladda terminsm\\u00E5l eller avklarade steg fr\\u00E5n EDS. F\\u00F6rs\\u00F6k igen senare...\"]))));\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Retrieve latest assessments for current logged in user.\n     *\n     * @param limit Optional limit\n     */\n    EdsClient.prototype.getLatestAssessments = function (limit) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var query, res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        query = this.privatizingCacheBust();\n                        if (!isNaN(limit))\n                            query.Count = limit;\n                        return [4 /*yield*/, this.http.get(\"studentassessments\", query)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.assessments];\n                }\n            });\n        });\n    };\n    /**\n     * Retrieve studyplans for current logged-in user\n     */\n    EdsClient.prototype.getStudentGoals = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"studentgoals\", this.privatizingCacheBust())];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.studentGoals];\n                }\n            });\n        });\n    };\n    EdsClient.prototype.getStudentFutureAbilities = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"studentFutureAbilities\", this.privatizingCacheBust())];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.studentFutureAbilities];\n                }\n            });\n        });\n    };\n    EdsClient.prototype.getTeacherTutorStudents = function () {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"teachertutorstudents\", this.privatizingCacheBust())];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.students];\n                }\n            });\n        });\n    };\n    /**\n     * getSchoolTuitionGroups()\n     *\n     * Return tuitiongroups for school\n     *\n     * @param schoolName - name of school\n     * @param courseCode - Skolverkets code for course\n     */\n    EdsClient.prototype.getSchoolTuitionGroups = function (q) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"SchoolTuitionGroups\", tslib_1.__assign({}, this.privatizingCacheBust(), q))];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.schoolTuitionGroups];\n                }\n            });\n        });\n    };\n    /**\n     * getTuitionGroupStudents()\n     *\n     * Return name and mailadresses for tutitiongroups in schools\n     *\n     * @param schoolName - name of school\n     * @param tuitionGroupName - tuition gruop name in EDS\n     */\n    EdsClient.prototype.getTuitionGroupStudents = function (q) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"TuitionGroupStudents\", tslib_1.__assign({}, this.privatizingCacheBust(), q))];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.tuitionGroupStudents];\n                }\n            });\n        });\n    };\n    /**\n     * getSchoolTeachers()\n     *\n     * Return name and mailadresses for tutitiongroups in schools\n     *\n     * @param schoolName - name of school\n     */\n    EdsClient.prototype.getSchoolTeachers = function (q) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var res, _a, _b, json;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.http.get(\"SchoolTeachers\", tslib_1.__assign({}, this.privatizingCacheBust(), q))];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3: return [4 /*yield*/, res.json()];\n                    case 4:\n                        json = _c.sent();\n                        return [2 /*return*/, json.schoolTeachers];\n                }\n            });\n        });\n    };\n    // we assume that the EDS will return the current academic year dates determined by the current date\n    EdsClient.prototype.getAcademicYearTerms = function (schoolLocale, date) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var holidays, firstTermMoment, secondTermMoment, startFirstTermDate, startSecondTermDate, endFirstTermDate, endSecondTermDate, firstTerm, secondTerm;\n            return tslib_1.__generator(this, function (_a) {\n                // mock data\n                switch (schoolLocale) {\n                    case 'en_sin':\n                        return [2 /*return*/, mockJsonFile.SouthIndia.filter(function (f) { return moment(date).isSameOrAfter(f.firstTerm.startDate) && moment(date).isSameOrBefore(f.secondTerm.endDate); })[0]];\n                    case 'en_nin':\n                        return [2 /*return*/, mockJsonFile.NorthIndia.filter(function (f) { return moment(date).isSameOrAfter(f.firstTerm.startDate) && moment(date).isSameOrBefore(f.secondTerm.endDate); })[0]];\n                    case 'sv':\n                        {\n                            holidays = [];\n                            firstTermMoment = getTermStarEndDate(date, true);\n                            secondTermMoment = getTermStarEndDate(date, false);\n                            startFirstTermDate = firstTermMoment[0];\n                            startSecondTermDate = secondTermMoment[0];\n                            endFirstTermDate = firstTermMoment[1];\n                            endSecondTermDate = secondTermMoment[1];\n                            firstTerm = { startDate: new Date(startFirstTermDate.year(), startFirstTermDate.month(), startFirstTermDate.date()).toDateString(), endDate: new Date(startFirstTermDate.year(), endFirstTermDate.month(), endFirstTermDate.date()).toDateString() };\n                            secondTerm = { startDate: new Date(startSecondTermDate.year(), startSecondTermDate.month(), startSecondTermDate.date()).toDateString(), endDate: new Date(startSecondTermDate.year(), endSecondTermDate.month(), endSecondTermDate.date()).toDateString() };\n                            return [2 /*return*/, { firstTerm: firstTerm, secondTerm: secondTerm, holidays: holidays }];\n                        }\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    return EdsClient;\n}());\nexport { EdsClient };\nvar EDSPeriod = /** @class */ (function () {\n    function EDSPeriod(periodStringOrSchoolTerm) {\n        if (typeof periodStringOrSchoolTerm === 'string') {\n            this.period = periodStringOrSchoolTerm;\n            this.term = this.period.startsWith('HT') ? 'AT' : 'ST';\n            this.year = parseInt(this.period.substr(2));\n            if (isNaN(this.year))\n                throw new Error(\"Invalid period: \" + this.period);\n        }\n        else {\n            var schoolTerm = new SchoolTerm(periodStringOrSchoolTerm);\n            this.period = (schoolTerm.term === 'AT' ? \"HT\" : \"VT\") + schoolTerm.year;\n            this.term = schoolTerm.term;\n            this.year = schoolTerm.year;\n        }\n    }\n    Object.defineProperty(EDSPeriod.prototype, \"schoolTerm\", {\n        get: function () {\n            return new SchoolTerm({\n                academicYear: this.term === 'AT' ?\n                    this.year + \"/\" + (this.year + 1) :\n                    this.year - 1 + \"/\" + this.year,\n                term: this.term\n            });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    EDSPeriod.prototype.toString = function () {\n        return this.period;\n    };\n    EDSPeriod.prototype.valueOf = function () {\n        return this.year + \":\" + (this.term === 'ST' ? \"1\" : \"2\");\n    };\n    return EDSPeriod;\n}());\nexport { EDSPeriod };\nexport function parseJsonDate_old(jsonDateStr) {\n    var date = dateTimeReviver(\"\", jsonDateStr);\n    if (!(date instanceof Date))\n        throw new Error(\"Invalid JSON date string: \" + jsonDateStr);\n    return date;\n}\nfunction avoidSimultanousCalls(method) {\n    var ongoingPromises = {};\n    return function () {\n        var argsJson = JSON.stringify([].slice.call(arguments));\n        if (!ongoingPromises[argsJson]) {\n            ongoingPromises[argsJson] = method.apply(this, arguments).then(function (result) {\n                delete ongoingPromises[argsJson];\n                return result;\n            });\n        }\n        return ongoingPromises[argsJson];\n    };\n}\nvar templateObject_1;\n","import * as tslib_1 from \"tslib\";\nvar createStudents = function (group, n, m) {\n    var students = [];\n    for (var i = n; i <= m; i++) {\n        students.push({\n            schoolName: 'KED',\n            tuitionGroupName: group,\n            studentFirstName: 'Student ' + i,\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student' + i + '.classroom@kedschools.com'\n        });\n    }\n    return students;\n};\nexport var mockTeachers = [\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Teacher 1',\n        teacherLastName: 'Classroom',\n        teacherEmailAddress: 'teacher1.classroom@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Teacher 2',\n        teacherLastName: 'Classroom',\n        teacherEmailAddress: 'teacher2.classroom@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Teacher 3',\n        teacherLastName: 'Classroom',\n        teacherEmailAddress: 'teacher3.classroom@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Carl',\n        teacherLastName: 'Holmberg',\n        teacherEmailAddress: 'carl@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'David',\n        teacherLastName: 'Fahlander',\n        teacherEmailAddress: 'david.fahlander@kedschools.com'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Andrei',\n        teacherLastName: 'Spatarelu',\n        teacherEmailAddress: 'andrei.spatarelu@vemendo.se'\n    },\n    {\n        schoolName: 'KED',\n        teacherFirstName: 'Andrei',\n        teacherLastName: 'Spatarelu',\n        teacherEmailAddress: 'andrei@kedschools.com'\n    }\n];\nexport var mockTuitionGroups = {\n    'DJUSÄL01': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR1 (180816-190614)',\n            courseCode: 'DJUSÄL01'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR2 (180816-190614)',\n            courseCode: 'DJUSÄL01'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            courseCode: 'DJUSÄL01'\n        }\n    ],\n    'DJUDJI0': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\n            courseCode: 'DJUDJI0'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\n            courseCode: 'DJUDJI0'\n        },\n    ],\n    'KEMKEM01': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            courseCode: 'KEMKEM01'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\n            courseCode: 'KEMKEM01'\n        }\n    ],\n    \"MATMAT03b\": [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'MAT3b_Gr1 (180816-190614)',\n            courseCode: 'MATMAT03b'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'MAT3b_Gr2 (180816-190614)',\n            courseCode: 'MATMAT03b'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'MAT3b_Gr3 (180816-190614)',\n            courseCode: 'MATMAT03b'\n        }\n    ],\n    'BIOBIO01': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            courseCode: 'BIOBIO01'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\n            courseCode: 'BIOBIO01'\n        }\n    ],\n    'SVESVE03': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr1 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr2 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr3 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr4 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr5 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr6 (180816-190614)',\n            courseCode: 'SVESVE03'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'SVE3_Gr7 (180816-190614)',\n            courseCode: 'SVESVE03'\n        }\n    ]\n};\nexport var mockTuitionStudents = {\n    'DJUR1_GR1 (180816-190614)': createStudents('DJUR1_GR1 (180816-190614)', 1, 12),\n    'DJUR1_GR2 (180816-190614)': createStudents('DJUR1_GR2 (180816-190614)', 13, 24),\n    'DJUR1_GR3 (180816-190614)': tslib_1.__spread([\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            studentFirstName: 'Student2',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student2.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            studentFirstName: 'Carl',\n            studentLastName: 'Holmberg',\n            studentEmailAddress: 'carl@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            studentFirstName: 'Andrei',\n            studentLastName: 'Spatarelu',\n            studentEmailAddress: 'andrei.spatarelu@vemendo.se'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\n            studentFirstName: 'Student3',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student3.classroom@kedschools.com'\n        }\n    ], createStudents('DJUR1_GR3 (180816-190614)', 23, 34)),\n    'DJUDJ_Gr1 (180816-190614)': tslib_1.__spread([\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\n            studentFirstName: 'Carl',\n            studentLastName: 'Holmberg',\n            studentEmailAddress: 'carl@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\n            studentFirstName: 'Andrei',\n            studentLastName: 'Spatarelu',\n            studentEmailAddress: 'andrei.spatarelu@vemendo.se'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\n            studentFirstName: 'David',\n            studentLastName: 'Fahlander',\n            studentEmailAddress: 'david.fahlander@kedschools.com'\n        }\n    ], createStudents('DJUDJ_Gr1 (180816-190614)', 151, 160)),\n    'DJUDJ_Gr2 (180816-190614)': tslib_1.__spread([\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\n            studentFirstName: 'Carl',\n            studentLastName: 'Holmberg',\n            studentEmailAddress: 'carl@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\n            studentFirstName: 'Andrei',\n            studentLastName: 'Spatarelu',\n            studentEmailAddress: 'andrei.spatarelu@vemendo.se'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\n            studentFirstName: 'David',\n            studentLastName: 'Fahlander',\n            studentEmailAddress: 'david.fahlander@kedschools.com'\n        }\n    ], createStudents('DJUDJ_Gr2 (180816-190614)', 161, 165)),\n    'MAT3b_Gr1 (180816-190614)': createStudents('MAT3b_Gr1 (180816-190614)', 3, 23),\n    'MAT3b_Gr3 (180816-190614)': createStudents('MAT3b_Gr3 (180816-190614)', 24, 49),\n    'MAT3b_Gr2 (180816-190614)': tslib_1.__spread([\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'MAT3b_Gr2 (180816-190614)',\n            studentFirstName: 'Andrei',\n            studentLastName: 'Spatarelu',\n            studentEmailAddress: 'andrei@kedschools.com'\n        }\n    ], createStudents('MAT3b_Gr2 (180816-190614)', 50, 72)),\n    'IDR1_Gr1 (180816-190614)': createStudents('IDR1_Gr1 (180816-190614)', 1, 12),\n    'IDR1_Gr2 (180816-190614)': createStudents('IDR1_Gr2 (180816-190614)', 13, 22),\n    'IDR1_Gr3 (180816-190614)': createStudents('IDR1_Gr3 (180816-190614)', 23, 34),\n    'KEM1_Gr1 (180816-190614)': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 2',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student2.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 3',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student3.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 8',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student8.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 9',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student9.classroom@kedschools.com'\n        }\n    ],\n    'KEM1_Gr2 (180816-190614)': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 1',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student1.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 5',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student5.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 6',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student6.classroom@kedschools.com'\n        }\n    ],\n    'BIO1_Gr1 (180816-190614)': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 1',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student1.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 4',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student4.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 6',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student6.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\n            studentFirstName: 'Student 10',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student10.classroom@kedschools.com'\n        }\n    ],\n    'BIO1_Gr2 (180816-190614)': [\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 2',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student2.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 7',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student7.classroom@kedschools.com'\n        },\n        {\n            schoolName: 'KED',\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\n            studentFirstName: 'Student 8',\n            studentLastName: 'Classroom',\n            studentEmailAddress: 'student8.classroom@kedschools.com'\n        },\n    ],\n    'SVE3_Gr1 (180816-190614)': createStudents('SVE3_Gr1 (180816-190614)', 1, 21),\n    'SVE3_Gr2 (180816-190614)': createStudents('SVE3_Gr2 (180816-190614)', 22, 44),\n    'SVE3_Gr3 (180816-190614)': createStudents('SVE3_Gr3 (180816-190614)', 45, 61),\n    'SVE3_Gr4 (180816-190614)': createStudents('SVE3_Gr4 (180816-190614)', 62, 78),\n    'SVE3_Gr5 (180816-190614)': createStudents('SVE3_Gr5 (180816-190614)', 83, 107),\n    'SVE3_Gr6 (180816-190614)': createStudents('SVE3_Gr6 (180816-190614)', 108, 124),\n    'SVE3_Gr7 (180816-190614)': createStudents('SVE3_Gr7 (180816-190614)', 125, 150)\n};\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nvar GoalProgress = /** @class */ (function (_super) {\n    tslib_1.__extends(GoalProgress, _super);\n    function GoalProgress() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.createProgress = function () {\n            var _a = _this.props, numberOfTasks = _a.numberOfTasks, completedNumberOfTasks = _a.completedNumberOfTasks, maximumTasksDisplayed = _a.maximumTasksDisplayed, backgroundColor = _a.backgroundColor, progressColor = _a.progressColor;\n            var progress = [];\n            if (numberOfTasks > maximumTasksDisplayed) {\n                return React.createElement(\"div\", { className: \"progress-overview\" },\n                    \" \",\n                    completedNumberOfTasks,\n                    \" / \",\n                    numberOfTasks,\n                    \" \");\n            }\n            for (var taskNo = 1; taskNo <= numberOfTasks; taskNo++) {\n                progress.push(React.createElement(\"svg\", { key: taskNo },\n                    React.createElement(\"circle\", { className: \"circle-chart-background\", fill: taskNo > completedNumberOfTasks ? backgroundColor : progressColor, cx: \"8\", cy: \"8\", r: \"8\" })));\n            }\n            return progress;\n        };\n        return _this;\n    }\n    GoalProgress.prototype.render = function () {\n        return React.createElement(\"div\", { className: \"goals-progress\" }, this.createProgress());\n    };\n    GoalProgress.defaultProps = {\n        numberofTasks: 0,\n        completedNumberOfTasks: 0,\n        maximumTasksDisplayed: 10,\n        backgroundColor: \"lightgrey\",\n        progressColor: \"#3dbca2\",\n    };\n    return GoalProgress;\n}(React.Component));\nexport { GoalProgress };\n","import * as React from 'react';\nexport var TwoColumnsPage = function (_a) {\n    var left = _a.left, right = _a.right, rightWidth = _a.rightWidth;\n    return (React.createElement(\"div\", { className: \"sv-row sv-layout\" },\n        React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\n            React.createElement(\"div\", { className: \"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\" },\n                React.createElement(\"div\", { className: \"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\" },\n                    React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\n                        React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-\" + (12 - rightWidth) }, left),\n                        React.createElement(\"div\", { className: \"sv-layout sv-column-\" + rightWidth }, right)))))));\n};\n","import * as React from 'react';\nexport var EllipsisLoader = function () {\n    return React.createElement(\"img\", { style: { border: 0, margin: 0, padding: 0 }, className: \"ellipsis-loader\" });\n};\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { L } from \"../../../utils/utils\";\n;\nexport var RemoveItem = function (_a) {\n    var onClick = _a.onClick, className = _a.className, style = _a.style, title = _a.title;\n    return React.createElement(\"div\", { title: title || L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"Radera\"], [\"Radera\"]))), className: \"removeItem \" + (className || \"\"), onClick: onClick, style: style });\n};\nvar templateObject_1;\n","import * as React from 'react';\nexport var Spinner = function (_a) {\n    var _b = _a.label, label = _b === void 0 ? \"\" : _b;\n    return React.createElement(\"span\", null,\n        React.createElement(\"i\", { className: \"fa fa-spinner fa-spin\", \"aria-hidden\": \"true\" }),\n        \"\\u00A0\",\n        label);\n};\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { HttpError } from 'kedbackend/client';\nimport { env } from '../../../globals/KED.env';\nimport download from 'downloadjs';\nimport { Spinner } from '../../course-builder/sub-components/spinner';\nimport { getUrkundHoverText, getUrkundStatusClass, getUrkundSignificanceClass } from './urkund-utils';\nexport function getUrkundStatus(file, refreshAssignment, checkWithUrkund) {\n    var metadata = file.metadata;\n    var urkundResponses;\n    try {\n        urkundResponses = metadata.urkundResponse && JSON.parse(metadata.urkundResponse);\n    }\n    catch (err) {\n        urkundResponses = null;\n    }\n    var urkundResponse = urkundResponses && urkundResponses[0];\n    if (!urkundResponse && file.metadata.urkundUploadError) {\n        urkundResponse = {\n            Status: {\n                ErrorCode: -1,\n                Message: file.metadata.urkundUploadError,\n                State: 'Error'\n            },\n            ExternalId: file.metadata.urkundExternalId\n        };\n    }\n    if (file.isRefreshing)\n        return React.createElement(\"td\", { colSpan: 2 },\n            React.createElement(Spinner, null),\n            \" Uppdaterar...\");\n    return urkundResponse ? React.createElement(React.Fragment, null,\n        React.createElement(\"td\", { className: \"urkund-status-col\" },\n            React.createElement(\"a\", { href: urkundResponse.Report && urkundResponse.Report.ReportUrl, onClick: function (ev) {\n                    if (['Accepted', 'Submitted'].indexOf(urkundResponse.Status.State) === -1)\n                        return; // Follow HREF instead.\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                    checkWithUrkund && refreshAssignment(file);\n                }, target: \"_blank\", title: getUrkundHoverText(urkundResponse) },\n                React.createElement(\"div\", { className: getUrkundStatusClass(urkundResponse) }))),\n        React.createElement(\"td\", { className: \"urkund-status-col\" },\n            React.createElement(\"div\", { className: getUrkundSignificanceClass(urkundResponse) }, urkundResponse.Report && typeof urkundResponse.Report.Significance === 'number' ?\n                urkundResponse.Report.Significance.toFixed() + \"%\" : ' '))) : React.createElement(\"td\", { colSpan: 2 });\n}\nexport function update(assignments, assignment) {\n    var retval = tslib_1.__spread([\n        assignment\n    ], assignments.filter(function (_a) {\n        var user = _a.user, filename = _a.filename;\n        return user !== assignment.user ||\n            filename !== assignment.filename;\n    }));\n    return retval;\n}\nexport function downloadFile(file) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n        var res, _a, _b, blob, err_1;\n        return tslib_1.__generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    _c.trys.push([0, 5, , 6]);\n                    return [4 /*yield*/, env.kedBackendClient.http.fetch(file.mediaLink, 'get', {})];\n                case 1:\n                    res = _c.sent();\n                    if (!(res.status >= 400)) return [3 /*break*/, 3];\n                    _a = HttpError.bind;\n                    _b = [void 0, res.status];\n                    return [4 /*yield*/, res.text()];\n                case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                case 3: return [4 /*yield*/, res.blob()];\n                case 4:\n                    blob = _c.sent();\n                    download(blob, file.filename, file.contentType);\n                    return [3 /*break*/, 6];\n                case 5:\n                    err_1 = _c.sent();\n                    this.setState({ error: \"Kunde inte ladda ned filen. \" + (err_1.message || err_1) });\n                    console.error(err_1);\n                    return [3 /*break*/, 6];\n                case 6: return [2 /*return*/];\n            }\n        });\n    });\n}\nexport function DriveFileListing(_a) {\n    var file = _a.file;\n    var _b = file.metadata, driveFileIconUrl = _b.driveFileIconUrl, driveFileUrl = _b.driveFileUrl;\n    var filename = file.filename.substr(0, file.filename.lastIndexOf('.'));\n    return (React.createElement(\"div\", { className: \"align-horizontal spaced\" },\n        React.createElement(\"div\", { className: \"horizontalItem top\" },\n            React.createElement(\"img\", { className: \"file-icon\", src: driveFileIconUrl })),\n        React.createElement(\"div\", { className: \"horizontalItem top\" },\n            React.createElement(\"span\", null,\n                React.createElement(\"a\", { target: \"_blank\", href: driveFileUrl }, filename)))));\n}\n","export function getUrkundStatusClass(res) {\n    if (!res || !res.Status) {\n        return null;\n    }\n    else\n        switch (res.Status.State) {\n            case 'Error':\n                return \"urkund-status urkund-status-error\";\n            case 'Submitted':\n                return \"urkund-status urkund-status-submitted\";\n            case 'Accepted':\n                return \"urkund-status urkund-status-accepted\";\n            case 'Analyzed':\n                return \"urkund-status urkund-status-analyzed\";\n        }\n}\nexport function getUrkundHoverText(res) {\n    if (!res || !res.Status)\n        return null;\n    switch (res.Status.State) {\n        case 'Error':\n            return res.ExternalId ?\n                \"Kunde inte tas emot av urkund. Felkod: \" + res.Status.ErrorCode + \"\\n\" +\n                    (\"External ID: \" + res.ExternalId + \"\\nFelmeddelande: \" + res.Status.Message)\n                :\n                    res.Status.Message;\n        case 'Submitted':\n            return \"Filen \\u00E4r uppladdad till Urkund. Klicka f\\u00F6r att uppdatera status.\";\n        case 'Accepted':\n            return \"Filen analyseras fortfarande av Urkund. Klicka f\\u00F6r att uppdatera status.\";\n        case 'Analyzed':\n            return \"Rapport skapad. Klicka f\\u00F6r att \\u00F6ppna rapporten i nytt f\\u00F6nster\";\n    }\n}\nexport function getUrkundSignificanceClass(res) {\n    if (!res || !res.Status)\n        return '';\n    switch (res.Status.State) {\n        case 'Error': return 'urkund-significance-error';\n        case 'Submitted': return 'urkund-significance-submitted';\n        case 'Accepted': return 'urkund-significance-accepted';\n    }\n    var report = res.Report;\n    if (!report) {\n        return \"\";\n    }\n    if (report.Significance < 1)\n        //return `${cdn}/images/urkund/0.gif`;\n        return \"urkund-significance urkund-significance-0\";\n    if (report.Significance < 10)\n        //return `${cdn}/images/urkund/1.gif`;\n        return \"urkund-significance urkund-significance-1\";\n    if (report.Significance < 25)\n        return \"urkund-significance urkund-significance-2\";\n    //return `${cdn}/images/urkund/2.gif`;\n    if (report.Significance < 40)\n        return \"urkund-significance urkund-significance-3\";\n    //return `${cdn}/images/urkund/3.gif`;\n    if (report.Significance < 55)\n        return \"urkund-significance urkund-significance-4\";\n    //return `${cdn}/images/urkund/4.gif`;\n    if (report.Significance < 70)\n        return \"urkund-significance urkund-significance-5\";\n    //return `${cdn}/images/urkund/5.gif`;\n    if (report.Significance < 85)\n        return \"urkund-significance urkund-significance-6\";\n    //return `${cdn}/images/urkund/6.gif`;\n    if (report.Significance < 99.9)\n        return \"urkund-significance urkund-significance-7\";\n    //return `${cdn}/images/urkund/7.gif`;\n    if (report.Significance >= 99.9)\n        return \"urkund-significance urkund-significance-8\";\n    //return `${cdn}/images/urkund/8.gif`;\n    return \"\";\n}\n","import * as tslib_1 from \"tslib\";\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\nimport * as React from 'react';\nimport { CourseTask } from './course-task';\nimport { useContext } from 'react';\nimport { compareProps } from '../../../utils/utils';\nimport { mockTuitionStudents } from '../../../apis/mock/mock-classroom-data';\nimport { LanguageContext } from '../../utility-components/LanguageContext';\nimport { NotificationIcon } from '../shared/notification-icon';\nimport { StateContext } from '../digest-view';\nimport { AssignmentsContext } from '.';\nexport var CourseModuleView = (function (_a) {\n    var module = _a.module, tasks = _a.tasks;\n    var intl = useContext(LanguageContext).intl;\n    var _b = useContext(StateContext), notificationdigests = _b.notificationdigests, selectedCourse = _b.selectedCourse;\n    var filterStudyGroups = useContext(AssignmentsContext).filterStudyGroups;\n    var getNotSubmittedUsers = function (taskAssignments) {\n        var taskNotSubmittedUsers = [];\n        // get students from the course study groups who have't uploaded their assignments\n        var studyGroups = filterStudyGroups.length > 0 ? selectedCourse.studyGroups.filter(function (sg) { return filterStudyGroups.includes(sg); }) : selectedCourse.studyGroups;\n        studyGroups.forEach(function (group) {\n            var users = mockTuitionStudents[group] && mockTuitionStudents[group]\n                .filter(function (cs) { return (!taskAssignments || !taskAssignments.find(function (f) { return f.user === cs.studentEmailAddress; })) && !taskNotSubmittedUsers.find(function (u) { return u.email === cs.studentEmailAddress; }); })\n                .map(function (ns) { return { displayName: ns.studentFirstName + \" \" + ns.studentLastName, firstName: ns.studentFirstName, lastName: ns.studentLastName, email: ns.studentEmailAddress }; });\n            if (users) {\n                taskNotSubmittedUsers.push.apply(taskNotSubmittedUsers, tslib_1.__spread(users));\n            }\n        });\n        //sort by lastname - firstname\n        return taskNotSubmittedUsers.map(function (s) {\n            var _a = tslib_1.__read(s.displayName.split(' ')), firstName = _a[0], rest = _a.slice(1);\n            return tslib_1.__assign({}, s, { firstName: firstName, lastName: rest.join(' ') });\n        }).sort(compareProps([\"lastName\", \"firstName\"]));\n    };\n    var courseNotifications = notificationdigests[selectedCourse.id];\n    return tasks && tasks.length > 0 &&\n        React.createElement(React.Fragment, null,\n            React.createElement(OpenCloseBox, { title: React.createElement(\"div\", { className: \"notification-container\" },\n                    React.createElement(\"span\", null, module.name),\n                    React.createElement(NotificationIcon, { course: selectedCourse, entity: 'module', moduleId: module.id, notificationdigests: notificationdigests })), headerOpen: false }, courseNotifications && Object.keys(courseNotifications).length > 0 ? React.createElement(\"div\", null, tasks.map(function (task) {\n                var taskAssignments = courseNotifications[task.id] ? courseNotifications[task.id].map(function (t) { return t.assignment; }) : [];\n                var notSubmittedUsers = selectedCourse.studyGroups && selectedCourse.studyGroups.length > 0 && getNotSubmittedUsers(taskAssignments);\n                var displayTask = notSubmittedUsers && notSubmittedUsers.length > 0 || taskAssignments && taskAssignments.length > 0;\n                return displayTask &&\n                    React.createElement(CourseTask, { key: task.id, task: task, module: module, assignments: taskAssignments, notSubmittedUsers: notSubmittedUsers });\n            })) :\n                React.createElement(\"div\", null, intl.formatMessage({ id: \"teacherView.noUploadedAssignmentsForModule\", defaultMessage: \"No assignments have been uploaded for this module\" }))));\n});\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { useState, useContext } from 'react';\nimport { LanguageContext } from '../../utility-components/LanguageContext';\nimport { env } from '../../../globals/KED.env';\nimport { showError, showInfo } from '../../../utils/utils';\nimport { HttpError } from 'kedbackend/client';\nimport { StateContext } from '../digest-view';\nimport { Spinner } from '../../course-builder/sub-components/spinner';\nexport var CourseTaskNotHandedUserList = (function (_a) {\n    var notSubmittedUsers = _a.notSubmittedUsers, moduleName = _a.moduleName, taskName = _a.taskName, taskDeadline = _a.taskDeadline;\n    var intl = useContext(LanguageContext).intl;\n    var selectedCourse = useContext(StateContext).selectedCourse;\n    var notSubmittedLength = notSubmittedUsers && notSubmittedUsers.length;\n    var _b = tslib_1.__read(useState({ emailSendInProgress: false, emaiRecipients: [] }), 2), emailInfo = _b[0], setEmailInfo = _b[1];\n    function sendReminder(data) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var client, res, _a, _b, err_1;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _c.trys.push([0, 4, , 5]);\n                        client = env.kedBackendClient.http;\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emailSendInProgress: true }));\n                        return [4 /*yield*/, client.post(\"email/reminder\", data)];\n                    case 1:\n                        res = _c.sent();\n                        if (!(res.status !== 200)) return [3 /*break*/, 3];\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emailSendInProgress: false }));\n                        _a = HttpError.bind;\n                        _b = [void 0, res.status];\n                        return [4 /*yield*/, res.text()];\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 3:\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emailSendInProgress: false }));\n                        showInfo(intl.formatMessage({ id: \"teacherView.emailRemindersSentMsg\", defaultMessage: \"Reminders successfully sent\" }));\n                        return [3 /*break*/, 5];\n                    case 4:\n                        err_1 = _c.sent();\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emailSendInProgress: false }));\n                        showError(err_1);\n                        return [3 /*break*/, 5];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    }\n    return !notSubmittedUsers || notSubmittedUsers.length === 0 ? null : React.createElement(\"div\", { className: \"not-submitted-users taskContainer\" },\n        React.createElement(\"h4\", null, intl.formatMessage({ id: \"teacherView.notSubmittedAssignments\", defaultMessage: \"Ej lämnat in\" })),\n        notSubmittedUsers.map(function (ns, index) {\n            return React.createElement(\"div\", { key: \"notHandedIn_\" + index, className: \"align-horizontal student-row\" + (notSubmittedLength === index + 1 ? \" last\" : \"\") },\n                React.createElement(\"div\", { className: \"horizontalItem top pull-right\", onClick: function () {\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emaiRecipients: emailInfo.emaiRecipients.find(function (su) { return su.email === ns.email; }) ? emailInfo.emaiRecipients.filter(function (u) { return u.email != ns.email; }) : tslib_1.__spread(emailInfo.emaiRecipients, [{ email: ns.email, firstName: ns.firstName, lastName: ns.lastName }]) }));\n                    } },\n                    React.createElement(\"div\", { className: \"checkBox\" + (emailInfo.emaiRecipients.find(function (su) { return su.email === ns.email; }) ? \" checked\" : \"\") })),\n                React.createElement(\"div\", { className: \"horizontalItem top\" }, ns.displayName));\n        }),\n        React.createElement(\"div\", { className: \"align-horizontal remind-assignment\" },\n            React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\n                React.createElement(\"button\", { className: \"btn btn-info\" + (emailInfo.emailSendInProgress ? \" disabled\" : \"\"), disabled: emailInfo.emailSendInProgress, onClick: function () {\n                        if (emailInfo.emaiRecipients.length > 0) {\n                            var emailData = {\n                                sendTo: emailInfo.emaiRecipients,\n                                courseName: selectedCourse.name,\n                                moduleName: moduleName,\n                                taskName: taskName,\n                                taskDeadline: taskDeadline\n                            };\n                            sendReminder(emailData);\n                        }\n                        else {\n                            showError(intl.formatMessage({ id: \"teacherView.sendEmailAtLeastOneRecipientErr\", defaultMessage: \"At least one student should be selected\" }));\n                        }\n                    } }, emailInfo.emailSendInProgress ?\n                    React.createElement(React.Fragment, null,\n                        React.createElement(Spinner, null),\n                        intl.formatMessage({ id: \"teacherView.emailReminderInProgress\", defaultMessage: \"Pågående\" }))\n                    :\n                        React.createElement(React.Fragment, null, intl.formatMessage({ id: \"teacherView.remindBtn\", defaultMessage: \"Påminn\" }))))));\n});\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\nimport { CourseTaskAssignments } from './course-tasks-assignments';\nimport { CourseTaskNotHandedUserList } from './course-task-not-handed-users';\nimport { NotificationIcon } from '../shared/notification-icon';\nimport { createUUID, simpleDigest } from 'kedbackend/client';\nimport { db } from '../../../globals/db';\nimport { env } from '../../../globals/KED.env';\nimport { StateContext } from '../digest-view';\nexport var CourseTask = (function (_a) {\n    var task = _a.task, assignments = _a.assignments, notSubmittedUsers = _a.notSubmittedUsers, module = _a.module;\n    var _b = React.useContext(StateContext), notificationdigests = _b.notificationdigests, selectedCourse = _b.selectedCourse, seenDigestsObservable = _b.seenDigestsObservable;\n    function onTaskOpened(isOpened) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var tagsDigest_1, seenDigests_1;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(isOpened && notificationdigests[selectedCourse.id][task.id])) return [3 /*break*/, 3];\n                        return [4 /*yield*/, simpleDigest(env.currentUser.mail + selectedCourse.id)];\n                    case 1:\n                        tagsDigest_1 = _a.sent();\n                        return [4 /*yield*/, seenDigestsObservable.load()];\n                    case 2:\n                        seenDigests_1 = _a.sent();\n                        assignments.forEach(function (assignment) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                            var assignmentDigest;\n                            return tslib_1.__generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, simpleDigest(assignment.user + //(studen's email address)\n                                            assignment.courseId +\n                                            assignment.taskId +\n                                            assignment.uploadDate +\n                                            (assignment.metadata.driveFileId || \"\"))];\n                                    case 1:\n                                        assignmentDigest = _a.sent();\n                                        if (!(seenDigests_1 && seenDigests_1.find(function (a) { return a.digest === assignmentDigest; }))) {\n                                            db.seenStudentAssignments.add({\n                                                id: createUUID(),\n                                                tags: [tagsDigest_1],\n                                                digest: assignmentDigest\n                                            });\n                                        }\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); });\n                        _a.label = 3;\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    }\n    return React.createElement(OpenCloseBox, { onOpenClose: function (becameOpen) { return onTaskOpened(becameOpen); }, className: \"task-container\", title: React.createElement(\"div\", { className: \"notification-container\" },\n            React.createElement(\"span\", null, task.name),\n            React.createElement(NotificationIcon, { course: selectedCourse, entity: 'task', taskId: task.id, notificationdigests: notificationdigests })), headerOpen: false },\n        React.createElement(\"div\", { className: \"ked_boxed\" },\n            React.createElement(CourseTaskAssignments, { taskId: task.id, assignments: assignments, checkWithUrkund: task.sendToUrkund === undefined ? true : task.sendToUrkund }),\n            React.createElement(\"br\", null),\n            React.createElement(CourseTaskNotHandedUserList, { notSubmittedUsers: notSubmittedUsers, moduleName: module.name, taskName: task.name, taskDeadline: task.deadline })));\n});\n","import * as React from 'react';\nimport moment from 'moment';\nimport { TaskAssignment } from './task-assignment';\nimport { LanguageContext } from '../../utility-components/LanguageContext';\nimport { useContext } from 'react';\nimport { AssignmentsContext } from '.';\nimport { mockTuitionStudents } from '../../../apis/mock/mock-classroom-data';\nimport { flatten } from '../../../utils/utils';\nexport var CourseTaskAssignments = (function (_a) {\n    var assignments = _a.assignments, checkWithUrkund = _a.checkWithUrkund, taskId = _a.taskId;\n    var intl = useContext(LanguageContext).intl;\n    var filterStudyGroups = React.useContext(AssignmentsContext).filterStudyGroups;\n    var refreshableAssigments = Object.assign([], assignments);\n    var studyGroups = filterStudyGroups.length > 0 && Object.keys(mockTuitionStudents).filter(function (gr) { return filterStudyGroups.includes(gr); }).map(function (st) { return mockTuitionStudents[st]; });\n    var filteredAssignments = filterStudyGroups.length > 0 ?\n        refreshableAssigments.filter(function (r) { return flatten(studyGroups).find(function (sg) { return sg.studentEmailAddress === r.user; }); }) : refreshableAssigments;\n    //determine which assignments should get data from urkund\n    checkWithUrkund && filteredAssignments.length > 0 && filteredAssignments.forEach(function (a) {\n        a.shouldRefresh = false;\n        if (a.metadata &&\n            a.metadata.urkundExternalId &&\n            a.metadata.urkundExternalId.length > 0 && // Must have metadata.urkundExternalId Otherwise not possible to refresh\n            !a.metadata.urkundUploadError && ( // Not possible to refresh if upload has failed\n        !a.metadata.urkundLastPoll || // Never checked status yet\n            (['Accepted', 'Submitted'].indexOf(JSON.parse(a.metadata.urkundResponse)[0].Status.State) >= 0 &&\n                parseInt(a.metadata.urkundLastPoll) < moment().add(-15, \"seconds\").toDate().getTime()))) {\n            a.shouldRefresh = true;\n        }\n    });\n    return filteredAssignments.length > 0 ? React.createElement(\"table\", { className: \"task-assignments-table\" },\n        React.createElement(\"thead\", null,\n            React.createElement(\"tr\", null,\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentStudentName\", defaultMessage: \"Elev\" })),\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentFileName\", defaultMessage: \"Filnamn\" })),\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentSubmittedAt\", defaultMessage: \"Inlamnat\" })),\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentReport\", defaultMessage: \"Rapport\" })),\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentGrade\", defaultMessage: \"Niva\" })))),\n        React.createElement(\"tbody\", null, filteredAssignments.map(function (assignment) {\n            return React.createElement(TaskAssignment, { taskId: taskId, key: assignment.uploadDate, assignment: assignment, shouldGetUrkundStatus: assignment.shouldRefresh });\n        })))\n        :\n            React.createElement(\"div\", null, intl.formatMessage({ id: \"teacherView.noTaskAssignments\", defaultMessage: \"Inga uppdrag uppladdade för denna uppgift\" }));\n});\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { CourseModuleView } from './course-module';\nimport { useContext, useState, createContext } from 'react';\nimport { LanguageContext } from '../../utility-components/LanguageContext';\nimport { StateContext } from '../digest-view';\nimport Select from 'react-select';\nimport { ExtraPageButtons } from '../../utility-components/extra-page-buttons';\nexport var AssignmentsContext = createContext({ filterStudyGroups: [] });\nexport var AssignmentsView = (function () {\n    var intl = useContext(LanguageContext).intl;\n    var _a = tslib_1.__read(useState([]), 2), selectedStudyGroups = _a[0], setFilterStudyGroup = _a[1];\n    var _b = useContext(StateContext), tasks = _b.tasks, selectedCourse = _b.selectedCourse;\n    var defaultDescriptionMessage = \"Här listas samtliga inlämningsuppgifter i din/dina kurser du handleder.\"\n        + \"Klicka till höger för att välja kurs. Kursens uppgifter syns nedan. Du kan öppna/dölja varje modul.\";\n    return React.createElement(React.Fragment, null,\n        React.createElement(ExtraPageButtons, null),\n        selectedCourse ?\n            React.createElement(AssignmentsContext.Provider, { value: { filterStudyGroups: selectedStudyGroups } },\n                React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\n                    React.createElement(\"h2\", null, intl.formatMessage({ id: \"teacherView.assignmentsViewTitle\", defaultMessage: \"Inlämningsuppgifter\" })),\n                    React.createElement(\"p\", null, intl.formatMessage({ id: \"teacherView.assignmentsViewDescription\", defaultMessage: { defaultDescriptionMessage: defaultDescriptionMessage } })),\n                    React.createElement(\"h3\", null,\n                        selectedCourse.name,\n                        \"-\",\n                        selectedCourse.description),\n                    selectedCourse.studyGroups && selectedCourse.studyGroups.length > 0 &&\n                        React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\n                            React.createElement(\"div\", { className: \"horizontalItem top pull-right study-group-filter\" },\n                                React.createElement(Select, { isMulti: true, options: selectedCourse.studyGroups.map(function (sg) { return ({ label: sg, value: sg }); }), value: selectedStudyGroups.map(function (group) { return ({ label: group, value: group }); }), placeholder: intl.formatMessage({ id: \"teacherView.filterByStudygroupsPlaceholder\", defaultMessage: \"Välj undervisningsgrupp\" }), onChange: function (options) {\n                                        setFilterStudyGroup(options.map(function (_a) {\n                                            var value = _a.value;\n                                            return value;\n                                        }));\n                                    } }))),\n                    selectedCourse.modules.map(function (module) {\n                        var moduleTasks = tasks.filter(function (t) { return module.taskIds.find(function (tId) { return tId === t.id; }); });\n                        return moduleTasks.length > 0 ? React.createElement(CourseModuleView, { tasks: moduleTasks, key: module.id, module: module }) : null;\n                    })))\n            : null);\n});\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport moment from 'moment';\nimport { DriveFileListing, downloadFile, getUrkundStatus } from '../../course-viewer/course-page/task-assignments-utils';\nimport { env } from '../../../globals/KED.env';\nimport { HttpError } from 'kedbackend/client';\nimport { useEffect, useState, useContext } from 'react';\nimport { maxLength } from '../../../utils/utils';\nimport { StateContext } from '../digest-view';\nexport var TaskAssignment = (function (_a) {\n    var assignment = _a.assignment, shouldGetUrkundStatus = _a.shouldGetUrkundStatus, taskId = _a.taskId;\n    var _b = tslib_1.__read(useState(assignment), 2), assignmentsWithStatus = _b[0], setAssignmentStatus = _b[1];\n    var _c = useContext(StateContext), school = _c.school, selectedCourse = _c.selectedCourse;\n    function refreshAssignment(assignment) {\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\n            var client, user, filename, req, _a, _b, resJson, e_1;\n            return tslib_1.__generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        client = env.kedBackendClient.http;\n                        user = assignment.user, filename = assignment.filename;\n                        return [4 /*yield*/, setAssignmentStatus(tslib_1.__assign({}, assignment, { isRefreshing: true }))];\n                    case 1:\n                        _c.sent();\n                        _c.label = 2;\n                    case 2:\n                        _c.trys.push([2, 8, , 10]);\n                        return [4 /*yield*/, client.get(\"assignments/urkund/\" + school + \"/\" + selectedCourse.id + \"/\" + taskId + \"/\" + user + \"/\" + filename)];\n                    case 3:\n                        req = _c.sent();\n                        if (!(req.status >= 400)) return [3 /*break*/, 5];\n                        _a = HttpError.bind;\n                        _b = [void 0, req.status];\n                        return [4 /*yield*/, req.text()];\n                    case 4: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\n                    case 5: return [4 /*yield*/, req.text()];\n                    case 6:\n                        resJson = _c.sent();\n                        return [4 /*yield*/, setAssignmentStatus(tslib_1.__assign({}, assignment, { isRefreshing: false, metadata: tslib_1.__assign({}, assignment.metadata, { urkundResponse: resJson }) }))];\n                    case 7:\n                        _c.sent();\n                        return [3 /*break*/, 10];\n                    case 8:\n                        e_1 = _c.sent();\n                        return [4 /*yield*/, setAssignmentStatus(tslib_1.__assign({}, assignment, { isRefreshing: false, refreshError: e_1 }))];\n                    case 9:\n                        _c.sent();\n                        return [3 /*break*/, 10];\n                    case 10: return [2 /*return*/];\n                }\n            });\n        });\n    }\n    useEffect(function () {\n        if (shouldGetUrkundStatus) {\n            setAssignmentStatus(tslib_1.__assign({}, assignment, { isRefreshing: true }));\n            refreshAssignment(assignment);\n        }\n    }, [shouldGetUrkundStatus, assignment]);\n    return React.createElement(\"tr\", { key: assignmentsWithStatus.mediaLink, style: assignmentsWithStatus.metadata.$meta ? { opacity: 0.5 } : {} },\n        React.createElement(\"td\", null,\n            React.createElement(\"a\", { href: \"mailto:\" + assignmentsWithStatus.user }, assignmentsWithStatus.metadata.userDisplayName || assignmentsWithStatus.user)),\n        React.createElement(\"td\", null, assignmentsWithStatus.metadata.driveFileId ?\n            // The file can be edited on drive. Link to editing it.\n            React.createElement(DriveFileListing, { file: assignmentsWithStatus }) :\n            React.createElement(\"a\", { href: \"#\", onClick: function (ev) {\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                    downloadFile(assignmentsWithStatus);\n                } }, maxLength(assignmentsWithStatus.filename, 32))),\n        React.createElement(\"td\", { className: \"assignment-date-col\" }, moment(assignmentsWithStatus.uploadDate).format('YYYY-MM-DD HH:mm')),\n        getUrkundStatus(assignmentsWithStatus, refreshAssignment, shouldGetUrkundStatus));\n});\n","import React, { useContext } from 'react';\nimport { Link } from 'react-router-dom';\nimport { LanguageContext } from '../../utility-components/LanguageContext';\nimport { preserveImpersonationQuery } from '../../../access-control';\nimport { NotificationIcon } from '../shared/notification-icon';\nimport { StateContext } from '../digest-view';\nimport { env } from '../../../globals/KED.env';\nexport var CoursesView = (function (_a) {\n    var courseBuilderUrl = _a.courseBuilderUrl;\n    var intl = useContext(LanguageContext).intl;\n    var _b = useContext(StateContext), notificationdigests = _b.notificationdigests, teacherCourses = _b.teacherCourses, selectedCourse = _b.selectedCourse;\n    return React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n        React.createElement(\"div\", { className: \"ked_boxed\" },\n            React.createElement(\"h3\", null, intl.formatMessage({ id: \"teacherView.coursesViewTitle\", defaultMessage: \"Mina kurser/ uppgifter\" })),\n            React.createElement(\"div\", { className: \"taskContainer odd-even\" }, teacherCourses.map(function (course) {\n                return React.createElement(\"div\", { key: course.id + course.code, className: \"align-horizontal\" },\n                    React.createElement(\"div\", { className: \"teacherSchoolCourse\" },\n                        React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\n                            React.createElement(\"a\", { target: \"_blank\", href: preserveImpersonationQuery(courseBuilderUrl, {}) + \"#/courses/\" + course.id + \"/edit\", className: \"editItem\" })),\n                        React.createElement(\"div\", { className: \"horizontalItem top\" },\n                            React.createElement(\"div\", { className: \"notification-container\" },\n                                React.createElement(Link, { key: \"linkCourse_\" + course.id, className: selectedCourse && selectedCourse.id === course.id ? \"selected\" : \"\", to: \"/overview/course/\" + course.id + \"/assignments\" },\n                                    course.name,\n                                    \" - \",\n                                    course.description),\n                                React.createElement(NotificationIcon, { key: \"notifictiona_\" + course.id, notificationdigests: notificationdigests, entity: 'course', course: course })))));\n            }))),\n        env.currentUser.roles.includes(\"ADMIN\") && React.createElement(Link, { to: \"/admin/emailtemplate\" }, \"Manage Email Template\"));\n});\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { withRouter } from \"react-router\";\nimport { TwoColumnsPage } from '../course-builder-ks/common/two-columns-page';\nimport { AssignmentsView } from './assignments-view';\nimport { CoursesView } from './courses-view';\nimport { db } from '../../globals/db';\nimport { env } from '../../globals/KED.env';\nimport { HttpError, simpleDigestSuspense } from 'kedbackend/client';\nimport { createContext } from 'react';\nimport { compareProps } from '../../utils/utils';\nimport { Emitter } from 'kedbackend/observable';\nvar contextInitialValue = { notificationdigests: {}, selectedCourse: null, teacherCourses: [], seenDigestsObservable: new Emitter([]), school: \"\", tasks: [] };\nexport var StateContext = createContext(contextInitialValue);\nexport var DigestView = withRouter((function (_a) {\n    var _b;\n    var match = _a.match, courseBuilderUrl = _a.courseBuilderUrl;\n    var courseId = match ? match.params.courseId : null;\n    var courseId = courseId ? courseId : null;\n    var myCourses = [];\n    var school = db.schools.tags(\"gymnasium\").name(env.currentUser.school).include(\"courses\").single().read();\n    var schoolCourses = school ? school.courses : [];\n    if (schoolCourses) {\n        var me_1 = env.currentUser.mail;\n        schoolCourses.forEach(function (course) {\n            if (course.modules.length > 0) {\n                if (course.activatedBy && course.activatedBy.url == me_1) {\n                    myCourses.push(course);\n                }\n                else if (course.responsibleTeachers.filter(function (t) { return t.url == me_1; }).length > 0) {\n                    myCourses.push(course);\n                }\n            }\n        });\n    }\n    myCourses = myCourses.sort(compareProps([\"name\", \"dateTime\"]));\n    var tasks = myCourses ? db.tasks.hasEdgesFrom(myCourses.map(function (c) { return c.id; })).toValue().read() : [];\n    var taskAssignments = tasks.filter(function (task) { return task.assignment === true; });\n    var schoolName = school.name;\n    var courseIds = myCourses.map(function (e) { return e.id; }).join(',');\n    var selectedCourse = myCourses.find(function (c) { return c.id === courseId; });\n    var res = env.kedBackendClient.http.suspenseGet(\"assignments/notificationdigests\", { school: schoolName, courseIds: courseIds });\n    if (res.status !== 200) {\n        throw new HttpError(res.status, res.text());\n    }\n    var assignments = res.json();\n    var digestArray = simpleDigestSuspense(myCourses.map(function (course) { return env.currentUser.mail + course.id; }));\n    var seenDigestsObservable = digestArray.length > 0 ?\n        (_b = db.seenStudentAssignments).tags.apply(_b, tslib_1.__spread(digestArray)).toValue() :\n        new Emitter([]);\n    var contextValue = {\n        notificationdigests: assignments,\n        selectedCourse: selectedCourse,\n        teacherCourses: myCourses,\n        seenDigestsObservable: seenDigestsObservable,\n        school: schoolName,\n        tasks: taskAssignments\n    };\n    return React.createElement(StateContext.Provider, { value: contextValue },\n        React.createElement(TwoColumnsPage, { left: React.createElement(AssignmentsView, { key: selectedCourse ? selectedCourse.id : \"\" }), right: React.createElement(CoursesView, { courseBuilderUrl: courseBuilderUrl }), rightWidth: 5 }));\n}));\n","import * as tslib_1 from \"tslib\";\nimport React, { useState } from 'react';\nimport { withRouter } from 'react-router';\nimport { Wysiwyg } from '../../utility-components/wysiwyg';\nimport { getCurrentUser } from '../../../globals/current-user';\nimport { db } from '../../../globals/db';\nimport { createUUID } from 'kedbackend/client';\nimport { showError, showInfo } from '../../../utils/utils';\nexport var EmailTemplates = withRouter((function (_a) {\n    var match = _a.match;\n    var currentUser = getCurrentUser();\n    var writeAccess = currentUser.roles.includes(\"ADMIN\");\n    var emailParams = [\"[FirstName]\", \"[LastName]\", \"[CourseName]\", \"[ModuleName]\", \"[TaskName]\", \"[TaskDeadline]\", \"[TeacherName]\"];\n    var emailTemplate = db.emailTemplates.tags(\"email-type: assignment-reminder\").single({ onZero: function () { } }).read();\n    var _b = tslib_1.__read(useState(emailTemplate ? { content: emailTemplate.content, subject: emailTemplate.subject } : { content: \"\", subject: \"\" }), 2), emaiTemplateContent = _b[0], setEmailContent = _b[1];\n    function saveTemplate() {\n        var regexContentResult = emaiTemplateContent.content.match(/\\[(.*?)\\]/gm);\n        var regexSubjectResult = emaiTemplateContent.subject.match(/\\[(.*?)\\]/gm);\n        var checkContentUsedParamsOk = true;\n        var checkSubjectUsedParamsOk = true;\n        checkContentUsedParamsOk = regexContentResult != null && regexContentResult.every(function (item) {\n            return emailParams.indexOf(item) !== -1;\n        });\n        checkSubjectUsedParamsOk = regexSubjectResult != null && regexSubjectResult.every(function (item) {\n            return emailParams.indexOf(item) !== -1;\n        });\n        if (checkContentUsedParamsOk && checkSubjectUsedParamsOk) {\n            try {\n                emailTemplate ?\n                    db.emailTemplates.update(emailTemplate, { content: emaiTemplateContent.content, subject: emaiTemplateContent.subject })\n                    :\n                        db.emailTemplates.add({\n                            id: createUUID(),\n                            tags: [\"email-type: assignment-reminder\"],\n                            content: emaiTemplateContent.content,\n                            subject: emaiTemplateContent.subject\n                        });\n                showInfo(\"Template successfully saved\");\n            }\n            catch (err) {\n                showError(err);\n            }\n        }\n        else {\n            showError(\"Invalid parameters were used in template. Please use only the specified ones and try again.\");\n        }\n    }\n    return React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\n        React.createElement(\"div\", { className: \"ked_boxed\" },\n            React.createElement(\"h4\", null, \"Email reminder template\"),\n            React.createElement(\"p\", { className: \"subHeader\" }, \"(Compose the email template. Possible parameters are: \" + emailParams.join(\",\") + \")\"),\n            React.createElement(\"input\", { placeholder: \"Subject\", value: emaiTemplateContent.subject, className: \"inputTextBox inputTextSmall\", onChange: function (ev) { return setEmailContent(tslib_1.__assign({}, emaiTemplateContent, { subject: ev.target.value })); } }),\n            React.createElement(Wysiwyg, { actions: [\n                    \"bold\",\n                    \"italic\",\n                    \"underline\",\n                    \"strikethrough\",\n                    \"heading2\",\n                    \"heading3\",\n                    \"olist\",\n                    \"ulist\",\n                    \"outdent\",\n                    \"indent\",\n                    \"line\",\n                    \"link\",\n                    \"image\"\n                ], readOnly: !writeAccess, html: emaiTemplateContent.content, onChange: function (html) { return setEmailContent(tslib_1.__assign({}, emaiTemplateContent, { content: html })); } }),\n            React.createElement(\"button\", { className: \"btn\", onClick: function () { saveTemplate(); } }, \"Submit\")));\n}));\n","import React from 'react';\nimport { HashRouter as Router, Route, Redirect } from 'react-router-dom';\nimport { Observe } from '../utility-components/observe';\nimport { EllipsisLoader } from '../course-builder/sub-components/ellipsis-loader';\nimport { DigestView } from './digest-view';\nimport { EmailTemplates } from './email-templates';\nimport { ErrorSuccessFeedback } from '../../utils/error-success-feedback';\nexport var TeacherViewApp = function (_a) {\n    var courseBuilderUrl = _a.courseBuilderUrl;\n    return React.createElement(Router, null,\n        React.createElement(\"div\", { className: \"teacher-view\" },\n            React.createElement(Route, { path: \"/\", exact: true, render: function () { return React.createElement(Redirect, { to: \"/overview\" }); } }),\n            React.createElement(Route, { path: \"/overview/(course)?/:courseId?/(assignments)?\", render: function () {\n                    return React.createElement(Observe, { fallback: React.createElement(EllipsisLoader, null) },\n                        React.createElement(DigestView, { courseBuilderUrl: courseBuilderUrl }));\n                } }),\n            React.createElement(Route, { exact: true, path: \"/admin/emailtemplate\", render: function () {\n                    return React.createElement(Observe, { fallback: React.createElement(EllipsisLoader, null) },\n                        React.createElement(EmailTemplates, null));\n                } }),\n            React.createElement(ErrorSuccessFeedback, null)));\n};\n","import React from 'react';\nimport { StateContext } from '../digest-view';\nimport { LazyContent } from '../../utility-components/lazy-content';\nexport var NotificationIcon = (function (_a) {\n    var course = _a.course, entity = _a.entity, moduleId = _a.moduleId, taskId = _a.taskId, notificationdigests = _a.notificationdigests;\n    var seenDigestsObserable = React.useContext(StateContext).seenDigestsObservable;\n    return React.createElement(LazyContent, null, seenDigestsObserable.map(function (seenDigests) {\n        var notifications = 0;\n        var courseNotifications = notificationdigests[course.id];\n        if (courseNotifications) {\n            if (entity === 'course') {\n                course.modules.forEach(function (cmod) {\n                    cmod.taskIds.forEach(function (courseTask) {\n                        notifications += getTaskNotifications(courseNotifications[courseTask]);\n                    });\n                });\n            }\n            else if (entity === 'module') {\n                var currentModule = course.modules.find(function (m) { return m.id == moduleId; });\n                currentModule && currentModule.taskIds.forEach(function (courseTask) {\n                    notifications += getTaskNotifications(courseNotifications[courseTask]);\n                });\n            }\n            else if (entity === 'task') {\n                notifications += getTaskNotifications(courseNotifications[taskId]);\n            }\n        }\n        function getTaskNotifications(taskAssignments) {\n            if (taskAssignments) {\n                return taskAssignments.filter(function (t) { return !seenDigests.find(function (d) { return d.digest === t.digest; }); }).length;\n            }\n            return 0;\n        }\n        return notifications > 0 && React.createElement(\"div\", { className: \"notification-icon\" }, notifications);\n    }));\n});\n","import * as React from 'react';\nexport var LanguageContext = React.createContext({ intl: null });\n","import * as tslib_1 from \"tslib\";\nimport { IntlProvider, addLocaleData } from 'react-intl';\nimport locale_en from 'react-intl/locale-data/en';\nimport locale_sv from 'react-intl/locale-data/sv';\nimport messages_sv from \"../../translations/sv.json\";\nimport messages_en from \"../../translations/en.json\";\nimport * as React from 'react';\nimport cfg from '../../globals/KED.cfg';\nimport moment from 'moment';\nexport var setupIntl = function (Component) {\n    return /** @class */ (function (_super) {\n        tslib_1.__extends(_SetupLanguageIntl, _super);\n        function _SetupLanguageIntl(props) {\n            var _this = _super.call(this, props) || this;\n            addLocaleData(tslib_1.__spread(locale_en, locale_sv));\n            _this.messages = {\n                'sv': messages_sv,\n                'en': messages_en\n            };\n            moment().locale(cfg.KED_LOCALE);\n            return _this;\n        }\n        _SetupLanguageIntl.prototype.render = function () {\n            return React.createElement(IntlProvider, { locale: cfg.KED_LOCALE, messages: this.messages[cfg.KED_LOCALE] },\n                React.createElement(Component, tslib_1.__assign({}, this.props)));\n        };\n        return _SetupLanguageIntl;\n    }(React.Component));\n};\n","import React from \"react\";\nimport $ from \"jquery\";\nimport { Button } from \"../../apis/buttons\";\nexport var ExtraPageButtons = function () { return (React.createElement(React.Fragment, null,\n    React.createElement(Button, { action: function (e) {\n            e.preventDefault();\n            sessionStorage.setItem(\"supportUrl\", window.location.href);\n            window.location.href = \"4.2a395e4132f14296eb80002043.html\";\n        }, addClass: \"btn-small\", faIcon: \"fa fa-exclamation-triangle\", label: \"Felanm\\u00E4l\" }),\n    \"\\u00A0\",\n    React.createElement(Button, { action: function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            var ruler = $(\"#flytta\");\n            if (ruler.data(\"uiDraggable\") === undefined) {\n                ruler.draggable({\n                    axis: \"y\",\n                    cursorAt: { top: 1 }\n                });\n            }\n            ruler.stop().slideToggle(600);\n        }, faIcon: \"fa fa-minus\", label: \"L\\u00E4slinjal\", addClass: \"btn-small\" }),\n    React.createElement(\"div\", { id: \"flytta\", className: \"ui-draggable ui-draggable-handle\" }))); };\n","import * as React from 'react';\nimport { LiveQueryView } from './live-query-view';\nexport function LazyContent(_a) {\n    var children = _a.children, spinner = _a.spinner, onError = _a.onError, noError = _a.noError;\n    return React.createElement(LiveQueryView, { props: children, spinner: spinner, noError: noError, onError: onError, fn: function (observable) { return observable; } });\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { shallowEquals } from '../../utils/utils';\nexport function liveQueryView(fn, options) {\n    return function (props) {\n        return React.createElement(LiveQueryView, tslib_1.__assign({ props: props, fn: fn }, options));\n    };\n}\nvar LiveQueryView = /** @class */ (function (_super) {\n    tslib_1.__extends(LiveQueryView, _super);\n    function LiveQueryView(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            result: null,\n            isLoading: true\n        };\n        return _this;\n    }\n    LiveQueryView.prototype.componentDidMount = function () {\n        this.subscribe();\n    };\n    LiveQueryView.prototype.componentWillUnmount = function () {\n        this.unsubscribe();\n    };\n    LiveQueryView.prototype.shouldComponentUpdate = function (nextProps, nextState) {\n        return (this.state.error !== nextState.error ||\n            this.state.isLoading !== nextState.isLoading ||\n            this.state.result !== nextState.result ||\n            !shallowEquals(nextProps.props, this.props.props));\n    };\n    LiveQueryView.prototype.componentDidUpdate = function (prevProps) {\n        if (!shallowEquals(prevProps.props, this.props.props)) {\n            this.unsubscribe();\n            this.subscribe();\n        }\n    };\n    LiveQueryView.prototype.subscribe = function () {\n        var _this = this;\n        this.setState({ isLoading: true });\n        this.subscription = this.props.fn(this.props.props).subscribe(function (result, error) { return _this.setState({\n            result: result,\n            error: error,\n            isLoading: false\n        }); });\n    };\n    LiveQueryView.prototype.unsubscribe = function () {\n        if (this.subscription) {\n            this.subscription.unsubscribe();\n            this.subscription = null;\n        }\n    };\n    LiveQueryView.prototype.render = function () {\n        var _a = this.state, result = _a.result, error = _a.error, isLoading = _a.isLoading;\n        var _b = this.props, spinner = _b.spinner, onError = _b.onError, noError = _b.noError;\n        //if (!isLoading && !result) debugger;\n        return error ?\n            noError ? \"\" : onError ? onError(error) : React.createElement(\"p\", null,\n                \"Error: \",\n                error.message) :\n            isLoading ?\n                spinner ? spinner : \"\" :\n                result === undefined ? \"\" : result;\n    };\n    return LiveQueryView;\n}(React.Component));\nexport { LiveQueryView };\n","import * as tslib_1 from \"tslib\";\nimport { FiberContext } from \"kedbackend/observable\";\nimport React, { Suspense } from 'react';\nimport { L } from '../../utils/utils';\nvar FiberContextReact = React.createContext(null);\nvar ReactSharedInternals = Object.keys(React).filter(function (key) { return key.includes(\"_INTERNALS\"); }).map(function (k) { return React[k]; })[0];\nvar ReactCurrentDispatcher = ReactSharedInternals.ReactCurrentDispatcher;\nFiberContext.addProvider(function () {\n    // Here we actuall do useContext(FiberContext) but without logging to internal debug logs\n    // Normally, react hooks are sensitive in which order they are called (useState(), etc)\n    // but useContext() is not sensitive about that at all.\n    // Still, the debug version of react will log calls to useHook() and throw if a render\n    // doesn't use the same number of hooks every time. This check should not apply\n    // to useHook() since it is not sensitive to the order in which it was called.\n    // And we need to be able to call it from within contitional expressions / statements,\n    // so we must bypass this debug logging here by accessing readContext() directly.\n    return ReactCurrentDispatcher.current && ReactCurrentDispatcher.current.readContext(FiberContextReact);\n});\nvar Observe = /** @class */ (function (_super) {\n    tslib_1.__extends(Observe, _super);\n    function Observe(props) {\n        var _this = _super.call(this, props) || this;\n        _this.subscriptions = [];\n        _this.outerSubscription = {\n            unsubscribe: function () {\n                _this.subscriptions.forEach(function (s) { return s.unsubscribe(); });\n                _this.subscriptions = [];\n            }\n        };\n        _this.observer = function (value, error, subscription) {\n            if (error) {\n                _this.setState({ error: error });\n            }\n            else {\n                _this.setState(function (_a) {\n                    var counter = _a.counter;\n                    return ({ counter: counter + 1, error: error });\n                });\n            }\n        };\n        _this.state = {\n            counter: 0,\n            error: null\n        };\n        return _this;\n    }\n    Observe.prototype.componentDidCatch = function (error, info) {\n        if (!error || !error.name)\n            error = new Error('' + error);\n        this.setState({ error: error, info: info });\n        console.log(error, info);\n    };\n    Observe.prototype.componentWillMount = function () {\n        this.outerSubscription.unsubscribe();\n    };\n    Observe.prototype.render = function () {\n        if (this.state.error) {\n            return this.props.errorFallback || React.createElement(\"p\", null, L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"Kunde inte ladda inneh\\u00E5llet\"], [\"Kunde inte ladda inneh\\u00E5llet\"]))));\n        }\n        this.outerSubscription.unsubscribe();\n        return React.createElement(Suspense, { fallback: this.props.fallback || null },\n            React.createElement(FiberContextReact.Provider, { value: this }, this.props.children));\n    };\n    return Observe;\n}(React.Component));\nexport { Observe };\nvar templateObject_1;\n","/* REFACTOR: Move this component outside coursebuilder!\n   This is a general-purpose component\n*/\nimport * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { GoalProgress } from '../charts/goal-progress';\nvar OpenCloseBox = /** @class */ (function (_super) {\n    tslib_1.__extends(OpenCloseBox, _super);\n    function OpenCloseBox(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            headerOpen: props.headerOpen || false\n        };\n        return _this;\n    }\n    OpenCloseBox.prototype.componentWillReceiveProps = function (nextProps) {\n        if (nextProps.headerOpen !== this.props.headerOpen) {\n            this.setState({ headerOpen: nextProps.headerOpen });\n        }\n    };\n    OpenCloseBox.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, title = _a.title, className = _a.className, children = _a.children, headerClassName = _a.headerClassName, contentClassName = _a.contentClassName, displayProgress = _a.displayProgress, progressData = _a.progressData, inactivated = _a.inactivated, inactivatedRender = _a.inactivatedRender;\n        var headerOpen = this.state.headerOpen;\n        if (inactivated)\n            return inactivatedRender === 'titleAndChildren' ? React.createElement(React.Fragment, null,\n                React.createElement(React.Fragment, null, title),\n                React.createElement(React.Fragment, null, children)) : React.createElement(React.Fragment, null, children);\n        //var currentProgressData = //progressData();\n        return React.createElement(\"div\", { className: (className || '') + \" openClose\" + (headerOpen ? \" open\" : \"\") },\n            React.createElement(\"div\", { className: \"openHeader\" + (headerClassName ? \" \" + headerClassName : \"\"), onClick: function () {\n                    if (_this.props.onOpenClose)\n                        _this.props.onOpenClose(!_this.state.headerOpen);\n                    _this.setState({ headerOpen: !_this.state.headerOpen });\n                } },\n                React.createElement(\"div\", { className: \"openHeaderContainer\" },\n                    React.createElement(\"div\", null, title),\n                    displayProgress && React.createElement(GoalProgress, tslib_1.__assign({}, progressData)))),\n            React.createElement(\"div\", { className: \"openContent\" + (contentClassName ? \" \" + contentClassName : \"\") }, children));\n    };\n    return OpenCloseBox;\n}(React.Component));\nexport { OpenCloseBox };\n","import exec from './exec';\nexport default {\n    bold: {\n        icon: '<b>B</b>',\n        title: 'Bold',\n        result: function () { return exec('bold'); }\n    },\n    italic: {\n        icon: '<i>I</i>',\n        title: 'Italic',\n        result: function () { return exec('italic'); }\n    },\n    underline: {\n        icon: '<u>U</u>',\n        title: 'Underline',\n        result: function () { return exec('underline'); }\n    },\n    strikethrough: {\n        icon: '<strike>S</strike>',\n        title: 'Strike-through',\n        result: function () { return exec('strikeThrough'); }\n    },\n    heading1: {\n        icon: '<b>H<sub>1</sub></b>',\n        title: 'Heading 1',\n        result: function () { return exec('formatBlock', '<H1>'); }\n    },\n    heading2: {\n        icon: '<b>H<sub>2</sub></b>',\n        title: 'Heading 2',\n        result: function () { return exec('formatBlock', '<H2>'); }\n    },\n    heading3: {\n        icon: '<b>H<sub>3</sub></b>',\n        title: 'Heading 3',\n        result: function () { return exec('formatBlock', '<H3>'); }\n    },\n    paragraph: {\n        icon: '&#182;',\n        title: 'Paragraph',\n        result: function () { return exec('formatBlock', '<P>'); }\n    },\n    quote: {\n        icon: '&#8220; &#8221;',\n        title: 'Quote',\n        result: function () { return exec('formatBlock', '<BLOCKQUOTE>'); }\n    },\n    olist: {\n        icon: '&#35;',\n        title: 'Ordered List',\n        result: function () { return exec('insertOrderedList'); }\n    },\n    ulist: {\n        icon: '&#8226;',\n        title: 'Unordered List',\n        result: function () { return exec('insertUnorderedList'); }\n    },\n    outdent: {\n        icon: '<i class=\"fa fa-outdent\" aria-hidden=\"true\"></i>',\n        title: 'Outdent',\n        result: function () { return exec(\"outdent\"); }\n    },\n    indent: {\n        icon: '<i class=\"fa fa-indent\" aria-hidden=\"true\"></i>',\n        title: 'Indent',\n        result: function () { return exec(\"indent\"); },\n    },\n    code: {\n        icon: '&lt;/&gt;',\n        title: 'Code',\n        result: function () { return exec('formatBlock', '<PRE>'); }\n    },\n    line: {\n        icon: '&#8213;',\n        title: 'Horizontal Line',\n        result: function () { return exec('insertHorizontalRule'); }\n    },\n    link: {\n        icon: '&#128279;',\n        title: 'Link',\n        result: function () {\n            var url = window.prompt('Enter the link URL');\n            if (url) {\n                var selected = document.getSelection();\n                var elem = document.createElement('a');\n                elem.href = url;\n                elem.target = \"_blank\";\n                elem.appendChild(document.createTextNode(selected.toString()));\n                exec('insertHTML', elem.outerHTML);\n            }\n        }\n    },\n    image: {\n        icon: '&#128247;',\n        title: 'Image',\n        promptMsg: 'Enter the URL of the image',\n        result: function () {\n            var url = window.prompt(this.promptMsg);\n            if (url)\n                exec('insertImage', url);\n        }\n    }\n};\n","export default (function (command, value) {\n    if (value === void 0) { value = null; }\n    document.execCommand(command, false, value);\n});\n","export function patchElement(element) {\n    var modified = false;\n    if (element.tagName === \"A\") {\n        var href = element.getAttribute(\"href\");\n        var target = element.getAttribute(\"target\");\n        if (href) {\n            if (href.startsWith(\"javascript:\")) {\n                // Fix \"javascript:window.open('...')\" URLS\n                var url = href;\n                var windowOpen = \"window.open('\";\n                var pWindowOpen = url.indexOf(windowOpen);\n                if (pWindowOpen >= 0) {\n                    var urlEnd = url.substr(pWindowOpen + windowOpen.length);\n                    var pUrlEnd = urlEnd.indexOf(\"'\");\n                    if (pUrlEnd >= 0) {\n                        var newUrl = urlEnd.substr(0, pUrlEnd);\n                        element.setAttribute(\"href\", newUrl);\n                        element.setAttribute(\"target\", \"_blank\"); // The reason they use JS links is for opening in new tab\n                        modified = true;\n                    }\n                }\n            }\n            else if (href.startsWith(\"https://\") || href.startsWith(\"http://\")) {\n                try {\n                    var url = new URL(href);\n                    // Fix digilär URLs:\n                    if (url.host === \"xn--digilr-fua.se\") {\n                        if (url.search[0] === '?') {\n                            var pSecondQ = url.search.indexOf('?', 1);\n                            if (pSecondQ > 0) {\n                                url.search = url.search.substr(0, pSecondQ) + \"&\" + url.search.substr(pSecondQ + 1);\n                                element.setAttribute(\"href\", url.href);\n                                modified = true;\n                            }\n                        }\n                    }\n                    // Fix so that external URLS are opened in separate tabs\n                    if (location.hostname !== 'localhost') {\n                        if (url.host !== location.host) {\n                            if (!element.getAttribute(\"target\")) {\n                                element.setAttribute(\"target\", \"_blank\");\n                                modified = true;\n                            }\n                        }\n                    }\n                }\n                catch (error) {\n                    element.removeAttribute(\"a\");\n                    modified = true;\n                }\n            }\n            else if (href.startsWith(\"/content?\")) { // Should maybe use KED.cfg.KED_RESOURCES_URL instead of hardcoding \"/content?\".\n                if (!element.getAttribute(\"target\")) {\n                    element.setAttribute(\"target\", \"_blank\");\n                    modified = true;\n                }\n            }\n        }\n    }\n    return modified;\n}\n","export default function imageEditActions(cb) {\n    return [{\n            name: 'float-left',\n            icon: \"<div style=\\\"position:relative\\\">\\n      <i class=\\\"fa fa-align-right\\\" aria-hidden=\\\"true\\\"></i>\\n      <div style=\\\"position:absolute; left:-4px;top:0; transform: scale(0.5); transform-origin: left top\\\">\\n        <i class=\\\"fa fa-picture-o\\\" aria-hidden=\\\"true\\\"></i>\\n      </div>\\n    </div>\",\n            title: 'Låt bilden flyta vänster om text',\n            result: function () { return cb('float-left'); }\n        }, {\n            name: 'float-right',\n            icon: \"<div style=\\\"position:relative\\\">\\n      <i class=\\\"fa fa-align-left\\\" aria-hidden=\\\"true\\\"></i>\\n      <div style=\\\"position:absolute; right:-4px;top:0; transform: scale(0.5); transform-origin: right top\\\">\\n        <i class=\\\"fa fa-picture-o\\\" aria-hidden=\\\"true\\\"></i>\\n      </div>\\n    </div>\",\n            title: 'Låt bilden flyta höger om text',\n            result: function () { return cb('float-right'); }\n        }, {\n            name: 'unfloat',\n            icon: \"<div style=\\\"position:relative;\\\" aria-hidden=\\\"true\\\">\\n      <div style=\\\"position:absolute;top:0;left:0\\\">&#8254;</div>\\n      <div style=\\\"position:absolute;top:0:left:0;transform: scale(0.5); transform-origin: left bottom\\\">\\n        <i class=\\\"fa fa-picture-o\\\" aria-hidden=\\\"true\\\"></i>\\n      </div>\\n      <div style=\\\"position:absolute;top:0;left:0\\\">_</div>\\n    </div>\",\n            title: 'Placera bilden på egen rad',\n            result: function () { return cb('unfloat'); }\n        }];\n}\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport exec from './exec';\nimport { washHtml } from './wash-html';\nimport imageEditActions from './image-edit-actions';\nimport actions from './actions';\nvar classes = {\n    actionbar: 'wysiwyg-actionbar',\n    button: 'wysiwyg-button',\n    content: 'wysiwyg-content',\n    focusrect: 'wysiwyg-focusrect',\n    focuspoint: 'wysiwyg-focuspoint',\n    readonlyContent: 'wysiwyg-content readonly'\n};\nvar Wysiwyg = /** @class */ (function (_super) {\n    tslib_1.__extends(Wysiwyg, _super);\n    function Wysiwyg(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = { focusRect: null };\n        _this.onFocus = _this.onFocus.bind(_this);\n        _this.onBlur = _this.onBlur.bind(_this);\n        _this.onMouseDown = _this.onMouseDown.bind(_this);\n        _this.onMouseMove = _this.onMouseMove.bind(_this);\n        _this.onMouseUp = _this.onMouseUp.bind(_this);\n        return _this;\n    }\n    Wysiwyg.prototype.componentDidMount = function () {\n        var _this = this;\n        if (!this.props.readOnly) {\n            Array.from(this.contentDiv.querySelectorAll(\"img,a\")).map(function (elem) { return elem; })\n                .forEach(function (elem) {\n                elem.tabIndex = 1;\n                elem.onfocus = _this.onFocus;\n                elem.onblur = _this.onBlur;\n            });\n        }\n        if (this.props.reportNumChars) {\n            this.props.reportNumChars((this.contentDiv && this.contentDiv.innerText && this.contentDiv.innerText.length) || 0);\n        }\n    };\n    Wysiwyg.prototype.componentDidUpdate = function () {\n        var _this = this;\n        Array.from(this.contentDiv.querySelectorAll(\"img,a\")).map(function (elem) { return elem; })\n            .forEach(function (elem) {\n            elem.tabIndex = 1;\n            elem.onfocus = _this.onFocus;\n            elem.onblur = _this.onBlur;\n        });\n        if (this.props.reportNumChars) {\n            this.props.reportNumChars((this.contentDiv && this.contentDiv.innerText && this.contentDiv.innerText.length) || 0);\n        }\n    };\n    Wysiwyg.prototype.shouldComponentUpdate = function (nextProps, nextState) {\n        //this.contentDiv.onfocus = this.onFocus;\n        //this.contentDiv.onblur = this.onBlur;\n        return !this.contentDiv ||\n            nextState != this.state ||\n            nextProps.readOnly !== this.props.readOnly ||\n            washHtml(nextProps.html) !== washHtml(this.contentDiv.innerHTML);\n    };\n    Wysiwyg.prototype.triggerOnChange = function (html) {\n        this.props.onChange && this.props.onChange(washHtml(html));\n    };\n    Wysiwyg.prototype.onFocus = function (ev) {\n        var elem = ev.target;\n        if (!elem || !elem.tagName)\n            return;\n        if (elem.tagName !== 'IMG' && elem.tagName !== 'A')\n            return;\n        var contentParent = this.contentDiv.parentElement;\n        var newState = {\n            focusRect: getRelatativeClientRect(contentParent, elem),\n        };\n        switch (elem.tagName) {\n            case 'A':\n            case 'IMG':\n            default: break;\n        }\n        this.setState(newState);\n        this.focusElem = elem;\n    };\n    Wysiwyg.prototype.onBlur = function (ev) {\n        /*if (ev.relatedTarget) {\n          const relatedTarget = ev.relatedTarget as HTMLElement;\n          if (relatedTarget.className && relatedTarget.className.split(' ').indexOf(classes.button) >= 0) {\n            // A image action button was pressed\n            set\n            return;\n          }\n        }*/\n        if ((ev.target === this.focusElem && ev.relatedTarget !== this.focusRectDiv) ||\n            ev.target === this.focusRectDiv) {\n            this.setState({ focusRect: null });\n        }\n    };\n    Wysiwyg.prototype.makeClickable = function (elem) {\n        elem.tabIndex = 1;\n    };\n    Wysiwyg.prototype.onMouseDown = function (ev) {\n        if ((ev.target.className || \"\").split(' ').indexOf(classes.focuspoint) >= 0) {\n            var corner = this.getRectCorner(ev);\n            this.corner = corner;\n            this.resizeStartX = ev.clientX;\n        }\n    };\n    Wysiwyg.prototype.onMouseMove = function (ev) {\n        if (this.corner && this.state.focusRect && this.focusElem) {\n            ev.preventDefault();\n            // TODO: Räkna ut baserat på this.corner hur bildens storlek borde ändras.\n            // Leta upp bilden per ID från this.contentDiv\n            // Sätt DIV:ens style attribut width till ny width.\n            // Om DIV:en redan hade height, sätt ny height med samma aspect ratio som innan,\n            // annars, sätt inte height alls (eller möjligtvis till auto))\n            var focusRect = this.focusRectDiv.getBoundingClientRect();\n            if (focusRect.width < 32)\n                return;\n            //const currentWidth = focusRect.width;\n            //const currentHeight = focusRect.height;\n            //const hasHeightStyle = !this.focusElem.style.height || this.focusElem.style.height === \"auto\";\n            var newWidth = Math.max(32, this.corner.endsWith('l') ?\n                focusRect.width + (this.resizeStartX - ev.clientX) :\n                //focusRect.right - ev.clientX :\n                focusRect.width - (this.resizeStartX - ev.clientX));\n            this.resizeStartX = ev.clientX;\n            //ev.clientX - focusRect.left;\n            var factor = newWidth / focusRect.width;\n            var newHeight = focusRect.height * factor;\n            this.focusElem.style.width = newWidth + \"px\";\n            this.focusElem.style.height = newHeight + \"px\";\n            this.setState({\n                focusRect: getRelatativeClientRect(this.contentDiv.parentElement, this.focusElem),\n            });\n        }\n    };\n    Wysiwyg.prototype.onMouseUp = function (ev) {\n        if (this.corner && this.state.focusRect && this.focusElem) {\n            this.corner = null;\n            this.triggerOnChange(this.contentDiv.innerHTML);\n        }\n    };\n    Wysiwyg.prototype.getRectCorner = function (ev) {\n        var e_1, _a;\n        try {\n            for (var _b = tslib_1.__values((ev.target.className || '').split(' ')), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var className = _c.value;\n                switch (className) {\n                    case 'fpul':\n                        return 'ul';\n                    case 'fpur':\n                        return 'fpur';\n                    case 'fplr':\n                        return 'lr';\n                    case 'fpll':\n                        return 'll';\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        return null;\n    };\n    Wysiwyg.prototype.execImageEditAction = function (cmd) {\n        //console.log(cmd);\n        if (!this.focusElem)\n            return;\n        //console.log(\"doing it\");\n        switch (cmd) {\n            case 'float-left':\n                this.focusElem.style.cssFloat = 'left';\n                break;\n            case 'float-right':\n                this.focusElem.style.cssFloat = 'right';\n                break;\n            case 'unfloat':\n                this.focusElem.style.cssFloat = '';\n                break;\n        }\n        this.triggerOnChange(this.contentDiv.innerHTML);\n        this.setState({ focusRect: getRelatativeClientRect(this.contentDiv.parentElement, this.focusElem) });\n    };\n    Wysiwyg.prototype.render = function () {\n        var _this = this;\n        var defaultActions = this.props.defaultActions || actions;\n        var actionsToUse = this.props.actions ? this.props.actions.map(function (action) {\n            return typeof action === 'string' ?\n                defaultActions[action] :\n                defaultActions[action.name] ? tslib_1.__assign({}, defaultActions[action.name], action) :\n                    action;\n        })\n            : Object.keys(defaultActions).map(function (action) { return defaultActions[action]; });\n        if (this.state.focusRect) {\n            actionsToUse = actionsToUse.concat(imageEditActions(function (cmd) { return _this.execImageEditAction(cmd); }));\n        }\n        var focusRect = this.state.focusRect;\n        var _a = this.props, readOnly = _a.readOnly, reportNumChars = _a.reportNumChars, maxChars = _a.maxChars;\n        return React.createElement(\"div\", { className: this.props.className },\n            !readOnly && React.createElement(\"div\", { className: classes.actionbar }, actionsToUse.map(function (action, idx) {\n                return React.createElement(\"button\", { key: idx, className: classes.button, dangerouslySetInnerHTML: { __html: action.icon }, title: action.title, onMouseDown: function (ev) { action.result(ev, _this); }, onMouseUp: function (ev) { return setTimeout(function () { return _this.contentDiv.focus(); }, 10); } });\n            })),\n            React.createElement(\"div\", { className: readOnly ? classes.readonlyContent : classes.content, style: { position: 'relative', top: 0, left: 0 }, onMouseMove: this.onMouseMove, onMouseDown: this.onMouseDown, onMouseUp: this.onMouseUp },\n                React.createElement(\"div\", { className: \"editor\", ref: function (div) { return _this.contentDiv = div; }, dangerouslySetInnerHTML: { __html: washHtml(this.props.html) }, contentEditable: !readOnly, onPaste: function (ev) {\n                        if (!isNaN(maxChars)) {\n                            var target = ev.target, currentTarget = ev.currentTarget;\n                            //const textBeingOverwritten = (target as any).innerText || \"\";\n                            var editorText = (currentTarget && currentTarget.innerText) || \"\";\n                            var textBeingPasted = ev.clipboardData.getData(\"text/plain\") || \"\";\n                            if (editorText.length + textBeingPasted.length > maxChars) {\n                                ev.preventDefault();\n                            }\n                        }\n                    }, onKeyUp: reportNumChars ? function (ev) {\n                        var innerText = ev.target.innerText;\n                        reportNumChars(innerText ? innerText.length : 0);\n                    } : null, onKeyPress: !isNaN(maxChars) ? function (ev) {\n                        var innerText = ev.target.innerText;\n                        if (innerText && innerText.length >= maxChars) {\n                            ev.preventDefault();\n                        }\n                    } : null, onInput: function (ev) { return _this.triggerOnChange(ev.target.innerHTML); }, onKeyDown: function (ev) {\n                        if (readOnly)\n                            return;\n                        if (reportNumChars && ev.currentTarget) {\n                            reportNumChars((ev.currentTarget.innerText || \"\").length);\n                        }\n                        //console.log(\"Key: \" + ev.which);\n                        if (ev.which >= 35 && ev.which <= 40) { // home/end/up/down/left/right\n                            ev.stopPropagation(); // Prevent entire page from scrolling??\n                        }\n                        if (ev.which === 9) {\n                            ev.preventDefault(); // TAB\n                            if (ev.shiftKey) {\n                                exec(\"outdent\");\n                            }\n                            else {\n                                exec(\"indent\");\n                            }\n                        }\n                        if ((ev.keyCode === 8 || ev.keyCode === 46) && // Delete or Back buttons\n                            _this.focusElem && _this.state.focusRect) {\n                            if (_this.focusElem && _this.focusElem.parentElement) {\n                                _this.focusElem.parentElement.removeChild(_this.focusElem); // Remove marked image\n                            }\n                            _this.focusElem = null;\n                            _this.setState({ focusRect: null });\n                            _this.triggerOnChange(_this.contentDiv.innerHTML);\n                        }\n                    } }),\n                focusRect && React.createElement(\"div\", { ref: function (div) { return _this.focusRectDiv = div; }, className: classes.focusrect, onBlur: this.onBlur, tabIndex: 1, style: {\n                        outline: 0,\n                        position: 'absolute',\n                        top: this.state.focusRect.top,\n                        left: this.state.focusRect.left,\n                        width: this.state.focusRect.width,\n                        height: this.state.focusRect.height\n                    } },\n                    React.createElement(\"div\", { className: classes.focuspoint + \" fpul\", style: { position: 'absolute', top: 0, left: 0 } }),\n                    React.createElement(\"div\", { className: classes.focuspoint + \" fpur\", style: { position: 'absolute', top: 0, right: 0 } }),\n                    React.createElement(\"div\", { className: classes.focuspoint + \" fplr\", style: { position: 'absolute', bottom: 0, right: 0 } }),\n                    React.createElement(\"div\", { className: classes.focuspoint + \" fpll\", style: { position: 'absolute', bottom: 0, left: 0 } }))));\n    };\n    return Wysiwyg;\n}(React.Component));\nexport { Wysiwyg };\nfunction getRelatativeClientRect(parent, child) {\n    var parentRect = parent.getBoundingClientRect();\n    var childRect = child.getBoundingClientRect();\n    return {\n        top: childRect.top - parentRect.top + parent.scrollTop,\n        left: childRect.left - parentRect.left + parent.scrollLeft,\n        bottom: childRect.bottom - parentRect.top + parent.scrollTop,\n        right: childRect.right - parentRect.left + parent.scrollLeft,\n        width: childRect.width,\n        height: childRect.height\n    };\n}\n","import { patchElement } from './html-patch-policy';\nvar parser = new DOMParser();\n/** Tags / Attributes Whitelist\n *\n */\nvar HTML_WASH_POLICY = {\n    b: {},\n    i: {},\n    p: {},\n    u: {},\n    strike: {},\n    pre: {},\n    h1: {},\n    h2: {},\n    h3: {},\n    h4: {},\n    h5: {},\n    img: { src: true, class: true, style: true, tabindex: true },\n    a: { href: true, target: true, tabindex: true },\n    ul: {},\n    ol: {},\n    li: {},\n    hr: {},\n    br: {},\n    div: {},\n    span: {},\n    // table tags:\n    table: { border: true },\n    tbody: {},\n    thead: {},\n    tfoot: {},\n    tr: {},\n    td: { headers: true, colspan: true, rowspan: true },\n    th: { abbr: true, headers: true, scope: true, sorted: true, colspan: true, rowspan: true }\n};\nexport function washHtml(html) {\n    var doc = parser.parseFromString(html, \"text/html\");\n    var childNodes = doc.body.childNodes;\n    var modified = false;\n    for (var i = 0; i < childNodes.length; ++i) {\n        if (washNode(childNodes.item(i))) {\n            modified = true;\n        }\n    }\n    return modified ?\n        doc.body.innerHTML :\n        html; // By returning the original HTML string, we spare the user from refreshing the edit area,\n    // which would otherwise put the cursor at the top, losing the position where user where.\n}\nfunction washNode(node) {\n    var modified = false;\n    if (isElement(node)) {\n        if (washElement(node)) {\n            modified = true;\n        }\n    }\n    if (washChildNodes(node)) {\n        modified = true;\n    }\n    return modified;\n}\nfunction washChildNodes(node) {\n    var modified = false;\n    var childNodes = node.childNodes;\n    for (var i = 0; i < childNodes.length; ++i) {\n        if (washNode(childNodes.item(i))) {\n            modified = true;\n        }\n    }\n    return modified;\n}\n/** Replace an element with its child nodes.\n *\n */\nfunction removeMiddleElement(element) {\n    var childNodes = element.childNodes;\n    for (var i = 0; i < childNodes.length; ++i) {\n        element.parentNode.insertBefore(childNodes.item(i), element);\n    }\n    element.remove();\n}\nfunction washElement(element) {\n    var modified = patchElement(element);\n    var policy = element.tagName && HTML_WASH_POLICY[element.tagName.toLowerCase()];\n    if (!policy) {\n        console.warn(\"Wysiwyg: not allowed tag\", element.tagName);\n        washChildNodes(element);\n        removeMiddleElement(element);\n        return true;\n    }\n    for (var i = 0; i < element.attributes.length; ++i) {\n        var attr = element.attributes.item(i);\n        var allowed = attr.name && !!policy[attr.name.toLowerCase()];\n        if (!allowed) {\n            modified = true;\n            console.warn(\"Wysiwyg: not allowed attribute\", attr.name, \"Tag: \", element.tagName);\n            element.removeAttribute(attr.name);\n        }\n    }\n    return modified;\n}\nfunction isElement(node) {\n    return !!node.tagName;\n}\n","import * as tslib_1 from \"tslib\";\nimport '../../global-setters/set-all';\nimport env from '../../globals/KED.env';\nimport cfg from '../../globals/KED.cfg';\nvar bearerPromise = env.bearerProvider.getBearer(); // Start getting bearer as soon as possible.\nimport * as React from 'react';\nimport { TeacherViewApp } from '../../components/teacher-view';\nimport { showError } from '../../utils/utils';\nimport { Spinner } from '../../components/course-builder/sub-components/spinner';\nimport { LanguageContext } from '../../components/utility-components/LanguageContext';\nimport { injectIntl } from 'react-intl';\nimport { setupIntl } from '../../components/utility-components/SetupLanguageIntl';\nvar _KEDAppTeacherView = /** @class */ (function (_super) {\n    tslib_1.__extends(_KEDAppTeacherView, _super);\n    function _KEDAppTeacherView(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            isTokenLoaded: false\n        };\n        return _this;\n    }\n    _KEDAppTeacherView.prototype.componentWillMount = function () {\n        var _this = this;\n        bearerPromise.then(function () {\n            _this.setState({ isTokenLoaded: true });\n        }).catch(function (err) {\n            showError(err);\n        });\n    };\n    _KEDAppTeacherView.prototype.render = function () {\n        var intl = this.props.intl;\n        return this.state.isTokenLoaded ?\n            React.createElement(LanguageContext.Provider, { value: { intl: intl } },\n                React.createElement(TeacherViewApp, { courseBuilderUrl: cfg.KED_COURSE_BUILDER_URL })) :\n            React.createElement(\"p\", null,\n                React.createElement(Spinner, null),\n                \"V.g. v\\u00E4nta... autenticerar...\");\n    };\n    return _KEDAppTeacherView;\n}(React.Component));\nexport var KEDAppTeacherView = setupIntl(injectIntl(_KEDAppTeacherView));\n","import * as tslib_1 from \"tslib\";\nimport KED from '../../globals/KED';\nimport { KEDAppTeacherView } from './app.teacherview.client';\n// Add KEDAppTeacherView to the set of components in KED.components\nKED.components = tslib_1.__assign({}, KED.components, { KEDAppTeacherView: KEDAppTeacherView });\n","import cfg from '../globals/KED.cfg';\ncfg.ENVIRONMENT = process.env.ENVIRONMENT;\ncfg.KED_API_URL = process.env.KED_API_URL; // \"https://kedbackendtest.azurewebsites.net/api/\"\ncfg.EDS_API_URL = process.env.EDS_API_URL; // \"https://edsportalowinapi.azurewebsites.net/api/\"\ncfg.KED_TOKEN_URL = process.env.KED_TOKEN_URL; // \"https://kedauthtest.azurewebsites.net/token\"\ncfg.KED_CLIENT_ID = process.env.KED_CLIENT_ID; // \"devclient\", \"testclient\", \"...\"\ncfg.KED_CLIENT_SECRET = process.env.KED_CLIENT_SECRET;\ncfg.KED_REALM = process.env.KED_REALM; // \"SE1\"\ncfg.KED_LOCALE = cfg.KED_LOCALE || process.env.KED_LOCALE; // \"sv\", \"en\". Only set from process.env if not set from SiteVision element config.\ncfg.KED_SCHOOL_LOCALE = cfg.KED_SCHOOL_LOCALE || process.env.KED_SCHOOL_LOCALE; // \"sv\", \"en_sin\", \"en_nin\". Only set from process.env if not set from SiteVision element config.\ncfg.KED_RESOURCES_URL = cfg.KED_RESOURCES_URL || process.env.KED_RESOURCES_URL;\n","/* These scripts assume some of the global vars have already been set:\n  * KED.cfg\n  * KED.env.currentUser\n\n  The rest will be set here (client side)\n*/\nimport './configure';\nimport './set-bearer-providers';\nimport './set-ked-backend-client';\nimport './set-eds-client';\n","import * as tslib_1 from \"tslib\";\nimport { parseQueryString, generateQueryString, splitUrlAndQuery } from \"../utils/query-string\";\nimport { WebServerBearerProvider, isomorphic, storage } from 'kedbackend/clientweb';\nimport { KedBearerProvider } from 'kedbackend/client';\nimport cfg from '../globals/KED.cfg';\nimport env from '../globals/KED.env';\nimport { IMPERSONATION_QUERY_PARAMS } from \"../access-control/index\";\nimport { cherryPickProps } from \"../utils/utils\";\nvar employeeClassroomScopes = [\n    \"https://www.googleapis.com/auth/classroom.courses\",\n    \"https://www.googleapis.com/auth/classroom.profile.emails\",\n    \"https://www.googleapis.com/auth/classroom.rosters\",\n    \"https://www.googleapis.com/auth/classroom.coursework.students\"\n];\nvar studentClassroomScopes = [\n    \"https://www.googleapis.com/auth/classroom.courses\",\n    \"https://www.googleapis.com/auth/classroom.coursework.me\"\n];\nfunction getMergedTokenPath(tokenPath, locationSearch, scopes) {\n    // Merge configured query params of token path with params given to current page\n    var currentQuery = parseQueryString(locationSearch);\n    var impersonationProps = cherryPickProps(currentQuery, IMPERSONATION_QUERY_PARAMS);\n    var _a = tslib_1.__read(splitUrlAndQuery(tokenPath), 2), tokenPathWithoutQuery = _a[0], tokenQueryString = _a[1];\n    var tokenPathQuery = parseQueryString(tokenQueryString);\n    return tokenPathWithoutQuery + generateQueryString(tslib_1.__assign({}, tokenPathQuery, impersonationProps, { scopes: scopes.join(',') }));\n}\nfunction getTokenId(mergedTokenPath, userEmail) {\n    return mergedTokenPath + \"/\" + userEmail;\n}\nfunction saveUserInfo(user, tokenId) {\n    env.currentUser = user;\n    var schoolgrade = parseQueryString(location.search, { toLower: true }).schoolgrade;\n    if (schoolgrade) {\n        var schoolGradeInt = parseInt(schoolgrade);\n        env.currentUser.schoolGrade = schoolGradeInt;\n        env.currentUser.schoolType = schoolGradeInt > 9 ? \"Gymnasium\" : \"Grundskolor\";\n    }\n    sessionStorage.setItem(\"userInfo\" + tokenId, JSON.stringify(user));\n}\nfunction loadUserInfo(tokenId) {\n    var storedSessionUser = sessionStorage.getItem(\"userInfo\" + tokenId);\n    if (storedSessionUser) {\n        env.currentUser = JSON.parse(storedSessionUser);\n    }\n}\nfunction createBearerProvider(mergedTokenPath, userEmail) {\n    var tokenId = getTokenId(mergedTokenPath, userEmail);\n    return new WebServerBearerProvider(mergedTokenPath, function (responseText) {\n        var res = JSON.parse(responseText);\n        if (!res.ok)\n            throw new Error(res.error);\n        if (res.user) {\n            saveUserInfo(res.user, tokenId);\n        }\n        return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\n    }, tokenId);\n}\nfunction createGoogleTokenProvider(mergedTokenPath, userEmail) {\n    var tokenId = getTokenId(mergedTokenPath, userEmail);\n    return new WebServerBearerProvider(mergedTokenPath, function (responseText) {\n        var res = JSON.parse(responseText);\n        if (!res.ok)\n            throw new Error(res.error);\n        return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\n    }, tokenId);\n}\nfunction createTestTokenProvider(tokenUrl, user, scopes) {\n    return new KedBearerProvider(isomorphic, storage, tokenUrl + user.mail + location.search, cfg.KED_CLIENT_ID, cfg.KED_CLIENT_SECRET, tokenUrl, {\n        email: user.mail.toLowerCase(),\n        roles: user.roles,\n        school: user.school,\n        schoolType: user.schoolType,\n        scopes: scopes,\n        name: user.displayName\n    });\n}\n// env.currentUser.mail is set by SiteVision server initially.\n// A response from /api/token may change the mail attribute of the current\n// user, so env.currentUser.mail may be different after getting a response.\n// However, the initial value is valuable always in order to distinguish the case\n// when one normal user logs out and another user logs in.\nvar initialUserEmail = env.currentUser && env.currentUser.mail; // Initial value of mail. May change.\nif (initialUserEmail) {\n    // KED\n    if (cfg.KED_TOKEN_PATH) {\n        //\n        //\n        // Production / SiteVision proxied /api/token to request tokens from:\n        //\n        //\n        var mergedTokenPath = getMergedTokenPath(cfg.KED_TOKEN_PATH, location.search, [\n            \"kedbackend\",\n            \"EDS\",\n        ]);\n        env.bearerProvider = createBearerProvider(mergedTokenPath, initialUserEmail);\n        loadUserInfo(getTokenId(mergedTokenPath, initialUserEmail));\n        var scopes = [\n            \"https://www.googleapis.com/auth/calendar.readonly\",\n            \"https://www.googleapis.com/auth/drive\"\n        ].concat(env.currentUser.roles.includes(\"EMPLOYEE\")\n            ? employeeClassroomScopes\n            : studentClassroomScopes);\n        // Google\n        var googleMergedPath = getMergedTokenPath(cfg.KED_TOKEN_PATH, location.search, scopes);\n        env.googleTokenProvider = createGoogleTokenProvider(googleMergedPath, initialUserEmail);\n    }\n    else if (cfg.KED_TOKEN_URL && cfg.KED_CLIENT_ID && cfg.KED_CLIENT_SECRET) {\n        //\n        //\n        // Test - go directly to KEDAUTH server to retrieve tokens\n        //\n        //\n        env.bearerProvider = createTestTokenProvider(cfg.KED_TOKEN_URL, env.currentUser, [\n            \"kedbackend\",\n            \"EDS\",\n        ]);\n        var scopes = [\n            \"https://www.googleapis.com/auth/calendar.readonly\",\n            \"https://www.googleapis.com/auth/drive\"\n        ].concat(env.currentUser.roles.includes(\"EMPLOYEE\")\n            ? employeeClassroomScopes\n            : studentClassroomScopes);\n        env.googleTokenProvider = createTestTokenProvider(cfg.KED_TOKEN_URL + \"/google\", env.currentUser, scopes);\n    }\n    else {\n        throw new Error(\"Missing configuration parameter KED_TOKEN_PATH\");\n    }\n}\n","import env from '../globals/KED.env';\nimport cfg from '../globals/KED.cfg';\nimport { isomorphic } from 'kedbackend/clientweb';\nimport { EdsClient } from '../apis/edsclient';\nenv.edsClient = new EdsClient(isomorphic, cfg.EDS_API_URL, env.bearerProvider, function () { return env.currentUser.mail; });\n","import env from '../globals/KED.env';\nimport cfg from '../globals/KED.cfg';\nimport { KedBackendClientWeb } from 'kedbackend/clientweb';\nenv.kedBackendClient = new KedBackendClientWeb(cfg.KED_API_URL, env.bearerProvider);\n","import KED from './KED';\n;\nif (!KED.cfg)\n    KED.cfg = {};\nexport default KED.cfg;\nexport var cfg = KED.cfg;\n","import KED from './ked';\nif (!KED.env)\n    KED.env = {};\nexport default KED.env;\nexport var env = KED.env;\n","export var KED_NAMESPACE = \"KED\";\nvar result = typeof KED === 'undefined' ? {} : KED;\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\n    window[KED_NAMESPACE] = result;\n}\nexport default result;\n","import env from './KED.env';\nexport function getCurrentUser() {\n    return env.currentUser;\n}\n","import env from './KED.env';\nimport { KedBackendRepo } from 'kedbackend/repo';\nimport { getGlobalId, createUUID } from 'kedbackend/client';\nimport cfg from './KED.cfg';\nif (!env.db) {\n    // Put db on env so that it is shared between subject planner and other components!\n    env.db = new KedBackendRepo(function () { return env.kedBackendClient; }, function () { return env.currentUser ?\n        env.currentUser.mail :\n        \"\"; }, function () { return env.currentUser ?\n        env.currentUser.displayName || env.currentUser.mail :\n        \"\"; });\n}\nexport var db = env.db;\nexport var globalId = getGlobalId(cfg.KED_REALM);\nexport var Schools = {\n    standardSchool: db.schools.name(\"standard\").cacheOptimized().single(),\n    get mySchool() { return db.schools.name(env.currentUser.school).cacheOptimized().single(); }\n};\nexport var CourseInstances = {\n    getBranchId: function (school, courseId) {\n        return school.switchMap(function (school) {\n            return db.branches\n                .hasEdgesFrom([school.officialBranchId])\n                .name(\"draft\")\n                .tags(courseId)\n                .idsOnly()\n                .map(function (_a) {\n                var id = _a.id;\n                return id;\n            })\n                .toValue()\n                .map(function (ids) { return ids.length > 0 ? ids[0] : undefined; });\n        });\n    },\n    /** Get a DRAFT branch for given course ID and given school.\n     * If there is not yet such a branch, create it using mutationsOnEmpty() which will\n     * lead to the C# code DocumentRepository.ReadOrMutate() via DocumentController.\n     */\n    getOrCreateBranchId: function (school, courseId) {\n        return db.courseInstances.idsOnly().id(courseId).switchMap(function () {\n            return school.switchMap(function (school) {\n                return db.branches\n                    .hasEdgesFrom([school.officialBranchId])\n                    .name(\"draft\")\n                    .tags(courseId)\n                    .idsOnly()\n                    .mutationsOnEmpty(function (tx) {\n                    // These 2 mutations will occur server side, atomically.\n                    // Will be sent on each request in the query, but will only execute if query results in zero items.\n                    //console.log(\"School:\", school);\n                    var id = createUUID();\n                    tx.add(\"branches\", {\n                        id: id,\n                        acl: [\n                            \"role:USER:R\",\n                            \"schoolRole:\" + school.name + \"/EMPLOYEE:S\"\n                        ],\n                        name: 'draft',\n                        schoolId: school.id,\n                        treeParentId: school.officialBranchId,\n                        tags: [courseId]\n                    });\n                    // Approving the branch makes sure that it was created by an EMPLOYEE on given school.\n                    tx.link2(\"branches\", school.officialBranchId, \"approvedChildren\", id);\n                })\n                    .single()\n                    .map(function (_a) {\n                    var id = _a.id;\n                    return id;\n                });\n            });\n        });\n    },\n    getAllDescendantIds: function (courseId) {\n        return db.courseBlocks.tags(courseId).idsOnly().concat(db.courseContents.tags(courseId).idsOnly()).concat(db.courseTabs.tags(courseId).idsOnly()).concat(db.tasks.tags(courseId).idsOnly())\n            .map(function (x) { return x.id; });\n    }\n};\n","export var KED_NAMESPACE = \"KED\";\nvar result = typeof KED === 'undefined' ? {} : KED;\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\n    window[KED_NAMESPACE] = result;\n}\nexport default result;\n","import * as tslib_1 from \"tslib\";\nimport * as React from 'react';\nimport { db } from '../globals/db';\nimport { RemoveItem } from '../components/course-builder/sub-components/remove-item';\nvar ErrorSuccessFeedback = /** @class */ (function (_super) {\n    tslib_1.__extends(ErrorSuccessFeedback, _super);\n    function ErrorSuccessFeedback(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            errors: [],\n            infos: []\n        };\n        _this._unhandledRejection = _this._unhandledRejection.bind(_this);\n        _this._error = _this._error.bind(_this);\n        _this._customError = _this._customError.bind(_this);\n        _this._onInfo = _this._onInfo.bind(_this);\n        _this._dbWriterError = _this._dbWriterError.bind(_this);\n        _this._dbWriterStateChanged = _this._dbWriterStateChanged.bind(_this);\n        return _this;\n    }\n    ErrorSuccessFeedback.prototype._addError = function (message, details, retryable) {\n        var _this = this;\n        //console.error(message, {retryable: !!retryable, details});\n        this.setState(function (_a) {\n            var errors = _a.errors;\n            if (errors.some(function (e) { return e.message === message; }))\n                return { errors: errors };\n            if (errors.length > 2)\n                errors = errors.slice(1);\n            return {\n                errors: errors.concat([{ message: message, details: details, retryable: retryable }])\n            };\n        });\n        // Remove non-retryable errors after 30 seconds:\n        if (!retryable)\n            setTimeout(function () {\n                _this.setState(function (_a) {\n                    var errors = _a.errors;\n                    return ({\n                        errors: errors.filter(function (e) { return e.message !== message; })\n                    });\n                });\n            }, 30000);\n    };\n    ErrorSuccessFeedback.prototype._addInfo = function (message) {\n        var _this = this;\n        if (message === \"\") {\n            // Turn off current info messages\n            this.setState({ infos: [] });\n            return;\n        }\n        this.setState(function (_a) {\n            var infos = _a.infos;\n            if (infos.some(function (info) { return info === message; }))\n                return { infos: infos };\n            if (infos.length > 1)\n                infos = infos.slice(1);\n            return {\n                infos: [message] // was: infos.concat(message). But it sucks!\n            };\n        });\n        // Remove info message after 10 seconds:\n        setTimeout(function () {\n            _this.setState(function (_a) {\n                var infos = _a.infos;\n                return ({\n                    infos: infos.filter(function (msg) { return msg !== message; })\n                });\n            });\n        }, 10000);\n    };\n    ErrorSuccessFeedback.prototype._dbWriterError = function (error, retryable) {\n        this._addError(\"Det g\\u00E5r inte att spara till servern\", error, retryable);\n    };\n    ErrorSuccessFeedback.prototype._dbWriterStateChanged = function (_a) {\n        var isEdited = _a.isEdited, isSaving = _a.isSaving;\n        if (!isEdited) {\n            // If isEdited is false, a successful write must have happened, and\n            // there cannot be any retryable error anymore\n            this.setState(function (_a) {\n                var errors = _a.errors;\n                errors = errors.filter(function (e) { return !e.retryable; });\n                return { errors: errors };\n            });\n        }\n        this.setState({\n            dbWriterIsEdited: isEdited,\n            dbWriterIsSaving: isSaving\n        });\n    };\n    ErrorSuccessFeedback.prototype.componentDidMount = function () {\n        window.addEventListener('unhandledrejection', this._unhandledRejection);\n        window.addEventListener('error', this._error);\n        window.addEventListener('customerror', this._customError);\n        window.addEventListener('info', this._onInfo);\n        db.writer.onError(this._dbWriterError);\n        db.writer.onStateChange(this._dbWriterStateChanged);\n    };\n    ErrorSuccessFeedback.prototype.componentWillUnmount = function () {\n        window.removeEventListener('unhandledrejection', this._unhandledRejection);\n        window.removeEventListener('error', this._error);\n        window.removeEventListener('customerror', this._customError);\n        window.removeEventListener('info', this._onInfo);\n        db.writer.off(this._dbWriterError);\n        db.writer.off(this._dbWriterStateChanged);\n    };\n    ErrorSuccessFeedback.prototype._unhandledRejection = function (ev) {\n        this._addError(\"Ett ok\\u00E4nt fel intr\\u00E4ffade...\", ev.reason);\n    };\n    ErrorSuccessFeedback.prototype._error = function (ev) {\n        this._addError(ev.error ? ev.error.message : \"Ett ok\\u00E4nt fel intr\\u00E4ffade...\", ev.error);\n    };\n    ErrorSuccessFeedback.prototype._customError = function (ev) {\n        this._addError(ev.detail);\n    };\n    ErrorSuccessFeedback.prototype._onInfo = function (ev) {\n        this._addInfo(ev.detail);\n    };\n    ErrorSuccessFeedback.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, errors = _a.errors, infos = _a.infos, dbWriterIsSaving = _a.dbWriterIsSaving;\n        return React.createElement(\"div\", { className: \"error-success-feedback\", style: {\n                position: \"fixed\",\n                left: 0,\n                top: 0,\n                width: \"100%\",\n                pointerEvents: 'none'\n            } },\n            React.createElement(\"div\", { style: { display: 'table', margin: \"0 auto\" } },\n                errors.filter(function (e) { return !e.retryable || !dbWriterIsSaving; })\n                    .map(function (_a) {\n                    var message = _a.message, details = _a.details, retryable = _a.retryable, showDetails = _a.showDetails;\n                    return (React.createElement(\"div\", { key: message, className: \"error\" },\n                        React.createElement(\"div\", { style: { float: 'left' } }, message),\n                        React.createElement(\"div\", { style: { pointerEvents: 'auto' } },\n                            React.createElement(RemoveItem, { onClick: function () { return _this.removeError(message); } })),\n                        details || retryable ? React.createElement(\"div\", { style: { pointerEvents: 'auto' } },\n                            details ? React.createElement(React.Fragment, null,\n                                React.createElement(\"a\", { className: \"btn\", onClick: function () { return _this.toggleDetails(message); } }, showDetails ? \"Dölj detailer\" : \"Visa detailjer\"),\n                                \"\\u00A0\") : undefined,\n                            showDetails ? React.createElement(\"p\", null, '' + details) : React.createElement(React.Fragment, null, \"\\u00A0\"),\n                            retryable ? React.createElement(\"a\", { className: \"btn\", onClick: function () { return _this.retrySave(); } }, \"F\\u00F6rs\\u00F6k spara nu\") : undefined) : undefined));\n                }),\n                infos.map(function (message) {\n                    return React.createElement(\"p\", { key: message, className: \"info\" }, message);\n                })));\n    };\n    ErrorSuccessFeedback.prototype.removeError = function (message) {\n        this.setState(function (_a) {\n            var errors = _a.errors;\n            return ({\n                errors: errors.filter(function (e) { return e.message !== message; })\n            });\n        });\n    };\n    ErrorSuccessFeedback.prototype.retrySave = function () {\n        db.writer.retrySave();\n    };\n    ErrorSuccessFeedback.prototype.toggleDetails = function (message) {\n        this.setState(function (_a) {\n            var errors = _a.errors;\n            return ({ errors: errors.map(function (error) { return error.message === message ? tslib_1.__assign({}, error, { showDetails: !error.showDetails }) :\n                    error; })\n            });\n        });\n    };\n    return ErrorSuccessFeedback;\n}(React.Component));\nexport { ErrorSuccessFeedback };\n","import * as tslib_1 from \"tslib\";\nvar DEFAULT_CACHE_EXPIRATION = 30 * 60 * 1000; // 30 minutes.\nvar defaultOptions = {\n    isApiMethod: function (f) { return typeof f === 'function'; },\n    cacheExpiration: DEFAULT_CACHE_EXPIRATION\n};\nexport function makeSuspenseApi(api, options) {\n    if (options === void 0) { options = defaultOptions; }\n    options = tslib_1.__assign({}, defaultOptions, options);\n    var isApiMethod = options.isApiMethod, cacheExpiration = options.cacheExpiration;\n    var rv = Object.create(api);\n    var cache = {};\n    // Walk the instance + prototype chain to generate suspense version of each promise returning method\n    for (var proto = api; proto && proto !== Object.prototype; proto = Object.getPrototypeOf(proto)) {\n        suspendify(proto);\n    }\n    function suspendify(proto) {\n        Object.keys(proto).forEach(function (prop) {\n            if (!rv.hasOwnProperty(prop) && isApiMethod(prop)) {\n                rv[prop] = function () {\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    var key = JSON.stringify(tslib_1.__spread([prop], args));\n                    var cachedEntry = cache[key];\n                    if (cachedEntry !== undefined) {\n                        if (cachedEntry.promise)\n                            throw cachedEntry.promise;\n                        if (cachedEntry.error)\n                            throw cachedEntry.error;\n                        if (cachedEntry.timeout > Date.now()) {\n                            return cachedEntry.value;\n                        }\n                    }\n                    try {\n                        var promise = proto[prop].apply(api, args).then(function (result) {\n                            cache[key] = { timeout: Date.now() + cacheExpiration, value: result };\n                        }).catch(function (error) {\n                            cache[key] = { timeout: Date.now() + cacheExpiration, error: error };\n                        });\n                        cache[key] = { timeout: Date.now() + cacheExpiration, promise: promise };\n                        throw promise;\n                    }\n                    catch (error) {\n                        if (error.then)\n                            throw error;\n                        cache[key] = { timeout: Date.now() + cacheExpiration, error: error };\n                    }\n                };\n            }\n        });\n    }\n    return rv;\n}\n","import * as tslib_1 from \"tslib\";\nexport function parseQueryString(locationSearch, options) {\n    var toLower = (options || {}).toLower;\n    var result = {};\n    if (locationSearch && locationSearch.length > 1)\n        locationSearch.substr(1)\n            .split('&')\n            .map(function (part) { return part.split('=').map(function (s) { return decodeURIComponent(s.trim()); }); })\n            .forEach(function (_a) {\n            var _b = tslib_1.__read(_a, 2), key = _b[0], value = _b[1];\n            return result[toLower ? key.toLowerCase() : key] = value;\n        });\n    return result;\n}\nfunction encodeParams(params) {\n    return Object.keys(params).filter(function (key) { return params[key] !== undefined; }).map(function (key) { return encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key]); }).join('&');\n}\nexport function generateQueryString(params) {\n    return \"?\" + encodeParams(params);\n}\nexport function parseHashQueryString(locationHash, options) {\n    return parseQueryString(locationHash, options);\n}\nexport function generateHashQueryString(params) {\n    return \"#\" + encodeParams(params);\n}\nexport function splitUrlAndQuery(urlWithPossibleQuery) {\n    var pQuery = urlWithPossibleQuery.indexOf('?');\n    return pQuery >= 0 ?\n        [urlWithPossibleQuery.substr(0, pQuery), urlWithPossibleQuery.substr(pQuery)] :\n        [urlWithPossibleQuery, \"\"];\n}\n","import * as tslib_1 from \"tslib\";\nimport moment from 'moment';\nexport function getFirstAndLastWeekOfTerm(term) {\n    return term === 'AT' ?\n        [32, 51] :\n        [1, 25];\n}\n//Not used anymore\n// export function getTermStartAndEnd(now: moment.Moment) : moment.Moment[] {\n//     return now.month() >= 6 ? // 6 = July in JS Dates and in moment as well!\n//     [moment(new Date(now.year(), 7, 1)), moment(new Date(now.year(), 11, 31))] : // aug1 - dec31\n//     [moment(new Date(now.year(), 0, 1)), moment(new Date(now.year(), 6, 31))]; // jan1 - july31\n// }\nexport function getTermStarEndDate(date, isFirstTerm) {\n    var addYear = date.getMonth() >= 7;\n    var termYear = null;\n    if (addYear) {\n        termYear = isFirstTerm ? date.getFullYear() : date.getFullYear() + 1;\n    }\n    else {\n        termYear = isFirstTerm ? date.getFullYear() - 1 : date.getFullYear();\n    }\n    var termYearMoment = moment(termYear.toString(), \"YYYY\");\n    if (termYearMoment.week() != 1) {\n        termYearMoment = termYearMoment.clone().add(1, 'week');\n    }\n    return isFirstTerm ? [moment(termYearMoment.clone()).week(32).startOf('week'), moment(termYearMoment.clone()).week(51).endOf('week')] :\n        [moment(termYearMoment.clone()), moment(termYearMoment.clone()).week(25).endOf('week')];\n}\nexport function getSchoolMoment(m) {\n    var thisYear = m.year();\n    var isAutumn = m.month() >= 6; // determine \n    var _a = tslib_1.__read(isAutumn ?\n        [thisYear, thisYear + 1] :\n        [thisYear - 1, thisYear], 2), autumnYear = _a[0], springYear = _a[1];\n    var academicYear = '' + autumnYear + '/' + springYear;\n    var term = isAutumn ? 'AT' : 'ST';\n    var week = m.week();\n    return { academicYear: academicYear, term: term, week: week };\n}\nexport function addYear(aYear, numYearsToAdd) {\n    return aYear.split('/')\n        .map(function (yearStr) { return parseInt(yearStr) + numYearsToAdd; })\n        .map(function (year) { return '' + year; })\n        .join('/');\n}\nexport function nextAcademicYear(aYear) {\n    return addYear(aYear, 1);\n}\nexport function prevAcademicYear(aYear) {\n    return addYear(aYear, -1);\n}\n","import moment from 'moment';\nimport { getSchoolMoment, addYear } from './school-moment';\nfunction isSchoolMoment(obj) {\n    return 'academicYear' in obj;\n}\nvar SchoolTerm = /** @class */ (function () {\n    function SchoolTerm(dateOrSchoolMoment) {\n        var schoolMoment = isSchoolMoment(dateOrSchoolMoment) ?\n            dateOrSchoolMoment : getSchoolMoment(moment(dateOrSchoolMoment));\n        this.academicYear = schoolMoment.academicYear;\n        this.term = schoolMoment.term;\n    }\n    Object.defineProperty(SchoolTerm.prototype, \"year\", {\n        get: function () {\n            return parseInt(this.academicYear\n                .split('/')[this.term === 'AT' ? 0 : 1]);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    SchoolTerm.prototype.nextTerm = function () {\n        return new SchoolTerm(this.term === 'AT' ?\n            {\n                term: 'ST',\n                academicYear: this.academicYear\n            } :\n            {\n                term: 'AT',\n                academicYear: addYear(this.academicYear, 1)\n            });\n    };\n    SchoolTerm.prototype.prevTerm = function () {\n        return new SchoolTerm(this.term === 'AT' ?\n            {\n                term: 'ST',\n                academicYear: addYear(this.academicYear, -1)\n            } :\n            {\n                term: 'AT',\n                academicYear: this.academicYear\n            });\n    };\n    SchoolTerm.prototype.toLocaleString = function (intl, shortYear) {\n        var year = this.term === 'AT' ?\n            this.academicYear.split('/')[0] :\n            this.academicYear.split('/')[1];\n        if (shortYear)\n            year = year.substr(2);\n        return this.term === 'AT' ? intl.formatMessage({ id: 'termplanner.secondTerm', defaultMessage: 'HT {year}' }, { year: year }) :\n            intl.formatMessage({ id: 'termplanner.firstTerm', defaultMessage: 'VT {year}' }, { year: year });\n    };\n    return SchoolTerm;\n}());\nexport { SchoolTerm };\n","import * as tslib_1 from \"tslib\";\nexport function capitalizeFirst(str) {\n    for (var i = 0, l = str.length; i < l; ++i) {\n        if (str.charCodeAt(i) < 0x2000) {\n            return str.substr(0, i) + str[i].toLocaleUpperCase() + str.substr(i + 1);\n        }\n    }\n    return str;\n}\nexport function extend(obj, extension) {\n    if (typeof extension !== 'object')\n        return obj;\n    Object.keys(extension).forEach(function (key) {\n        obj[key] = extension[key];\n    });\n    return obj;\n}\nexport function clone(obj, extension) {\n    var clone = {};\n    Object.getOwnPropertyNames(obj).forEach(function (key) {\n        Object.defineProperty(clone, key, Object.getOwnPropertyDescriptor(obj, key));\n    });\n    if (extension)\n        extend(clone, extension);\n    return clone;\n}\nvar concat = [].concat;\nexport function flatten(a) {\n    return concat.apply([], a);\n}\nexport function compareProp(prop) {\n    return function (a, b) {\n        var aProp = a[prop], bProp = b[prop];\n        return aProp > bProp ? 1 : aProp < bProp ? -1 : 0;\n    };\n}\nexport function compareProps(props, locales, options) {\n    props = Array.isArray(props) ? props : [props];\n    var localeCompare = function (a, b) {\n        return typeof a === 'string' ?\n            a.localeCompare(b, locales, options) :\n            a < b ? -1 : a > b ? 1 : 0;\n    };\n    function cmpPart(a, b, firstPart, rest) {\n        var firstA = a[firstPart];\n        var firstB = b[firstPart];\n        if (firstA === firstB)\n            return 0;\n        if (firstA == null)\n            return -1;\n        if (firstB == null)\n            return 1;\n        return rest.length === 0 ?\n            localeCompare(firstA, firstB) :\n            cmpPart(firstA, firstB, rest[0], rest.slice(1));\n    }\n    return props\n        .map(function (prop) { return prop.split('.'); })\n        .map(function (_a) {\n        var _b = tslib_1.__read(_a), firstPart = _b[0], rest = _b.slice(1);\n        return function (a, b) { return cmpPart(a, b, firstPart, rest); };\n    })\n        .reduce(function (cmp1, cmp2) {\n        return function (a, b) { return cmp1(a, b) || cmp2(a, b); };\n    });\n}\nexport function L(text) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    var first = text[0];\n    return buildMessage(text, args);\n}\nfunction buildMessage(text, args) {\n    var rv = text[0];\n    for (var i = 1, l = text.length; i < l; ++i) {\n        rv += args[i - 1] + text[i];\n    }\n    return rv;\n}\nvar TC = /** @class */ (function () {\n    function TC(template) {\n        extend(this, template);\n    }\n    return TC;\n}());\nexport { TC };\nexport function dateTimeReviver(key, value) {\n    var a;\n    if (typeof value === 'string') {\n        a = /\\/Date\\((\\d*)\\)\\//.exec(value);\n        if (a) {\n            return new Date(+a[1]);\n        }\n    }\n    return value;\n}\n//let infoSerial = 1;\nexport function showInfo(msg) {\n    var event = new CustomEvent('info', { 'detail': msg });\n    window.dispatchEvent(event);\n}\nexport function showError(errMsg) {\n    var msg = typeof errMsg === 'string' ? errMsg : errMsg.message;\n    var event = new CustomEvent('customerror', { 'detail': msg });\n    console.error(errMsg);\n    window.dispatchEvent(event);\n}\nexport function maxLength(str, maxLen) {\n    return str.length > maxLen ?\n        str.substr(0, maxLen - 3) + \"...\" :\n        str;\n}\nexport function arrayToLookup(a, keyAccessor) {\n    var result = {};\n    for (var i = 0, l = a.length; i < l; ++i) {\n        var item = a[i];\n        var key = keyAccessor(item);\n        var array = result[key];\n        if (array)\n            array.push(item);\n        else\n            result[key] = [item];\n    }\n    return result;\n}\nexport function arrayToMap(a, keyAccessor) {\n    var result = {};\n    for (var i = 0, l = a.length; i < l; ++i) {\n        var item = a[i];\n        var key = keyAccessor(item);\n        result[key] = item;\n    }\n    return result;\n}\nexport function cherryPickProps(obj, propsToPick) {\n    var e_1, _a;\n    var result = {};\n    try {\n        for (var propsToPick_1 = tslib_1.__values(propsToPick), propsToPick_1_1 = propsToPick_1.next(); !propsToPick_1_1.done; propsToPick_1_1 = propsToPick_1.next()) {\n            var param = propsToPick_1_1.value;\n            if (param in obj)\n                result[param] = obj[param];\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (propsToPick_1_1 && !propsToPick_1_1.done && (_a = propsToPick_1.return)) _a.call(propsToPick_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return result;\n}\nexport function distinct(a, keyAccessor) {\n    var map = arrayToMap(a, keyAccessor || (function (x) { return x; }));\n    return Object.keys(map).map(function (key) { return map[key]; });\n}\nexport function shallowEquals(a, b) {\n    if (a === b)\n        return true;\n    if (!a || !b)\n        return false;\n    if (typeof a !== 'object' || typeof b !== 'object')\n        return false;\n    var keysA = Object.keys(a);\n    var keysB = Object.keys(b);\n    if (keysA.length !== keysB.length)\n        return false;\n    for (var i = 0, l = keysA.length; i < l; ++i) {\n        var key = keysA[i];\n        if (keysB[i] !== key)\n            return false;\n        if (a[key] !== b[key])\n            return false;\n    }\n    return true;\n}\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACvJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClBA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACtGA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrDA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACnPA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC1FA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzDA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/JA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9JA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9JA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC3NA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvZA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjFA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9NA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACtJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjCA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACZA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/CA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACLA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AChBA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrFA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrVA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACrXA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/FA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnCA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1CA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtGA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5DA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvRA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7EA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxKA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}