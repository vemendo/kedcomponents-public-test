{"version":3,"file":"kedappteacherview.js","sources":["webpack://[name]/webpack/bootstrap","webpack://[name]/./kedbackend/client.js","webpack://[name]/./kedbackend/clientweb.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client-web/bearer-storage-sessionstorage.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client-web/hash-restorer.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client-web/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/access-control.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/http-error.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/ked-bearer-provider.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/restclient.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-client/utils.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/cache-bust.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-collection/apply-mutations-on-deltas.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-collection/delta-cache.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-collection/delta-collection.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/delta-merge.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-collection.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-query.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-repo.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-subscription.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/kedbackend-writer.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/mutation-queue.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/query-set.js","webpack://[name]/./kedbackend/js/dist/js/ked-backend-repo/utils.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/index.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/migrate-course.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/migrate-task.js","webpack://[name]/./kedbackend/js/dist/js/ked-model-migrator/migrate.js","webpack://[name]/./kedbackend/js/dist/js/observable/collection.js","webpack://[name]/./kedbackend/js/dist/js/observable/emitter.js","webpack://[name]/./kedbackend/js/dist/js/observable/fiber-context.js","webpack://[name]/./kedbackend/js/dist/js/observable/index.js","webpack://[name]/./kedbackend/js/dist/js/observable/map.js","webpack://[name]/./kedbackend/js/dist/js/observable/mixin.js","webpack://[name]/./kedbackend/js/dist/js/observable/observable.js","webpack://[name]/./kedbackend/js/dist/js/observable/value.js","webpack://[name]/./kedbackend/observable.js","webpack://[name]/./kedbackend/repo.js","webpack://[name]/./src/access-control/get-user-claims.ts","webpack://[name]/./src/access-control/index.ts","webpack://[name]/./src/apis/edsclient.ts","webpack://[name]/./src/apis/mock/mock-classroom-data.ts","webpack://[name]/./src/components/charts/goal-progress.tsx","webpack://[name]/./src/components/course-builder-ks/common/two-columns-page.tsx","webpack://[name]/./src/components/course-builder/sub-components/ellipsis-loader.tsx","webpack://[name]/./src/components/course-builder/sub-components/remove-item.tsx","webpack://[name]/./src/components/course-builder/sub-components/spinner.tsx","webpack://[name]/./src/components/course-viewer/course-page/task-assignments-utils.tsx","webpack://[name]/./src/components/course-viewer/course-page/urkund-utils.ts","webpack://[name]/./src/components/teacher-view/assignments-view/course-module.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/course-task-not-handed-users.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/course-task.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/course-tasks-assignments.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/index.tsx","webpack://[name]/./src/components/teacher-view/assignments-view/task-assignment.tsx","webpack://[name]/./src/components/teacher-view/courses-view/index.tsx","webpack://[name]/./src/components/teacher-view/digest-view.tsx","webpack://[name]/./src/components/teacher-view/email-templates/index.tsx","webpack://[name]/./src/components/teacher-view/index.tsx","webpack://[name]/./src/components/teacher-view/shared/notification-icon.tsx","webpack://[name]/./src/components/utility-components/LanguageContext.tsx","webpack://[name]/./src/components/utility-components/SetupLanguageIntl.tsx","webpack://[name]/./src/components/utility-components/lazy-content.tsx","webpack://[name]/./src/components/utility-components/live-query-view.tsx","webpack://[name]/./src/components/utility-components/observe.tsx","webpack://[name]/./src/components/utility-components/open-close-box.tsx","webpack://[name]/./src/components/utility-components/wysiwyg/actions.ts","webpack://[name]/./src/components/utility-components/wysiwyg/exec.ts","webpack://[name]/./src/components/utility-components/wysiwyg/html-patch-policy.ts","webpack://[name]/./src/components/utility-components/wysiwyg/image-edit-actions.ts","webpack://[name]/./src/components/utility-components/wysiwyg/index.tsx","webpack://[name]/./src/components/utility-components/wysiwyg/wash-html.ts","webpack://[name]/./src/elements/KEDAppTeacherView/app.teacherview.client.tsx","webpack://[name]/./src/elements/KEDAppTeacherView/webpack-entry.ts","webpack://[name]/./src/global-setters/configure.ts","webpack://[name]/./src/global-setters/set-all.ts","webpack://[name]/./src/global-setters/set-bearer-providers.ts","webpack://[name]/./src/global-setters/set-eds-client.ts","webpack://[name]/./src/global-setters/set-ked-backend-client.ts","webpack://[name]/./src/globals/KED.cfg.ts","webpack://[name]/./src/globals/KED.env.ts","webpack://[name]/./src/globals/KED.ts","webpack://[name]/./src/globals/current-user.ts","webpack://[name]/./src/globals/db.ts","webpack://[name]/./src/globals/ked.ts","webpack://[name]/./src/utils/error-success-feedback.tsx","webpack://[name]/./src/utils/make-suspense-api.ts","webpack://[name]/./src/utils/query-string.ts","webpack://[name]/./src/utils/school-moment.ts","webpack://[name]/./src/utils/school-term.ts","webpack://[name]/./src/utils/utils.ts"],"sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"kedappteacherview\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp_name_\"] = window[\"webpackJsonp_name_\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"./src/elements/KEDAppTeacherView/webpack-entry.ts\",\"vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from './js/dist/js/ked-backend-client';","export * from './js/dist/js/ked-backend-client-web';","var BearerStorageSessionStorage = /** @class */ (function () {\r\n    function BearerStorageSessionStorage() {\r\n    }\r\n    BearerStorageSessionStorage.prototype.save = function (id, tokenInfo) {\r\n        sessionStorage.setItem(\"bearer-\" + id, JSON.stringify(tokenInfo));\r\n    };\r\n    BearerStorageSessionStorage.prototype.load = function (id) {\r\n        try {\r\n            var json = sessionStorage.getItem(\"bearer-\" + id);\r\n            return Promise.resolve(json ? JSON.parse(json) : { token: null, expires: 0 });\r\n        }\r\n        catch (ex) {\r\n            return Promise.resolve({ token: null, expires: 0 });\r\n        }\r\n    };\r\n    return BearerStorageSessionStorage;\r\n}());\r\nexport { BearerStorageSessionStorage };\r\n//# sourceMappingURL=bearer-storage-sessionstorage.js.map","var redirHash = sessionStorage.getItem(\"redir-hash\");\r\nif (redirHash)\r\n    try {\r\n        var _a = JSON.parse(redirHash), time = _a.time, hash = _a.hash;\r\n        if (time && time > Date.now() - 60000) {\r\n            sessionStorage.removeItem(\"redir-hash\");\r\n            location.hash = hash;\r\n        }\r\n    }\r\n    catch (_) { }\r\nexport function rememberHashLocation() {\r\n    sessionStorage.setItem(\"redir-hash\", JSON.stringify({ time: Date.now(), hash: location.hash }));\r\n}\r\n//# sourceMappingURL=hash-restorer.js.map","import * as tslib_1 from \"tslib\";\r\nimport { KedBackendClient, HttpError } from '../ked-backend-client';\r\nimport { BearerStorageSessionStorage } from \"./bearer-storage-sessionstorage\";\r\nimport { avoidSimultanousCalls } from '../ked-backend-client/utils';\r\nimport { KedModelMigratorMixin } from '../ked-model-migrator';\r\nimport './hash-restorer';\r\nimport { rememberHashLocation } from './hash-restorer';\r\nKedModelMigratorMixin(KedBackendClient.prototype);\r\nexport var storage = new BearerStorageSessionStorage();\r\nvar timeOfPageLoad = Date.now();\r\nvar WebServerBearerProvider = /** @class */ (function () {\r\n    function WebServerBearerProvider(tokenPath, tokenResponseMapper, tokenId) {\r\n        this.tokenPath = tokenPath;\r\n        this.tokenResponseMapper = tokenResponseMapper;\r\n        this.tokenId = tokenId;\r\n        this.tokenInfo = { token: null, expires: 0 };\r\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\r\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\r\n    }\r\n    WebServerBearerProvider.prototype.getBearer = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            return tslib_1.__generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (!!this.tokenInfo.token) return [3 /*break*/, 2];\r\n                        if (!this.tokenId) return [3 /*break*/, 2];\r\n                        _a = this;\r\n                        return [4 /*yield*/, storage.load(this.tokenId)];\r\n                    case 1:\r\n                        _a.tokenInfo = _b.sent();\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        if (!(this.tokenInfo.expires < Date.now())) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, this.refreshBearer()];\r\n                    case 3:\r\n                        _b.sent();\r\n                        _b.label = 4;\r\n                    case 4: return [2 /*return*/, this.tokenInfo];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WebServerBearerProvider.prototype.refreshBearer = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b, _c, _d;\r\n            return tslib_1.__generator(this, function (_e) {\r\n                switch (_e.label) {\r\n                    case 0: return [4 /*yield*/, fetch(this.tokenPath, {\r\n                            headers: { Accept: \"text/plain; application/json\" },\r\n                            redirect: 'manual',\r\n                            cache: 'no-cache',\r\n                            credentials: \"same-origin\"\r\n                        })];\r\n                    case 1:\r\n                        res = _e.sent();\r\n                        if (res.status === 302 || (!res.status && res.type === \"opaqueredirect\")) {\r\n                            // User session timed out and server wants to redirect entire page to login page\r\n                            // Time to reload current page to force a redirect of the entire page instead for\r\n                            // just redirecting to /api/token or whatever.\r\n                            if (Date.now() - timeOfPageLoad > 60000) { // prohibit endless loop of reloading self.\r\n                                this.wantsRedirect = true; // So that listeners to onbeforeunload could show alternate message.\r\n                                console.log(\"Redirect wanted. Reload page.\");\r\n                                rememberHashLocation();\r\n                                window.location.reload(true);\r\n                                throw new HttpError(302, \"Redirected\");\r\n                            }\r\n                        }\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = Error.bind;\r\n                        _b = \"HTTP\" + res.status + \" \";\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(Error, [void 0, _b + (_e.sent())]))();\r\n                    case 3:\r\n                        _c = this;\r\n                        _d = this.tokenResponseMapper;\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 4:\r\n                        _c.tokenInfo = _d.apply(this, [_e.sent()]);\r\n                        storage.save(this.tokenId, this.tokenInfo);\r\n                        return [2 /*return*/, this.tokenInfo];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return WebServerBearerProvider;\r\n}());\r\nexport { WebServerBearerProvider };\r\nexport var isomorphic = { fetch: fetch.bind(self), btoa: btoa.bind(self) };\r\nvar KedBackendClientWeb = /** @class */ (function (_super) {\r\n    tslib_1.__extends(KedBackendClientWeb, _super);\r\n    function KedBackendClientWeb(apiBaseUrl, providerOrTokenPath, options) {\r\n        var _this = this;\r\n        var bearerProvider = typeof providerOrTokenPath !== 'string' ?\r\n            providerOrTokenPath :\r\n            new WebServerBearerProvider(providerOrTokenPath, (options && options.tokenResponseMapper) || (function (x) { return ({ token: x, expires: Date.now() + 59 * 60 * 60 }); }), options && options.tokenId);\r\n        _this = _super.call(this, isomorphic, bearerProvider, apiBaseUrl) || this;\r\n        return _this;\r\n    }\r\n    return KedBackendClientWeb;\r\n}(KedBackendClient));\r\nexport { KedBackendClientWeb };\r\n//# sourceMappingURL=index.js.map","var DocumentAccess = /** @class */ (function () {\r\n    function DocumentAccess(accessClaimType, accessClaimValue, right) {\r\n        this.accessClaimType = accessClaimType;\r\n        this.accessClaimValue = accessClaimValue;\r\n        this.right = right;\r\n    }\r\n    DocumentAccess.fromString = function (ac) {\r\n        if (!ac)\r\n            return null;\r\n        var split = ac.split(':');\r\n        if (split.length < 3)\r\n            throw new Error(\"Invalid access string: \" + ac);\r\n        var claimType = DocumentAccess.unescape(split[0]);\r\n        var claimValue = DocumentAccess.unescape(split[1]);\r\n        var right = split[2];\r\n        if (right !== 'R' && right !== 'W' && right !== 'S')\r\n            throw new Error(\"Invalid access string: \" + ac);\r\n        return new DocumentAccess(claimType, claimValue, right);\r\n    };\r\n    DocumentAccess.escape = function (accessComponent) {\r\n        return accessComponent.replace(/\\%/g, \"%25\").replace(/\\:/g, \"%3A\");\r\n    };\r\n    DocumentAccess.unescape = function (accessComponent) {\r\n        return accessComponent.replace(/\\%3A/g, \":\").replace(/\\%25/g, \"%\");\r\n    };\r\n    DocumentAccess.prototype.toString = function () {\r\n        return DocumentAccess.escape(this.accessClaimType) + \":\" +\r\n            DocumentAccess.escape(this.accessClaimValue) + \":\" +\r\n            this.right;\r\n    };\r\n    DocumentAccess.fromStringArray = function (acl) {\r\n        return acl\r\n            .map(function (ac) { return DocumentAccess.fromString(ac); })\r\n            .filter(function (ac) { return ac; });\r\n    };\r\n    DocumentAccess.toStringArray = function (acl) {\r\n        return acl.map(function (ac) { return ac.toString(); });\r\n    };\r\n    return DocumentAccess;\r\n}());\r\nexport { DocumentAccess };\r\nexport function hasAccess(acl, userClaims, requestedRight) {\r\n    if (userClaims.some(function (claim) { return claim.type === 'role' && claim.value === \"ADMIN\"; }))\r\n        return true;\r\n    return acl.some(function (a) {\r\n        return userClaims.some(function (c) {\r\n            return a.accessClaimType === c.type &&\r\n                a.accessClaimValue === c.value && ((a.right === 'R' && requestedRight === 'R') ||\r\n                (a.right === 'W' && ['R', 'W'].indexOf(requestedRight) >= 0) ||\r\n                (a.right === 'S'));\r\n        });\r\n    });\r\n}\r\n//# sourceMappingURL=access-control.js.map","import * as tslib_1 from \"tslib\";\r\nvar HttpError = /** @class */ (function (_super) {\r\n    tslib_1.__extends(HttpError, _super);\r\n    function HttpError(code, message) {\r\n        var _this = _super.call(this, \"HTTP\" + code + \" \" + message) || this;\r\n        _this.code = code;\r\n        _this.message = message;\r\n        _this.name = \"http\" + code;\r\n        _this.message = \"HTTP\" + code + \" \" + message;\r\n        return _this;\r\n    }\r\n    return HttpError;\r\n}(Error));\r\nexport { HttpError };\r\n//# sourceMappingURL=http-error.js.map","import * as tslib_1 from \"tslib\";\r\nimport { RestClient } from './restclient';\r\nexport * from './utils';\r\nexport { KedBearerProvider } from './ked-bearer-provider';\r\nexport * from './access-control';\r\nexport { RestClient };\r\nimport { HttpError } from './http-error';\r\nexport { HttpError };\r\nexport * from './restclient';\r\n;\r\n// | 'otherFlag' | 'thirdFlag';...\r\nvar KedBackendClient = /** @class */ (function () {\r\n    function KedBackendClient(isomorphic, bearerProvider, baseUrl) {\r\n        this.http = new RestClient(isomorphic, baseUrl, { bearerProvider: bearerProvider });\r\n    }\r\n    KedBackendClient.prototype.getMyClaims = function (table, fetchOptions) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.http.get(\"me/claims/\" + (table || \"\"), null, fetchOptions)];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4: return [2 /*return*/, _c.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendClient.prototype.get = function (table, id, options, fetchOptions) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.http.get(table + \"/\" + id, options, fetchOptions)];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4: return [2 /*return*/, _c.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendClient.prototype.list = function (table, options, fetchOptions) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var query, res, _a, _b;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        query = tslib_1.__assign({}, options);\r\n                        if (typeof location !== 'undefined' && location.search.includes('useSP')) {\r\n                            if (!options.from &&\r\n                                !options.to &&\r\n                                (!options.include || !options.include.includes(\"acl\")) &&\r\n                                !options.role &&\r\n                                !options.name &&\r\n                                [options.hasEdgesFrom, options.hasEdgesTo, options.ids, options.tags].filter(function (x) { return !!x; }).length === 1) {\r\n                                query.flags = (query.flags || []).concat(['useSP']);\r\n                            }\r\n                        }\r\n                        if (options && options.mutationsOnEmpty)\r\n                            query.mutationsOnEmpty = JSON.stringify(options.mutationsOnEmpty);\r\n                        return [4 /*yield*/, this.http.get(\"\" + table, query, fetchOptions)];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4: return [2 /*return*/, _c.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendClient.prototype.batch = function (reqs, fetchOptions) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        // Reorder operations so that 'add's come first and 'delete's come last:\r\n                        reqs = reqs.slice().sort(function (req1, req2) {\r\n                            return req1.op === 'add' ? -1 : req2.op === 'add' ? 1 :\r\n                                req1.op === 'delete' ? 1 : req2.op === 'delete' ? -1 : 0;\r\n                        });\r\n                        return [4 /*yield*/, this.http.post(\"batch\", reqs, fetchOptions)];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4: return [2 /*return*/, _c.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendClient.prototype.do = function (scopeFn) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var runner;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        runner = new BatchRunner();\r\n                        scopeFn(runner);\r\n                        return [4 /*yield*/, this.batch(runner.mutationRequests)];\r\n                    case 1: return [2 /*return*/, _a.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendClient.prototype.deleteRealm = function (realm) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.http.delete(\"realms/\" + realm)];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4: return [2 /*return*/, _c.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendClient.prototype.add = function (table, doc, branchId) {\r\n        return this.do(function (r) { return r.add(table, doc); });\r\n    };\r\n    KedBackendClient.prototype.put = function (table, doc) {\r\n        return this.do(function (r) { return r.put(table, doc); });\r\n    };\r\n    KedBackendClient.prototype.update = function (table, id, deltaDoc, branchId) {\r\n        return this.do(function (r) { return r.update(table, id, deltaDoc, branchId); });\r\n    };\r\n    KedBackendClient.prototype.merge = function (branchId, targetBranchId) {\r\n        return this.do(function (r) { return r.merge(branchId, targetBranchId); });\r\n    };\r\n    KedBackendClient.prototype.clearBranch = function (branchId) {\r\n        return this.do(function (r) { return r.clearBranch(branchId); });\r\n    };\r\n    KedBackendClient.prototype.delete = function (table, id) {\r\n        return this.do(function (r) { return r.delete(table, id); });\r\n    };\r\n    KedBackendClient.prototype.share = function (table, id, acl) {\r\n        return this.do(function (r) { return r.share(table, id, acl); });\r\n    };\r\n    KedBackendClient.prototype.unshare = function (table, id, acl) {\r\n        return this.do(function (r) { return r.unshare(table, id, acl); });\r\n    };\r\n    KedBackendClient.prototype.link = function (sourceTable, sourceId, targetTable, targetId, label) {\r\n        return this.do(function (r) { return r.link(sourceTable, sourceId, targetTable, targetId, label); });\r\n    };\r\n    KedBackendClient.prototype.link2 = function (sourceTable, sourceId, targetId, label, branchId) {\r\n        return this.do(function (r) { return r.link2(sourceTable, sourceId, label, targetId, branchId); });\r\n    };\r\n    KedBackendClient.prototype.unlink = function (sourceTable, sourceId, targetTable, targetId, label) {\r\n        return this.do(function (r) { return r.unlink(sourceTable, sourceId, targetTable, targetId, label); });\r\n    };\r\n    KedBackendClient.prototype.unlink2 = function (sourceTable, sourceId, targetId, label, branchId) {\r\n        return this.do(function (r) { return r.unlink2(sourceTable, sourceId, label, targetId, branchId); });\r\n    };\r\n    KedBackendClient.prototype.undoLink = function (sourceTable, sourceId, targetId, label, branchId) {\r\n        return this.do(function (r) { return r.undoLink(sourceTable, sourceId, label, targetId, branchId); });\r\n    };\r\n    return KedBackendClient;\r\n}());\r\nexport { KedBackendClient };\r\nvar BatchRunner = /** @class */ (function () {\r\n    function BatchRunner() {\r\n        this.mutationRequests = [];\r\n    }\r\n    BatchRunner.prototype.add = function (table, doc, branchId) {\r\n        this.mutationRequests.push({ op: 'add', table: table, doc: doc, branchId: branchId });\r\n        return this;\r\n    };\r\n    BatchRunner.prototype.put = function (table, doc) {\r\n        doc = tslib_1.__assign({}, doc);\r\n        delete doc.acl; // Forbidden to send acl with put() calls.\r\n        this.mutationRequests.push({ op: 'put', table: table, doc: doc });\r\n        return this;\r\n    };\r\n    BatchRunner.prototype.update = function (table, id, deltaDoc, branchId) {\r\n        deltaDoc = tslib_1.__assign({}, deltaDoc);\r\n        this.mutationRequests.push({ op: 'update', table: table, id: id, deltaDoc: deltaDoc, branchId: branchId });\r\n    };\r\n    BatchRunner.prototype.merge = function (branchId, targetBranchId) {\r\n        this.mutationRequests.push({ op: 'merge', branchId: branchId, targetBranchId: targetBranchId });\r\n    };\r\n    BatchRunner.prototype.clearBranch = function (branchId) {\r\n        this.mutationRequests.push({ op: 'clear-branch', branchId: branchId });\r\n    };\r\n    BatchRunner.prototype.delete = function (table, id) {\r\n        this.mutationRequests.push({ op: 'delete', table: table, id: id });\r\n        return this;\r\n    };\r\n    BatchRunner.prototype.share = function (table, id, acl) {\r\n        this.mutationRequests.push({ op: 'share', table: table, id: id, acl: acl });\r\n        return this;\r\n    };\r\n    BatchRunner.prototype.unshare = function (table, id, acl) {\r\n        this.mutationRequests.push({ op: 'unshare', table: table, id: id, acl: acl });\r\n        return this;\r\n    };\r\n    BatchRunner.prototype.link = function (sourceTable, sourceId, targetTable, targetId, label) {\r\n        this.mutationRequests.push({ op: 'link', sourceTable: sourceTable, sourceId: sourceId, targetTable: targetTable, targetId: targetId, label: label });\r\n        return this;\r\n    };\r\n    BatchRunner.prototype.link2 = function (sourceTable, sourceId, label, targetId, branchId) {\r\n        this.mutationRequests.push({ op: 'link', sourceTable: sourceTable, sourceId: sourceId, targetId: targetId, label: label, branchId: branchId });\r\n    };\r\n    BatchRunner.prototype.unlink = function (sourceTable, sourceId, targetTable, targetId, label) {\r\n        this.mutationRequests.push({ op: 'unlink', sourceTable: sourceTable, sourceId: sourceId, targetTable: targetTable, targetId: targetId, label: label });\r\n        return this;\r\n    };\r\n    BatchRunner.prototype.unlink2 = function (sourceTable, sourceId, label, targetId, branchId) {\r\n        this.mutationRequests.push({ op: 'unlink', sourceTable: sourceTable, sourceId: sourceId, targetId: targetId, label: label, branchId: branchId });\r\n        return this;\r\n    };\r\n    BatchRunner.prototype.undoLink = function (sourceTable, sourceId, label, targetId, branchId) {\r\n        this.mutationRequests.push({ op: 'undo-link', sourceTable: sourceTable, sourceId: sourceId, targetId: targetId, label: label, branchId: branchId });\r\n    };\r\n    return BatchRunner;\r\n}());\r\nexport { BatchRunner };\r\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\r\nimport { RestClient } from './restclient';\r\nimport { avoidSimultanousCalls } from './utils';\r\nvar KedBearerProvider = /** @class */ (function () {\r\n    function KedBearerProvider(isomorphic, storage, tokenId, clientId, clientSecret, tokenUrl, tokenQuery) {\r\n        this.isomorphic = isomorphic;\r\n        this.storage = storage;\r\n        this.tokenId = tokenId;\r\n        this.clientId = clientId;\r\n        this.clientSecret = clientSecret;\r\n        this.tokenUrl = tokenUrl;\r\n        this.tokenQuery = tokenQuery;\r\n        this.tokenInfo = { token: null, expires: 0 };\r\n        this.client = new RestClient(isomorphic, \"\", {\r\n            username: this.clientId,\r\n            password: this.clientSecret\r\n        });\r\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\r\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\r\n    }\r\n    KedBearerProvider.prototype.getBearer = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var _a, token, expires, _b, e_1;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        _a = this.tokenInfo, token = _a.token, expires = _a.expires;\r\n                        if (token && expires >= Date.now())\r\n                            return [2 /*return*/, this.tokenInfo];\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        _c.trys.push([1, 4, , 6]);\r\n                        _b = this;\r\n                        return [4 /*yield*/, this.storage.load(this.clientId + \"/\" + this.tokenId)];\r\n                    case 2:\r\n                        _b.tokenInfo = _c.sent();\r\n                        if (this.tokenInfo.token && this.tokenInfo.expires >= Date.now())\r\n                            return [2 /*return*/, this.tokenInfo];\r\n                        return [4 /*yield*/, this.refreshBearer()];\r\n                    case 3:\r\n                        _c.sent();\r\n                        return [2 /*return*/, this.tokenInfo];\r\n                    case 4:\r\n                        e_1 = _c.sent();\r\n                        return [4 /*yield*/, this.refreshBearer()];\r\n                    case 5:\r\n                        _c.sent();\r\n                        return [2 /*return*/, this.tokenInfo];\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBearerProvider.prototype.refreshBearer = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, retries, _a, _b;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        retries = 0;\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        if (!(retries < 6)) return [3 /*break*/, 5];\r\n                        console.log(\"Retrieving token for \" + this.tokenId);\r\n                        return [4 /*yield*/, this.client.get(this.tokenUrl, this.tokenQuery, { cache: 'reload' })];\r\n                    case 2:\r\n                        res = _c.sent();\r\n                        if (res.status !== 200) {\r\n                            console.warn(\"Got \" + res.status + \" \" + res.statusText);\r\n                            return [3 /*break*/, 4];\r\n                        }\r\n                        _a = this;\r\n                        _b = {};\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 3:\r\n                        _a.tokenInfo = (_b.token = _c.sent(), _b.expires = Date.now() + 59 * 60 * 1000, _b);\r\n                        console.log(\"Got token for \" + this.tokenId + \": \" + JSON.stringify(this.tokenInfo));\r\n                        this.storage.save(this.clientId + \"/\" + this.tokenId, this.tokenInfo);\r\n                        return [2 /*return*/, this.tokenInfo];\r\n                    case 4:\r\n                        ++retries;\r\n                        return [3 /*break*/, 1];\r\n                    case 5: throw new Error(\"Failed to retrieve token for \" + JSON.stringify(this.tokenId));\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return KedBearerProvider;\r\n}());\r\nexport { KedBearerProvider };\r\n//# sourceMappingURL=ked-bearer-provider.js.map","/*\r\ndeclare var Buffer; // node built-in\r\n\r\n\r\nfunction basicAuthHeader(username, password) {\r\n    return \"Basic \" + new Buffer(username + \":\" + password).toString(\"base64\");\r\n}\r\n*/\r\nimport * as tslib_1 from \"tslib\";\r\nimport { createUUID } from \"./utils\";\r\nimport { Emitter } from '../observable/emitter';\r\nvar RestClient = /** @class */ (function () {\r\n    function RestClient(isomorphic, baseUrl, options) {\r\n        this.isomorphic = isomorphic;\r\n        this.baseUrl = baseUrl;\r\n        this.options = options;\r\n        this.numOutstandingOperations = 0;\r\n        this.cache = {}; //, timeout: number}};\r\n        this._status = new Emitter(this);\r\n        this.fetchOptions = { mode: 'cors' };\r\n        this.authHeader = options.bearer ?\r\n            \"Bearer \" + options.bearer :\r\n            options.username ?\r\n                \"Basic \" + isomorphic.btoa(options.username + \":\" + (options.password || \"\")) :\r\n                null;\r\n        this.bearerProvider = options.bearerProvider || null;\r\n    }\r\n    Object.defineProperty(RestClient.prototype, \"status\", {\r\n        get: function () {\r\n            return this._status;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    RestClient.prototype.suspenseFetch = function (path, method, headers, query, fetchOptions) {\r\n        var _this = this;\r\n        var key = method + \" \" + path + \" \" + JSON.stringify(headers) + \" \" + JSON.stringify(query) + \" \" + JSON.stringify(fetchOptions);\r\n        var entry = this.cache[key];\r\n        if (entry) {\r\n            // Entry found. Is it still being fetched?\r\n            if ('promise' in entry)\r\n                throw entry.promise; // Still being fetched. Multiple parallell fetches should work on same promise!\r\n            // Promise has resolved. Return result.\r\n            return entry.result;\r\n        }\r\n        else {\r\n            // We are the first to do this request. Start doing it:\r\n            var promise = this.fetch(path, method, headers, query, fetchOptions).then(function (res) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n                var status, text;\r\n                return tslib_1.__generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            status = res.status;\r\n                            return [4 /*yield*/, res.text()];\r\n                        case 1:\r\n                            text = _a.sent();\r\n                            this.cache[key] = {\r\n                                result: {\r\n                                    status: status,\r\n                                    text: function () { return text; },\r\n                                    json: function () { return JSON.parse(text); }\r\n                                }\r\n                            };\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            }); });\r\n            // Immediately put the promise in the cache. Multiple parallell fetches should work on the same promise!\r\n            this.cache[key] = { promise: promise };\r\n            // Suspend until promise is resolved. At that time, the cache will contain an answer!\r\n            throw promise;\r\n        }\r\n    };\r\n    RestClient.prototype.fetch = function (path, method, headers, query, fetchOptions) {\r\n        var _this = this;\r\n        ++this.numOutstandingOperations;\r\n        this._status.dispatch(this);\r\n        return this._fetch(path, method, headers, query, fetchOptions)\r\n            .then(function (res) {\r\n            --_this.numOutstandingOperations;\r\n            _this._status.dispatch(_this);\r\n            return res;\r\n        }).catch(function (err) {\r\n            --_this.numOutstandingOperations;\r\n            _this._status.dispatch(_this);\r\n            return Promise.reject(err);\r\n        });\r\n    };\r\n    RestClient.prototype._fetch = function (path, method, headers, query, fetchOptions) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var queryStr, _a, authHeader, tokenInfo, bearerProvider, _b, _c, url, res, wwwauth, _d;\r\n            return tslib_1.__generator(this, function (_e) {\r\n                switch (_e.label) {\r\n                    case 0:\r\n                        if (fetchOptions && fetchOptions.cache === 'no-cache') {\r\n                            // Workaround for back-button not respecting cache control in Chrome/Opera.\r\n                            // Append a query parameter to force a cache entry\r\n                            query = tslib_1.__assign({}, query, { nocache: createUUID() });\r\n                        }\r\n                        queryStr = query && Object.keys(query).filter(function (key) { return query[key] !== undefined; }).map(function (key) {\r\n                            return encodeURIComponent(key) +\r\n                                \"=\" +\r\n                                encodeURIComponent(query[key]);\r\n                        })\r\n                            .join('&');\r\n                        _a = this, authHeader = _a.authHeader, tokenInfo = _a.tokenInfo, bearerProvider = _a.bearerProvider;\r\n                        if (!(!authHeader && !tokenInfo && bearerProvider)) return [3 /*break*/, 2];\r\n                        _b = this;\r\n                        return [4 /*yield*/, bearerProvider.getBearer()];\r\n                    case 1:\r\n                        _b.tokenInfo = tokenInfo = _e.sent();\r\n                        _e.label = 2;\r\n                    case 2:\r\n                        if (!tokenInfo) return [3 /*break*/, 5];\r\n                        if (!(tokenInfo.expires < Date.now())) return [3 /*break*/, 4];\r\n                        console.log(\"Token expired. Refresh it:\");\r\n                        _c = this;\r\n                        return [4 /*yield*/, bearerProvider.refreshBearer()];\r\n                    case 3:\r\n                        _c.tokenInfo = tokenInfo = _e.sent();\r\n                        _e.label = 4;\r\n                    case 4:\r\n                        authHeader = \"Bearer \" + tokenInfo.token;\r\n                        _e.label = 5;\r\n                    case 5:\r\n                        // In one way or another, we've concluded an Authorization header to use:\r\n                        if (authHeader) {\r\n                            headers.Authorization = authHeader;\r\n                        }\r\n                        url = this.baseUrl + path + (queryStr ? \"?\" + queryStr : \"\");\r\n                        return [4 /*yield*/, this.isomorphic.fetch(url, tslib_1.__assign({}, this.fetchOptions, { headers: headers, method: method }, fetchOptions))];\r\n                    case 6:\r\n                        res = _e.sent();\r\n                        if (!(res.status == 401 && this.bearerProvider)) return [3 /*break*/, 9];\r\n                        wwwauth = res.headers.get(\"www-authenticate\");\r\n                        console.log(\"Got \" + res.status + \" from \" + (this.baseUrl + path));\r\n                        if (!(wwwauth && /Bearer/i.test(wwwauth))) return [3 /*break*/, 9];\r\n                        _d = this;\r\n                        return [4 /*yield*/, this.bearerProvider.refreshBearer()];\r\n                    case 7:\r\n                        _d.tokenInfo = _e.sent();\r\n                        headers.Authorization = \"Bearer \" + this.tokenInfo.token;\r\n                        return [4 /*yield*/, this.isomorphic.fetch(url, tslib_1.__assign({}, this.fetchOptions, { headers: headers, method: method }, fetchOptions))];\r\n                    case 8:\r\n                        res = _e.sent();\r\n                        _e.label = 9;\r\n                    case 9: return [2 /*return*/, res];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RestClient.prototype.get = function (path, query, fetchOptions) {\r\n        return this.fetch(path, \"GET\", { Accept: \"application/json; text/plain\" }, query, fetchOptions);\r\n    };\r\n    RestClient.prototype.suspenseGet = function (path, query, fetchOptions) {\r\n        return this.suspenseFetch(path, \"GET\", { Accept: \"application/json; text/plain\" }, query, fetchOptions);\r\n    };\r\n    RestClient.prototype.post = function (path, data, fetchOptions) {\r\n        return this.fetch(path, \"POST\", {\r\n            \"Content-Type\": \"application/json\",\r\n            \"Accept\": \"application/json\"\r\n        }, null, tslib_1.__assign({}, fetchOptions, { body: JSON.stringify(data) }));\r\n    };\r\n    RestClient.prototype.delete = function (path, query, body, fetchOptions) {\r\n        return this.fetch(path, \"DELETE\", { Accept: \"application/json; text/plain\" }, query, tslib_1.__assign({}, fetchOptions, { body: body }));\r\n    };\r\n    return RestClient;\r\n}());\r\nexport { RestClient };\r\n//# sourceMappingURL=restclient.js.map","import * as tslib_1 from \"tslib\";\r\nexport function createUUID() {\r\n    // Decent solution from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\r\n    var d = Date.now();\r\n    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n        var r = (d + Math.random() * 16) % 16 | 0;\r\n        d = Math.floor(d / 16);\r\n        return (c === 'x' ? r : (r & 0x7 | 0x8)).toString(16);\r\n    });\r\n    return uuid;\r\n}\r\nexport function avoidSimultanousCalls(method) {\r\n    var ongoingPromise = null;\r\n    return function () {\r\n        if (!ongoingPromise) {\r\n            ongoingPromise = method.apply(this, arguments).then(function (result) {\r\n                ongoingPromise = null;\r\n                return result;\r\n            });\r\n        }\r\n        return ongoingPromise;\r\n    };\r\n}\r\nexport function getGlobalId(realm) {\r\n    var prefix = 'ec96b3be-45fc-41d3-b69e-';\r\n    var pad = ['50', '08', 'e1', '40', 'e4', 'e7'];\r\n    if (realm.length > 6)\r\n        throw new Error(\"Too long realm\");\r\n    for (var i = 0; i < realm.length; ++i) {\r\n        var hex = realm.charCodeAt(i).toString(16);\r\n        pad[i] = hex.length === 2 ?\r\n            hex :\r\n            '0' + hex;\r\n    }\r\n    return prefix + pad.join('');\r\n}\r\nexport function computePredestinatedId(input) {\r\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n        var encoder, data, digest, _a, i;\r\n        return tslib_1.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    encoder = new TextEncoder();\r\n                    data = encoder.encode(input);\r\n                    _a = Uint8Array.bind;\r\n                    return [4 /*yield*/, crypto.subtle.digest('SHA-256', data)];\r\n                case 1:\r\n                    digest = new (_a.apply(Uint8Array, [void 0, _b.sent()]))();\r\n                    i = 0;\r\n                    return [2 /*return*/, 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n                            var nibble = digest[i++] % 16 | 0;\r\n                            var washedNibble = c === 'x' ?\r\n                                nibble :\r\n                                nibble & 0x7 | 0x8;\r\n                            return washedNibble.toString(16);\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nexport function simpleDigest(input) {\r\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n        var encoder, inputBytes, digestBytes, _a;\r\n        return tslib_1.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    encoder = new TextEncoder();\r\n                    inputBytes = encoder.encode(input);\r\n                    _a = Uint8Array.bind;\r\n                    return [4 /*yield*/, crypto.subtle.digest('SHA-256', inputBytes)];\r\n                case 1:\r\n                    digestBytes = new (_a.apply(Uint8Array, [void 0, _b.sent(), 0, 16]))();\r\n                    return [2 /*return*/, buf2hex(digestBytes)];\r\n            }\r\n        });\r\n    });\r\n}\r\nvar simpleDigestCache = {};\r\nexport function simpleDigestSuspense(inputs) {\r\n    var results = inputs.map(function (input) { return simpleDigestCache[input]; });\r\n    var unresolvedInputs = [];\r\n    results.forEach(function (result, index) {\r\n        if (!result)\r\n            unresolvedInputs.push(inputs[index]);\r\n    });\r\n    if (unresolvedInputs.length === 0)\r\n        return results;\r\n    throw Promise.all(unresolvedInputs.map(function (input) { return simpleDigest(input).then(function (result) { return simpleDigestCache[input] = result; }); }));\r\n}\r\nexport function buf2hex(buffer) {\r\n    return Array.prototype.map.call(buffer, function (x) { return ('00' + x.toString(16)).slice(-2); }).join('');\r\n}\r\nexport function updateArray(a, mapper) {\r\n    var retval = a;\r\n    for (var i = 0, l = a.length; i < l; ++i) {\r\n        var t = a[i];\r\n        var mapped = mapper(t);\r\n        if (mapped !== t) {\r\n            if (retval === a)\r\n                retval = a.slice();\r\n            retval[i] = mapped;\r\n        }\r\n    }\r\n    return retval;\r\n}\r\n/*\r\nexport function updateArray<T>(a: T[], mapper: (t: T) => T | false): T[] {\r\n  let retval = a;\r\n  let j = 0;\r\n  for (let i=0,l=a.length; i<l; ++i, ++j) {\r\n    const t = a[i];\r\n    const mapped = mapper(t);\r\n    if (mapped === false) {\r\n      // Mapper wants to delete this doc.\r\n      if (retval === a) retval = a.slice();\r\n      retval.splice(j, 1);\r\n      --j; // compensate for ++j\r\n    } else if (mapped !== t) {\r\n      if (retval === a) retval = a.slice();\r\n      retval[j] = mapped;\r\n    }\r\n  }\r\n  return retval;\r\n}\r\n*/ \r\n//# sourceMappingURL=utils.js.map","import * as JsonSchema from \"kedbackend-schema/schema.json\";\r\nimport { getTableFromLabel } from \"./utils\";\r\nvar CacheBust = /** @class */ (function () {\r\n    function CacheBust() {\r\n    }\r\n    CacheBust.getCacheBust = function (table, query, user, includes) {\r\n        var involvedItems = CacheBust.getInvolvedItems(table, query, includes);\r\n        return involvedItems\r\n            .map(function (item) { return localStorage.getItem(\"cache-bust-\" + user + \"-\" + item); })\r\n            .filter(function (value) { return !!value; })\r\n            .join('/') || 'static';\r\n    };\r\n    CacheBust.invalidateCache = function (reqs, user) {\r\n        for (var _i = 0, _a = CacheBust.getCacheInvalidations(reqs); _i < _a.length; _i++) {\r\n            var item = _a[_i];\r\n            localStorage.setItem(\"cache-bust-\" + user + \"-\" + item, '' + Date.now());\r\n        }\r\n    };\r\n    CacheBust.getInvolvedItems = function (table, query, includes) {\r\n        var hasEdgesFrom = query.hasEdgesFrom;\r\n        var relatedTables = includes\r\n            .map(function (label) { return JsonSchema.tables[table].relationships[label]; })\r\n            .filter(function (table) { return !!table; });\r\n        if (hasEdgesFrom)\r\n            relatedTables.push(\"hef\" + table);\r\n        return [table, 'master', query.branchId].filter(function (x) { return !!x; }).concat(relatedTables).sort();\r\n    };\r\n    CacheBust.getCacheInvalidations = function (reqs) {\r\n        var invalidationSet = {};\r\n        reqs.forEach(function (req) {\r\n            switch (req.op) {\r\n                case 'add':\r\n                case 'put':\r\n                case 'delete':\r\n                case 'update':\r\n                    invalidationSet[req.table] = true;\r\n                    break;\r\n                case 'link':\r\n                case 'unlink':\r\n                case 'undo-link':\r\n                    invalidationSet[req.sourceTable] = true;\r\n                    invalidationSet[\"hef-\" + getTableFromLabel(req.sourceTable, req.label)] = true;\r\n                    break;\r\n                case 'clear-branch':\r\n                    invalidationSet[req.branchId] = true;\r\n                    break;\r\n                case 'merge':\r\n                    invalidationSet[req.branchId] = true;\r\n                    invalidationSet[req.targetBranchId || \"master\"] = true;\r\n                    break;\r\n            }\r\n        });\r\n        return Object.keys(invalidationSet);\r\n    };\r\n    return CacheBust;\r\n}());\r\nexport { CacheBust };\r\n//# sourceMappingURL=cache-bust.js.map","import * as tslib_1 from \"tslib\";\r\nimport { mergeDeltas } from '../delta-merge';\r\nexport function applyMutationsOnDeltas(branchId, deltas, mutations, optimistic, userDisplayName, hasAdditionalFilter) {\r\n    var _loop_1 = function (m) {\r\n        switch (m.op) {\r\n            case 'add-related':\r\n                //\r\n                // AddRelated RepoMutation\r\n                //\r\n                if (!hasAdditionalFilter && m.branchId === branchId) {\r\n                    deltas = [{\r\n                            type: 'add',\r\n                            sourceId: m.id,\r\n                            targetId: m.relatedDoc.id,\r\n                            label: m.graphProp,\r\n                            sourceTable: m.table,\r\n                            $meta: optimistic ? 'adding' : 'persisted',\r\n                            dateTime: Date.now(),\r\n                            targetName: m.relatedDoc.name,\r\n                            contributor: userDisplayName\r\n                        }].concat(deltas);\r\n                }\r\n                break;\r\n            case 'clear-branch':\r\n                //\r\n                // ClearBranch RepoMutation\r\n                //\r\n                if (m.branchId === branchId) {\r\n                    deltas = [];\r\n                }\r\n                break;\r\n            case 'delete':\r\n                //\r\n                // Delete RepoMutation\r\n                //\r\n                // This type of mutation can not be performed onto branches. There's no branchId property on m.\r\n                break;\r\n            case 'merge':\r\n                //\r\n                // Merge RepoMutation\r\n                //\r\n                if (m.branchId === branchId) {\r\n                    deltas = [];\r\n                }\r\n                else if (m.targetBranchId === branchId) {\r\n                    // This change will append new deltas to our deltas array but we don't know what would come.\r\n                    // Need to refetch from server.\r\n                    if (!optimistic)\r\n                        return { value: null }; // Caller should check for null and re-fetch data from server.\r\n                }\r\n                break;\r\n            case 'remove-related':\r\n                //\r\n                // Remove-Related RepoMutation\r\n                //\r\n                if (hasAdditionalFilter || m.branchId !== branchId)\r\n                    return \"continue\";\r\n                deltas = [{\r\n                        type: 'remove',\r\n                        sourceId: m.id,\r\n                        targetId: m.relatedDoc.id,\r\n                        targetName: m.relatedDoc.name,\r\n                        label: m.graphProp,\r\n                        sourceTable: m.table,\r\n                        contributor: userDisplayName,\r\n                        dateTime: Date.now(),\r\n                        $meta: optimistic ? 'adding' : 'persisted'\r\n                    }].concat(deltas);\r\n                break;\r\n            case 'undo-link':\r\n                //\r\n                // Undo-Link RepoMutation\r\n                //\r\n                if (m.branchId !== branchId)\r\n                    return \"continue\";\r\n                {\r\n                    var idx = deltas.findIndex(function (d) {\r\n                        return (d.type === 'add' || d.type === 'remove' || d.type === 'undo-link') &&\r\n                            d.sourceId === m.id &&\r\n                            d.targetId === m.relatedId;\r\n                    });\r\n                    if (idx < 0)\r\n                        return \"continue\";\r\n                    // Found an \"add\" or \"remove\" delta to change:\r\n                    if (optimistic) {\r\n                        var deltaRelation = deltas[idx];\r\n                        // Mark the existing add/remove delta as currenlty being deleted\r\n                        deltas = deltas.slice(0, idx).concat([\r\n                            tslib_1.__assign({}, deltaRelation, { $meta: optimistic ? 'removing' : 'persisted' })\r\n                        ], deltas.slice(idx + 1));\r\n                    }\r\n                    else {\r\n                        // Persisted. Just remove it:\r\n                        deltas = deltas.slice(0, idx).concat(deltas.slice(idx + 1));\r\n                    }\r\n                }\r\n                break;\r\n            case 'update':\r\n                //\r\n                // Update RepoMutation\r\n                //\r\n                if (m.branchId !== branchId)\r\n                    return \"continue\";\r\n                {\r\n                    var idx = deltas.findIndex(function (delta) {\r\n                        return delta.type === 'modify' &&\r\n                            delta.targetId === m.id;\r\n                    });\r\n                    if (idx < 0 && !hasAdditionalFilter) {\r\n                        deltas = [{\r\n                                type: 'modify',\r\n                                table: m.table,\r\n                                targetId: m.id,\r\n                                targetName: m.targetName,\r\n                                data: m.deltaDoc,\r\n                                dateTime: Date.now(),\r\n                                contributors: [userDisplayName],\r\n                                $meta: optimistic ? 'adding' : 'persisted',\r\n                            }].concat(deltas);\r\n                    }\r\n                    else {\r\n                        var existingDeltaDoc = deltas[idx];\r\n                        var contributors = existingDeltaDoc.contributors.slice();\r\n                        if (!contributors.includes(userDisplayName)) {\r\n                            contributors.push(userDisplayName);\r\n                        }\r\n                        var newData = mergeDeltas(existingDeltaDoc.data, m.deltaDoc, { removeUnsetProps: true });\r\n                        if (!optimistic && Object.keys(newData).length === 0) {\r\n                            // Committed mutation that resets a deltaDoc. Remove the deltaDoc entirely:\r\n                            deltas = deltas.slice(0, idx).concat(deltas.slice(idx + 1));\r\n                        }\r\n                        else {\r\n                            // \r\n                            deltas = [\r\n                                {\r\n                                    type: 'modify',\r\n                                    table: m.table,\r\n                                    targetId: m.id,\r\n                                    targetName: m.targetName,\r\n                                    data: newData,\r\n                                    dateTime: Date.now(),\r\n                                    contributors: contributors,\r\n                                    $meta: optimistic ? 'updating' : 'persisted',\r\n                                }\r\n                            ].concat(deltas.slice(0, idx), deltas.slice(idx + 1));\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    };\r\n    for (var _i = 0, mutations_1 = mutations; _i < mutations_1.length; _i++) {\r\n        var m = mutations_1[_i];\r\n        var state_1 = _loop_1(m);\r\n        if (typeof state_1 === \"object\")\r\n            return state_1.value;\r\n    }\r\n    return deltas;\r\n}\r\n//# sourceMappingURL=apply-mutations-on-deltas.js.map","import * as tslib_1 from \"tslib\";\r\nimport { HttpError } from '../../ked-backend-client';\r\nimport { applyMutationsOnDeltas } from './apply-mutations-on-deltas';\r\nvar DeltaCache = /** @class */ (function () {\r\n    function DeltaCache(getClient, getUser, getUserDisplayName) {\r\n        this.getClient = getClient;\r\n        this.getUser = getUser;\r\n        this.getUserDisplayName = getUserDisplayName;\r\n        this.lookup = {};\r\n    }\r\n    DeltaCache.prototype.applyMutations = function (mutations, _a) {\r\n        var optimistic = (_a === void 0 ? { optimistic: false } : _a).optimistic;\r\n        // Apply mutations locally onto the DeltaCache and notify their subscribers\r\n        for (var _i = 0, _b = Object.keys(this.lookup); _i < _b.length; _i++) {\r\n            var queryKey = _b[_i];\r\n            var cacheEntry = this.lookup[queryKey];\r\n            if (cacheEntry.value) {\r\n                // Instead here: Store the mutations on cacheEntry. No matter if it yet has value or not.\r\n                // Then apply mutation whenever subscribing! (Better handling of mutations that arrives before fetch() is done)\r\n                // (See how I handle this in query-set.ts)\r\n                var newValue = applyMutationsOnDeltas(cacheEntry.query.branchId, cacheEntry.value, mutations, optimistic, this.getUserDisplayName(), !!cacheEntry.query.tags);\r\n                if (newValue === null) {\r\n                    // The mutation requires cacheEntry to be refetched from server\r\n                    if (!optimistic) {\r\n                        // Caller has successfully performed the mutations and got success back from server.\r\n                        // It's ok to refetch the deltas from server now:\r\n                        cacheEntry.fetch();\r\n                        // After fetch completes, it will notify the subscribers.\r\n                    }\r\n                }\r\n                if (newValue !== cacheEntry.value) {\r\n                    cacheEntry.optimisticValue = newValue;\r\n                    if (!optimistic)\r\n                        cacheEntry.value = newValue;\r\n                    cacheEntry.notify(newValue);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    DeltaCache.prototype.subscribe = function (query, observer) {\r\n        var _this = this;\r\n        var cacheEntry = this.lookup[query.branchId + query.tags];\r\n        if (!cacheEntry) {\r\n            cacheEntry = new DeltaCacheEntry(this.getClient(), query);\r\n            this.lookup[query.branchId + query.tags] = cacheEntry;\r\n        }\r\n        if (cacheEntry.cleanupTimer) {\r\n            clearTimeout(cacheEntry.cleanupTimer);\r\n            cacheEntry.cleanupTimer = null;\r\n        }\r\n        var subscription = {\r\n            unsubscribe: function () {\r\n                cacheEntry.subscribers = cacheEntry.subscribers.filter(function (_a) {\r\n                    var o = _a.observer;\r\n                    return o !== observer;\r\n                });\r\n                if (cacheEntry.subscribers.length === 0) {\r\n                    cacheEntry.cleanupTimer = setTimeout(function () {\r\n                        if (cacheEntry.subscribers.length === 0) {\r\n                            delete _this.lookup[query.branchId + query.tags];\r\n                        }\r\n                    }, 100);\r\n                }\r\n            }\r\n        };\r\n        cacheEntry.subscribers.push({ observer: observer, subscription: subscription });\r\n        if (cacheEntry.value) {\r\n            // Value has been successfully retrieved already. Pick from cache.\r\n            observer(cacheEntry.optimisticValue || cacheEntry.value, null, subscription);\r\n        }\r\n        else if (cacheEntry.isFetching) {\r\n            // A value is on its way. Sit back and relax. All registered\r\n            // observers (including this one) will be notified when data arrives\r\n            // or fails.\r\n        }\r\n        else if (cacheEntry.error) {\r\n            observer(null, cacheEntry.error, subscription);\r\n        }\r\n        else {\r\n            cacheEntry.fetch();\r\n        }\r\n        return subscription;\r\n    };\r\n    return DeltaCache;\r\n}());\r\nexport { DeltaCache };\r\nvar DeltaCacheEntry = /** @class */ (function () {\r\n    function DeltaCacheEntry(client, query) {\r\n        this.fetchOperationId = 0; // Makes sure a re-fetch will discard the result from any ongoing fetch.\r\n        this.client = client;\r\n        this.query = query;\r\n        this.value = null;\r\n        this.error = null;\r\n        this.optimisticValue = null;\r\n        this.subscribers = [];\r\n        this.isFetching = false;\r\n        this.cleanupTimer = null;\r\n    }\r\n    DeltaCacheEntry.prototype.fetch = function () {\r\n        var _this = this;\r\n        var fetchOperationId = ++this.fetchOperationId;\r\n        this.isFetching = true;\r\n        this.fetchFromServer().then(function (value) {\r\n            // Success\r\n            if (fetchOperationId === _this.fetchOperationId) {\r\n                _this.isFetching = false;\r\n                value.sort(function (a, b) { return b.dateTime - a.dateTime; }); // Latest first\r\n                _this.value = value;\r\n                _this.optimisticValue = value;\r\n                _this.notify(value);\r\n            }\r\n        }).catch(function (error) {\r\n            // Fail\r\n            if (fetchOperationId === _this.fetchOperationId) {\r\n                _this.isFetching = false;\r\n                _this.error = error;\r\n                _this.fail(error);\r\n            }\r\n        });\r\n    };\r\n    DeltaCacheEntry.prototype.fetchFromServer = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        if (!this.query.branchId)\r\n                            throw new Error('Deltas only available on branches');\r\n                        return [4 /*yield*/, this.client.http.get('deltas', this.query)];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status >= 300 || res.status < 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4: return [2 /*return*/, _c.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    DeltaCacheEntry.prototype.notify = function (value) {\r\n        for (var _i = 0, _a = this.subscribers; _i < _a.length; _i++) {\r\n            var _b = _a[_i], observer = _b.observer, subscription = _b.subscription;\r\n            observer(value, null, subscription);\r\n        }\r\n    };\r\n    DeltaCacheEntry.prototype.fail = function (error) {\r\n        var copy = this.subscribers.slice();\r\n        this.subscribers = [];\r\n        for (var _i = 0, copy_1 = copy; _i < copy_1.length; _i++) {\r\n            var _a = copy_1[_i], observer = _a.observer, subscription = _a.subscription;\r\n            observer(null, error, subscription);\r\n        }\r\n    };\r\n    return DeltaCacheEntry;\r\n}());\r\n//# sourceMappingURL=delta-cache.js.map","import * as tslib_1 from \"tslib\";\r\nimport { Collection } from '../../observable';\r\nvar DeltaCollection = /** @class */ (function (_super) {\r\n    tslib_1.__extends(DeltaCollection, _super);\r\n    function DeltaCollection(deltaCache, query) {\r\n        var _this = _super.call(this, function (observer) { return _this.deltaCache.subscribe(query, observer); }) || this;\r\n        _this.deltaCache = deltaCache;\r\n        _this.query = query;\r\n        return _this;\r\n    }\r\n    DeltaCollection.prototype.tags = function () {\r\n        var tags = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            tags[_i] = arguments[_i];\r\n        }\r\n        return new DeltaCollection(this.deltaCache, tslib_1.__assign({}, this.query, { tags: tags }));\r\n    };\r\n    return DeltaCollection;\r\n}(Collection));\r\nexport { DeltaCollection };\r\n//# sourceMappingURL=delta-collection.js.map","import * as tslib_1 from \"tslib\";\r\nexport function applyDelta(doc, delta) {\r\n    var keys = Object.keys(delta);\r\n    var targetDoc = doc;\r\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\r\n        var key = keys_1[_i];\r\n        if (targetDoc === doc)\r\n            targetDoc = tslib_1.__assign({}, doc);\r\n        var val = delta[key];\r\n        if (val && typeof val === 'object') {\r\n            var metaInstructions = Object.keys(val)\r\n                .filter(function (key) { return key.startsWith('$'); });\r\n            if (metaInstructions.length > 0) {\r\n                var _loop_1 = function (mi) {\r\n                    var miValue = val[mi];\r\n                    switch (mi) {\r\n                        case \"$unset\": {\r\n                            // Do nothing on target doc!\r\n                            targetDoc.$wasUnset = true; // Just mark it for re-retrieval after successful posting changes.\r\n                            break;\r\n                        }\r\n                        case \"$add\": {\r\n                            var valuesToAdd = miValue;\r\n                            if (!Array.isArray(valuesToAdd)) {\r\n                                throw new Error(\"$add instruction must contain array\");\r\n                            }\r\n                            var targetArray = targetDoc[key];\r\n                            if (!Array.isArray(targetArray)) {\r\n                                targetArray = [];\r\n                            }\r\n                            else {\r\n                                targetArray = targetArray.slice(); // On JS side, we must be immutable\r\n                            }\r\n                            targetDoc[key] = targetArray;\r\n                            for (var _i = 0, valuesToAdd_1 = valuesToAdd; _i < valuesToAdd_1.length; _i++) {\r\n                                var v = valuesToAdd_1[_i];\r\n                                if (!targetArray.includes(v)) { // avoid dups\r\n                                    targetArray.push(v);\r\n                                }\r\n                            }\r\n                            break;\r\n                        }\r\n                        case \"$remove\": {\r\n                            var valuesToRemove_1 = miValue;\r\n                            if (!Array.isArray(valuesToRemove_1)) {\r\n                                throw new Error(\"$remove instruction must contain array\");\r\n                            }\r\n                            var targetArray = targetDoc[key];\r\n                            if (!Array.isArray(targetArray)) {\r\n                                targetArray = [];\r\n                            }\r\n                            targetDoc[key] = targetArray.filter(function (t) { return !valuesToRemove_1.includes(t); });\r\n                            break;\r\n                        }\r\n                    }\r\n                };\r\n                for (var _a = 0, metaInstructions_1 = metaInstructions; _a < metaInstructions_1.length; _a++) {\r\n                    var mi = metaInstructions_1[_a];\r\n                    _loop_1(mi);\r\n                }\r\n                continue;\r\n            }\r\n        }\r\n        targetDoc[key] = val;\r\n    }\r\n    return targetDoc;\r\n}\r\n// {name: \"Ulla\"}, {name: {$unset:0}\r\n// {tags: {$add: \"hej\"}}, {tags: {$unset:0}\"}\r\nexport function mergeDeltas(delta1, delta2, _a) {\r\n    var removeUnsetProps = (_a === void 0 ? { removeUnsetProps: false } : _a).removeUnsetProps;\r\n    //return {...delta1, ...delta2};\r\n    var keys = Object.keys(delta2);\r\n    var targetDelta = tslib_1.__assign({}, delta1);\r\n    for (var _i = 0, keys_2 = keys; _i < keys_2.length; _i++) {\r\n        var key = keys_2[_i];\r\n        var val = delta2[key];\r\n        if (val && typeof val === 'object') {\r\n            var metaInstructions = Object.keys(val)\r\n                .filter(function (key) { return key.startsWith('$'); });\r\n            if (metaInstructions.length > 0) {\r\n                var _loop_2 = function (mi) {\r\n                    var miValue = val[mi];\r\n                    switch (mi) {\r\n                        case \"$unset\": {\r\n                            if (removeUnsetProps) {\r\n                                delete targetDelta[key];\r\n                            }\r\n                            else {\r\n                                // No matter if targetDelta is empty or has value. Set it to {$unset:0}\r\n                                // to make sure the very end result will have {$unset:0}\r\n                                targetDelta[key] = { $unset: 0 };\r\n                            }\r\n                            break;\r\n                        }\r\n                        case \"$add\": {\r\n                            var valuesToAdd_2 = miValue;\r\n                            if (!Array.isArray(valuesToAdd_2)) {\r\n                                throw new Error(\"$add instruction must contain array\");\r\n                            }\r\n                            var targetMetaProp = targetDelta[key];\r\n                            targetMetaProp = targetMetaProp ? tslib_1.__assign({}, targetMetaProp) : {};\r\n                            targetDelta[key] = targetMetaProp;\r\n                            // First, just check if target metaProp has {$remove: [...items]}\r\n                            // If so, remove any equal items from there before merging the {$add: [...]} arrays.\r\n                            var targetRemoveArray = targetMetaProp.$remove;\r\n                            if (Array.isArray(targetRemoveArray)) {\r\n                                targetMetaProp.$remove =\r\n                                    targetRemoveArray.filter(function (t) { return !valuesToAdd_2.includes(t); });\r\n                                if (targetMetaProp.$remove.length === 0) {\r\n                                    // If $remove array became emtpy. Remove the $remove prop.\r\n                                    delete targetMetaProp.$remove;\r\n                                }\r\n                            }\r\n                            // Now it's time to merge or create target $add array.\r\n                            var targetAddArray = targetMetaProp.$add;\r\n                            targetAddArray = targetAddArray ? targetAddArray.concat(valuesToAdd_2) : valuesToAdd_2.slice();\r\n                            targetMetaProp.$add = targetAddArray;\r\n                            break;\r\n                        }\r\n                        case \"$remove\": {\r\n                            var valuesToRemove_2 = miValue;\r\n                            if (!Array.isArray(valuesToRemove_2)) {\r\n                                throw new Error(\"$remove instruction must contain array\");\r\n                            }\r\n                            var targetMetaProp = targetDelta[key];\r\n                            targetMetaProp = targetMetaProp ? tslib_1.__assign({}, targetMetaProp) : {};\r\n                            targetDelta[key] = targetMetaProp;\r\n                            // First, just check if target metaProp has {$add: [...items]}\r\n                            // If so, remove any equal items from there before merging the {$remove: [...]} arrays.\r\n                            var targetAddArray = targetMetaProp.$remove;\r\n                            if (Array.isArray(targetAddArray)) {\r\n                                targetMetaProp.$add =\r\n                                    targetAddArray.filter(function (t) { return !valuesToRemove_2.includes(t); });\r\n                                if (targetMetaProp.$add.length === 0) {\r\n                                    // If $add array became emtpy. Remove the $add prop.\r\n                                    delete targetMetaProp.$add;\r\n                                }\r\n                            }\r\n                            // Now it's time to merge or create target $remove array.\r\n                            var targetRemoveArray = targetMetaProp.$remove;\r\n                            targetRemoveArray = targetRemoveArray ? targetRemoveArray.concat(valuesToRemove_2) : valuesToRemove_2.slice();\r\n                            targetMetaProp.$remove = targetRemoveArray;\r\n                            break;\r\n                        }\r\n                    }\r\n                };\r\n                for (var _b = 0, metaInstructions_2 = metaInstructions; _b < metaInstructions_2.length; _b++) {\r\n                    var mi = metaInstructions_2[_b];\r\n                    _loop_2(mi);\r\n                }\r\n                continue;\r\n            }\r\n        }\r\n        targetDelta[key] = val;\r\n    }\r\n    return targetDelta;\r\n}\r\n//# sourceMappingURL=delta-merge.js.map","export * from './kedbackend-collection';\r\nexport * from './kedbackend-query';\r\nexport * from './kedbackend-repo';\r\nexport * from './kedbackend-subscription';\r\nexport * from './kedbackend-writer';\r\nexport * from './mutation-queue';\r\nexport * from './query-set';\r\nexport * from '../observable/mixin';\r\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\r\nimport { BatchRunner } from '../ked-backend-client';\r\nimport { KedBackendSubscription } from \"./kedbackend-subscription\";\r\nimport { CacheBust } from './cache-bust';\r\nimport { KedBackendQuery } from './kedbackend-query';\r\nimport { Collection } from '../observable/collection';\r\n/**\r\n * Represents a \"live\" query against a table or filtered table.\r\n */\r\nvar KedBackendCollection = /** @class */ (function (_super) {\r\n    tslib_1.__extends(KedBackendCollection, _super);\r\n    function KedBackendCollection(repo, table, query) {\r\n        var _this = _super.call(this, function (observer) {\r\n            var subscription = new KedBackendSubscription(observer, _this);\r\n            _this.repo.querySet.subscribe(subscription);\r\n            return subscription;\r\n        }) || this;\r\n        _this.repo = repo;\r\n        _this.table = table;\r\n        _this.query = query;\r\n        return _this;\r\n    }\r\n    Object.defineProperty(KedBackendCollection.prototype, \"queryKey\", {\r\n        get: function () {\r\n            return KedBackendQuery.queryKey(this.table, this.query);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(KedBackendCollection.prototype, \"includes\", {\r\n        get: function () {\r\n            return this._includes || (this._includes = [].concat(this.query.include || []));\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    KedBackendCollection.prototype.applyQuery = function (query) {\r\n        return new KedBackendCollection(this.repo, this.table, tslib_1.__assign({}, this.query, query));\r\n    };\r\n    KedBackendCollection.prototype.addToQueryArrayProp = function (arrayProp, entries) {\r\n        var _a;\r\n        return this.applyQuery((_a = {}, _a[arrayProp] = (this.query[arrayProp] || []).concat(entries), _a));\r\n    };\r\n    KedBackendCollection.prototype.addFlags = function () {\r\n        var flags = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            flags[_i] = arguments[_i];\r\n        }\r\n        return this.addToQueryArrayProp(\"flags\", flags);\r\n    };\r\n    KedBackendCollection.prototype.debug = function () {\r\n        return this.applyQuery({ debug: true });\r\n    };\r\n    KedBackendCollection.prototype.idsOnly = function () {\r\n        return this.addFlags(\"idsOnly\");\r\n    };\r\n    KedBackendCollection.prototype.idsAndNamesOnly = function () {\r\n        return this.addFlags(\"idsAndNamesOnly\");\r\n    };\r\n    KedBackendCollection.prototype.includeIdsOnly = function () {\r\n        return this.addFlags(\"includeIdsOnly\");\r\n    };\r\n    KedBackendCollection.prototype.includeIdsAndNamesOnly = function () {\r\n        return this.addFlags(\"includeIdsAndNamesOnly\");\r\n    };\r\n    KedBackendCollection.prototype.between = function (from, to) {\r\n        return this.applyQuery({ from: from, to: to });\r\n    };\r\n    KedBackendCollection.prototype.role = function (role) {\r\n        return this.applyQuery({ role: role });\r\n    };\r\n    KedBackendCollection.prototype.hasEdgesFrom = function (ids) {\r\n        if (ids.length === 0 || ids.some(function (id) { return !id; }))\r\n            throw new Error(\"Invalid id list given to Collection.hasEdgesFrom(\" + JSON.stringify(ids) + \")\");\r\n        var hef = this.addToQueryArrayProp(\"hasEdgesFrom\", ids);\r\n        return hef;\r\n    };\r\n    KedBackendCollection.prototype.hasEdgesTo = function (ids) {\r\n        if (ids.length === 0 || ids.some(function (id) { return !id; }))\r\n            throw new Error(\"Invalid id list given to Collection.hasEdgesTo(\" + JSON.stringify(ids) + \")\");\r\n        var het = this.addToQueryArrayProp(\"hasEdgesTo\", ids);\r\n        return het;\r\n    };\r\n    KedBackendCollection.prototype.id = function (id) {\r\n        var _this = this;\r\n        return this.applyQuery({ ids: [id] }).single({\r\n            onZero: function () { throw new Error(\"Could not find entity in \" + _this.table + \" with id \" + id); },\r\n            onMany: function () { throw new Error(\"Multiple entries in \" + _this.table + \" with id \" + id); },\r\n        });\r\n    };\r\n    KedBackendCollection.prototype.ids = function (ids) {\r\n        return this.applyQuery({ ids: ids });\r\n    };\r\n    KedBackendCollection.prototype.name = function (name) {\r\n        return this.applyQuery({ name: name });\r\n    };\r\n    KedBackendCollection.prototype.tags = function () {\r\n        var tags = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            tags[_i] = arguments[_i];\r\n        }\r\n        return this.applyQuery({ tags: tags });\r\n    };\r\n    KedBackendCollection.prototype.branchId = function (branchId) {\r\n        return this.applyQuery({ branchId: branchId });\r\n    };\r\n    KedBackendCollection.prototype.include = function () {\r\n        var graphs = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            graphs[_i] = arguments[_i];\r\n        }\r\n        return this.addToQueryArrayProp(\"include\", graphs);\r\n    };\r\n    KedBackendCollection.prototype.cacheOptimized = function (onOrOff) {\r\n        return onOrOff === undefined || onOrOff === true ?\r\n            this.applyQuery({ cacheBust: CacheBust.getCacheBust(this.table, this.query, this.repo.getUser(), this.includes) }) :\r\n            this.applyQuery({ cacheBust: undefined });\r\n    };\r\n    KedBackendCollection.prototype.mutationsOnEmpty = function (mutationFactory) {\r\n        var tx = new BatchRunner();\r\n        mutationFactory(tx);\r\n        return this.applyQuery({ mutationsOnEmpty: tx.mutationRequests });\r\n    };\r\n    KedBackendCollection.prototype.single = function (throwers) {\r\n        var _this = this;\r\n        var _a = throwers || {}, onZero = _a.onZero, onMany = _a.onMany;\r\n        return this.toValue().map(function (items) {\r\n            if (items.length === 0) {\r\n                if (onZero)\r\n                    onZero();\r\n                else\r\n                    throw new Error(\"Single item of \" + _this.table + \" expected to be returned by query \" + JSON.stringify(_this.query) + \" but none was found.\");\r\n            }\r\n            if (items.length > 1) {\r\n                debugger;\r\n                if (onMany)\r\n                    onMany();\r\n                else\r\n                    console.log(\"Single item of \" + _this.table + \" expected to be returned by query \" + JSON.stringify(_this.query) + \" but \" + items.length + \" was found.\");\r\n            }\r\n            return items[0];\r\n        });\r\n    };\r\n    /*combineLatest<TOther>(other: QueryObservable<TOther>) {\r\n      return this.render(x => x).combineLatest(other);\r\n    }*/\r\n    KedBackendCollection.prototype.update = function (doc, changes, debounce) {\r\n        if (debounce === void 0) { debounce = 1000; }\r\n        this.repo.writer.mutate([{\r\n                op: 'update',\r\n                table: this.table,\r\n                branchId: this.query.branchId,\r\n                id: doc.id,\r\n                deltaDoc: changes,\r\n                targetName: doc.name\r\n            }], debounce);\r\n    };\r\n    KedBackendCollection.prototype.addRelated = function (id, label, relatedDoc) {\r\n        this.repo.writer.mutate([{\r\n                op: 'add-related',\r\n                table: this.table,\r\n                branchId: this.query.branchId,\r\n                id: id,\r\n                graphProp: label,\r\n                relatedDoc: relatedDoc\r\n            }], 0);\r\n    };\r\n    KedBackendCollection.prototype.add = function (doc) {\r\n        this.repo.writer.mutate([{\r\n                op: 'add',\r\n                id: doc.id,\r\n                table: this.table,\r\n                doc: doc\r\n            }], 0);\r\n    };\r\n    KedBackendCollection.prototype.removeRelated = function (id, label, relatedDoc) {\r\n        this.repo.writer.mutate([{\r\n                op: 'remove-related',\r\n                table: this.table,\r\n                branchId: this.query.branchId,\r\n                id: id,\r\n                graphProp: label,\r\n                relatedDoc: relatedDoc\r\n            }], 0);\r\n    };\r\n    KedBackendCollection.prototype.undoLink = function (id, label, relatedId) {\r\n        if (!this.query.branchId)\r\n            throw new Error(\"undo links can only be performed on branches\");\r\n        this.repo.writer.mutate([{\r\n                op: 'undo-link',\r\n                table: this.table,\r\n                branchId: this.query.branchId,\r\n                id: id,\r\n                graphProp: label,\r\n                relatedId: relatedId\r\n            }], 0);\r\n    };\r\n    KedBackendCollection.prototype.delete = function () {\r\n        var _this = this;\r\n        var ids = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            ids[_i] = arguments[_i];\r\n        }\r\n        this.repo.writer.mutate(ids.map(function (id) { return ({\r\n            op: 'delete',\r\n            table: _this.table,\r\n            id: id\r\n        }); }), 0);\r\n    };\r\n    KedBackendCollection.prototype.unsubscribe = function (subscription) {\r\n        this.repo.querySet.unsubscribe(subscription);\r\n    };\r\n    return KedBackendCollection;\r\n}(Collection));\r\nexport { KedBackendCollection };\r\n/*mixin(\r\n  KedBackendCollection.prototype,\r\n  MappedCollection.prototype,\r\n  \"map\", \"flat\", \"concat\", \"render\", \"load\");*/\r\n//# sourceMappingURL=kedbackend-collection.js.map","import * as tslib_1 from \"tslib\";\r\nimport { updateArray } from '../ked-backend-client/utils';\r\nimport { branchSensitive, getTableFromLabel } from './utils';\r\nimport { applyDelta } from './delta-merge';\r\nvar KedBackendQuery = /** @class */ (function () {\r\n    function KedBackendQuery(table, query, user, repo, mutationQueue) {\r\n        this.table = table;\r\n        this.query = query;\r\n        this.user = user;\r\n        this.repo = repo;\r\n        this.mutationQueue = mutationQueue;\r\n        this.subscriptions = [];\r\n        this.data = [];\r\n        this.gotInitialResponse = false;\r\n        this.invalid = false;\r\n        this.loadedVersion = 0;\r\n        this._loadPromise = null;\r\n        this.includes = query.include ?\r\n            typeof query.include === 'string' ?\r\n                [query.include] :\r\n                query.include :\r\n            [];\r\n    }\r\n    KedBackendQuery.queryKey = function (table, query) {\r\n        var mutationsOnEmpty = query.mutationsOnEmpty, comparableProps = tslib_1.__rest(query, [\"mutationsOnEmpty\"]);\r\n        return table + JSON.stringify(comparableProps);\r\n    };\r\n    Object.defineProperty(KedBackendQuery.prototype, \"queryKey\", {\r\n        get: function () {\r\n            return KedBackendQuery.queryKey(this.table, this.query);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    KedBackendQuery.prototype.subscribe = function (subscription) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var data, data;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.subscriptions.push(subscription);\r\n                        if (!(this.gotInitialResponse && !this.invalid)) return [3 /*break*/, 1];\r\n                        data = this.getDataWithMutationsApplied(this.mutationQueue.get(), true, this.data);\r\n                        subscription.notifySubscriber(data, this.error);\r\n                        return [3 /*break*/, 4];\r\n                    case 1:\r\n                        data = this.queryLocally();\r\n                        if (!data) return [3 /*break*/, 2];\r\n                        this.data = data;\r\n                        this.error = null;\r\n                        subscription.notifySubscriber(data, this.error);\r\n                        return [3 /*break*/, 4];\r\n                    case 2: return [4 /*yield*/, this.load()];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendQuery.prototype.load = function (version) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var loadPromise;\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.gotInitialResponse) {\r\n                            // mutationsOnEmpty should never be used twice.\r\n                            delete this.query.mutationsOnEmpty;\r\n                        }\r\n                        if (!(!version && this._loadPromise)) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this._loadPromise];\r\n                    case 1: \r\n                    // loading is ongoing, and caller does not require a recent refresh.\r\n                    // wait for the ongoing load to complete\r\n                    return [2 /*return*/, _a.sent()];\r\n                    case 2:\r\n                        version = version || this.repo.writer.persistedVersion.value;\r\n                        loadPromise = this._loadPromise = this._load(version).then(function (data) {\r\n                            if (_this._loadPromise === loadPromise) {\r\n                                _this.data = data;\r\n                                _this.loadedVersion = Math.max(_this.loadedVersion, version);\r\n                            }\r\n                        }).catch(function (error) {\r\n                            if (_this._loadPromise === loadPromise) {\r\n                                // Noone has refreshed our load. The error is the final result. Set it.\r\n                                _this.error = error;\r\n                            }\r\n                        }).then(function () {\r\n                            if (_this._loadPromise === loadPromise) {\r\n                                // Noone has refreshed our load. We're finished. Data or error is already set.\r\n                                // Mark gotInitialResponse to true and notify subscribers.\r\n                                _this._loadPromise = null;\r\n                                _this.gotInitialResponse = true;\r\n                                _this.notifySubscribers(_this.mutationQueue.get());\r\n                            }\r\n                            else {\r\n                                // A more recent call to load() is ongoing, OR was ongoing but responded\r\n                                // before us.\r\n                                // In any case return this._loadPromise. If it's ongoing we'll wait for it\r\n                                // to finish. If it's null, we'll be returning finally here without\r\n                                // any action, because the action was taken by the refresher.\r\n                                return _this._loadPromise; // Wait for the refreshed load to complete\r\n                            }\r\n                        });\r\n                        return [4 /*yield*/, loadPromise];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendQuery.prototype._load = function (version) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.mutationQueue.affectsQuery(this.table, this.query, this.includes)) return [3 /*break*/, 2];\r\n                        // There are outgoing mutations that affects this query.\r\n                        // Need to wait till they reach server and server responds with OK before querying\r\n                        // the server. Otherwise, we may get inaccurate data from server.\r\n                        return [4 /*yield*/, this.repo.writer.waitForVersionToPersist(version)];\r\n                    case 1:\r\n                        // There are outgoing mutations that affects this query.\r\n                        // Need to wait till they reach server and server responds with OK before querying\r\n                        // the server. Otherwise, we may get inaccurate data from server.\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [4 /*yield*/, this.queryServer()];\r\n                    case 3: return [2 /*return*/, _a.sent()];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendQuery.prototype.unsubscribe = function (subscription) {\r\n        this.subscriptions = this.subscriptions.filter(function (s) { return s !== subscription; });\r\n    };\r\n    KedBackendQuery.prototype.commitMutations = function (mutations, version) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var _i, mutations_1, m, data;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.data) return [3 /*break*/, 9];\r\n                        _i = 0, mutations_1 = mutations;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!(_i < mutations_1.length)) return [3 /*break*/, 8];\r\n                        m = mutations_1[_i];\r\n                        if (!(m.op === 'clear-branch' && (m.branchId === this.query.branchId))) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, this.refreshOrInvalidate(version)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                    case 3:\r\n                        if (!(m.op === 'merge' && (!m.targetBranchId ||\r\n                            m.branchId === this.query.branchId ||\r\n                            m.targetBranchId === this.query.branchId))) return [3 /*break*/, 5];\r\n                        return [4 /*yield*/, this.refreshOrInvalidate(version)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                    case 5:\r\n                        if (!(m.op === 'update' && ((m.deltaDoc.tags && this.query.tags) ||\r\n                            (m.deltaDoc.name && this.query.name)))) return [3 /*break*/, 7];\r\n                        // A tag may have been added, or renamed, and\r\n                        // the query is dependent on the same property.\r\n                        // The query must be refreshed from server as we cannot\r\n                        // commit the mutations locally as we don't have all info.\r\n                        return [4 /*yield*/, this.refreshOrInvalidate(version)];\r\n                    case 6:\r\n                        // A tag may have been added, or renamed, and\r\n                        // the query is dependent on the same property.\r\n                        // The query must be refreshed from server as we cannot\r\n                        // commit the mutations locally as we don't have all info.\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                    case 7:\r\n                        _i++;\r\n                        return [3 /*break*/, 1];\r\n                    case 8:\r\n                        data = this.getDataWithMutationsApplied(mutations, false, this.data);\r\n                        this.data = data;\r\n                        _a.label = 9;\r\n                    case 9: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendQuery.prototype.refreshOrInvalidate = function (version) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(this.subscriptions.length === 0)) return [3 /*break*/, 1];\r\n                        this.invalid = true;\r\n                        return [3 /*break*/, 3];\r\n                    case 1: return [4 /*yield*/, this.load(version)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendQuery.prototype.notifySubscribers = function (optimisticMutations) {\r\n        var _this = this;\r\n        if (this.data && this.gotInitialResponse) {\r\n            var data_1 = this.getDataWithMutationsApplied(optimisticMutations, true, this.data);\r\n            this.subscriptions.forEach(function (s) {\r\n                s.notifySubscriber(data_1, _this.error);\r\n            });\r\n        }\r\n    };\r\n    KedBackendQuery.prototype.queryLocally = function () {\r\n        return this.repo.querySet.queryLocally(this.table, this.query, this.includes);\r\n    };\r\n    KedBackendQuery.prototype.queryServer = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var data;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.repo.getClient().list(this.table, tslib_1.__assign({}, this.query))];\r\n                    case 1:\r\n                        data = _a.sent();\r\n                        return [2 /*return*/, data];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendQuery.prototype.getDataWithMutationsApplied = function (mutations, optimistic, data) {\r\n        var _this = this;\r\n        mutations.forEach(function (mutation) {\r\n            data = _this.applyMutationsOnData(data, mutation, optimistic);\r\n        });\r\n        return data;\r\n    };\r\n    KedBackendQuery.prototype.applyMutationsOnData = function (data, m, optimistic) {\r\n        if (branchSensitive(m) && m.branchId != this.query.branchId)\r\n            return data;\r\n        var _a = this, table = _a.table, includes = _a.includes, listOptions = _a.query;\r\n        var sourceIds = listOptions.hasEdgesFrom ? [].concat(listOptions.hasEdgesFrom || []) : [];\r\n        var requestedTags = listOptions.tags ? [].concat(listOptions.tags || []) : [];\r\n        switch (m.op) {\r\n            case 'update': {\r\n                return updateArray(data, function (doc) {\r\n                    if (doc.id === m.id) {\r\n                        // Apply delta on updated document\r\n                        var updatedDoc = applyDelta(doc, m.deltaDoc);\r\n                        if (optimistic)\r\n                            updatedDoc.$meta = 'updating';\r\n                        return updatedDoc;\r\n                    }\r\n                    // If id does not apply to this doc, search in graphs the id is found\r\n                    // among graph included docs, and if so, update that one:\r\n                    includes.forEach(function (label) {\r\n                        var _a;\r\n                        var includedDocs = doc[label];\r\n                        if (includedDocs) {\r\n                            var updatedArray = updateArray(includedDocs, function (related) {\r\n                                if (related.id !== m.id)\r\n                                    return related;\r\n                                var updatedRelated = applyDelta(related, m.deltaDoc);\r\n                                if (optimistic)\r\n                                    updatedRelated.$meta = 'updating';\r\n                                return updatedRelated;\r\n                            });\r\n                            if (updatedArray !== includedDocs) {\r\n                                doc = tslib_1.__assign({}, doc, (_a = {}, _a[label] = updatedArray, _a));\r\n                            }\r\n                        }\r\n                    });\r\n                    return doc;\r\n                });\r\n            }\r\n            case 'add':\r\n                if (table === m.table) {\r\n                    if (listOptions.tags) {\r\n                        var queriedTags_1 = [].concat(listOptions.tags); // tag can be either string or string[]. Make is string[] always.\r\n                        if (m.doc.tags && m.doc.tags.some(function (tag) { return queriedTags_1.includes(tag); })) {\r\n                            return data.concat([m.doc]); // Make the added doc appear in the result (optimistic mutation)\r\n                        }\r\n                    }\r\n                    // Todo, apply also for other list options, like ids:\r\n                    // The above code for 'add' was only written to cover the use case of teachers-page notifications!\r\n                }\r\n                return data; // fallback case - query was not affected.\r\n            case 'add-related':\r\n                if (table === m.table && includes.indexOf(m.graphProp) !== -1) {\r\n                    // If expression is `db.courseBlocks....whatever.. .include(\"abilities\")`, detect: db.courseBlocks.addRelated(blockId, 'abilities', ...)\r\n                    // ...because table = 'courseBlocks' and includes has \"abilities\".\r\n                    return updateArray(data, function (doc) {\r\n                        var _a;\r\n                        if (doc.id !== m.id)\r\n                            return doc;\r\n                        var relatedDoc = tslib_1.__assign({}, m.relatedDoc);\r\n                        if (optimistic)\r\n                            relatedDoc.$meta = 'adding';\r\n                        return tslib_1.__assign({}, doc, (_a = {}, _a[m.graphProp] = doc[m.graphProp].concat([relatedDoc]), _a));\r\n                    });\r\n                }\r\n                if (listOptions.hasEdgesFrom) {\r\n                    if (sourceIds.includes(m.id)) {\r\n                        // If expression is:\r\n                        //   `db.courseBlocks.hasEdgesFrom([courseId])`  (meaning table='courseBlocks' and sourceIds includes courseId)\r\n                        // , detect: db.courseInstances.addRelated(courseId, 'courseBlocks', ....) // m.graphProp === 'blocks'--> getTableFromLabel --> 'courseBlocks'\r\n                        if (table === getTableFromLabel(m.table, m.graphProp)) {\r\n                            if (!listOptions.tags)\r\n                                return data.concat(this.setGraphProps(m.relatedDoc));\r\n                            if (m.relatedDoc.tags && requestedTags.some(function (tag) { return m.relatedDoc.tags.includes(tag); })) {\r\n                                return data.concat(this.setGraphProps(m.relatedDoc));\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                if (listOptions.ids && listOptions.ids.some(function (id) { return id === m.relatedDoc.id; })) {\r\n                    // A certain ID is observed. A doc with this id is being added.\r\n                    // Add the doc to the result. Exactly this WILL happen in the following typical scenario:\r\n                    // 1. User adds a related document to a list.\r\n                    // 2. Document remains within the MutationQueue while batch-request is being processed by server.\r\n                    // 3. User clicks the added item to edit or view it (or our component redirects to its editor)\r\n                    // 4. A new query of that particular ID is subscribed to {ids=[theId]}\r\n                    //    KedBackendQuery.subscribe then does this:\r\n                    //      1. Call queryLocally() before querying server\r\n                    //      2. queryLocally() inspects mutations and finds a match, returning an empty list\r\n                    //         (assumes as we are adding it, it can't exist on the server anyway)\r\n                    //      3. KedBackendQUery applies mutations onto the empty list, and ends up here to add\r\n                    //         it optimistically.\r\n                    //      4. When server responds with 200 OK, calls us here again with optimistic=false\r\n                    //         to \"persist\" it in the query's data array.\r\n                    //      4B: If not 200 OK, mutation may be gone and the subscriber will se an error page\r\n                    //         \"Could not find entity with id X.\" along with a red error message on the screen\r\n                    //         about that it failed to save on server.\r\n                    return data.concat(this.setGraphProps(m.relatedDoc));\r\n                }\r\n                return data;\r\n            case 'remove-related':\r\n                if (table === m.table && includes.indexOf(m.graphProp) !== -1) {\r\n                    return updateArray(data, function (doc) {\r\n                        var _a;\r\n                        var includedDocs = doc[m.graphProp];\r\n                        if (!includedDocs)\r\n                            return doc;\r\n                        if (doc.id !== m.id)\r\n                            return doc;\r\n                        return tslib_1.__assign({}, doc, (_a = {}, _a[m.graphProp] = optimistic ?\r\n                            // Mark related-doc-to-remove with $meta: 'deleting'\r\n                            includedDocs.map(function (d) { return d.id !== m.relatedDoc.id ?\r\n                                d : tslib_1.__assign({}, d, { $meta: 'deleting' }); }) :\r\n                            // Delete related-doc-to-remove from doc[grapProp]:\r\n                            includedDocs.filter(function (d) { return d.id !== m.relatedDoc.id; }), _a));\r\n                    });\r\n                }\r\n                if (listOptions.hasEdgesFrom) {\r\n                    if (sourceIds.includes(m.id))\r\n                        return optimistic ?\r\n                            data.map(function (d) { return d.id === m.relatedDoc.id ? tslib_1.__assign({}, d, { $meta: 'deleting' }) : d; }) :\r\n                            data.filter(function (d) { return d.id !== m.relatedDoc.id; });\r\n                }\r\n                return data;\r\n            case 'delete':\r\n                if (table === m.table) {\r\n                    return data.filter(function (d) { return d.id !== m.id; });\r\n                }\r\n                else if (listOptions.include) {\r\n                    var includedTables = includes\r\n                        .map(function (label) { return ({ label: label, table: getTableFromLabel(table, label) }); });\r\n                    var labels_1 = includedTables.filter(function (_a) {\r\n                        var table = _a.table;\r\n                        return table === m.table;\r\n                    });\r\n                    if (labels_1.length > 0) {\r\n                        return updateArray(data, function (doc) {\r\n                            labels_1.forEach(function (_a) {\r\n                                var label = _a.label;\r\n                                var _b;\r\n                                var relatedDocs = doc[label];\r\n                                if (relatedDocs) {\r\n                                    doc = tslib_1.__assign({}, doc, (_b = {}, _b[label] = optimistic ?\r\n                                        relatedDocs.map(function (d) { return d.id === m.id ? tslib_1.__assign({}, d, { $meta: 'deleting' }) : d; }) :\r\n                                        relatedDocs.filter(function (_a) {\r\n                                            var id = _a.id;\r\n                                            return id !== m.id;\r\n                                        }), _b));\r\n                                }\r\n                            });\r\n                            return doc;\r\n                        });\r\n                    }\r\n                }\r\n                return data;\r\n            default:\r\n                return data;\r\n        }\r\n    };\r\n    KedBackendQuery.prototype.setGraphProps = function (doc) {\r\n        var copy = tslib_1.__assign({}, doc);\r\n        this.includes.forEach(function (label) { return copy[label] = copy[label] || []; });\r\n        return copy;\r\n    };\r\n    return KedBackendQuery;\r\n}());\r\nexport { KedBackendQuery };\r\n//# sourceMappingURL=kedbackend-query.js.map","import * as tslib_1 from \"tslib\";\r\nimport { tables } from 'kedbackend-schema/schema.json';\r\nimport { KedBackendCollection } from './kedbackend-collection';\r\nimport { QuerySet } from './query-set';\r\nimport { MutationQueue } from './mutation-queue';\r\nimport { KedBackendWriter } from './kedbackend-writer';\r\nimport { DeltaCollection } from './delta-collection/delta-collection';\r\nvar KedBackendRepo = /** @class */ (function () {\r\n    function KedBackendRepo(getClient, getUser, getUserDisplayName, defaultQueryOptions, mutationQueue, querySet, writer, cacheOptimized) {\r\n        var _this = this;\r\n        this.getClient = getClient;\r\n        this.getUser = getUser;\r\n        this.getUserDisplayName = getUserDisplayName;\r\n        this.defaultQueryOptions = defaultQueryOptions;\r\n        this.mutationQueue = mutationQueue;\r\n        this.querySet = querySet;\r\n        this.writer = writer;\r\n        this.cacheOptimized = cacheOptimized;\r\n        if (!defaultQueryOptions)\r\n            this.defaultQueryOptions = {};\r\n        if (!mutationQueue)\r\n            this.mutationQueue = new MutationQueue();\r\n        if (!querySet)\r\n            this.querySet = new QuerySet(this.mutationQueue);\r\n        if (!writer)\r\n            this.writer = new KedBackendWriter(this.mutationQueue, this.querySet, getClient, getUser, getUserDisplayName);\r\n        Object.keys(tables).forEach(function (table) {\r\n            var collection = new KedBackendCollection(_this, table, defaultQueryOptions || {});\r\n            if (cacheOptimized) {\r\n                collection = collection.cacheOptimized();\r\n            }\r\n            _this[table] = collection;\r\n        });\r\n        this.deltas = new DeltaCollection(this.writer.deltaCache, {\r\n            branchId: this.defaultQueryOptions.branchId // If branchId is undefined. DeltaCollection will respond with Error on subscribe()\r\n        });\r\n    }\r\n    KedBackendRepo.prototype.table = function (tableName) {\r\n        var collection = new KedBackendCollection(this, tableName, this.defaultQueryOptions);\r\n        if (this.cacheOptimized)\r\n            collection = collection.cacheOptimized();\r\n        return collection;\r\n    };\r\n    KedBackendRepo.prototype._clone = function (queryOptions, cacheOptimized) {\r\n        var clone = new KedBackendRepo(this.getClient, this.getUser, this.getUserDisplayName, tslib_1.__assign({}, this.defaultQueryOptions, queryOptions), this.mutationQueue, this.querySet, this.writer, cacheOptimized === undefined ? this.cacheOptimized : cacheOptimized);\r\n        return clone;\r\n    };\r\n    KedBackendRepo.prototype.branch = function (branchId) {\r\n        return this._clone({ branchId: branchId });\r\n    };\r\n    KedBackendRepo.prototype.role = function (role) {\r\n        return this._clone({ role: role });\r\n    };\r\n    KedBackendRepo.prototype.optimizeCache = function () {\r\n        return this._clone({}, true);\r\n    };\r\n    KedBackendRepo.prototype.clearBranch = function () {\r\n        if (!this.defaultQueryOptions.branchId)\r\n            throw new Error(\"Cannot clear master branch\");\r\n        this.writer.mutate([{ op: 'clear-branch', branchId: this.defaultQueryOptions.branchId }], 0);\r\n    };\r\n    KedBackendRepo.prototype.merge = function (targetBranchId) {\r\n        if (!this.defaultQueryOptions.branchId)\r\n            throw new Error(\"Cannot merge from master branch\");\r\n        this.writer.mutate([{ op: 'merge', branchId: this.defaultQueryOptions.branchId, targetBranchId: targetBranchId }], 0);\r\n    };\r\n    KedBackendRepo.prototype.saveNow = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.writer.waitForVersionToPersist(this.writer.currentVersion)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return KedBackendRepo;\r\n}());\r\nexport { KedBackendRepo };\r\n//# sourceMappingURL=kedbackend-repo.js.map","var KedBackendSubscription = /** @class */ (function () {\r\n    function KedBackendSubscription(subscriber, collection) {\r\n        this.subscriber = subscriber;\r\n        this.collection = collection;\r\n    }\r\n    KedBackendSubscription.prototype.notifySubscriber = function (data, error) {\r\n        try {\r\n            if (error)\r\n                this.subscriber([], error, this);\r\n            else if (data !== this.lastNotifiedData) { // Will in-fact be equal by reference if data is same as last notification (as we use an immutable approach on data)\r\n                this.lastNotifiedData = data;\r\n                this.subscriber(data, error, this);\r\n            }\r\n        }\r\n        catch (ex) {\r\n            try {\r\n                this.subscriber([], ex, this);\r\n            }\r\n            catch (ex2) {\r\n                console.error(\"Error while notifying KedBackendSubscriber:\", ex2, 'originally notified error:', ex);\r\n            }\r\n        }\r\n    };\r\n    KedBackendSubscription.prototype.unsubscribe = function () {\r\n        this.collection.unsubscribe(this);\r\n    };\r\n    return KedBackendSubscription;\r\n}());\r\nexport { KedBackendSubscription };\r\n//# sourceMappingURL=kedbackend-subscription.js.map","import * as tslib_1 from \"tslib\";\r\nimport { MutationQueue } from './mutation-queue';\r\nimport { BatchRunner } from '../ked-backend-client';\r\nimport { tables } from 'kedbackend-schema/schema.json';\r\nimport { CacheBust } from './cache-bust';\r\nimport { Emitter } from '../observable';\r\nimport { DeltaCache } from './delta-collection/delta-cache';\r\nvar KedBackendWriter = /** @class */ (function () {\r\n    function KedBackendWriter(mutationQueue, querySet, getClient, getUser, getUserDisplayName) {\r\n        this.mutationQueue = mutationQueue;\r\n        this.querySet = querySet;\r\n        this.getClient = getClient;\r\n        this.getUser = getUser;\r\n        this.getUserDisplayName = getUserDisplayName;\r\n        this._timeoutId = null;\r\n        this._isSavingPromise = null;\r\n        this.currentVersion = 0;\r\n        this.persistedVersion = new Emitter(0);\r\n        this.errorSubscribers = [];\r\n        this.stateSubscribers = [];\r\n        this.deltaCache = new DeltaCache(getClient, getUser, getUserDisplayName);\r\n    }\r\n    Object.defineProperty(KedBackendWriter.prototype, \"isSaving\", {\r\n        get: function () { return !!this._isSavingPromise; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(KedBackendWriter.prototype, \"isEdited\", {\r\n        get: function () { return this.mutationQueue.get().length > 0; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    KedBackendWriter.prototype.onError = function (callback) {\r\n        this.errorSubscribers.push(callback);\r\n    };\r\n    KedBackendWriter.prototype.onStateChange = function (callback) {\r\n        this.stateSubscribers.push(callback);\r\n    };\r\n    KedBackendWriter.prototype.off = function (callback) {\r\n        this.errorSubscribers = this.errorSubscribers.filter(function (s) { return s !== callback; });\r\n        this.stateSubscribers = this.stateSubscribers.filter(function (s) { return s !== callback; });\r\n    };\r\n    KedBackendWriter.prototype.dispatchError = function (error, retryable) {\r\n        var _this = this;\r\n        this.errorSubscribers.forEach(function (callback) {\r\n            try {\r\n                callback(error, retryable, _this);\r\n            }\r\n            catch (_) { }\r\n        });\r\n    };\r\n    KedBackendWriter.prototype.dispatchStateChange = function () {\r\n        var _this = this;\r\n        this.stateSubscribers.forEach(function (callback) {\r\n            try {\r\n                callback(_this);\r\n            }\r\n            catch (_) { }\r\n        });\r\n    };\r\n    KedBackendWriter.prototype.mutate = function (mutations, debounce) {\r\n        this.mutationQueue.add(mutations);\r\n        ++this.currentVersion;\r\n        this.dispatchStateChange();\r\n        this.querySet.notifySubscribers();\r\n        this.deltaCache.applyMutations(this.mutationQueue.get(), { optimistic: true });\r\n        if (!this._isSavingPromise) {\r\n            if (this._timeoutId)\r\n                clearTimeout(this._timeoutId);\r\n            this._timeoutId = setTimeout(this.save.bind(this), debounce);\r\n        }\r\n        // If isSaving, we don't need to do anything, becase it will re-check if additional\r\n        // mutations have come, when saving is done.\r\n    };\r\n    KedBackendWriter.prototype.retrySave = function () {\r\n        return this.save();\r\n    };\r\n    KedBackendWriter.prototype.waitForVersionToPersist = function (version) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var persistedVersion;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.persistedVersion.load()];\r\n                    case 1:\r\n                        persistedVersion = _a.sent();\r\n                        if (!(persistedVersion < version)) return [3 /*break*/, 3];\r\n                        this.save(); // Be more eager to save\r\n                        return [4 /*yield*/, this.persistedVersion.filter(function (persistedVersion) { return persistedVersion >= version; }).load()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendWriter.prototype.save = function () {\r\n        var _this = this;\r\n        if (this._timeoutId)\r\n            clearTimeout(this._timeoutId);\r\n        if (this._isSavingPromise)\r\n            return this._isSavingPromise;\r\n        if (!this.isEdited)\r\n            return Promise.resolve();\r\n        this._timeoutId = null;\r\n        this._isSavingPromise = this._save();\r\n        this._isSavingPromise.catch(function () { }).then(function () { return _this._isSavingPromise = null; });\r\n        return this._isSavingPromise;\r\n    };\r\n    KedBackendWriter.prototype._save = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var mutations, version, mutationRequests, res_1, etagMutations, error_1;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.dispatchStateChange();\r\n                        mutations = this.mutationQueue.get();\r\n                        version = this.currentVersion;\r\n                        this.mutationQueue.moveToSavingQueue();\r\n                        mutationRequests = this.mapMutations(mutations);\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 6, 11, 12]);\r\n                        return [4 /*yield*/, this.getClient().batch(mutationRequests)];\r\n                    case 2:\r\n                        res_1 = _a.sent();\r\n                        etagMutations = Object.keys(res_1.newEtags).map(function (id) { return ({\r\n                            op: 'update',\r\n                            table: null,\r\n                            id: id,\r\n                            deltaDoc: { $etag: res_1.newEtags[id] },\r\n                            targetName: null // We don't have the target name. But this mutation won't be visible in a DeltaCollection anyway, so it wont be used.\r\n                        }); });\r\n                        // Invalidate cache\r\n                        CacheBust.invalidateCache(mutationRequests, this.getUser());\r\n                        // Commmit mutations along with etagMutations into queries cached data\r\n                        this.persistedVersion.dispatch(version);\r\n                        this.deltaCache.applyMutations(mutations, { optimistic: false });\r\n                        return [4 /*yield*/, this.querySet.commitMutations(MutationQueue.merge(mutations, etagMutations), version)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        // On success, clear saving queue as the mutations will now be committed to all query's data instead.\r\n                        this.mutationQueue.clearSavingQueue();\r\n                        this.dispatchStateChange(); // isEdited may have turned to false\r\n                        // Finally, notify subscribers so that views get updated with committed results\r\n                        this.querySet.notifySubscribers();\r\n                        if (!(this.mutationQueue.get().length > 0)) return [3 /*break*/, 5];\r\n                        // Additional mutations happend while we were saving. Handle them as well.\r\n                        return [4 /*yield*/, this._save()];\r\n                    case 4:\r\n                        // Additional mutations happend while we were saving. Handle them as well.\r\n                        _a.sent();\r\n                        _a.label = 5;\r\n                    case 5: return [3 /*break*/, 12];\r\n                    case 6:\r\n                        error_1 = _a.sent();\r\n                        this.persistedVersion.dispatchError(error_1);\r\n                        if (!(error_1 && error_1.name && error_1.name.startsWith(\"http4\"))) return [3 /*break*/, 9];\r\n                        // Access Control denied, bad request or similar. Throw mutations away.\r\n                        this.dispatchError(error_1, false);\r\n                        this.mutationQueue.clearSavingQueue();\r\n                        this.dispatchStateChange(); // isEdited may have turned to false\r\n                        this.querySet.notifySubscribers();\r\n                        if (!(this.mutationQueue.get().length > 0)) return [3 /*break*/, 8];\r\n                        // Ho ho! Additional mutations happend while we were saving. Handle them alone. THey might be more lucky.\r\n                        return [4 /*yield*/, this._save()];\r\n                    case 7:\r\n                        // Ho ho! Additional mutations happend while we were saving. Handle them alone. THey might be more lucky.\r\n                        _a.sent();\r\n                        _a.label = 8;\r\n                    case 8: return [3 /*break*/, 10];\r\n                    case 9:\r\n                        this.dispatchError(error_1, true);\r\n                        _a.label = 10;\r\n                    case 10: return [3 /*break*/, 12];\r\n                    case 11:\r\n                        this.dispatchStateChange();\r\n                        return [7 /*endfinally*/];\r\n                    case 12: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    KedBackendWriter.prototype.mapMutations = function (mutations) {\r\n        var br = new BatchRunner();\r\n        mutations.forEach(function (m) {\r\n            switch (m.op) {\r\n                case 'update':\r\n                    br.update(m.table, m.id, m.deltaDoc, m.branchId);\r\n                    break;\r\n                case 'add':\r\n                    br.add(m.table, m.doc);\r\n                    break;\r\n                case 'add-related':\r\n                    if (!m.relatedDoc.$etag) {\r\n                        // No $etag means this is a new document. Add it before linking to it:\r\n                        br.add(tables[m.table].relationships[m.graphProp], m.relatedDoc, m.branchId);\r\n                    }\r\n                    br.link2(m.table, m.id, m.graphProp, m.relatedDoc.id, m.branchId);\r\n                    break;\r\n                case 'remove-related':\r\n                    br.unlink2(m.table, m.id, m.graphProp, m.relatedDoc.id, m.branchId);\r\n                    break;\r\n                case 'undo-link':\r\n                    br.undoLink(m.table, m.id, m.graphProp, m.relatedId, m.branchId);\r\n                    break;\r\n                case 'delete':\r\n                    br.delete(m.table, m.id);\r\n                    break;\r\n                case 'clear-branch':\r\n                    br.clearBranch(m.branchId);\r\n                    break;\r\n                case 'merge':\r\n                    br.merge(m.branchId, m.targetBranchId);\r\n                    break;\r\n            }\r\n        });\r\n        return br.mutationRequests;\r\n    };\r\n    return KedBackendWriter;\r\n}());\r\nexport { KedBackendWriter };\r\n//# sourceMappingURL=kedbackend-writer.js.map","import * as tslib_1 from \"tslib\";\r\nimport { getTableFromLabel, branchSensitive, globalOp } from './utils';\r\nimport { mergeDeltas } from './delta-merge';\r\nvar MutationQueue = /** @class */ (function () {\r\n    function MutationQueue() {\r\n        this.queue = [];\r\n        this.savingQueue = [];\r\n    }\r\n    MutationQueue.prototype.add = function (mutations) {\r\n        this.queue = MutationQueue.merge(this.queue, mutations);\r\n    };\r\n    MutationQueue.prototype.moveToSavingQueue = function () {\r\n        this.savingQueue = MutationQueue.merge(this.savingQueue, this.queue);\r\n        this.queue = [];\r\n    };\r\n    MutationQueue.prototype.clearSavingQueue = function () {\r\n        this.savingQueue = [];\r\n    };\r\n    MutationQueue.prototype.get = function () {\r\n        return this.savingQueue.concat(this.queue);\r\n    };\r\n    MutationQueue.prototype.affectsQuery = function (table, query, includes) {\r\n        var mutations = this.get();\r\n        if (mutations.some(function (m) { return m.op === 'merge' || m.op === 'clear-branch'; }))\r\n            return true;\r\n        if (query.ids) {\r\n            // A query with \"ids\" filter will be easy to detect a no-match on:\r\n            return mutations.some(function (m) { return globalOp(m) || (!branchSensitive(m) || m.branchId === query.branchId) &&\r\n                query.ids.includes(m.id); });\r\n        }\r\n        // Otherwise, check if mutations affect same branch and table. Could be done more fine grained,\r\n        // but that would only be a suboptimization.\r\n        return mutations.some(function (m) {\r\n            return m.op === 'add' ?\r\n                m.table === table :\r\n                m.op === 'delete' ?\r\n                    m.table === table || (includes.some(function (label) { return getTableFromLabel(table, label) === m.table; })) :\r\n                    globalOp(m) ? true :\r\n                        m.branchId == query.branchId &&\r\n                            (m.table === table || (m.op !== 'update' && ([table].concat(includes.map(function (label) { return getTableFromLabel(table, label); })).some(function (table) { return getTableFromLabel(m.table, m.graphProp) === table; }))));\r\n        });\r\n    };\r\n    MutationQueue.merge = function (queue1, queue2) {\r\n        var mutableQueue1 = queue1.slice();\r\n        var mutableQueue2 = queue2.slice();\r\n        //if (mutableQueue1.length > 0) debugger;\r\n        var len = queue1.length;\r\n        var _loop_1 = function (i) {\r\n            var m = queue1[i];\r\n            if (m.op === 'update') {\r\n                var overlappingIdOpIdx = mutableQueue2.findIndex(function (newMut) {\r\n                    return newMut.op === 'update' &&\r\n                        newMut.branchId === m.branchId &&\r\n                        newMut.id === m.id;\r\n                });\r\n                if (overlappingIdOpIdx >= 0) {\r\n                    mutableQueue1[i] = tslib_1.__assign({}, m, { deltaDoc: mergeDeltas(m.deltaDoc, mutableQueue2[overlappingIdOpIdx].deltaDoc) });\r\n                    mutableQueue2.splice(overlappingIdOpIdx, 1);\r\n                }\r\n            }\r\n        };\r\n        for (var i = 0; i < len; ++i) {\r\n            _loop_1(i);\r\n        }\r\n        return mutableQueue1.concat(mutableQueue2);\r\n    };\r\n    return MutationQueue;\r\n}());\r\nexport { MutationQueue };\r\n//# sourceMappingURL=mutation-queue.js.map","import * as tslib_1 from \"tslib\";\r\nimport { KedBackendQuery } from './kedbackend-query';\r\nimport * as JsonSchema from 'kedbackend-schema/schema.json';\r\nimport { queryArray } from './utils';\r\nvar QuerySet = /** @class */ (function () {\r\n    function QuerySet(mutationQueue) {\r\n        this.mutationQueue = mutationQueue;\r\n        this.queries = [];\r\n    }\r\n    QuerySet.prototype.commitMutations = function (mutations, version) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, Promise.all(this.queries.map(function (q) { return q.commitMutations(mutations, version); }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.cleanupInvalidQueries();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    QuerySet.prototype.cleanupInvalidQueries = function () {\r\n        this.queries = this.queries.filter(function (q) {\r\n            if (q.invalid) {\r\n                if (q.timeoutHandle) {\r\n                    clearTimeout(q.timeoutHandle);\r\n                    q.timeoutHandle = null;\r\n                }\r\n                return false;\r\n            }\r\n            return true;\r\n        });\r\n    };\r\n    QuerySet.prototype.notifySubscribers = function () {\r\n        var optimisticMutations = this.mutationQueue.get();\r\n        this.queries.forEach(function (q) {\r\n            q.notifySubscribers(optimisticMutations);\r\n        });\r\n    };\r\n    QuerySet.prototype.findQuery = function (table, query) {\r\n        return this.queries.find(function (q) { return q.queryKey === KedBackendQuery.queryKey(table, query); });\r\n    };\r\n    QuerySet.prototype.queryLocally = function (table, query, includes) {\r\n        // For now, only handle this very common and special case (which\r\n        // will save a lot of unnescessary network traffic if I am thinking right...)\r\n        var mutations = this.mutationQueue.get();\r\n        // Check if the query wants to get a single entity by its ID:\r\n        if (query.ids && query.ids.length === 1) {\r\n            // And if so, if we have an outgoing mutation to create that entity:\r\n            if (mutations.some(function (m) { return m.op === 'add-related' && m.relatedDoc.id === query.ids[0]; })) {\r\n                // Then return an EMPTY response, signalling that we can resolve this locally,\r\n                // but let the optistic feature of KedBackendQuery apply the mutation before\r\n                // notifying subscribers (we don't want it to be persistent before the server\r\n                // has accepted the mutation)\r\n                return [];\r\n            }\r\n        }\r\n        // OK, another quite common case is when we ask for a certain ID and that ID replies\r\n        // within another query\r\n        if (query.hasEdgesFrom || query.hasEdgesTo)\r\n            return null; // Not possible to handle\r\n        if (!query.ids)\r\n            return null; // For now, just take hight for this particular and most common case!\r\n        var _loop_1 = function (q) {\r\n            if (!q.gotInitialResponse)\r\n                return \"continue\";\r\n            if (q.query.branchId !== query.branchId)\r\n                return \"continue\";\r\n            if (q.query.flags)\r\n                return \"continue\"; // It would be complex to support various flags. Query's data may include ids only. Can't rely on the query.\r\n            var qIncludes = q.includes;\r\n            if (qIncludes.length > 0 && (!query.include || query.include.length === 0)) {\r\n                // We don't include, but this query does. Check if we can find our result within it.\r\n                var label = qIncludes.find(function (l) { return JsonSchema.tables[q.table][\"relationships\"][l] === table; });\r\n                if (label) {\r\n                    var res_1 = {};\r\n                    for (var _i = 0, _a = q.data; _i < _a.length; _i++) {\r\n                        var entity = _a[_i];\r\n                        var subData = queryArray(query, entity[label]);\r\n                        subData.forEach(function (r) { return res_1[r.id] = r; });\r\n                    }\r\n                    var result_1 = Object.keys(res_1).map(function (id) { return res_1[id]; });\r\n                    // Only return result if we could look up every requested ID:\r\n                    if (!query.ids.every(function (id) { return result_1.some(function (x) { return x.id === id; }); }))\r\n                        return \"continue\";\r\n                    return { value: result_1 };\r\n                }\r\n            }\r\n            if (!includes.every(function (label) { return qIncludes.includes(label); }))\r\n                return \"continue\";\r\n            // Lastly, if the query includes all graphs that we do, pick the subset from that query.\r\n            // Concrete example: We observe a certain Task by ID and want its knowledgeRequirements along with it,\r\n            // and there's another query of all tasks that also includes knowledgeRequirements. Use it. \r\n            if (q.table === table) {\r\n                var result_2 = queryArray(query, q.data);\r\n                // Only return result if we could look up every requested ID:\r\n                if (!query.ids.every(function (id) { return result_2.some(function (x) { return x.id === id; }); }))\r\n                    return \"continue\";\r\n                return { value: result_2 };\r\n            }\r\n        };\r\n        for (var _i = 0, _a = this.queries; _i < _a.length; _i++) {\r\n            var q = _a[_i];\r\n            var state_1 = _loop_1(q);\r\n            if (typeof state_1 === \"object\")\r\n                return state_1.value;\r\n        }\r\n    };\r\n    QuerySet.prototype.subscribe = function (subscription) {\r\n        var _a = subscription.collection, table = _a.table, query = _a.query, repo = _a.repo;\r\n        var kbQuery = this.findQuery(table, query);\r\n        if (!kbQuery) {\r\n            kbQuery = new KedBackendQuery(table, query, repo.getUser(), repo, this.mutationQueue);\r\n            this.queries.push(kbQuery);\r\n        }\r\n        else {\r\n            if (kbQuery.timeoutHandle) {\r\n                clearTimeout(kbQuery.timeoutHandle);\r\n                kbQuery.timeoutHandle = null;\r\n            }\r\n        }\r\n        kbQuery.subscribe(subscription);\r\n    };\r\n    QuerySet.prototype.unsubscribe = function (subscription) {\r\n        var _this = this;\r\n        var _a = subscription.collection, table = _a.table, query = _a.query, repo = _a.repo;\r\n        var kbQuery = this.findQuery(table, query);\r\n        if (kbQuery) {\r\n            // Prohibit further notifications to this subscription:\r\n            kbQuery.unsubscribe(subscription);\r\n            // Release unnescessary memory when there are no more subscriptions of this query, by removing the query itself\r\n            // To that in a delayed manner, so that an unsubscribe() followed by an immediate subscribe() don't have to re-query the server:\r\n            if (kbQuery.subscriptions.length === 0) {\r\n                // Schedule for garbage collection in 5 minutes:\r\n                kbQuery.timeoutHandle = setTimeout(function () {\r\n                    // Check if kbQuery still has no subscriptions (not certain! A new subscriber may have come along...)\r\n                    if (kbQuery.subscriptions.length === 0) {\r\n                        // Still no subscriptions on it, time to release some memory and forget the in-memory cache of the query result\r\n                        _this.queries = _this.queries.filter(function (q) { return q !== kbQuery; });\r\n                    }\r\n                }, this.queries.length > 50 ?\r\n                    500 : // Don't host too many queries. Garbage collect this within 500 ms\r\n                    5 * 60000); // Allow query in memory for another 5 minutes\r\n            }\r\n        }\r\n    };\r\n    return QuerySet;\r\n}());\r\nexport { QuerySet };\r\n//# sourceMappingURL=query-set.js.map","import { tables } from 'kedbackend-schema/schema.json';\r\nexport function getTableFromLabel(table, label) {\r\n    return tables[table].relationships[label];\r\n}\r\nexport function queryArray(query, data) {\r\n    var filter = getFilterFromQuery(query);\r\n    return data.filter(filter);\r\n}\r\nexport function AND(filter1, filter2) {\r\n    return function (x) { return filter1(x) && filter2(x); };\r\n}\r\nexport function getFilterFromQuery(query) {\r\n    var filter = function (x) { return true; };\r\n    if (query.from)\r\n        return AND(filter, function (x) { return x.dateTime >= query.from; });\r\n    if (query.to)\r\n        return AND(filter, function (x) { return x.dateTime < query.to; });\r\n    if (query.ids)\r\n        return AND(filter, function (x) { return query.ids.includes(x.id); });\r\n    if (query.name)\r\n        return AND(filter, function (x) { return x.name === query.name; });\r\n    if (query.tags)\r\n        return AND(filter, function (x) { return x.tags && [].concat(query.tags || []).some(function (tag) { return x.tags.includes(tag); }); });\r\n    // query.hasEdgesFrom and query.hasEdgesTo cannot by filtered here\r\n    return filter;\r\n}\r\nexport function branchSensitive(m) {\r\n    return m.op !== 'delete';\r\n}\r\nexport function globalOp(m) {\r\n    return m.op === 'clear-branch' || m.op === 'merge';\r\n}\r\n//# sourceMappingURL=utils.js.map","import migrate from './migrate';\r\nexport var KedModelMigratorMixin = function (client) {\r\n    if (client.__migrator_mixed_in)\r\n        return;\r\n    client.__migrator_mixed_in = true;\r\n    var get = client.get;\r\n    var list = client.list;\r\n    client.get = function (table, id, options) {\r\n        var include = options && options.include;\r\n        return get.apply(this, arguments).then(function (result) {\r\n            migrate(result, table, include && include.toString().split(','));\r\n            return result;\r\n        });\r\n    };\r\n    client.list = function (table, options) {\r\n        var include = options && options.include;\r\n        return list.apply(this, arguments).then(function (result) {\r\n            result.forEach(function (doc) { return migrate(doc, table, include && include.toString().split(',')); });\r\n            return result;\r\n        });\r\n    };\r\n    return client;\r\n};\r\n//# sourceMappingURL=index.js.map","import migrateTask from './migrate-task';\r\nexport default function migrateCourse(course, graphs) {\r\n    if (!course.modules)\r\n        course.modules = [];\r\n    course.modules.forEach(function (module) {\r\n        if (!module.resources) {\r\n            module.resources = [];\r\n        }\r\n        if (!module.taskIds) {\r\n            module.taskIds = [];\r\n        }\r\n    });\r\n    if (!course.responsibleTeachers) {\r\n        course.responsibleTeachers = [];\r\n    }\r\n    // Earlier wrong spelling of resources\r\n    if ('resourses' in course && !('resources' in course)) {\r\n        course.resources = course.resourses;\r\n        delete course.resourses;\r\n    }\r\n    if (!course.resources) {\r\n        course.resources = [];\r\n    }\r\n    if (graphs) {\r\n        graphs.forEach(function (label) {\r\n            switch (label) {\r\n                case 'tasks':\r\n                    course.tasks.forEach(function (task) { return migrateTask(task); });\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=migrate-course.js.map","export default function migrateTask(task) {\r\n    if (!task.resources)\r\n        task.resources = [];\r\n}\r\n//# sourceMappingURL=migrate-task.js.map","import migrateCourse from './migrate-course';\r\nimport migrateTask from './migrate-task';\r\nexport default function migrate(doc, table, graphs) {\r\n    switch (table) {\r\n        case \"courses\":\r\n            migrateCourse(doc, graphs);\r\n            break;\r\n        case \"tasks\":\r\n            migrateTask(doc);\r\n            break;\r\n    }\r\n}\r\n//# sourceMappingURL=migrate.js.map","import * as tslib_1 from \"tslib\";\r\nimport { Observable } from \"./observable\";\r\nimport { initMapMethod } from \"./map\";\r\nimport { Value } from \"./value\";\r\nimport { Emitter } from \"./emitter\";\r\nvar Collection = /** @class */ (function (_super) {\r\n    tslib_1.__extends(Collection, _super);\r\n    function Collection(subscribe) {\r\n        return _super.call(this, subscribe) || this;\r\n    }\r\n    Collection.prototype._map = function (mapper) {\r\n        throw \"mixedin\";\r\n    };\r\n    Collection.from = function (x) {\r\n        if (x.subscribe)\r\n            return new Collection(function (s) { return x.subscribe(s); });\r\n        if (Array.isArray(x)) {\r\n            var emitter_1 = new Emitter(x);\r\n            return new Collection(function (s) { return emitter_1.subscribe(s); });\r\n        }\r\n        throw new Error(\"ObservableCollection.from() can only take arrays or observables\");\r\n    };\r\n    Collection.prototype.map = function (mapper) {\r\n        return this._map(function (items) { return items.map(function (item) { return mapper(item); }); });\r\n    };\r\n    Collection.prototype.flat = function () {\r\n        return this._map(function (items) { return [].concat.apply([], items); });\r\n    };\r\n    Collection.prototype.filter = function (filter) {\r\n        return this._map(function (items) { return items.filter(filter); });\r\n    };\r\n    Collection.prototype.concat = function (other) {\r\n        return Collection.from(this.toValue().combineLatest(other).map(function (_a) {\r\n            var me = _a[0], other = _a[1];\r\n            return me.concat(other);\r\n        }));\r\n    };\r\n    Collection.prototype.orderBy = function (prop) {\r\n        return this.toValue().map(function (array) { return array.slice().sort(function (a, b) {\r\n            var aProp = a && a[prop];\r\n            var bProp = b && b[prop];\r\n            return aProp > bProp ? 1 : aProp < bProp ? -1 : 0;\r\n        }); }).toCollection(function (x) { return x; });\r\n    };\r\n    Collection.prototype.toValue = function () {\r\n        var _this = this;\r\n        return new Value(function (s) { return _this.subscribe(s); });\r\n    };\r\n    Collection.prototype.groupBy = function (prop) {\r\n        return this.toValue().map(function (items) {\r\n            var rv = {};\r\n            items.forEach(function (item) {\r\n                var list = rv[item[prop]] || (rv[item[prop]] = []);\r\n                list.push(item);\r\n            });\r\n            return rv;\r\n        });\r\n    };\r\n    Collection.prototype.first = function () {\r\n        return this.toValue().map(function (arr) { return arr[0]; });\r\n    };\r\n    return Collection;\r\n}(Observable));\r\nexport { Collection };\r\nCollection.prototype._map = initMapMethod(Collection);\r\n//# sourceMappingURL=collection.js.map","import * as tslib_1 from \"tslib\";\r\nimport { Value } from \"./value\";\r\nvar Emitter = /** @class */ (function (_super) {\r\n    tslib_1.__extends(Emitter, _super);\r\n    function Emitter(initialValue) {\r\n        var _this = _super.call(this, function (observer) {\r\n            var subscription = {\r\n                unsubscribe: function () { return _this.subscribers = _this.subscribers.filter(function (_a) {\r\n                    var s = _a[0];\r\n                    return s !== observer;\r\n                }); },\r\n            };\r\n            _this.subscribers.push([observer, subscription]);\r\n            if (_this.error)\r\n                observer(null, _this.error, subscription);\r\n            else\r\n                observer(_this.value, undefined, subscription);\r\n            return subscription;\r\n        }) || this;\r\n        _this.subscribers = [];\r\n        _this.value = initialValue;\r\n        return _this;\r\n    }\r\n    Emitter.prototype.dispatch = function (value) {\r\n        this.value = value;\r\n        this.error = undefined;\r\n        this._dispatch();\r\n    };\r\n    Emitter.prototype.dispatchError = function (error) {\r\n        this.error = error;\r\n        this._dispatch();\r\n    };\r\n    Emitter.prototype._dispatch = function () {\r\n        var _this = this;\r\n        this.subscribers.forEach(function (_a) {\r\n            var observer = _a[0], subscription = _a[1];\r\n            try {\r\n                observer(_this.value, _this.error, subscription);\r\n            }\r\n            catch (err) {\r\n                observer(null, err, subscription);\r\n            }\r\n        });\r\n    };\r\n    return Emitter;\r\n}(Value));\r\nexport { Emitter };\r\n//# sourceMappingURL=emitter.js.map","var stack = [];\r\nvar currentFiber = null;\r\nvar providers = [function () { return currentFiber; }];\r\nfunction pushFiber(fiber) {\r\n    stack.push(currentFiber);\r\n    currentFiber = fiber;\r\n}\r\nfunction popFiber() {\r\n    currentFiber = stack.pop();\r\n}\r\nvar _FiberContext = {\r\n    get current() { return currentFiber; },\r\n    /*run: function rerun<R>(fiber: Fiber, fn: ()=>R): R | Promise<R> {\r\n      pushFiber(fiber);\r\n      try {\r\n        return Promise.resolve(fn());\r\n      } catch (p) {\r\n        if (p && typeof p.then === 'function') {\r\n          return p.then(()=>rerun(fiber, fn));\r\n        } else {\r\n          return Promise.reject(p);\r\n        }\r\n      } finally {\r\n        popFiber();\r\n      }\r\n    },*/\r\n    addProvider: function (getCurrentFiber) {\r\n        providers.push(getCurrentFiber);\r\n        setCurrentGetterFromProviders();\r\n    },\r\n    removeProvider: function (getCurrentFiber) {\r\n        providers = providers.filter(function (p) { return p !== getCurrentFiber; });\r\n        setCurrentGetterFromProviders();\r\n    }\r\n};\r\nfunction setCurrentGetterFromProviders() {\r\n    Object.defineProperty(_FiberContext, \"current\", {\r\n        get: providers.reduce(function (p, c) { return function () { return p() || c(); }; }),\r\n        set: function () { throw new Error(\"Use FiberContext.push() to change current fiber\"); }\r\n    });\r\n}\r\nvar _global = (typeof self === 'undefined' ? global : self);\r\nif (!_global[\"KEDFiberContext\"]) {\r\n    _global[\"KEDFiberContext\"] = _FiberContext;\r\n}\r\nexport var FiberContext = _global[\"KEDFiberContext\"];\r\n//# sourceMappingURL=fiber-context.js.map","export * from './observable';\r\nexport * from './value';\r\nexport * from './collection';\r\nexport * from './emitter';\r\nexport * from './fiber-context';\r\n//# sourceMappingURL=index.js.map","export function initMapMethod(ctor) {\r\n    return function (mapper) {\r\n        var _this = this;\r\n        return new ctor(function (observer) { return _this.subscribe(function (value, error, subscription) {\r\n            if (error)\r\n                observer(null, error, subscription);\r\n            else\r\n                try {\r\n                    observer(mapper(value), error, subscription);\r\n                }\r\n                catch (err) {\r\n                    observer(null, err, subscription);\r\n                }\r\n        }); });\r\n    };\r\n}\r\n//# sourceMappingURL=map.js.map","export function mixin(targetProto, mixinProto) {\r\n    var props = [];\r\n    for (var _i = 2; _i < arguments.length; _i++) {\r\n        props[_i - 2] = arguments[_i];\r\n    }\r\n    props.forEach(function (prop) { return targetProto[prop] = mixinProto[prop]; });\r\n}\r\n//# sourceMappingURL=mixin.js.map","var Observable = /** @class */ (function () {\r\n    //static get [Symbol.species]() { return this; }\r\n    function Observable(_subscribe) {\r\n        this._subscribe = _subscribe;\r\n    }\r\n    Observable.prototype.subscribe = function (observer) {\r\n        try {\r\n            return this._subscribe(function (items, error, subscription) {\r\n                try {\r\n                    observer(items, error, subscription);\r\n                }\r\n                catch (err) {\r\n                    observer(null, err, subscription);\r\n                }\r\n            });\r\n        }\r\n        catch (error) {\r\n            observer(null, error, { unsubscribe: function () { } });\r\n        }\r\n    };\r\n    return Observable;\r\n}());\r\nexport { Observable };\r\n//# sourceMappingURL=observable.js.map","import * as tslib_1 from \"tslib\";\r\nimport { Observable } from \"./observable\";\r\nimport { initMapMethod } from \"./map\";\r\nimport { Collection } from \"./collection\";\r\nimport { FiberContext } from './fiber-context';\r\nvar Value = /** @class */ (function (_super) {\r\n    tslib_1.__extends(Value, _super);\r\n    function Value(subscribe) {\r\n        return _super.call(this, subscribe) || this;\r\n    }\r\n    Value.from = function (x) {\r\n        if (x.subscribe)\r\n            return new Value(function (s) { return x.subscribe(s); });\r\n        throw new Error(\"Value.from() can only take observables\");\r\n    };\r\n    Value.prototype.read = function () {\r\n        var resolved = false, result, err, notify;\r\n        var subscription = this.subscribe(function (value, error, subsciption) {\r\n            resolved = true;\r\n            result = value;\r\n            err = error;\r\n            if (error && notify)\r\n                notify(null, error, subsciption);\r\n            else if (notify)\r\n                notify(value, null, subsciption);\r\n        });\r\n        if (resolved) {\r\n            var currentFiber = FiberContext.current;\r\n            if (!currentFiber) {\r\n                subscription.unsubscribe();\r\n                throw new Error(\"Invalid Fiber Context\");\r\n            }\r\n            if (err) {\r\n                subscription.unsubscribe();\r\n                throw err;\r\n            }\r\n            var subscriptions = currentFiber.subscriptions, observer = currentFiber.observer;\r\n            subscriptions.push(subscription);\r\n            notify = observer;\r\n            return result;\r\n        }\r\n        throw new Promise(function (resolve, reject) {\r\n            notify = function (value, error, subscription) {\r\n                subscription.unsubscribe();\r\n                if (error)\r\n                    reject(error);\r\n                else\r\n                    resolve(value);\r\n            };\r\n        });\r\n    };\r\n    Value.prototype.load = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.subscribe(function (value, error, subsciption) {\r\n                if (error)\r\n                    reject(error);\r\n                else\r\n                    resolve(value);\r\n                subsciption.unsubscribe();\r\n            });\r\n        });\r\n    };\r\n    Value.prototype.filter = function (fn) {\r\n        var _this = this;\r\n        return new Value(function (observer) { return _this.subscribe(function (value, error, subscription) {\r\n            if (error)\r\n                observer(null, error, subscription);\r\n            else if (fn(value))\r\n                observer(value, error, subscription);\r\n        }); });\r\n    };\r\n    Value.prototype.log = function (prefix) {\r\n        return this.map(function (x) {\r\n            console.log(prefix, x);\r\n            return x;\r\n        });\r\n    };\r\n    Value.prototype.toCollection = function (mapper) {\r\n        var _this = this;\r\n        return new Collection(function (s) { return _this.map(mapper).subscribe(s); });\r\n    };\r\n    Value.prototype.combineLatest = function (other) {\r\n        var _this = this;\r\n        return new Value(function (observer) {\r\n            var values = [null, null];\r\n            var mySubscription, otherSubscription;\r\n            var subscription = {\r\n                unsubscribe: function () {\r\n                    mySubscription.unsubscribe();\r\n                    otherSubscription.unsubscribe();\r\n                }\r\n            };\r\n            mySubscription = _this.subscribe(function (items, error, s) {\r\n                if (error) {\r\n                    s.unsubscribe();\r\n                    observer(null, error, subscription);\r\n                }\r\n                values[0] = items;\r\n                if (values[1] !== null)\r\n                    observer(values, null, subscription);\r\n            });\r\n            otherSubscription = other.subscribe(function (value, error, s) {\r\n                if (error) {\r\n                    s.unsubscribe();\r\n                    observer(null, error, subscription);\r\n                }\r\n                values[1] = value;\r\n                if (values[0] !== null)\r\n                    observer(values, null, subscription);\r\n            });\r\n            return subscription;\r\n        });\r\n    };\r\n    Value.prototype.switchMap = function (mapper) {\r\n        var _this = this;\r\n        return new Value(function (observer) {\r\n            var mappedSubscription = null;\r\n            var subscription = null;\r\n            var returnedSubscription = {\r\n                unsubscribe: function () {\r\n                    subscription.unsubscribe();\r\n                    if (mappedSubscription) {\r\n                        mappedSubscription.unsubscribe();\r\n                        mappedSubscription = null;\r\n                    }\r\n                }\r\n            };\r\n            subscription = _this.subscribe(function (item, error, s) {\r\n                subscription = s;\r\n                if (mappedSubscription) {\r\n                    mappedSubscription.unsubscribe();\r\n                    mappedSubscription = null;\r\n                }\r\n                if (error)\r\n                    observer(null, error, returnedSubscription);\r\n                else {\r\n                    try {\r\n                        var observableOrValue = mapper(item);\r\n                        if (observableOrValue && typeof observableOrValue.subscribe === 'function') {\r\n                            mappedSubscription = observableOrValue.subscribe(function (value, error, s) {\r\n                                mappedSubscription = s;\r\n                                observer(value, error, returnedSubscription);\r\n                            });\r\n                        }\r\n                        else {\r\n                            observer(observableOrValue, null, subscription);\r\n                        }\r\n                    }\r\n                    catch (error) {\r\n                        observer(null, error, subscription);\r\n                    }\r\n                }\r\n            });\r\n            return returnedSubscription;\r\n        });\r\n    };\r\n    return Value;\r\n}(Observable));\r\nexport { Value };\r\nValue.prototype.map = initMapMethod(Value);\r\n//# sourceMappingURL=value.js.map","export * from './js/dist/js/observable';\r\n","export * from './js/dist/js/ked-backend-repo';\r\n","export default function getUserClaims(user) {\r\n    return [{\r\n            type: \"email\",\r\n            value: user.mail\r\n        }, {\r\n            type: \"school\",\r\n            value: user.school\r\n        }].concat(user.roles.map(function (role) { return ({\r\n        type: \"role\",\r\n        value: role\r\n    }); })).concat(user.roles.map(function (role) { return ({\r\n        type: \"schoolRole\",\r\n        value: user.school + \"/\" + role\r\n    }); }));\r\n}\r\n","import * as tslib_1 from \"tslib\";\r\nimport { DocumentAccess, hasAccess as _hasAccess } from 'kedbackend/client';\r\nimport getUserClaims from './get-user-claims';\r\nimport { parseQueryString, generateQueryString } from \"../utils/query-string\";\r\nexport { getUserClaims };\r\nexport var IMPERSONATION_QUERY_PARAMS = [\r\n    \"user\",\r\n    \"role\",\r\n    \"school\",\r\n    \"debug\",\r\n    \"testVersion\",\r\n    \"testversion\",\r\n    \"features\",\r\n    \"schoolGrade\",\r\n    \"schoolgrade\",\r\n    \"schoolType\",\r\n    \"schooltype\"\r\n];\r\nexport function hasAccess(user, doc, requestedRight) {\r\n    var claims = getUserClaims(user);\r\n    if (requestedRight !== 'R' && user.tutorFor) {\r\n        claims = claims.filter(function (claim) { return claim.type !== 'email'; });\r\n    }\r\n    var result = _hasAccess(DocumentAccess.fromStringArray(doc.acl || []), claims, requestedRight);\r\n    //console.log(`Has ${requestedRight} access to ${doc.name}/${doc.id}: ${result}`);\r\n    return result;\r\n}\r\nexport function hasReadAccess(user, doc) {\r\n    return hasAccess(user, doc, 'R');\r\n}\r\nexport function hasWriteAccess(user, doc) {\r\n    return hasAccess(user, doc, 'W');\r\n}\r\nexport function hasShareAccess(user, doc) {\r\n    return hasAccess(user, doc, 'S');\r\n}\r\nexport function isTeacherAtSchool(user, school) {\r\n    var isTeacher = user.roles.some(function (role) { return role === 'EMPLOYEE' || role === 'ADMIN'; });\r\n    var belongsToSchool = (school || \"\").toLowerCase() === user.school.toLowerCase();\r\n    return (isTeacher && belongsToSchool);\r\n}\r\nexport function isAdminOrTeacherAtSchool(user, school) {\r\n    return user.roles.includes(\"ADMIN\") || isTeacherAtSchool(user, school);\r\n}\r\nexport var impersonationEnv = {\r\n    actAs: function (options) {\r\n        var role = options.role, school = options.school, url = options.url;\r\n        var currentQuery = parseQueryString(location.search);\r\n        var newQuery = tslib_1.__assign({}, currentQuery, { role: role, school: school });\r\n        var newQueryString = generateQueryString(newQuery);\r\n        if (url) {\r\n            location.href = \"\" + url + newQueryString;\r\n        }\r\n        else {\r\n            location.hash = \"#\";\r\n            location.search = newQueryString;\r\n        }\r\n    }\r\n};\r\nexport function actAs(options) {\r\n    impersonationEnv.actAs(options);\r\n}\r\nexport function preserveImpersonationQuery(url, query) {\r\n    var e_1, _a;\r\n    var currentQuery = parseQueryString(location.search);\r\n    var preservedQuery = {};\r\n    try {\r\n        for (var IMPERSONATION_QUERY_PARAMS_1 = tslib_1.__values(IMPERSONATION_QUERY_PARAMS), IMPERSONATION_QUERY_PARAMS_1_1 = IMPERSONATION_QUERY_PARAMS_1.next(); !IMPERSONATION_QUERY_PARAMS_1_1.done; IMPERSONATION_QUERY_PARAMS_1_1 = IMPERSONATION_QUERY_PARAMS_1.next()) {\r\n            var param = IMPERSONATION_QUERY_PARAMS_1_1.value;\r\n            if (currentQuery[param])\r\n                preservedQuery[param] = currentQuery[param];\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (IMPERSONATION_QUERY_PARAMS_1_1 && !IMPERSONATION_QUERY_PARAMS_1_1.done && (_a = IMPERSONATION_QUERY_PARAMS_1.return)) _a.call(IMPERSONATION_QUERY_PARAMS_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    var newQueryString = generateQueryString(tslib_1.__assign({}, preservedQuery, query));\r\n    var pHash = url.indexOf('#');\r\n    return pHash >= 0 ?\r\n        \"\" + url.substr(0, pHash) + newQueryString + url.substr(pHash) :\r\n        \"\" + url + newQueryString;\r\n}\r\n","import * as tslib_1 from \"tslib\";\r\nimport { RestClient } from 'kedbackend/client';\r\nimport { HttpError } from 'kedbackend/client';\r\nimport { getTermStarEndDate } from '../utils/school-moment';\r\nimport { SchoolTerm } from '../utils/school-term';\r\nimport { dateTimeReviver, L } from '../utils/utils';\r\nimport mockJsonFile from './mock/mock-eds-data.json';\r\nimport moment from 'moment';\r\nimport { makeSuspenseApi } from '../utils/make-suspense-api';\r\nvar EdsClient = /** @class */ (function () {\r\n    function EdsClient(isomorphic, baseUrl, bearerProvider, userEmailGetter) {\r\n        var _this = this;\r\n        this.http = new RestClient(isomorphic, baseUrl, { bearerProvider: bearerProvider });\r\n        this.userEmailGetter = userEmailGetter;\r\n        var isApiMethod = function (m) {\r\n            return typeof _this[m] === 'function' &&\r\n                m !== 'constructor' && // Since makeSuspenseApi() walks prototype chain\r\n                m !== 'privatizingCacheBust' &&\r\n                m !== 'userEmailGetter';\r\n        } // List non-API methods here...\r\n        ;\r\n        Object.keys(EdsClient.prototype).forEach(function (method) {\r\n            if (isApiMethod(method)) {\r\n                _this[method] = avoidSimultanousCalls(_this[method]);\r\n            }\r\n        });\r\n        this.suspense = makeSuspenseApi(this, { isApiMethod: isApiMethod });\r\n    }\r\n    EdsClient.prototype.privatizingCacheBust = function () {\r\n        return { user: this.userEmailGetter() };\r\n    };\r\n    /**\r\n       * Retrieve active courses for current logged in student.\r\n       *\r\n       * @param courseCode Short-name of the course. Optional.\r\n       */\r\n    EdsClient.prototype.getActiveCourses = function (q) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var query, res, _a, _b, json, ex_1;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        _c.trys.push([0, 5, , 6]);\r\n                        query = this.privatizingCacheBust();\r\n                        if (q) {\r\n                            if (q.courseCode)\r\n                                query.CourseCode = q.courseCode;\r\n                            if (q.periodName)\r\n                                query.PeriodName = q.periodName;\r\n                        }\r\n                        return [4 /*yield*/, this.http.get(\"studentactivecourses\", query)];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4:\r\n                        json = _c.sent();\r\n                        return [2 /*return*/, json.courses];\r\n                    case 5:\r\n                        ex_1 = _c.sent();\r\n                        console.error(\"Error from EDS: \" + ex_1);\r\n                        throw new Error(L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"Kunde tyv\\u00E4rr inte ladda terminsm\\u00E5l eller avklarade steg fr\\u00E5n EDS. F\\u00F6rs\\u00F6k igen senare...\"], [\"Kunde tyv\\u00E4rr inte ladda terminsm\\u00E5l eller avklarade steg fr\\u00E5n EDS. F\\u00F6rs\\u00F6k igen senare...\"]))));\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Retrieve latest assessments for current logged in user.\r\n     *\r\n     * @param limit Optional limit\r\n     */\r\n    EdsClient.prototype.getLatestAssessments = function (limit) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var query, res, _a, _b, json;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        query = this.privatizingCacheBust();\r\n                        if (!isNaN(limit))\r\n                            query.Count = limit;\r\n                        return [4 /*yield*/, this.http.get(\"studentassessments\", query)];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4:\r\n                        json = _c.sent();\r\n                        return [2 /*return*/, json.assessments];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Retrieve studyplans for current logged-in user\r\n     */\r\n    EdsClient.prototype.getStudentGoals = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b, json;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.http.get(\"studentgoals\", this.privatizingCacheBust())];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4:\r\n                        json = _c.sent();\r\n                        return [2 /*return*/, json.studentGoals];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    EdsClient.prototype.getStudentFutureAbilities = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b, json;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.http.get(\"studentFutureAbilities\", this.privatizingCacheBust())];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4:\r\n                        json = _c.sent();\r\n                        return [2 /*return*/, json.studentFutureAbilities];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    EdsClient.prototype.getTeacherTutorStudents = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b, json;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.http.get(\"teachertutorstudents\", this.privatizingCacheBust())];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4:\r\n                        json = _c.sent();\r\n                        return [2 /*return*/, json.students];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * getSchoolTuitionGroups()\r\n     *\r\n     * Return tuitiongroups for school\r\n     *\r\n     * @param schoolName - name of school\r\n     * @param courseCode - Skolverkets code for course\r\n     */\r\n    EdsClient.prototype.getSchoolTuitionGroups = function (q) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b, json;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.http.get(\"SchoolTuitionGroups\", tslib_1.__assign({}, this.privatizingCacheBust(), q))];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4:\r\n                        json = _c.sent();\r\n                        return [2 /*return*/, json.schoolTuitionGroups];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * getTuitionGroupStudents()\r\n     *\r\n     * Return name and mailadresses for tutitiongroups in schools\r\n     *\r\n     * @param schoolName - name of school\r\n     * @param tuitionGroupName - tuition gruop name in EDS\r\n     */\r\n    EdsClient.prototype.getTuitionGroupStudents = function (q) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b, json;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.http.get(\"TuitionGroupStudents\", tslib_1.__assign({}, this.privatizingCacheBust(), q))];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4:\r\n                        json = _c.sent();\r\n                        return [2 /*return*/, json.tuitionGroupStudents];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * getSchoolTeachers()\r\n     *\r\n     * Return name and mailadresses for tutitiongroups in schools\r\n     *\r\n     * @param schoolName - name of school\r\n     */\r\n    EdsClient.prototype.getSchoolTeachers = function (q) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var res, _a, _b, json;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0: return [4 /*yield*/, this.http.get(\"SchoolTeachers\", tslib_1.__assign({}, this.privatizingCacheBust(), q))];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status != 200)) return [3 /*break*/, 3];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3: return [4 /*yield*/, res.json()];\r\n                    case 4:\r\n                        json = _c.sent();\r\n                        return [2 /*return*/, json.schoolTeachers];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // we assume that the EDS will return the current academic year dates determined by the current date\r\n    EdsClient.prototype.getAcademicYearTerms = function (schoolLocale, date) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var holidays, firstTermMoment, secondTermMoment, startFirstTermDate, startSecondTermDate, endFirstTermDate, endSecondTermDate, firstTerm, secondTerm;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                // mock data\r\n                switch (schoolLocale) {\r\n                    case 'en_sin':\r\n                        return [2 /*return*/, mockJsonFile.SouthIndia.filter(function (f) { return moment(date).isSameOrAfter(f.firstTerm.startDate) && moment(date).isSameOrBefore(f.secondTerm.endDate); })[0]];\r\n                    case 'en_nin':\r\n                        return [2 /*return*/, mockJsonFile.NorthIndia.filter(function (f) { return moment(date).isSameOrAfter(f.firstTerm.startDate) && moment(date).isSameOrBefore(f.secondTerm.endDate); })[0]];\r\n                    case 'sv':\r\n                        {\r\n                            holidays = [];\r\n                            firstTermMoment = getTermStarEndDate(date, true);\r\n                            secondTermMoment = getTermStarEndDate(date, false);\r\n                            startFirstTermDate = firstTermMoment[0];\r\n                            startSecondTermDate = secondTermMoment[0];\r\n                            endFirstTermDate = firstTermMoment[1];\r\n                            endSecondTermDate = secondTermMoment[1];\r\n                            firstTerm = { startDate: new Date(startFirstTermDate.year(), startFirstTermDate.month(), startFirstTermDate.date()).toDateString(), endDate: new Date(startFirstTermDate.year(), endFirstTermDate.month(), endFirstTermDate.date()).toDateString() };\r\n                            secondTerm = { startDate: new Date(startSecondTermDate.year(), startSecondTermDate.month(), startSecondTermDate.date()).toDateString(), endDate: new Date(startSecondTermDate.year(), endSecondTermDate.month(), endSecondTermDate.date()).toDateString() };\r\n                            return [2 /*return*/, { firstTerm: firstTerm, secondTerm: secondTerm, holidays: holidays }];\r\n                        }\r\n                }\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    return EdsClient;\r\n}());\r\nexport { EdsClient };\r\nvar EDSPeriod = /** @class */ (function () {\r\n    function EDSPeriod(periodStringOrSchoolTerm) {\r\n        if (typeof periodStringOrSchoolTerm === 'string') {\r\n            this.period = periodStringOrSchoolTerm;\r\n            this.term = this.period.startsWith('HT') ? 'AT' : 'ST';\r\n            this.year = parseInt(this.period.substr(2));\r\n            if (isNaN(this.year))\r\n                throw new Error(\"Invalid period: \" + this.period);\r\n        }\r\n        else {\r\n            var schoolTerm = new SchoolTerm(periodStringOrSchoolTerm);\r\n            this.period = (schoolTerm.term === 'AT' ? \"HT\" : \"VT\") + schoolTerm.year;\r\n            this.term = schoolTerm.term;\r\n            this.year = schoolTerm.year;\r\n        }\r\n    }\r\n    Object.defineProperty(EDSPeriod.prototype, \"schoolTerm\", {\r\n        get: function () {\r\n            return new SchoolTerm({\r\n                academicYear: this.term === 'AT' ?\r\n                    this.year + \"/\" + (this.year + 1) :\r\n                    this.year - 1 + \"/\" + this.year,\r\n                term: this.term\r\n            });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    EDSPeriod.prototype.toString = function () {\r\n        return this.period;\r\n    };\r\n    EDSPeriod.prototype.valueOf = function () {\r\n        return this.year + \":\" + (this.term === 'ST' ? \"1\" : \"2\");\r\n    };\r\n    return EDSPeriod;\r\n}());\r\nexport { EDSPeriod };\r\nexport function parseJsonDate_old(jsonDateStr) {\r\n    var date = dateTimeReviver(\"\", jsonDateStr);\r\n    if (!(date instanceof Date))\r\n        throw new Error(\"Invalid JSON date string: \" + jsonDateStr);\r\n    return date;\r\n}\r\nfunction avoidSimultanousCalls(method) {\r\n    var ongoingPromises = {};\r\n    return function () {\r\n        var argsJson = JSON.stringify([].slice.call(arguments));\r\n        if (!ongoingPromises[argsJson]) {\r\n            ongoingPromises[argsJson] = method.apply(this, arguments).then(function (result) {\r\n                delete ongoingPromises[argsJson];\r\n                return result;\r\n            });\r\n        }\r\n        return ongoingPromises[argsJson];\r\n    };\r\n}\r\nvar templateObject_1;\r\n","import * as tslib_1 from \"tslib\";\r\nvar createStudents = function (group, n, m) {\r\n    var students = [];\r\n    for (var i = n; i <= m; i++) {\r\n        students.push({\r\n            schoolName: 'KED',\r\n            tuitionGroupName: group,\r\n            studentFirstName: 'Student ' + i,\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student' + i + '.classroom@kedschools.com'\r\n        });\r\n    }\r\n    return students;\r\n};\r\nexport var mockTeachers = [\r\n    {\r\n        schoolName: 'KED',\r\n        teacherFirstName: 'Teacher 1',\r\n        teacherLastName: 'Classroom',\r\n        teacherEmailAddress: 'teacher1.classroom@kedschools.com'\r\n    },\r\n    {\r\n        schoolName: 'KED',\r\n        teacherFirstName: 'Teacher 2',\r\n        teacherLastName: 'Classroom',\r\n        teacherEmailAddress: 'teacher2.classroom@kedschools.com'\r\n    },\r\n    {\r\n        schoolName: 'KED',\r\n        teacherFirstName: 'Teacher 3',\r\n        teacherLastName: 'Classroom',\r\n        teacherEmailAddress: 'teacher3.classroom@kedschools.com'\r\n    },\r\n    {\r\n        schoolName: 'KED',\r\n        teacherFirstName: 'Carl',\r\n        teacherLastName: 'Holmberg',\r\n        teacherEmailAddress: 'carl@kedschools.com'\r\n    },\r\n    {\r\n        schoolName: 'KED',\r\n        teacherFirstName: 'David',\r\n        teacherLastName: 'Fahlander',\r\n        teacherEmailAddress: 'david.fahlander@kedschools.com'\r\n    },\r\n    {\r\n        schoolName: 'KED',\r\n        teacherFirstName: 'Andrei',\r\n        teacherLastName: 'Spatarelu',\r\n        teacherEmailAddress: 'andrei.spatarelu@vemendo.se'\r\n    },\r\n    {\r\n        schoolName: 'KED',\r\n        teacherFirstName: 'Andrei',\r\n        teacherLastName: 'Spatarelu',\r\n        teacherEmailAddress: 'andrei@kedschools.com'\r\n    }\r\n];\r\nexport var mockTuitionGroups = {\r\n    'DJUSL01': [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUR1_GR1 (180816-190614)',\r\n            courseCode: 'DJUSL01'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUR1_GR2 (180816-190614)',\r\n            courseCode: 'DJUSL01'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\r\n            courseCode: 'DJUSL01'\r\n        }\r\n    ],\r\n    'DJUDJI0': [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\r\n            courseCode: 'DJUDJI0'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\r\n            courseCode: 'DJUDJI0'\r\n        },\r\n    ],\r\n    'KEMKEM01': [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\r\n            courseCode: 'KEMKEM01'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\r\n            courseCode: 'KEMKEM01'\r\n        }\r\n    ],\r\n    \"MATMAT03b\": [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'MAT3b_Gr1 (180816-190614)',\r\n            courseCode: 'MATMAT03b'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'MAT3b_Gr2 (180816-190614)',\r\n            courseCode: 'MATMAT03b'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'MAT3b_Gr3 (180816-190614)',\r\n            courseCode: 'MATMAT03b'\r\n        }\r\n    ],\r\n    'BIOBIO01': [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\r\n            courseCode: 'BIOBIO01'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\r\n            courseCode: 'BIOBIO01'\r\n        }\r\n    ],\r\n    'SVESVE03': [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'SVE3_Gr1 (180816-190614)',\r\n            courseCode: 'SVESVE03'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'SVE3_Gr2 (180816-190614)',\r\n            courseCode: 'SVESVE03'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'SVE3_Gr3 (180816-190614)',\r\n            courseCode: 'SVESVE03'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'SVE3_Gr4 (180816-190614)',\r\n            courseCode: 'SVESVE03'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'SVE3_Gr5 (180816-190614)',\r\n            courseCode: 'SVESVE03'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'SVE3_Gr6 (180816-190614)',\r\n            courseCode: 'SVESVE03'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'SVE3_Gr7 (180816-190614)',\r\n            courseCode: 'SVESVE03'\r\n        }\r\n    ]\r\n};\r\nexport var mockTuitionStudents = {\r\n    'DJUR1_GR1 (180816-190614)': createStudents('DJUR1_GR1 (180816-190614)', 1, 12),\r\n    'DJUR1_GR2 (180816-190614)': createStudents('DJUR1_GR2 (180816-190614)', 13, 24),\r\n    'DJUR1_GR3 (180816-190614)': tslib_1.__spread([\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\r\n            studentFirstName: 'Student2',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student2.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\r\n            studentFirstName: 'Carl',\r\n            studentLastName: 'Holmberg',\r\n            studentEmailAddress: 'carl@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\r\n            studentFirstName: 'Andrei',\r\n            studentLastName: 'Spatarelu',\r\n            studentEmailAddress: 'andrei.spatarelu@vemendo.se'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUR1_GR3 (180816-190614)',\r\n            studentFirstName: 'Student3',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student3.classroom@kedschools.com'\r\n        }\r\n    ], createStudents('DJUR1_GR3 (180816-190614)', 23, 34)),\r\n    'DJUDJ_Gr1 (180816-190614)': tslib_1.__spread([\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\r\n            studentFirstName: 'Carl',\r\n            studentLastName: 'Holmberg',\r\n            studentEmailAddress: 'carl@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\r\n            studentFirstName: 'Andrei',\r\n            studentLastName: 'Spatarelu',\r\n            studentEmailAddress: 'andrei.spatarelu@vemendo.se'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUDJ_Gr1 (180816-190614)',\r\n            studentFirstName: 'David',\r\n            studentLastName: 'Fahlander',\r\n            studentEmailAddress: 'david.fahlander@kedschools.com'\r\n        }\r\n    ], createStudents('DJUDJ_Gr1 (180816-190614)', 151, 160)),\r\n    'DJUDJ_Gr2 (180816-190614)': tslib_1.__spread([\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\r\n            studentFirstName: 'Carl',\r\n            studentLastName: 'Holmberg',\r\n            studentEmailAddress: 'carl@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\r\n            studentFirstName: 'Andrei',\r\n            studentLastName: 'Spatarelu',\r\n            studentEmailAddress: 'andrei.spatarelu@vemendo.se'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'DJUDJ_Gr2 (180816-190614)',\r\n            studentFirstName: 'David',\r\n            studentLastName: 'Fahlander',\r\n            studentEmailAddress: 'david.fahlander@kedschools.com'\r\n        }\r\n    ], createStudents('DJUDJ_Gr2 (180816-190614)', 161, 165)),\r\n    'MAT3b_Gr1 (180816-190614)': createStudents('MAT3b_Gr1 (180816-190614)', 3, 23),\r\n    'MAT3b_Gr3 (180816-190614)': createStudents('MAT3b_Gr3 (180816-190614)', 24, 49),\r\n    'MAT3b_Gr2 (180816-190614)': tslib_1.__spread([\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'MAT3b_Gr2 (180816-190614)',\r\n            studentFirstName: 'Andrei',\r\n            studentLastName: 'Spatarelu',\r\n            studentEmailAddress: 'andrei@kedschools.com'\r\n        }\r\n    ], createStudents('MAT3b_Gr2 (180816-190614)', 50, 72)),\r\n    'IDR1_Gr1 (180816-190614)': createStudents('IDR1_Gr1 (180816-190614)', 1, 12),\r\n    'IDR1_Gr2 (180816-190614)': createStudents('IDR1_Gr2 (180816-190614)', 13, 22),\r\n    'IDR1_Gr3 (180816-190614)': createStudents('IDR1_Gr3 (180816-190614)', 23, 34),\r\n    'KEM1_Gr1 (180816-190614)': [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\r\n            studentFirstName: 'Student 2',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student2.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\r\n            studentFirstName: 'Student 3',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student3.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\r\n            studentFirstName: 'Student 8',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student8.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'KEM1_Gr1 (180816-190614)',\r\n            studentFirstName: 'Student 9',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student9.classroom@kedschools.com'\r\n        }\r\n    ],\r\n    'KEM1_Gr2 (180816-190614)': [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\r\n            studentFirstName: 'Student 1',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student1.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\r\n            studentFirstName: 'Student 5',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student5.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'KEM1_Gr2 (180816-190614)',\r\n            studentFirstName: 'Student 6',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student6.classroom@kedschools.com'\r\n        }\r\n    ],\r\n    'BIO1_Gr1 (180816-190614)': [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\r\n            studentFirstName: 'Student 1',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student1.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\r\n            studentFirstName: 'Student 4',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student4.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\r\n            studentFirstName: 'Student 6',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student6.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'BIO1_Gr1 (180816-190614)',\r\n            studentFirstName: 'Student 10',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student10.classroom@kedschools.com'\r\n        }\r\n    ],\r\n    'BIO1_Gr2 (180816-190614)': [\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\r\n            studentFirstName: 'Student 2',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student2.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\r\n            studentFirstName: 'Student 7',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student7.classroom@kedschools.com'\r\n        },\r\n        {\r\n            schoolName: 'KED',\r\n            tuitionGroupName: 'BIO1_Gr2 (180816-190614)',\r\n            studentFirstName: 'Student 8',\r\n            studentLastName: 'Classroom',\r\n            studentEmailAddress: 'student8.classroom@kedschools.com'\r\n        },\r\n    ],\r\n    'SVE3_Gr1 (180816-190614)': createStudents('SVE3_Gr1 (180816-190614)', 1, 21),\r\n    'SVE3_Gr2 (180816-190614)': createStudents('SVE3_Gr2 (180816-190614)', 22, 44),\r\n    'SVE3_Gr3 (180816-190614)': createStudents('SVE3_Gr3 (180816-190614)', 45, 61),\r\n    'SVE3_Gr4 (180816-190614)': createStudents('SVE3_Gr4 (180816-190614)', 62, 78),\r\n    'SVE3_Gr5 (180816-190614)': createStudents('SVE3_Gr5 (180816-190614)', 83, 107),\r\n    'SVE3_Gr6 (180816-190614)': createStudents('SVE3_Gr6 (180816-190614)', 108, 124),\r\n    'SVE3_Gr7 (180816-190614)': createStudents('SVE3_Gr7 (180816-190614)', 125, 150)\r\n};\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nvar GoalProgress = /** @class */ (function (_super) {\r\n    tslib_1.__extends(GoalProgress, _super);\r\n    function GoalProgress() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.createProgress = function () {\r\n            var _a = _this.props, numberOfTasks = _a.numberOfTasks, completedNumberOfTasks = _a.completedNumberOfTasks, maximumTasksDisplayed = _a.maximumTasksDisplayed, backgroundColor = _a.backgroundColor, progressColor = _a.progressColor;\r\n            var progress = [];\r\n            if (numberOfTasks > maximumTasksDisplayed) {\r\n                return React.createElement(\"div\", { className: \"progress-overview\" },\r\n                    \" \",\r\n                    completedNumberOfTasks,\r\n                    \" / \",\r\n                    numberOfTasks,\r\n                    \" \");\r\n            }\r\n            for (var taskNo = 1; taskNo <= numberOfTasks; taskNo++) {\r\n                progress.push(React.createElement(\"svg\", { key: taskNo },\r\n                    React.createElement(\"circle\", { className: \"circle-chart-background\", fill: taskNo > completedNumberOfTasks ? backgroundColor : progressColor, cx: \"8\", cy: \"8\", r: \"8\" })));\r\n            }\r\n            return progress;\r\n        };\r\n        return _this;\r\n    }\r\n    GoalProgress.prototype.render = function () {\r\n        return React.createElement(\"div\", { className: \"goals-progress\" }, this.createProgress());\r\n    };\r\n    GoalProgress.defaultProps = {\r\n        numberofTasks: 0,\r\n        completedNumberOfTasks: 0,\r\n        maximumTasksDisplayed: 10,\r\n        backgroundColor: \"lightgrey\",\r\n        progressColor: \"#3dbca2\",\r\n    };\r\n    return GoalProgress;\r\n}(React.Component));\r\nexport { GoalProgress };\r\n","import * as React from 'react';\r\nexport var TwoColumnsPage = function (_a) {\r\n    var left = _a.left, right = _a.right, rightWidth = _a.rightWidth;\r\n    return (React.createElement(\"div\", { className: \"sv-row sv-layout\" },\r\n        React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-12\" },\r\n            React.createElement(\"div\", { className: \"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\" },\r\n                React.createElement(\"div\", { className: \"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\" },\r\n                    React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\r\n                        React.createElement(\"div\", { className: \"sv-layout sv-skip-spacer sv-column-\" + (12 - rightWidth) }, left),\r\n                        React.createElement(\"div\", { className: \"sv-layout sv-column-\" + rightWidth }, right)))))));\r\n};\r\n","import * as React from 'react';\r\nexport var EllipsisLoader = function () {\r\n    return React.createElement(\"img\", { style: { border: 0, margin: 0, padding: 0 }, className: \"ellipsis-loader\" });\r\n};\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport { L } from \"../../../utils/utils\";\r\n;\r\nexport var RemoveItem = function (_a) {\r\n    var onClick = _a.onClick, className = _a.className, style = _a.style, title = _a.title;\r\n    return React.createElement(\"div\", { title: title || L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"Radera\"], [\"Radera\"]))), className: \"removeItem \" + (className || \"\"), onClick: onClick, style: style });\r\n};\r\nvar templateObject_1;\r\n","import * as React from 'react';\r\nexport var Spinner = function (_a) {\r\n    var _b = _a.label, label = _b === void 0 ? \"\" : _b;\r\n    return React.createElement(\"span\", null,\r\n        React.createElement(\"i\", { className: \"fa fa-spinner fa-spin\", \"aria-hidden\": \"true\" }),\r\n        \"\\u00A0\",\r\n        label);\r\n};\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport { HttpError } from 'kedbackend/client';\r\nimport { env } from '../../../globals/KED.env';\r\nimport download from 'downloadjs';\r\nimport { Spinner } from '../../course-builder/sub-components/spinner';\r\nimport { getUrkundHoverText, getUrkundStatusClass, getUrkundSignificanceClass } from './urkund-utils';\r\nexport function getUrkundStatus(file, refreshAssignment, checkWithUrkund) {\r\n    var metadata = file.metadata;\r\n    var urkundResponses;\r\n    try {\r\n        urkundResponses = metadata.urkundResponse && JSON.parse(metadata.urkundResponse);\r\n    }\r\n    catch (err) {\r\n        urkundResponses = null;\r\n    }\r\n    var urkundResponse = urkundResponses && urkundResponses[0];\r\n    if (!urkundResponse && file.metadata.urkundUploadError) {\r\n        urkundResponse = {\r\n            Status: {\r\n                ErrorCode: -1,\r\n                Message: file.metadata.urkundUploadError,\r\n                State: 'Error'\r\n            },\r\n            ExternalId: file.metadata.urkundExternalId\r\n        };\r\n    }\r\n    if (file.isRefreshing)\r\n        return React.createElement(\"td\", { colSpan: 2 },\r\n            React.createElement(Spinner, null),\r\n            \" Uppdaterar...\");\r\n    return urkundResponse ? React.createElement(React.Fragment, null,\r\n        React.createElement(\"td\", { className: \"urkund-status-col\" },\r\n            React.createElement(\"a\", { href: urkundResponse.Report && urkundResponse.Report.ReportUrl, onClick: function (ev) {\r\n                    if (['Accepted', 'Submitted'].indexOf(urkundResponse.Status.State) === -1)\r\n                        return; // Follow HREF instead.\r\n                    ev.preventDefault();\r\n                    ev.stopPropagation();\r\n                    checkWithUrkund && refreshAssignment(file);\r\n                }, target: \"_blank\", title: getUrkundHoverText(urkundResponse) },\r\n                React.createElement(\"div\", { className: getUrkundStatusClass(urkundResponse) }))),\r\n        React.createElement(\"td\", { className: \"urkund-status-col\" },\r\n            React.createElement(\"div\", { className: getUrkundSignificanceClass(urkundResponse) }, urkundResponse.Report && typeof urkundResponse.Report.Significance === 'number' ?\r\n                urkundResponse.Report.Significance.toFixed() + \"%\" : ' '))) : React.createElement(\"td\", { colSpan: 2 });\r\n}\r\nexport function update(assignments, assignment) {\r\n    var retval = tslib_1.__spread([\r\n        assignment\r\n    ], assignments.filter(function (_a) {\r\n        var user = _a.user, filename = _a.filename;\r\n        return user !== assignment.user ||\r\n            filename !== assignment.filename;\r\n    }));\r\n    return retval;\r\n}\r\nexport function downloadFile(file) {\r\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n        var res, _a, _b, blob, err_1;\r\n        return tslib_1.__generator(this, function (_c) {\r\n            switch (_c.label) {\r\n                case 0:\r\n                    _c.trys.push([0, 5, , 6]);\r\n                    return [4 /*yield*/, env.kedBackendClient.http.fetch(file.mediaLink, 'get', {})];\r\n                case 1:\r\n                    res = _c.sent();\r\n                    if (!(res.status >= 400)) return [3 /*break*/, 3];\r\n                    _a = HttpError.bind;\r\n                    _b = [void 0, res.status];\r\n                    return [4 /*yield*/, res.text()];\r\n                case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                case 3: return [4 /*yield*/, res.blob()];\r\n                case 4:\r\n                    blob = _c.sent();\r\n                    download(blob, file.filename, file.contentType);\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_1 = _c.sent();\r\n                    this.setState({ error: \"Kunde inte ladda ned filen. \" + (err_1.message || err_1) });\r\n                    console.error(err_1);\r\n                    return [3 /*break*/, 6];\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nexport function DriveFileListing(_a) {\r\n    var file = _a.file;\r\n    var _b = file.metadata, driveFileIconUrl = _b.driveFileIconUrl, driveFileUrl = _b.driveFileUrl;\r\n    var filename = file.filename.substr(0, file.filename.lastIndexOf('.'));\r\n    return (React.createElement(\"div\", { className: \"align-horizontal spaced\" },\r\n        React.createElement(\"div\", { className: \"horizontalItem top\" },\r\n            React.createElement(\"img\", { className: \"file-icon\", src: driveFileIconUrl })),\r\n        React.createElement(\"div\", { className: \"horizontalItem top\" },\r\n            React.createElement(\"span\", null,\r\n                React.createElement(\"a\", { target: \"_blank\", href: driveFileUrl }, filename)))));\r\n}\r\n","export function getUrkundStatusClass(res) {\r\n    if (!res || !res.Status) {\r\n        return null;\r\n    }\r\n    else\r\n        switch (res.Status.State) {\r\n            case 'Error':\r\n                return \"urkund-status urkund-status-error\";\r\n            case 'Submitted':\r\n                return \"urkund-status urkund-status-submitted\";\r\n            case 'Accepted':\r\n                return \"urkund-status urkund-status-accepted\";\r\n            case 'Analyzed':\r\n                return \"urkund-status urkund-status-analyzed\";\r\n        }\r\n}\r\nexport function getUrkundHoverText(res) {\r\n    if (!res || !res.Status)\r\n        return null;\r\n    switch (res.Status.State) {\r\n        case 'Error':\r\n            return res.ExternalId ?\r\n                \"Kunde inte tas emot av urkund. Felkod: \" + res.Status.ErrorCode + \"\\n\" +\r\n                    (\"External ID: \" + res.ExternalId + \"\\nFelmeddelande: \" + res.Status.Message)\r\n                :\r\n                    res.Status.Message;\r\n        case 'Submitted':\r\n            return \"Filen \\u00E4r uppladdad till Urkund. Klicka f\\u00F6r att uppdatera status.\";\r\n        case 'Accepted':\r\n            return \"Filen analyseras fortfarande av Urkund. Klicka f\\u00F6r att uppdatera status.\";\r\n        case 'Analyzed':\r\n            return \"Rapport skapad. Klicka f\\u00F6r att \\u00F6ppna rapporten i nytt f\\u00F6nster\";\r\n    }\r\n}\r\nexport function getUrkundSignificanceClass(res) {\r\n    if (!res || !res.Status)\r\n        return '';\r\n    switch (res.Status.State) {\r\n        case 'Error': return 'urkund-significance-error';\r\n        case 'Submitted': return 'urkund-significance-submitted';\r\n        case 'Accepted': return 'urkund-significance-accepted';\r\n    }\r\n    var report = res.Report;\r\n    if (!report) {\r\n        return \"\";\r\n    }\r\n    if (report.Significance < 1)\r\n        //return `${cdn}/images/urkund/0.gif`;\r\n        return \"urkund-significance urkund-significance-0\";\r\n    if (report.Significance < 10)\r\n        //return `${cdn}/images/urkund/1.gif`;\r\n        return \"urkund-significance urkund-significance-1\";\r\n    if (report.Significance < 25)\r\n        return \"urkund-significance urkund-significance-2\";\r\n    //return `${cdn}/images/urkund/2.gif`;\r\n    if (report.Significance < 40)\r\n        return \"urkund-significance urkund-significance-3\";\r\n    //return `${cdn}/images/urkund/3.gif`;\r\n    if (report.Significance < 55)\r\n        return \"urkund-significance urkund-significance-4\";\r\n    //return `${cdn}/images/urkund/4.gif`;\r\n    if (report.Significance < 70)\r\n        return \"urkund-significance urkund-significance-5\";\r\n    //return `${cdn}/images/urkund/5.gif`;\r\n    if (report.Significance < 85)\r\n        return \"urkund-significance urkund-significance-6\";\r\n    //return `${cdn}/images/urkund/6.gif`;\r\n    if (report.Significance < 99.9)\r\n        return \"urkund-significance urkund-significance-7\";\r\n    //return `${cdn}/images/urkund/7.gif`;\r\n    if (report.Significance >= 99.9)\r\n        return \"urkund-significance urkund-significance-8\";\r\n    //return `${cdn}/images/urkund/8.gif`;\r\n    return \"\";\r\n}\r\n","import * as tslib_1 from \"tslib\";\r\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\r\nimport * as React from 'react';\r\nimport { CourseTask } from './course-task';\r\nimport { useContext } from 'react';\r\nimport { compareProps } from '../../../utils/utils';\r\nimport { mockTuitionStudents } from '../../../apis/mock/mock-classroom-data';\r\nimport { LanguageContext } from '../../utility-components/LanguageContext';\r\nimport { NotificationIcon } from '../shared/notification-icon';\r\nimport { StateContext } from '../digest-view';\r\nimport { AssignmentsContext } from '.';\r\nexport var CourseModuleView = (function (_a) {\r\n    var module = _a.module, tasks = _a.tasks;\r\n    var intl = useContext(LanguageContext).intl;\r\n    var _b = useContext(StateContext), notificationdigests = _b.notificationdigests, selectedCourse = _b.selectedCourse;\r\n    var filterStudyGroups = useContext(AssignmentsContext).filterStudyGroups;\r\n    var getNotSubmittedUsers = function (taskAssignments) {\r\n        var taskNotSubmittedUsers = [];\r\n        // get students from the course study groups who have't uploaded their assignments\r\n        var studyGroups = filterStudyGroups.length > 0 ? selectedCourse.studyGroups.filter(function (sg) { return filterStudyGroups.includes(sg); }) : selectedCourse.studyGroups;\r\n        studyGroups.forEach(function (group) {\r\n            var users = mockTuitionStudents[group] && mockTuitionStudents[group]\r\n                .filter(function (cs) { return (!taskAssignments || !taskAssignments.find(function (f) { return f.user === cs.studentEmailAddress; })) && !taskNotSubmittedUsers.find(function (u) { return u.email === cs.studentEmailAddress; }); })\r\n                .map(function (ns) { return { displayName: ns.studentFirstName + \" \" + ns.studentLastName, firstName: ns.studentFirstName, lastName: ns.studentLastName, email: ns.studentEmailAddress }; });\r\n            if (users) {\r\n                taskNotSubmittedUsers.push.apply(taskNotSubmittedUsers, tslib_1.__spread(users));\r\n            }\r\n        });\r\n        //sort by lastname - firstname\r\n        return taskNotSubmittedUsers.map(function (s) {\r\n            var _a = tslib_1.__read(s.displayName.split(' ')), firstName = _a[0], rest = _a.slice(1);\r\n            return tslib_1.__assign({}, s, { firstName: firstName, lastName: rest.join(' ') });\r\n        }).sort(compareProps([\"lastName\", \"firstName\"]));\r\n    };\r\n    var courseNotifications = notificationdigests[selectedCourse.id];\r\n    return tasks && tasks.length > 0 &&\r\n        React.createElement(React.Fragment, null,\r\n            React.createElement(OpenCloseBox, { title: React.createElement(\"div\", { className: \"notification-container\" },\r\n                    React.createElement(\"span\", null, module.name),\r\n                    React.createElement(NotificationIcon, { course: selectedCourse, entity: 'module', moduleId: module.id, notificationdigests: notificationdigests })), headerOpen: false }, courseNotifications && Object.keys(courseNotifications).length > 0 ? React.createElement(\"div\", null, tasks.map(function (task) {\r\n                var taskAssignments = courseNotifications[task.id] ? courseNotifications[task.id].map(function (t) { return t.assignment; }) : [];\r\n                var notSubmittedUsers = selectedCourse.studyGroups && selectedCourse.studyGroups.length > 0 && getNotSubmittedUsers(taskAssignments);\r\n                var displayTask = notSubmittedUsers && notSubmittedUsers.length > 0 || taskAssignments && taskAssignments.length > 0;\r\n                return displayTask &&\r\n                    React.createElement(CourseTask, { key: task.id, task: task, module: module, assignments: taskAssignments, notSubmittedUsers: notSubmittedUsers });\r\n            })) :\r\n                React.createElement(\"div\", null, intl.formatMessage({ id: \"teacherView.noUploadedAssignmentsForModule\", defaultMessage: \"No assignments have been uploaded for this module\" }))));\r\n});\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport { useState, useContext } from 'react';\r\nimport { LanguageContext } from '../../utility-components/LanguageContext';\r\nimport { env } from '../../../globals/KED.env';\r\nimport { showError, showInfo } from '../../../utils/utils';\r\nimport { HttpError } from 'kedbackend/client';\r\nimport { StateContext } from '../digest-view';\r\nimport { Spinner } from '../../course-builder/sub-components/spinner';\r\nexport var CourseTaskNotHandedUserList = (function (_a) {\r\n    var notSubmittedUsers = _a.notSubmittedUsers, moduleName = _a.moduleName, taskName = _a.taskName, taskDeadline = _a.taskDeadline;\r\n    var intl = useContext(LanguageContext).intl;\r\n    var selectedCourse = useContext(StateContext).selectedCourse;\r\n    var notSubmittedLength = notSubmittedUsers && notSubmittedUsers.length;\r\n    var _b = tslib_1.__read(useState({ emailSendInProgress: false, emaiRecipients: [] }), 2), emailInfo = _b[0], setEmailInfo = _b[1];\r\n    function sendReminder(data) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var client, res, _a, _b, err_1;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        _c.trys.push([0, 4, , 5]);\r\n                        client = env.kedBackendClient.http;\r\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emailSendInProgress: true }));\r\n                        return [4 /*yield*/, client.post(\"email/reminder\", data)];\r\n                    case 1:\r\n                        res = _c.sent();\r\n                        if (!(res.status !== 200)) return [3 /*break*/, 3];\r\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emailSendInProgress: false }));\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, res.status];\r\n                        return [4 /*yield*/, res.text()];\r\n                    case 2: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 3:\r\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emailSendInProgress: false }));\r\n                        showInfo(intl.formatMessage({ id: \"teacherView.emailRemindersSentMsg\", defaultMessage: \"Reminders successfully sent\" }));\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        err_1 = _c.sent();\r\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emailSendInProgress: false }));\r\n                        showError(err_1);\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    }\r\n    return !notSubmittedUsers || notSubmittedUsers.length === 0 ? null : React.createElement(\"div\", { className: \"not-submitted-users taskContainer\" },\r\n        React.createElement(\"h4\", null, intl.formatMessage({ id: \"teacherView.notSubmittedAssignments\", defaultMessage: \"Ej lmnat in\" })),\r\n        notSubmittedUsers.map(function (ns, index) {\r\n            return React.createElement(\"div\", { key: \"notHandedIn_\" + index, className: \"align-horizontal student-row\" + (notSubmittedLength === index + 1 ? \" last\" : \"\") },\r\n                React.createElement(\"div\", { className: \"horizontalItem top pull-right\", onClick: function () {\r\n                        setEmailInfo(tslib_1.__assign({}, emailInfo, { emaiRecipients: emailInfo.emaiRecipients.find(function (su) { return su.email === ns.email; }) ? emailInfo.emaiRecipients.filter(function (u) { return u.email != ns.email; }) : tslib_1.__spread(emailInfo.emaiRecipients, [{ email: ns.email, firstName: ns.firstName, lastName: ns.lastName }]) }));\r\n                    } },\r\n                    React.createElement(\"div\", { className: \"checkBox\" + (emailInfo.emaiRecipients.find(function (su) { return su.email === ns.email; }) ? \" checked\" : \"\") })),\r\n                React.createElement(\"div\", { className: \"horizontalItem top\" }, ns.displayName));\r\n        }),\r\n        React.createElement(\"div\", { className: \"align-horizontal remind-assignment\" },\r\n            React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\r\n                React.createElement(\"button\", { className: \"btn btn-info\" + (emailInfo.emailSendInProgress ? \" disabled\" : \"\"), disabled: emailInfo.emailSendInProgress, onClick: function () {\r\n                        if (emailInfo.emaiRecipients.length > 0) {\r\n                            var emailData = {\r\n                                sendTo: emailInfo.emaiRecipients,\r\n                                courseName: selectedCourse.name,\r\n                                moduleName: moduleName,\r\n                                taskName: taskName,\r\n                                taskDeadline: taskDeadline\r\n                            };\r\n                            sendReminder(emailData);\r\n                        }\r\n                        else {\r\n                            showError(intl.formatMessage({ id: \"teacherView.sendEmailAtLeastOneRecipientErr\", defaultMessage: \"At least one student should be selected\" }));\r\n                        }\r\n                    } }, emailInfo.emailSendInProgress ?\r\n                    React.createElement(React.Fragment, null,\r\n                        React.createElement(Spinner, null),\r\n                        intl.formatMessage({ id: \"teacherView.emailReminderInProgress\", defaultMessage: \"Pgende\" }))\r\n                    :\r\n                        React.createElement(React.Fragment, null, intl.formatMessage({ id: \"teacherView.remindBtn\", defaultMessage: \"Pminn\" }))))));\r\n});\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\r\nimport { CourseTaskAssignments } from './course-tasks-assignments';\r\nimport { CourseTaskNotHandedUserList } from './course-task-not-handed-users';\r\nimport { NotificationIcon } from '../shared/notification-icon';\r\nimport { createUUID, simpleDigest } from 'kedbackend/client';\r\nimport { db } from '../../../globals/db';\r\nimport { env } from '../../../globals/KED.env';\r\nimport { StateContext } from '../digest-view';\r\nexport var CourseTask = (function (_a) {\r\n    var task = _a.task, assignments = _a.assignments, notSubmittedUsers = _a.notSubmittedUsers, module = _a.module;\r\n    var _b = React.useContext(StateContext), notificationdigests = _b.notificationdigests, selectedCourse = _b.selectedCourse, seenDigestsObservable = _b.seenDigestsObservable;\r\n    function onTaskOpened(isOpened) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var tagsDigest_1, seenDigests_1;\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(isOpened && notificationdigests[selectedCourse.id][task.id])) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, simpleDigest(env.currentUser.mail + selectedCourse.id)];\r\n                    case 1:\r\n                        tagsDigest_1 = _a.sent();\r\n                        return [4 /*yield*/, seenDigestsObservable.load()];\r\n                    case 2:\r\n                        seenDigests_1 = _a.sent();\r\n                        assignments.forEach(function (assignment) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n                            var assignmentDigest;\r\n                            return tslib_1.__generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4 /*yield*/, simpleDigest(assignment.user + //(studen's email address)\r\n                                            assignment.courseId +\r\n                                            assignment.taskId +\r\n                                            assignment.uploadDate +\r\n                                            (assignment.metadata.driveFileId || \"\"))];\r\n                                    case 1:\r\n                                        assignmentDigest = _a.sent();\r\n                                        if (!(seenDigests_1 && seenDigests_1.find(function (a) { return a.digest === assignmentDigest; }))) {\r\n                                            db.seenStudentAssignments.add({\r\n                                                id: createUUID(),\r\n                                                tags: [tagsDigest_1],\r\n                                                digest: assignmentDigest\r\n                                            });\r\n                                        }\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        }); });\r\n                        _a.label = 3;\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    }\r\n    return React.createElement(OpenCloseBox, { onOpenClose: function (becameOpen) { return onTaskOpened(becameOpen); }, className: \"task-container\", title: React.createElement(\"div\", { className: \"notification-container\" },\r\n            React.createElement(\"span\", null, task.name),\r\n            React.createElement(NotificationIcon, { course: selectedCourse, entity: 'task', taskId: task.id, notificationdigests: notificationdigests })), headerOpen: false },\r\n        React.createElement(\"div\", { className: \"ked_boxed\" },\r\n            React.createElement(CourseTaskAssignments, { taskId: task.id, assignments: assignments, checkWithUrkund: task.sendToUrkund === undefined ? true : task.sendToUrkund }),\r\n            React.createElement(\"br\", null),\r\n            React.createElement(CourseTaskNotHandedUserList, { notSubmittedUsers: notSubmittedUsers, moduleName: module.name, taskName: task.name, taskDeadline: task.deadline })));\r\n});\r\n","import * as React from 'react';\r\nimport moment from 'moment';\r\nimport { TaskAssignment } from './task-assignment';\r\nimport { LanguageContext } from '../../utility-components/LanguageContext';\r\nimport { useContext } from 'react';\r\nimport { AssignmentsContext } from '.';\r\nimport { mockTuitionStudents } from '../../../apis/mock/mock-classroom-data';\r\nimport { flatten } from '../../../utils/utils';\r\nexport var CourseTaskAssignments = (function (_a) {\r\n    var assignments = _a.assignments, checkWithUrkund = _a.checkWithUrkund, taskId = _a.taskId;\r\n    var intl = useContext(LanguageContext).intl;\r\n    var filterStudyGroups = React.useContext(AssignmentsContext).filterStudyGroups;\r\n    var refreshableAssigments = Object.assign([], assignments);\r\n    var studyGroups = filterStudyGroups.length > 0 && Object.keys(mockTuitionStudents).filter(function (gr) { return filterStudyGroups.includes(gr); }).map(function (st) { return mockTuitionStudents[st]; });\r\n    var filteredAssignments = filterStudyGroups.length > 0 ?\r\n        refreshableAssigments.filter(function (r) { return flatten(studyGroups).find(function (sg) { return sg.studentEmailAddress === r.user; }); }) : refreshableAssigments;\r\n    //determine which assignments should get data from urkund\r\n    checkWithUrkund && filteredAssignments.length > 0 && filteredAssignments.forEach(function (a) {\r\n        a.shouldRefresh = false;\r\n        if (a.metadata &&\r\n            a.metadata.urkundExternalId &&\r\n            a.metadata.urkundExternalId.length > 0 && // Must have metadata.urkundExternalId Otherwise not possible to refresh\r\n            !a.metadata.urkundUploadError && ( // Not possible to refresh if upload has failed\r\n        !a.metadata.urkundLastPoll || // Never checked status yet\r\n            (['Accepted', 'Submitted'].indexOf(JSON.parse(a.metadata.urkundResponse)[0].Status.State) >= 0 &&\r\n                parseInt(a.metadata.urkundLastPoll) < moment().add(-15, \"seconds\").toDate().getTime()))) {\r\n            a.shouldRefresh = true;\r\n        }\r\n    });\r\n    return filteredAssignments.length > 0 ? React.createElement(\"table\", { className: \"task-assignments-table\" },\r\n        React.createElement(\"thead\", null,\r\n            React.createElement(\"tr\", null,\r\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentStudentName\", defaultMessage: \"Elev\" })),\r\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentFileName\", defaultMessage: \"Filnamn\" })),\r\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentSubmittedAt\", defaultMessage: \"Inlamnat\" })),\r\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentReport\", defaultMessage: \"Rapport\" })),\r\n                React.createElement(\"th\", null, intl.formatMessage({ id: \"teacherView.assignmentGrade\", defaultMessage: \"Niva\" })))),\r\n        React.createElement(\"tbody\", null, filteredAssignments.map(function (assignment) {\r\n            return React.createElement(TaskAssignment, { taskId: taskId, key: assignment.uploadDate, assignment: assignment, shouldGetUrkundStatus: assignment.shouldRefresh });\r\n        })))\r\n        :\r\n            React.createElement(\"div\", null, intl.formatMessage({ id: \"teacherView.noTaskAssignments\", defaultMessage: \"Inga uppdrag uppladdade fr denna uppgift\" }));\r\n});\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport { CourseModuleView } from './course-module';\r\nimport { useContext, useState, createContext } from 'react';\r\nimport { LanguageContext } from '../../utility-components/LanguageContext';\r\nimport { StateContext } from '../digest-view';\r\nimport Select from 'react-select';\r\nexport var AssignmentsContext = createContext({ filterStudyGroups: [] });\r\nexport var AssignmentsView = (function () {\r\n    var intl = useContext(LanguageContext).intl;\r\n    var _a = tslib_1.__read(useState([]), 2), selectedStudyGroups = _a[0], setFilterStudyGroup = _a[1];\r\n    var _b = useContext(StateContext), tasks = _b.tasks, selectedCourse = _b.selectedCourse;\r\n    var defaultDescriptionMessage = \"Hr listas samtliga inlmningsuppgifter i din/dina kurser du handleder.\"\r\n        + \"Klicka till hger fr att vlja kurs. Kursens uppgifter syns nedan. Du kan ppna/dlja varje modul.\";\r\n    return React.createElement(React.Fragment, null,\r\n        \" \",\r\n        selectedCourse ?\r\n            React.createElement(AssignmentsContext.Provider, { value: { filterStudyGroups: selectedStudyGroups } },\r\n                React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\r\n                    React.createElement(\"h2\", null, intl.formatMessage({ id: \"teacherView.assignmentsViewTitle\", defaultMessage: \"Inlmningsuppgifter\" })),\r\n                    React.createElement(\"p\", null, intl.formatMessage({ id: \"teacherView.assignmentsViewDescription\", defaultMessage: { defaultDescriptionMessage: defaultDescriptionMessage } })),\r\n                    React.createElement(\"h3\", null,\r\n                        selectedCourse.name,\r\n                        \"-\",\r\n                        selectedCourse.description),\r\n                    selectedCourse.studyGroups && selectedCourse.studyGroups.length > 0 &&\r\n                        React.createElement(\"div\", { className: \"sv-row sv-layout sv-skip-spacer\" },\r\n                            React.createElement(\"div\", { className: \"horizontalItem top pull-right study-group-filter\" },\r\n                                React.createElement(Select, { isMulti: true, options: selectedCourse.studyGroups.map(function (sg) { return ({ label: sg, value: sg }); }), value: selectedStudyGroups.map(function (group) { return ({ label: group, value: group }); }), placeholder: intl.formatMessage({ id: \"teacherView.filterByStudygroupsPlaceholder\", defaultMessage: \"Vlj undervisningsgrupp\" }), onChange: function (options) {\r\n                                        setFilterStudyGroup(options.map(function (_a) {\r\n                                            var value = _a.value;\r\n                                            return value;\r\n                                        }));\r\n                                    } }))),\r\n                    selectedCourse.modules.map(function (module) {\r\n                        var moduleTasks = tasks.filter(function (t) { return module.taskIds.find(function (tId) { return tId === t.id; }); });\r\n                        return moduleTasks.length > 0 ? React.createElement(CourseModuleView, { tasks: moduleTasks, key: module.id, module: module }) : null;\r\n                    })))\r\n            : null);\r\n});\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport moment from 'moment';\r\nimport { DriveFileListing, downloadFile, getUrkundStatus } from '../../course-viewer/course-page/task-assignments-utils';\r\nimport { env } from '../../../globals/KED.env';\r\nimport { HttpError } from 'kedbackend/client';\r\nimport { useEffect, useState, useContext } from 'react';\r\nimport { maxLength } from '../../../utils/utils';\r\nimport { StateContext } from '../digest-view';\r\nexport var TaskAssignment = (function (_a) {\r\n    var assignment = _a.assignment, shouldGetUrkundStatus = _a.shouldGetUrkundStatus, taskId = _a.taskId;\r\n    var _b = tslib_1.__read(useState(assignment), 2), assignmentsWithStatus = _b[0], setAssignmentStatus = _b[1];\r\n    var _c = useContext(StateContext), school = _c.school, selectedCourse = _c.selectedCourse;\r\n    function refreshAssignment(assignment) {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var client, user, filename, req, _a, _b, resJson, e_1;\r\n            return tslib_1.__generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        client = env.kedBackendClient.http;\r\n                        user = assignment.user, filename = assignment.filename;\r\n                        return [4 /*yield*/, setAssignmentStatus(tslib_1.__assign({}, assignment, { isRefreshing: true }))];\r\n                    case 1:\r\n                        _c.sent();\r\n                        _c.label = 2;\r\n                    case 2:\r\n                        _c.trys.push([2, 8, , 10]);\r\n                        return [4 /*yield*/, client.get(\"assignments/urkund/\" + school + \"/\" + selectedCourse.id + \"/\" + taskId + \"/\" + user + \"/\" + filename)];\r\n                    case 3:\r\n                        req = _c.sent();\r\n                        if (!(req.status >= 400)) return [3 /*break*/, 5];\r\n                        _a = HttpError.bind;\r\n                        _b = [void 0, req.status];\r\n                        return [4 /*yield*/, req.text()];\r\n                    case 4: throw new (_a.apply(HttpError, _b.concat([_c.sent()])))();\r\n                    case 5: return [4 /*yield*/, req.text()];\r\n                    case 6:\r\n                        resJson = _c.sent();\r\n                        return [4 /*yield*/, setAssignmentStatus(tslib_1.__assign({}, assignment, { isRefreshing: false, metadata: tslib_1.__assign({}, assignment.metadata, { urkundResponse: resJson }) }))];\r\n                    case 7:\r\n                        _c.sent();\r\n                        return [3 /*break*/, 10];\r\n                    case 8:\r\n                        e_1 = _c.sent();\r\n                        return [4 /*yield*/, setAssignmentStatus(tslib_1.__assign({}, assignment, { isRefreshing: false, refreshError: e_1 }))];\r\n                    case 9:\r\n                        _c.sent();\r\n                        return [3 /*break*/, 10];\r\n                    case 10: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    }\r\n    useEffect(function () {\r\n        if (shouldGetUrkundStatus) {\r\n            setAssignmentStatus(tslib_1.__assign({}, assignment, { isRefreshing: true }));\r\n            refreshAssignment(assignment);\r\n        }\r\n    }, [shouldGetUrkundStatus, assignment]);\r\n    return React.createElement(\"tr\", { key: assignmentsWithStatus.mediaLink, style: assignmentsWithStatus.metadata.$meta ? { opacity: 0.5 } : {} },\r\n        React.createElement(\"td\", null,\r\n            React.createElement(\"a\", { href: \"mailto:\" + assignmentsWithStatus.user }, assignmentsWithStatus.metadata.userDisplayName || assignmentsWithStatus.user)),\r\n        React.createElement(\"td\", null, assignmentsWithStatus.metadata.driveFileId ?\r\n            // The file can be edited on drive. Link to editing it.\r\n            React.createElement(DriveFileListing, { file: assignmentsWithStatus }) :\r\n            React.createElement(\"a\", { href: \"#\", onClick: function (ev) {\r\n                    ev.preventDefault();\r\n                    ev.stopPropagation();\r\n                    downloadFile(assignmentsWithStatus);\r\n                } }, maxLength(assignmentsWithStatus.filename, 32))),\r\n        React.createElement(\"td\", { className: \"assignment-date-col\" }, moment(assignmentsWithStatus.uploadDate).format('YYYY-MM-DD HH:mm')),\r\n        getUrkundStatus(assignmentsWithStatus, refreshAssignment, shouldGetUrkundStatus));\r\n});\r\n","import React, { useContext } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { LanguageContext } from '../../utility-components/LanguageContext';\r\nimport { preserveImpersonationQuery } from '../../../access-control';\r\nimport { NotificationIcon } from '../shared/notification-icon';\r\nimport { StateContext } from '../digest-view';\r\nimport { env } from '../../../globals/KED.env';\r\nexport var CoursesView = (function (_a) {\r\n    var courseBuilderUrl = _a.courseBuilderUrl;\r\n    var intl = useContext(LanguageContext).intl;\r\n    var _b = useContext(StateContext), notificationdigests = _b.notificationdigests, teacherCourses = _b.teacherCourses, selectedCourse = _b.selectedCourse;\r\n    return React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\r\n        React.createElement(\"div\", { className: \"ked_boxed\" },\r\n            React.createElement(\"h3\", null, intl.formatMessage({ id: \"teacherView.coursesViewTitle\", defaultMessage: \"Mina kurser/ uppgifter\" })),\r\n            React.createElement(\"div\", { className: \"taskContainer odd-even\" }, teacherCourses.map(function (course) {\r\n                return React.createElement(\"div\", { key: course.id + course.code, className: \"align-horizontal\" },\r\n                    React.createElement(\"div\", { className: \"teacherSchoolCourse\" },\r\n                        React.createElement(\"div\", { className: \"horizontalItem top pull-right\" },\r\n                            React.createElement(\"a\", { target: \"_blank\", href: preserveImpersonationQuery(courseBuilderUrl, {}) + \"#/courses/\" + course.id + \"/edit\", className: \"editItem\" })),\r\n                        React.createElement(\"div\", { className: \"horizontalItem top\" },\r\n                            React.createElement(\"div\", { className: \"notification-container\" },\r\n                                React.createElement(Link, { key: \"linkCourse_\" + course.id, className: selectedCourse && selectedCourse.id === course.id ? \"selected\" : \"\", to: \"/overview/course/\" + course.id + \"/assignments\" },\r\n                                    course.name,\r\n                                    \" - \",\r\n                                    course.description),\r\n                                React.createElement(NotificationIcon, { key: \"notifictiona_\" + course.id, notificationdigests: notificationdigests, entity: 'course', course: course })))));\r\n            }))),\r\n        env.currentUser.roles.includes(\"ADMIN\") && React.createElement(Link, { to: \"/admin/emailtemplate\" }, \"Manage Email Template\"));\r\n});\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport { withRouter } from \"react-router\";\r\nimport { TwoColumnsPage } from '../course-builder-ks/common/two-columns-page';\r\nimport { AssignmentsView } from './assignments-view';\r\nimport { CoursesView } from './courses-view';\r\nimport { db } from '../../globals/db';\r\nimport { env } from '../../globals/KED.env';\r\nimport { HttpError, simpleDigestSuspense } from 'kedbackend/client';\r\nimport { createContext } from 'react';\r\nimport { compareProps } from '../../utils/utils';\r\nimport { Emitter } from 'kedbackend/observable';\r\nvar contextInitialValue = { notificationdigests: {}, selectedCourse: null, teacherCourses: [], seenDigestsObservable: new Emitter([]), school: \"\", tasks: [] };\r\nexport var StateContext = createContext(contextInitialValue);\r\nexport var DigestView = withRouter((function (_a) {\r\n    var _b;\r\n    var match = _a.match, courseBuilderUrl = _a.courseBuilderUrl;\r\n    var courseId = match ? match.params.courseId : null;\r\n    var courseId = courseId ? courseId : null;\r\n    var myCourses = [];\r\n    var school = db.schools.tags(\"gymnasium\").name(env.currentUser.school).include(\"courses\").single().read();\r\n    var schoolCourses = school ? school.courses : [];\r\n    if (schoolCourses) {\r\n        var me_1 = env.currentUser.mail;\r\n        schoolCourses.forEach(function (course) {\r\n            if (course.modules.length > 0) {\r\n                if (course.activatedBy && course.activatedBy.url == me_1) {\r\n                    myCourses.push(course);\r\n                }\r\n                else if (course.responsibleTeachers.filter(function (t) { return t.url == me_1; }).length > 0) {\r\n                    myCourses.push(course);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    myCourses = myCourses.sort(compareProps([\"name\", \"dateTime\"]));\r\n    var tasks = myCourses ? db.tasks.hasEdgesFrom(myCourses.map(function (c) { return c.id; })).toValue().read() : [];\r\n    var taskAssignments = tasks.filter(function (task) { return task.assignment === true; });\r\n    var schoolName = school.name;\r\n    var courseIds = myCourses.map(function (e) { return e.id; }).join(',');\r\n    var selectedCourse = myCourses.find(function (c) { return c.id === courseId; });\r\n    var res = env.kedBackendClient.http.suspenseGet(\"assignments/notificationdigests\", { school: schoolName, courseIds: courseIds });\r\n    if (res.status !== 200) {\r\n        throw new HttpError(res.status, res.text());\r\n    }\r\n    var assignments = res.json();\r\n    var digestArray = simpleDigestSuspense(myCourses.map(function (course) { return env.currentUser.mail + course.id; }));\r\n    var seenDigestsObservable = digestArray.length > 0 ?\r\n        (_b = db.seenStudentAssignments).tags.apply(_b, tslib_1.__spread(digestArray)).toValue() :\r\n        new Emitter([]);\r\n    var contextValue = {\r\n        notificationdigests: assignments,\r\n        selectedCourse: selectedCourse,\r\n        teacherCourses: myCourses,\r\n        seenDigestsObservable: seenDigestsObservable,\r\n        school: schoolName,\r\n        tasks: taskAssignments\r\n    };\r\n    return React.createElement(StateContext.Provider, { value: contextValue },\r\n        React.createElement(TwoColumnsPage, { left: React.createElement(AssignmentsView, { key: selectedCourse ? selectedCourse.id : \"\" }), right: React.createElement(CoursesView, { courseBuilderUrl: courseBuilderUrl }), rightWidth: 5 }));\r\n}));\r\n","import * as tslib_1 from \"tslib\";\r\nimport React, { useState } from 'react';\r\nimport { withRouter } from 'react-router';\r\nimport { Wysiwyg } from '../../utility-components/wysiwyg';\r\nimport { getCurrentUser } from '../../../globals/current-user';\r\nimport { db } from '../../../globals/db';\r\nimport { createUUID } from 'kedbackend/client';\r\nimport { showError, showInfo } from '../../../utils/utils';\r\nexport var EmailTemplates = withRouter((function (_a) {\r\n    var match = _a.match;\r\n    var currentUser = getCurrentUser();\r\n    var writeAccess = currentUser.roles.includes(\"ADMIN\");\r\n    var emailParams = [\"[FirstName]\", \"[LastName]\", \"[CourseName]\", \"[ModuleName]\", \"[TaskName]\", \"[TaskDeadline]\", \"[TeacherName]\"];\r\n    var emailTemplate = db.emailTemplates.tags(\"email-type: assignment-reminder\").single({ onZero: function () { } }).read();\r\n    var _b = tslib_1.__read(useState(emailTemplate ? { content: emailTemplate.content, subject: emailTemplate.subject } : { content: \"\", subject: \"\" }), 2), emaiTemplateContent = _b[0], setEmailContent = _b[1];\r\n    function saveTemplate() {\r\n        var regexContentResult = emaiTemplateContent.content.match(/\\[(.*?)\\]/gm);\r\n        var regexSubjectResult = emaiTemplateContent.subject.match(/\\[(.*?)\\]/gm);\r\n        var checkContentUsedParamsOk = true;\r\n        var checkSubjectUsedParamsOk = true;\r\n        checkContentUsedParamsOk = regexContentResult != null && regexContentResult.every(function (item) {\r\n            return emailParams.indexOf(item) !== -1;\r\n        });\r\n        checkSubjectUsedParamsOk = regexSubjectResult != null && regexSubjectResult.every(function (item) {\r\n            return emailParams.indexOf(item) !== -1;\r\n        });\r\n        if (checkContentUsedParamsOk && checkSubjectUsedParamsOk) {\r\n            try {\r\n                emailTemplate ?\r\n                    db.emailTemplates.update(emailTemplate, { content: emaiTemplateContent.content, subject: emaiTemplateContent.subject })\r\n                    :\r\n                        db.emailTemplates.add({\r\n                            id: createUUID(),\r\n                            tags: [\"email-type: assignment-reminder\"],\r\n                            content: emaiTemplateContent.content,\r\n                            subject: emaiTemplateContent.subject\r\n                        });\r\n                showInfo(\"Template successfully saved\");\r\n            }\r\n            catch (err) {\r\n                showError(err);\r\n            }\r\n        }\r\n        else {\r\n            showError(\"Invalid parameters were used in template. Please use only the specified ones and try again.\");\r\n        }\r\n    }\r\n    return React.createElement(\"div\", { className: \"sv-html-portlet sv-portlet sv-skip-spacer\" },\r\n        React.createElement(\"div\", { className: \"ked_boxed\" },\r\n            React.createElement(\"h4\", null, \"Email reminder template\"),\r\n            React.createElement(\"p\", { className: \"subHeader\" }, \"(Compose the email template. Possible parameters are: \" + emailParams.join(\",\") + \")\"),\r\n            React.createElement(\"input\", { placeholder: \"Subject\", value: emaiTemplateContent.subject, className: \"inputTextBox inputTextSmall\", onChange: function (ev) { return setEmailContent(tslib_1.__assign({}, emaiTemplateContent, { subject: ev.target.value })); } }),\r\n            React.createElement(Wysiwyg, { actions: [\r\n                    \"bold\",\r\n                    \"italic\",\r\n                    \"underline\",\r\n                    \"strikethrough\",\r\n                    \"heading2\",\r\n                    \"heading3\",\r\n                    \"olist\",\r\n                    \"ulist\",\r\n                    \"outdent\",\r\n                    \"indent\",\r\n                    \"line\",\r\n                    \"link\",\r\n                    \"image\"\r\n                ], readOnly: !writeAccess, html: emaiTemplateContent.content, onChange: function (html) { return setEmailContent(tslib_1.__assign({}, emaiTemplateContent, { content: html })); } }),\r\n            React.createElement(\"button\", { className: \"btn\", onClick: function () { saveTemplate(); } }, \"Submit\")));\r\n}));\r\n","import React from 'react';\r\nimport { HashRouter as Router, Route, Redirect } from 'react-router-dom';\r\nimport { Observe } from '../utility-components/observe';\r\nimport { EllipsisLoader } from '../course-builder/sub-components/ellipsis-loader';\r\nimport { DigestView } from './digest-view';\r\nimport { EmailTemplates } from './email-templates';\r\nimport { ErrorSuccessFeedback } from '../../utils/error-success-feedback';\r\nexport var TeacherViewApp = function (_a) {\r\n    var courseBuilderUrl = _a.courseBuilderUrl;\r\n    return React.createElement(Router, null,\r\n        React.createElement(\"div\", { className: \"teacher-view\" },\r\n            React.createElement(Route, { path: \"/\", exact: true, render: function () { return React.createElement(Redirect, { to: \"/overview\" }); } }),\r\n            React.createElement(Route, { path: \"/overview/(course)?/:courseId?/(assignments)?\", render: function () {\r\n                    return React.createElement(Observe, { fallback: React.createElement(EllipsisLoader, null) },\r\n                        React.createElement(DigestView, { courseBuilderUrl: courseBuilderUrl }));\r\n                } }),\r\n            React.createElement(Route, { exact: true, path: \"/admin/emailtemplate\", render: function () {\r\n                    return React.createElement(Observe, { fallback: React.createElement(EllipsisLoader, null) },\r\n                        React.createElement(EmailTemplates, null));\r\n                } }),\r\n            React.createElement(ErrorSuccessFeedback, null)));\r\n};\r\n","import React from 'react';\r\nimport { StateContext } from '../digest-view';\r\nimport { LazyContent } from '../../utility-components/lazy-content';\r\nexport var NotificationIcon = (function (_a) {\r\n    var course = _a.course, entity = _a.entity, moduleId = _a.moduleId, taskId = _a.taskId, notificationdigests = _a.notificationdigests;\r\n    var seenDigestsObserable = React.useContext(StateContext).seenDigestsObservable;\r\n    return React.createElement(LazyContent, null, seenDigestsObserable.map(function (seenDigests) {\r\n        var notifications = 0;\r\n        var courseNotifications = notificationdigests[course.id];\r\n        if (courseNotifications) {\r\n            if (entity === 'course') {\r\n                course.modules.forEach(function (cmod) {\r\n                    cmod.taskIds.forEach(function (courseTask) {\r\n                        notifications += getTaskNotifications(courseNotifications[courseTask]);\r\n                    });\r\n                });\r\n            }\r\n            else if (entity === 'module') {\r\n                var currentModule = course.modules.find(function (m) { return m.id == moduleId; });\r\n                currentModule && currentModule.taskIds.forEach(function (courseTask) {\r\n                    notifications += getTaskNotifications(courseNotifications[courseTask]);\r\n                });\r\n            }\r\n            else if (entity === 'task') {\r\n                notifications += getTaskNotifications(courseNotifications[taskId]);\r\n            }\r\n        }\r\n        function getTaskNotifications(taskAssignments) {\r\n            if (taskAssignments) {\r\n                return taskAssignments.filter(function (t) { return !seenDigests.find(function (d) { return d.digest === t.digest; }); }).length;\r\n            }\r\n            return 0;\r\n        }\r\n        return notifications > 0 && React.createElement(\"div\", { className: \"notification-icon\" }, notifications);\r\n    }));\r\n});\r\n","import * as React from 'react';\r\nexport var LanguageContext = React.createContext({ intl: null });\r\n","import * as tslib_1 from \"tslib\";\r\nimport { IntlProvider, addLocaleData } from 'react-intl';\r\nimport locale_en from 'react-intl/locale-data/en';\r\nimport locale_sv from 'react-intl/locale-data/sv';\r\nimport messages_sv from \"../../translations/sv.json\";\r\nimport messages_en from \"../../translations/en.json\";\r\nimport * as React from 'react';\r\nimport cfg from '../../globals/KED.cfg';\r\nimport moment from 'moment';\r\nexport var setupIntl = function (Component) {\r\n    return /** @class */ (function (_super) {\r\n        tslib_1.__extends(_SetupLanguageIntl, _super);\r\n        function _SetupLanguageIntl(props) {\r\n            var _this = _super.call(this, props) || this;\r\n            addLocaleData(tslib_1.__spread(locale_en, locale_sv));\r\n            _this.messages = {\r\n                'sv': messages_sv,\r\n                'en': messages_en\r\n            };\r\n            moment().locale(cfg.KED_LOCALE);\r\n            return _this;\r\n        }\r\n        _SetupLanguageIntl.prototype.render = function () {\r\n            return React.createElement(IntlProvider, { locale: cfg.KED_LOCALE, messages: this.messages[cfg.KED_LOCALE] },\r\n                React.createElement(Component, tslib_1.__assign({}, this.props)));\r\n        };\r\n        return _SetupLanguageIntl;\r\n    }(React.Component));\r\n};\r\n","import * as React from 'react';\r\nimport { LiveQueryView } from './live-query-view';\r\nexport function LazyContent(_a) {\r\n    var children = _a.children, spinner = _a.spinner, onError = _a.onError, noError = _a.noError;\r\n    return React.createElement(LiveQueryView, { props: children, spinner: spinner, noError: noError, onError: onError, fn: function (observable) { return observable; } });\r\n}\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport { shallowEquals } from '../../utils/utils';\r\nexport function liveQueryView(fn, options) {\r\n    return function (props) {\r\n        return React.createElement(LiveQueryView, tslib_1.__assign({ props: props, fn: fn }, options));\r\n    };\r\n}\r\nvar LiveQueryView = /** @class */ (function (_super) {\r\n    tslib_1.__extends(LiveQueryView, _super);\r\n    function LiveQueryView(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.state = {\r\n            result: null,\r\n            isLoading: true\r\n        };\r\n        return _this;\r\n    }\r\n    LiveQueryView.prototype.componentDidMount = function () {\r\n        this.subscribe();\r\n    };\r\n    LiveQueryView.prototype.componentWillUnmount = function () {\r\n        this.unsubscribe();\r\n    };\r\n    LiveQueryView.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n        return (this.state.error !== nextState.error ||\r\n            this.state.isLoading !== nextState.isLoading ||\r\n            this.state.result !== nextState.result ||\r\n            !shallowEquals(nextProps.props, this.props.props));\r\n    };\r\n    LiveQueryView.prototype.componentDidUpdate = function (prevProps) {\r\n        if (!shallowEquals(prevProps.props, this.props.props)) {\r\n            this.unsubscribe();\r\n            this.subscribe();\r\n        }\r\n    };\r\n    LiveQueryView.prototype.subscribe = function () {\r\n        var _this = this;\r\n        this.setState({ isLoading: true });\r\n        this.subscription = this.props.fn(this.props.props).subscribe(function (result, error) { return _this.setState({\r\n            result: result,\r\n            error: error,\r\n            isLoading: false\r\n        }); });\r\n    };\r\n    LiveQueryView.prototype.unsubscribe = function () {\r\n        if (this.subscription) {\r\n            this.subscription.unsubscribe();\r\n            this.subscription = null;\r\n        }\r\n    };\r\n    LiveQueryView.prototype.render = function () {\r\n        var _a = this.state, result = _a.result, error = _a.error, isLoading = _a.isLoading;\r\n        var _b = this.props, spinner = _b.spinner, onError = _b.onError, noError = _b.noError;\r\n        //if (!isLoading && !result) debugger;\r\n        return error ?\r\n            noError ? \"\" : onError ? onError(error) : React.createElement(\"p\", null,\r\n                \"Error: \",\r\n                error.message) :\r\n            isLoading ?\r\n                spinner ? spinner : \"\" :\r\n                result === undefined ? \"\" : result;\r\n    };\r\n    return LiveQueryView;\r\n}(React.Component));\r\nexport { LiveQueryView };\r\n","import * as tslib_1 from \"tslib\";\r\nimport { FiberContext } from \"kedbackend/observable\";\r\nimport React, { Suspense } from 'react';\r\nimport { L } from '../../utils/utils';\r\nvar FiberContextReact = React.createContext(null);\r\nvar ReactSharedInternals = Object.keys(React).filter(function (key) { return key.includes(\"_INTERNALS\"); }).map(function (k) { return React[k]; })[0];\r\nvar ReactCurrentDispatcher = ReactSharedInternals.ReactCurrentDispatcher;\r\nFiberContext.addProvider(function () {\r\n    // Here we actuall do useContext(FiberContext) but without logging to internal debug logs\r\n    // Normally, react hooks are sensitive in which order they are called (useState(), etc)\r\n    // but useContext() is not sensitive about that at all.\r\n    // Still, the debug version of react will log calls to useHook() and throw if a render\r\n    // doesn't use the same number of hooks every time. This check should not apply\r\n    // to useHook() since it is not sensitive to the order in which it was called.\r\n    // And we need to be able to call it from within contitional expressions / statements,\r\n    // so we must bypass this debug logging here by accessing readContext() directly.\r\n    return ReactCurrentDispatcher.current && ReactCurrentDispatcher.current.readContext(FiberContextReact);\r\n});\r\nvar Observe = /** @class */ (function (_super) {\r\n    tslib_1.__extends(Observe, _super);\r\n    function Observe(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.subscriptions = [];\r\n        _this.outerSubscription = {\r\n            unsubscribe: function () {\r\n                _this.subscriptions.forEach(function (s) { return s.unsubscribe(); });\r\n                _this.subscriptions = [];\r\n            }\r\n        };\r\n        _this.observer = function (value, error, subscription) {\r\n            if (error) {\r\n                _this.setState({ error: error });\r\n            }\r\n            else {\r\n                _this.setState(function (_a) {\r\n                    var counter = _a.counter;\r\n                    return ({ counter: counter + 1, error: error });\r\n                });\r\n            }\r\n        };\r\n        _this.state = {\r\n            counter: 0,\r\n            error: null\r\n        };\r\n        return _this;\r\n    }\r\n    Observe.prototype.componentDidCatch = function (error, info) {\r\n        if (!error || !error.name)\r\n            error = new Error('' + error);\r\n        this.setState({ error: error, info: info });\r\n        console.log(error, info);\r\n    };\r\n    Observe.prototype.componentWillMount = function () {\r\n        this.outerSubscription.unsubscribe();\r\n    };\r\n    Observe.prototype.render = function () {\r\n        if (this.state.error) {\r\n            return this.props.errorFallback || React.createElement(\"p\", null, L(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject([\"Kunde inte ladda inneh\\u00E5llet\"], [\"Kunde inte ladda inneh\\u00E5llet\"]))));\r\n        }\r\n        this.outerSubscription.unsubscribe();\r\n        return React.createElement(Suspense, { fallback: this.props.fallback || null },\r\n            React.createElement(FiberContextReact.Provider, { value: this }, this.props.children));\r\n    };\r\n    return Observe;\r\n}(React.Component));\r\nexport { Observe };\r\nvar templateObject_1;\r\n","/* REFACTOR: Move this component outside coursebuilder!\r\n   This is a general-purpose component\r\n*/\r\nimport * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport { GoalProgress } from '../charts/goal-progress';\r\nvar OpenCloseBox = /** @class */ (function (_super) {\r\n    tslib_1.__extends(OpenCloseBox, _super);\r\n    function OpenCloseBox(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.state = {\r\n            headerOpen: props.headerOpen || false\r\n        };\r\n        return _this;\r\n    }\r\n    OpenCloseBox.prototype.componentWillReceiveProps = function (nextProps) {\r\n        if (nextProps.headerOpen !== this.props.headerOpen) {\r\n            this.setState({ headerOpen: nextProps.headerOpen });\r\n        }\r\n    };\r\n    OpenCloseBox.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.props, title = _a.title, className = _a.className, children = _a.children, headerClassName = _a.headerClassName, contentClassName = _a.contentClassName, displayProgress = _a.displayProgress, progressData = _a.progressData, inactivated = _a.inactivated, inactivatedRender = _a.inactivatedRender;\r\n        var headerOpen = this.state.headerOpen;\r\n        if (inactivated)\r\n            return inactivatedRender === 'titleAndChildren' ? React.createElement(React.Fragment, null,\r\n                React.createElement(React.Fragment, null, title),\r\n                React.createElement(React.Fragment, null, children)) : React.createElement(React.Fragment, null, children);\r\n        //var currentProgressData = //progressData();\r\n        return React.createElement(\"div\", { className: (className || '') + \" openClose\" + (headerOpen ? \" open\" : \"\") },\r\n            React.createElement(\"div\", { className: \"openHeader\" + (headerClassName ? \" \" + headerClassName : \"\"), onClick: function () {\r\n                    if (_this.props.onOpenClose)\r\n                        _this.props.onOpenClose(!_this.state.headerOpen);\r\n                    _this.setState({ headerOpen: !_this.state.headerOpen });\r\n                } },\r\n                React.createElement(\"div\", { className: \"openHeaderContainer\" },\r\n                    React.createElement(\"div\", null, title),\r\n                    displayProgress && React.createElement(GoalProgress, tslib_1.__assign({}, progressData)))),\r\n            React.createElement(\"div\", { className: \"openContent\" + (contentClassName ? \" \" + contentClassName : \"\") }, children));\r\n    };\r\n    return OpenCloseBox;\r\n}(React.Component));\r\nexport { OpenCloseBox };\r\n","import exec from './exec';\r\nexport default {\r\n    bold: {\r\n        icon: '<b>B</b>',\r\n        title: 'Bold',\r\n        result: function () { return exec('bold'); }\r\n    },\r\n    italic: {\r\n        icon: '<i>I</i>',\r\n        title: 'Italic',\r\n        result: function () { return exec('italic'); }\r\n    },\r\n    underline: {\r\n        icon: '<u>U</u>',\r\n        title: 'Underline',\r\n        result: function () { return exec('underline'); }\r\n    },\r\n    strikethrough: {\r\n        icon: '<strike>S</strike>',\r\n        title: 'Strike-through',\r\n        result: function () { return exec('strikeThrough'); }\r\n    },\r\n    heading1: {\r\n        icon: '<b>H<sub>1</sub></b>',\r\n        title: 'Heading 1',\r\n        result: function () { return exec('formatBlock', '<H1>'); }\r\n    },\r\n    heading2: {\r\n        icon: '<b>H<sub>2</sub></b>',\r\n        title: 'Heading 2',\r\n        result: function () { return exec('formatBlock', '<H2>'); }\r\n    },\r\n    heading3: {\r\n        icon: '<b>H<sub>3</sub></b>',\r\n        title: 'Heading 3',\r\n        result: function () { return exec('formatBlock', '<H3>'); }\r\n    },\r\n    paragraph: {\r\n        icon: '&#182;',\r\n        title: 'Paragraph',\r\n        result: function () { return exec('formatBlock', '<P>'); }\r\n    },\r\n    quote: {\r\n        icon: '&#8220; &#8221;',\r\n        title: 'Quote',\r\n        result: function () { return exec('formatBlock', '<BLOCKQUOTE>'); }\r\n    },\r\n    olist: {\r\n        icon: '&#35;',\r\n        title: 'Ordered List',\r\n        result: function () { return exec('insertOrderedList'); }\r\n    },\r\n    ulist: {\r\n        icon: '&#8226;',\r\n        title: 'Unordered List',\r\n        result: function () { return exec('insertUnorderedList'); }\r\n    },\r\n    outdent: {\r\n        icon: '<i class=\"fa fa-outdent\" aria-hidden=\"true\"></i>',\r\n        title: 'Outdent',\r\n        result: function () { return exec(\"outdent\"); }\r\n    },\r\n    indent: {\r\n        icon: '<i class=\"fa fa-indent\" aria-hidden=\"true\"></i>',\r\n        title: 'Indent',\r\n        result: function () { return exec(\"indent\"); },\r\n    },\r\n    code: {\r\n        icon: '&lt;/&gt;',\r\n        title: 'Code',\r\n        result: function () { return exec('formatBlock', '<PRE>'); }\r\n    },\r\n    line: {\r\n        icon: '&#8213;',\r\n        title: 'Horizontal Line',\r\n        result: function () { return exec('insertHorizontalRule'); }\r\n    },\r\n    link: {\r\n        icon: '&#128279;',\r\n        title: 'Link',\r\n        result: function () {\r\n            var url = window.prompt('Enter the link URL');\r\n            if (url) {\r\n                var selected = document.getSelection();\r\n                var elem = document.createElement('a');\r\n                elem.href = url;\r\n                elem.target = \"_blank\";\r\n                elem.appendChild(document.createTextNode(selected.toString()));\r\n                exec('insertHTML', elem.outerHTML);\r\n            }\r\n        }\r\n    },\r\n    image: {\r\n        icon: '&#128247;',\r\n        title: 'Image',\r\n        promptMsg: 'Enter the URL of the image',\r\n        result: function () {\r\n            var url = window.prompt(this.promptMsg);\r\n            if (url)\r\n                exec('insertImage', url);\r\n        }\r\n    }\r\n};\r\n","export default (function (command, value) {\r\n    if (value === void 0) { value = null; }\r\n    document.execCommand(command, false, value);\r\n});\r\n","export function patchElement(element) {\r\n    var modified = false;\r\n    if (element.tagName === \"A\") {\r\n        var href = element.getAttribute(\"href\");\r\n        var target = element.getAttribute(\"target\");\r\n        if (href) {\r\n            if (href.startsWith(\"javascript:\")) {\r\n                // Fix \"javascript:window.open('...')\" URLS\r\n                var url = href;\r\n                var windowOpen = \"window.open('\";\r\n                var pWindowOpen = url.indexOf(windowOpen);\r\n                if (pWindowOpen >= 0) {\r\n                    var urlEnd = url.substr(pWindowOpen + windowOpen.length);\r\n                    var pUrlEnd = urlEnd.indexOf(\"'\");\r\n                    if (pUrlEnd >= 0) {\r\n                        var newUrl = urlEnd.substr(0, pUrlEnd);\r\n                        element.setAttribute(\"href\", newUrl);\r\n                        element.setAttribute(\"target\", \"_blank\"); // The reason they use JS links is for opening in new tab\r\n                        modified = true;\r\n                    }\r\n                }\r\n            }\r\n            else if (href.startsWith(\"https://\") || href.startsWith(\"http://\")) {\r\n                try {\r\n                    var url = new URL(href);\r\n                    // Fix digilr URLs:\r\n                    if (url.host === \"xn--digilr-fua.se\") {\r\n                        if (url.search[0] === '?') {\r\n                            var pSecondQ = url.search.indexOf('?', 1);\r\n                            if (pSecondQ > 0) {\r\n                                url.search = url.search.substr(0, pSecondQ) + \"&\" + url.search.substr(pSecondQ + 1);\r\n                                element.setAttribute(\"href\", url.href);\r\n                                modified = true;\r\n                            }\r\n                        }\r\n                    }\r\n                    // Fix so that external URLS are opened in separate tabs\r\n                    if (location.hostname !== 'localhost') {\r\n                        if (url.host !== location.host) {\r\n                            if (!element.getAttribute(\"target\")) {\r\n                                element.setAttribute(\"target\", \"_blank\");\r\n                                modified = true;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                catch (error) {\r\n                    element.removeAttribute(\"a\");\r\n                    modified = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return modified;\r\n}\r\n","export default function imageEditActions(cb) {\r\n    return [{\r\n            name: 'float-left',\r\n            icon: \"<div style=\\\"position:relative\\\">\\n      <i class=\\\"fa fa-align-right\\\" aria-hidden=\\\"true\\\"></i>\\n      <div style=\\\"position:absolute; left:-4px;top:0; transform: scale(0.5); transform-origin: left top\\\">\\n        <i class=\\\"fa fa-picture-o\\\" aria-hidden=\\\"true\\\"></i>\\n      </div>\\n    </div>\",\r\n            title: 'Lt bilden flyta vnster om text',\r\n            result: function () { return cb('float-left'); }\r\n        }, {\r\n            name: 'float-right',\r\n            icon: \"<div style=\\\"position:relative\\\">\\n      <i class=\\\"fa fa-align-left\\\" aria-hidden=\\\"true\\\"></i>\\n      <div style=\\\"position:absolute; right:-4px;top:0; transform: scale(0.5); transform-origin: right top\\\">\\n        <i class=\\\"fa fa-picture-o\\\" aria-hidden=\\\"true\\\"></i>\\n      </div>\\n    </div>\",\r\n            title: 'Lt bilden flyta hger om text',\r\n            result: function () { return cb('float-right'); }\r\n        }, {\r\n            name: 'unfloat',\r\n            icon: \"<div style=\\\"position:relative;\\\" aria-hidden=\\\"true\\\">\\n      <div style=\\\"position:absolute;top:0;left:0\\\">&#8254;</div>\\n      <div style=\\\"position:absolute;top:0:left:0;transform: scale(0.5); transform-origin: left bottom\\\">\\n        <i class=\\\"fa fa-picture-o\\\" aria-hidden=\\\"true\\\"></i>\\n      </div>\\n      <div style=\\\"position:absolute;top:0;left:0\\\">_</div>\\n    </div>\",\r\n            title: 'Placera bilden p egen rad',\r\n            result: function () { return cb('unfloat'); }\r\n        }];\r\n}\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport exec from './exec';\r\nimport { washHtml } from './wash-html';\r\nimport imageEditActions from './image-edit-actions';\r\nimport actions from './actions';\r\nvar classes = {\r\n    actionbar: 'wysiwyg-actionbar',\r\n    button: 'wysiwyg-button',\r\n    content: 'wysiwyg-content',\r\n    focusrect: 'wysiwyg-focusrect',\r\n    focuspoint: 'wysiwyg-focuspoint',\r\n    readonlyContent: 'wysiwyg-content readonly'\r\n};\r\nvar Wysiwyg = /** @class */ (function (_super) {\r\n    tslib_1.__extends(Wysiwyg, _super);\r\n    function Wysiwyg(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.state = { focusRect: null };\r\n        _this.onFocus = _this.onFocus.bind(_this);\r\n        _this.onBlur = _this.onBlur.bind(_this);\r\n        _this.onMouseDown = _this.onMouseDown.bind(_this);\r\n        _this.onMouseMove = _this.onMouseMove.bind(_this);\r\n        _this.onMouseUp = _this.onMouseUp.bind(_this);\r\n        return _this;\r\n    }\r\n    Wysiwyg.prototype.componentDidMount = function () {\r\n        var _this = this;\r\n        if (!this.props.readOnly) {\r\n            Array.from(this.contentDiv.querySelectorAll(\"img,a\")).map(function (elem) { return elem; })\r\n                .forEach(function (elem) {\r\n                elem.tabIndex = 1;\r\n                elem.onfocus = _this.onFocus;\r\n                elem.onblur = _this.onBlur;\r\n            });\r\n        }\r\n        if (this.props.reportNumChars) {\r\n            this.props.reportNumChars((this.contentDiv && this.contentDiv.innerText && this.contentDiv.innerText.length) || 0);\r\n        }\r\n    };\r\n    Wysiwyg.prototype.componentDidUpdate = function () {\r\n        var _this = this;\r\n        Array.from(this.contentDiv.querySelectorAll(\"img,a\")).map(function (elem) { return elem; })\r\n            .forEach(function (elem) {\r\n            elem.tabIndex = 1;\r\n            elem.onfocus = _this.onFocus;\r\n            elem.onblur = _this.onBlur;\r\n        });\r\n        if (this.props.reportNumChars) {\r\n            this.props.reportNumChars((this.contentDiv && this.contentDiv.innerText && this.contentDiv.innerText.length) || 0);\r\n        }\r\n    };\r\n    Wysiwyg.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n        //this.contentDiv.onfocus = this.onFocus;\r\n        //this.contentDiv.onblur = this.onBlur;\r\n        return !this.contentDiv ||\r\n            nextState != this.state ||\r\n            nextProps.readOnly !== this.props.readOnly ||\r\n            washHtml(nextProps.html) !== washHtml(this.contentDiv.innerHTML);\r\n    };\r\n    Wysiwyg.prototype.triggerOnChange = function (html) {\r\n        this.props.onChange && this.props.onChange(washHtml(html));\r\n    };\r\n    Wysiwyg.prototype.onFocus = function (ev) {\r\n        var elem = ev.target;\r\n        if (!elem || !elem.tagName)\r\n            return;\r\n        if (elem.tagName !== 'IMG' && elem.tagName !== 'A')\r\n            return;\r\n        var contentParent = this.contentDiv.parentElement;\r\n        var newState = {\r\n            focusRect: getRelatativeClientRect(contentParent, elem),\r\n        };\r\n        switch (elem.tagName) {\r\n            case 'A':\r\n            case 'IMG':\r\n            default: break;\r\n        }\r\n        this.setState(newState);\r\n        this.focusElem = elem;\r\n    };\r\n    Wysiwyg.prototype.onBlur = function (ev) {\r\n        /*if (ev.relatedTarget) {\r\n          const relatedTarget = ev.relatedTarget as HTMLElement;\r\n          if (relatedTarget.className && relatedTarget.className.split(' ').indexOf(classes.button) >= 0) {\r\n            // A image action button was pressed\r\n            set\r\n            return;\r\n          }\r\n        }*/\r\n        if ((ev.target === this.focusElem && ev.relatedTarget !== this.focusRectDiv) ||\r\n            ev.target === this.focusRectDiv) {\r\n            this.setState({ focusRect: null });\r\n        }\r\n    };\r\n    Wysiwyg.prototype.makeClickable = function (elem) {\r\n        elem.tabIndex = 1;\r\n    };\r\n    Wysiwyg.prototype.onMouseDown = function (ev) {\r\n        if ((ev.target.className || \"\").split(' ').indexOf(classes.focuspoint) >= 0) {\r\n            var corner = this.getRectCorner(ev);\r\n            this.corner = corner;\r\n            this.resizeStartX = ev.clientX;\r\n        }\r\n    };\r\n    Wysiwyg.prototype.onMouseMove = function (ev) {\r\n        if (this.corner && this.state.focusRect && this.focusElem) {\r\n            ev.preventDefault();\r\n            // TODO: Rkna ut baserat p this.corner hur bildens storlek borde ndras.\r\n            // Leta upp bilden per ID frn this.contentDiv\r\n            // Stt DIV:ens style attribut width till ny width.\r\n            // Om DIV:en redan hade height, stt ny height med samma aspect ratio som innan,\r\n            // annars, stt inte height alls (eller mjligtvis till auto))\r\n            var focusRect = this.focusRectDiv.getBoundingClientRect();\r\n            if (focusRect.width < 32)\r\n                return;\r\n            //const currentWidth = focusRect.width;\r\n            //const currentHeight = focusRect.height;\r\n            //const hasHeightStyle = !this.focusElem.style.height || this.focusElem.style.height === \"auto\";\r\n            var newWidth = Math.max(32, this.corner.endsWith('l') ?\r\n                focusRect.width + (this.resizeStartX - ev.clientX) :\r\n                //focusRect.right - ev.clientX :\r\n                focusRect.width - (this.resizeStartX - ev.clientX));\r\n            this.resizeStartX = ev.clientX;\r\n            //ev.clientX - focusRect.left;\r\n            var factor = newWidth / focusRect.width;\r\n            var newHeight = focusRect.height * factor;\r\n            this.focusElem.style.width = newWidth + \"px\";\r\n            this.focusElem.style.height = newHeight + \"px\";\r\n            this.setState({\r\n                focusRect: getRelatativeClientRect(this.contentDiv.parentElement, this.focusElem),\r\n            });\r\n        }\r\n    };\r\n    Wysiwyg.prototype.onMouseUp = function (ev) {\r\n        if (this.corner && this.state.focusRect && this.focusElem) {\r\n            this.corner = null;\r\n            this.triggerOnChange(this.contentDiv.innerHTML);\r\n        }\r\n    };\r\n    Wysiwyg.prototype.getRectCorner = function (ev) {\r\n        var e_1, _a;\r\n        try {\r\n            for (var _b = tslib_1.__values((ev.target.className || '').split(' ')), _c = _b.next(); !_c.done; _c = _b.next()) {\r\n                var className = _c.value;\r\n                switch (className) {\r\n                    case 'fpul':\r\n                        return 'ul';\r\n                    case 'fpur':\r\n                        return 'fpur';\r\n                    case 'fplr':\r\n                        return 'lr';\r\n                    case 'fpll':\r\n                        return 'll';\r\n                }\r\n            }\r\n        }\r\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n        finally {\r\n            try {\r\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\r\n            }\r\n            finally { if (e_1) throw e_1.error; }\r\n        }\r\n        return null;\r\n    };\r\n    Wysiwyg.prototype.execImageEditAction = function (cmd) {\r\n        //console.log(cmd);\r\n        if (!this.focusElem)\r\n            return;\r\n        //console.log(\"doing it\");\r\n        switch (cmd) {\r\n            case 'float-left':\r\n                this.focusElem.style.cssFloat = 'left';\r\n                break;\r\n            case 'float-right':\r\n                this.focusElem.style.cssFloat = 'right';\r\n                break;\r\n            case 'unfloat':\r\n                this.focusElem.style.cssFloat = '';\r\n                break;\r\n        }\r\n        this.triggerOnChange(this.contentDiv.innerHTML);\r\n        this.setState({ focusRect: getRelatativeClientRect(this.contentDiv.parentElement, this.focusElem) });\r\n    };\r\n    Wysiwyg.prototype.render = function () {\r\n        var _this = this;\r\n        var defaultActions = this.props.defaultActions || actions;\r\n        var actionsToUse = this.props.actions ? this.props.actions.map(function (action) {\r\n            return typeof action === 'string' ?\r\n                defaultActions[action] :\r\n                defaultActions[action.name] ? tslib_1.__assign({}, defaultActions[action.name], action) :\r\n                    action;\r\n        })\r\n            : Object.keys(defaultActions).map(function (action) { return defaultActions[action]; });\r\n        if (this.state.focusRect) {\r\n            actionsToUse = actionsToUse.concat(imageEditActions(function (cmd) { return _this.execImageEditAction(cmd); }));\r\n        }\r\n        var focusRect = this.state.focusRect;\r\n        var _a = this.props, readOnly = _a.readOnly, reportNumChars = _a.reportNumChars, maxChars = _a.maxChars;\r\n        return React.createElement(\"div\", { className: this.props.className },\r\n            !readOnly && React.createElement(\"div\", { className: classes.actionbar }, actionsToUse.map(function (action, idx) {\r\n                return React.createElement(\"button\", { key: idx, className: classes.button, dangerouslySetInnerHTML: { __html: action.icon }, title: action.title, onMouseDown: function (ev) { action.result(ev, _this); }, onMouseUp: function (ev) { return setTimeout(function () { return _this.contentDiv.focus(); }, 10); } });\r\n            })),\r\n            React.createElement(\"div\", { className: readOnly ? classes.readonlyContent : classes.content, style: { position: 'relative', top: 0, left: 0 }, onMouseMove: this.onMouseMove, onMouseDown: this.onMouseDown, onMouseUp: this.onMouseUp },\r\n                React.createElement(\"div\", { className: \"editor\", ref: function (div) { return _this.contentDiv = div; }, dangerouslySetInnerHTML: { __html: washHtml(this.props.html) }, contentEditable: !readOnly, onPaste: function (ev) {\r\n                        if (!isNaN(maxChars)) {\r\n                            var target = ev.target, currentTarget = ev.currentTarget;\r\n                            //const textBeingOverwritten = (target as any).innerText || \"\";\r\n                            var editorText = (currentTarget && currentTarget.innerText) || \"\";\r\n                            var textBeingPasted = ev.clipboardData.getData(\"text/plain\") || \"\";\r\n                            if (editorText.length + textBeingPasted.length > maxChars) {\r\n                                ev.preventDefault();\r\n                            }\r\n                        }\r\n                    }, onKeyUp: reportNumChars ? function (ev) {\r\n                        var innerText = ev.target.innerText;\r\n                        reportNumChars(innerText ? innerText.length : 0);\r\n                    } : null, onKeyPress: !isNaN(maxChars) ? function (ev) {\r\n                        var innerText = ev.target.innerText;\r\n                        if (innerText && innerText.length >= maxChars) {\r\n                            ev.preventDefault();\r\n                        }\r\n                    } : null, onInput: function (ev) { return _this.triggerOnChange(ev.target.innerHTML); }, onKeyDown: function (ev) {\r\n                        if (readOnly)\r\n                            return;\r\n                        if (reportNumChars && ev.currentTarget) {\r\n                            reportNumChars((ev.currentTarget.innerText || \"\").length);\r\n                        }\r\n                        //console.log(\"Key: \" + ev.which);\r\n                        if (ev.which >= 35 && ev.which <= 40) { // home/end/up/down/left/right\r\n                            ev.stopPropagation(); // Prevent entire page from scrolling??\r\n                        }\r\n                        if (ev.which === 9) {\r\n                            ev.preventDefault(); // TAB\r\n                            if (ev.shiftKey) {\r\n                                exec(\"outdent\");\r\n                            }\r\n                            else {\r\n                                exec(\"indent\");\r\n                            }\r\n                        }\r\n                        if ((ev.keyCode === 8 || ev.keyCode === 46) && // Delete or Back buttons\r\n                            _this.focusElem && _this.state.focusRect) {\r\n                            if (_this.focusElem && _this.focusElem.parentElement) {\r\n                                _this.focusElem.parentElement.removeChild(_this.focusElem); // Remove marked image\r\n                            }\r\n                            _this.focusElem = null;\r\n                            _this.setState({ focusRect: null });\r\n                            _this.triggerOnChange(_this.contentDiv.innerHTML);\r\n                        }\r\n                    } }),\r\n                focusRect && React.createElement(\"div\", { ref: function (div) { return _this.focusRectDiv = div; }, className: classes.focusrect, onBlur: this.onBlur, tabIndex: 1, style: {\r\n                        outline: 0,\r\n                        position: 'absolute',\r\n                        top: this.state.focusRect.top,\r\n                        left: this.state.focusRect.left,\r\n                        width: this.state.focusRect.width,\r\n                        height: this.state.focusRect.height\r\n                    } },\r\n                    React.createElement(\"div\", { className: classes.focuspoint + \" fpul\", style: { position: 'absolute', top: 0, left: 0 } }),\r\n                    React.createElement(\"div\", { className: classes.focuspoint + \" fpur\", style: { position: 'absolute', top: 0, right: 0 } }),\r\n                    React.createElement(\"div\", { className: classes.focuspoint + \" fplr\", style: { position: 'absolute', bottom: 0, right: 0 } }),\r\n                    React.createElement(\"div\", { className: classes.focuspoint + \" fpll\", style: { position: 'absolute', bottom: 0, left: 0 } }))));\r\n    };\r\n    return Wysiwyg;\r\n}(React.Component));\r\nexport { Wysiwyg };\r\nfunction getRelatativeClientRect(parent, child) {\r\n    var parentRect = parent.getBoundingClientRect();\r\n    var childRect = child.getBoundingClientRect();\r\n    return {\r\n        top: childRect.top - parentRect.top + parent.scrollTop,\r\n        left: childRect.left - parentRect.left + parent.scrollLeft,\r\n        bottom: childRect.bottom - parentRect.top + parent.scrollTop,\r\n        right: childRect.right - parentRect.left + parent.scrollLeft,\r\n        width: childRect.width,\r\n        height: childRect.height\r\n    };\r\n}\r\n","import { patchElement } from './html-patch-policy';\r\nvar parser = new DOMParser();\r\n/** Tags / Attributes Whitelist\r\n *\r\n */\r\nvar HTML_WASH_POLICY = {\r\n    b: {},\r\n    i: {},\r\n    p: {},\r\n    u: {},\r\n    strike: {},\r\n    pre: {},\r\n    h1: {},\r\n    h2: {},\r\n    h3: {},\r\n    h4: {},\r\n    h5: {},\r\n    img: { src: true, class: true, style: true, tabindex: true },\r\n    a: { href: true, target: true, tabindex: true },\r\n    ul: {},\r\n    ol: {},\r\n    li: {},\r\n    hr: {},\r\n    br: {},\r\n    div: {},\r\n    span: {},\r\n    // table tags:\r\n    table: { border: true },\r\n    tbody: {},\r\n    thead: {},\r\n    tfoot: {},\r\n    tr: {},\r\n    td: { headers: true, colspan: true, rowspan: true },\r\n    th: { abbr: true, headers: true, scope: true, sorted: true, colspan: true, rowspan: true }\r\n};\r\nexport function washHtml(html) {\r\n    var doc = parser.parseFromString(html, \"text/html\");\r\n    var childNodes = doc.body.childNodes;\r\n    var modified = false;\r\n    for (var i = 0; i < childNodes.length; ++i) {\r\n        if (washNode(childNodes.item(i))) {\r\n            modified = true;\r\n        }\r\n    }\r\n    return modified ?\r\n        doc.body.innerHTML :\r\n        html; // By returning the original HTML string, we spare the user from refreshing the edit area,\r\n    // which would otherwise put the cursor at the top, losing the position where user where.\r\n}\r\nfunction washNode(node) {\r\n    var modified = false;\r\n    if (isElement(node)) {\r\n        if (washElement(node)) {\r\n            modified = true;\r\n        }\r\n    }\r\n    if (washChildNodes(node)) {\r\n        modified = true;\r\n    }\r\n    return modified;\r\n}\r\nfunction washChildNodes(node) {\r\n    var modified = false;\r\n    var childNodes = node.childNodes;\r\n    for (var i = 0; i < childNodes.length; ++i) {\r\n        if (washNode(childNodes.item(i))) {\r\n            modified = true;\r\n        }\r\n    }\r\n    return modified;\r\n}\r\n/** Replace an element with its child nodes.\r\n *\r\n */\r\nfunction removeMiddleElement(element) {\r\n    var childNodes = element.childNodes;\r\n    for (var i = 0; i < childNodes.length; ++i) {\r\n        element.parentNode.insertBefore(childNodes.item(i), element);\r\n    }\r\n    element.remove();\r\n}\r\nfunction washElement(element) {\r\n    var modified = patchElement(element);\r\n    var policy = element.tagName && HTML_WASH_POLICY[element.tagName.toLowerCase()];\r\n    if (!policy) {\r\n        console.warn(\"Wysiwyg: not allowed tag\", element.tagName);\r\n        washChildNodes(element);\r\n        removeMiddleElement(element);\r\n        return true;\r\n    }\r\n    for (var i = 0; i < element.attributes.length; ++i) {\r\n        var attr = element.attributes.item(i);\r\n        var allowed = attr.name && !!policy[attr.name.toLowerCase()];\r\n        if (!allowed) {\r\n            modified = true;\r\n            console.warn(\"Wysiwyg: not allowed attribute\", attr.name, \"Tag: \", element.tagName);\r\n            element.removeAttribute(attr.name);\r\n        }\r\n    }\r\n    return modified;\r\n}\r\nfunction isElement(node) {\r\n    return !!node.tagName;\r\n}\r\n","import * as tslib_1 from \"tslib\";\r\nimport '../../global-setters/set-all';\r\nimport env from '../../globals/KED.env';\r\nimport cfg from '../../globals/KED.cfg';\r\nvar bearerPromise = env.bearerProvider.getBearer(); // Start getting bearer as soon as possible.\r\nimport * as React from 'react';\r\nimport { TeacherViewApp } from '../../components/teacher-view';\r\nimport { showError } from '../../utils/utils';\r\nimport { Spinner } from '../../components/course-builder/sub-components/spinner';\r\nimport { LanguageContext } from '../../components/utility-components/LanguageContext';\r\nimport { injectIntl } from 'react-intl';\r\nimport { setupIntl } from '../../components/utility-components/SetupLanguageIntl';\r\nvar _KEDAppTeacherView = /** @class */ (function (_super) {\r\n    tslib_1.__extends(_KEDAppTeacherView, _super);\r\n    function _KEDAppTeacherView(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.state = {\r\n            isTokenLoaded: false\r\n        };\r\n        return _this;\r\n    }\r\n    _KEDAppTeacherView.prototype.componentWillMount = function () {\r\n        var _this = this;\r\n        bearerPromise.then(function () {\r\n            _this.setState({ isTokenLoaded: true });\r\n        }).catch(function (err) {\r\n            showError(err);\r\n        });\r\n    };\r\n    _KEDAppTeacherView.prototype.render = function () {\r\n        var intl = this.props.intl;\r\n        return this.state.isTokenLoaded ?\r\n            React.createElement(LanguageContext.Provider, { value: { intl: intl } },\r\n                React.createElement(TeacherViewApp, { courseBuilderUrl: cfg.KED_COURSE_BUILDER_URL })) :\r\n            React.createElement(\"p\", null,\r\n                React.createElement(Spinner, null),\r\n                \"V.g. v\\u00E4nta... autenticerar...\");\r\n    };\r\n    return _KEDAppTeacherView;\r\n}(React.Component));\r\nexport var KEDAppTeacherView = setupIntl(injectIntl(_KEDAppTeacherView));\r\n","import * as tslib_1 from \"tslib\";\r\nimport KED from '../../globals/KED';\r\nimport { KEDAppTeacherView } from './app.teacherview.client';\r\n// Add KEDAppTeacherView to the set of components in KED.components\r\nKED.components = tslib_1.__assign({}, KED.components, { KEDAppTeacherView: KEDAppTeacherView });\r\n","import cfg from '../globals/KED.cfg';\r\ncfg.ENVIRONMENT = process.env.ENVIRONMENT;\r\ncfg.KED_API_URL = process.env.KED_API_URL; // \"https://kedbackendtest.azurewebsites.net/api/\"\r\ncfg.EDS_API_URL = process.env.EDS_API_URL; // \"https://edsportalowinapi.azurewebsites.net/api/\"\r\ncfg.KED_TOKEN_URL = process.env.KED_TOKEN_URL; // \"https://kedauthtest.azurewebsites.net/token\"\r\ncfg.KED_CLIENT_ID = process.env.KED_CLIENT_ID; // \"devclient\", \"testclient\", \"...\"\r\ncfg.KED_CLIENT_SECRET = process.env.KED_CLIENT_SECRET;\r\ncfg.KED_REALM = process.env.KED_REALM; // \"SE1\"\r\ncfg.KED_LOCALE = cfg.KED_LOCALE || process.env.KED_LOCALE; // \"sv\", \"en\". Only set from process.env if not set from SiteVision element config.\r\ncfg.KED_SCHOOL_LOCALE = cfg.KED_SCHOOL_LOCALE || process.env.KED_SCHOOL_LOCALE; // \"sv\", \"en_sin\", \"en_nin\". Only set from process.env if not set from SiteVision element config.\r\ncfg.KED_RESOURCES_URL = cfg.KED_RESOURCES_URL || process.env.KED_RESOURCES_URL;\r\n","/* These scripts assume some of the global vars have already been set:\r\n  * KED.cfg\r\n  * KED.env.currentUser\r\n\r\n  The rest will be set here (client side)\r\n*/\r\nimport './configure';\r\nimport './set-bearer-providers';\r\nimport './set-ked-backend-client';\r\nimport './set-eds-client';\r\n","import * as tslib_1 from \"tslib\";\r\nimport { parseQueryString, generateQueryString, splitUrlAndQuery } from \"../utils/query-string\";\r\nimport { WebServerBearerProvider, isomorphic, storage } from 'kedbackend/clientweb';\r\nimport { KedBearerProvider } from 'kedbackend/client';\r\nimport cfg from '../globals/KED.cfg';\r\nimport env from '../globals/KED.env';\r\nimport { IMPERSONATION_QUERY_PARAMS } from \"../access-control/index\";\r\nimport { cherryPickProps } from \"../utils/utils\";\r\nvar employeeClassroomScopes = [\r\n    \"https://www.googleapis.com/auth/classroom.courses\",\r\n    \"https://www.googleapis.com/auth/classroom.profile.emails\",\r\n    \"https://www.googleapis.com/auth/classroom.rosters\",\r\n    \"https://www.googleapis.com/auth/classroom.coursework.students\"\r\n];\r\nvar studentClassroomScopes = [\r\n    \"https://www.googleapis.com/auth/classroom.courses\",\r\n    \"https://www.googleapis.com/auth/classroom.coursework.me\"\r\n];\r\nfunction getMergedTokenPath(tokenPath, locationSearch, scopes) {\r\n    // Merge configured query params of token path with params given to current page\r\n    var currentQuery = parseQueryString(locationSearch);\r\n    var impersonationProps = cherryPickProps(currentQuery, IMPERSONATION_QUERY_PARAMS);\r\n    var _a = tslib_1.__read(splitUrlAndQuery(tokenPath), 2), tokenPathWithoutQuery = _a[0], tokenQueryString = _a[1];\r\n    var tokenPathQuery = parseQueryString(tokenQueryString);\r\n    return tokenPathWithoutQuery + generateQueryString(tslib_1.__assign({}, tokenPathQuery, impersonationProps, { scopes: scopes.join(',') }));\r\n}\r\nfunction getTokenId(mergedTokenPath, userEmail) {\r\n    return mergedTokenPath + \"/\" + userEmail;\r\n}\r\nfunction saveUserInfo(user, tokenId) {\r\n    env.currentUser = user;\r\n    var schoolgrade = parseQueryString(location.search, { toLower: true }).schoolgrade;\r\n    if (schoolgrade) {\r\n        var schoolGradeInt = parseInt(schoolgrade);\r\n        env.currentUser.schoolGrade = schoolGradeInt;\r\n        env.currentUser.schoolType = schoolGradeInt > 9 ? \"Gymnasium\" : \"Grundskolor\";\r\n    }\r\n    sessionStorage.setItem(\"userInfo\" + tokenId, JSON.stringify(user));\r\n}\r\nfunction loadUserInfo(tokenId) {\r\n    var storedSessionUser = sessionStorage.getItem(\"userInfo\" + tokenId);\r\n    if (storedSessionUser) {\r\n        env.currentUser = JSON.parse(storedSessionUser);\r\n    }\r\n}\r\nfunction createBearerProvider(mergedTokenPath, userEmail) {\r\n    var tokenId = getTokenId(mergedTokenPath, userEmail);\r\n    return new WebServerBearerProvider(mergedTokenPath, function (responseText) {\r\n        var res = JSON.parse(responseText);\r\n        if (!res.ok)\r\n            throw new Error(res.error);\r\n        if (res.user) {\r\n            saveUserInfo(res.user, tokenId);\r\n        }\r\n        return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\r\n    }, tokenId);\r\n}\r\nfunction createGoogleTokenProvider(mergedTokenPath, userEmail) {\r\n    var tokenId = getTokenId(mergedTokenPath, userEmail);\r\n    return new WebServerBearerProvider(mergedTokenPath, function (responseText) {\r\n        var res = JSON.parse(responseText);\r\n        if (!res.ok)\r\n            throw new Error(res.error);\r\n        return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\r\n    }, tokenId);\r\n}\r\nfunction createTestTokenProvider(tokenUrl, user, scopes) {\r\n    return new KedBearerProvider(isomorphic, storage, tokenUrl + user.mail + location.search, cfg.KED_CLIENT_ID, cfg.KED_CLIENT_SECRET, tokenUrl, {\r\n        email: user.mail.toLowerCase(),\r\n        roles: user.roles,\r\n        school: user.school,\r\n        schoolType: user.schoolType,\r\n        scopes: scopes,\r\n        name: user.displayName\r\n    });\r\n}\r\n// env.currentUser.mail is set by SiteVision server initially.\r\n// A response from /api/token may change the mail attribute of the current\r\n// user, so env.currentUser.mail may be different after getting a response.\r\n// However, the initial value is valuable always in order to distinguish the case\r\n// when one normal user logs out and another user logs in.\r\nvar initialUserEmail = env.currentUser && env.currentUser.mail; // Initial value of mail. May change.\r\nif (initialUserEmail) {\r\n    // KED\r\n    if (cfg.KED_TOKEN_PATH) {\r\n        //\r\n        //\r\n        // Production / SiteVision proxied /api/token to request tokens from:\r\n        //\r\n        //\r\n        var mergedTokenPath = getMergedTokenPath(cfg.KED_TOKEN_PATH, location.search, [\r\n            \"kedbackend\",\r\n            \"EDS\",\r\n        ]);\r\n        env.bearerProvider = createBearerProvider(mergedTokenPath, initialUserEmail);\r\n        loadUserInfo(getTokenId(mergedTokenPath, initialUserEmail));\r\n        var scopes = [\r\n            \"https://www.googleapis.com/auth/calendar.readonly\",\r\n            \"https://www.googleapis.com/auth/drive\"\r\n        ].concat(env.currentUser.roles.includes(\"EMPLOYEE\")\r\n            ? employeeClassroomScopes\r\n            : studentClassroomScopes);\r\n        // Google\r\n        var googleMergedPath = getMergedTokenPath(cfg.KED_TOKEN_PATH, location.search, scopes);\r\n        env.googleTokenProvider = createGoogleTokenProvider(googleMergedPath, initialUserEmail);\r\n    }\r\n    else if (cfg.KED_TOKEN_URL && cfg.KED_CLIENT_ID && cfg.KED_CLIENT_SECRET) {\r\n        //\r\n        //\r\n        // Test - go directly to KEDAUTH server to retrieve tokens\r\n        //\r\n        //\r\n        env.bearerProvider = createTestTokenProvider(cfg.KED_TOKEN_URL, env.currentUser, [\r\n            \"kedbackend\",\r\n            \"EDS\",\r\n        ]);\r\n        var scopes = [\r\n            \"https://www.googleapis.com/auth/calendar.readonly\",\r\n            \"https://www.googleapis.com/auth/drive\"\r\n        ].concat(env.currentUser.roles.includes(\"EMPLOYEE\")\r\n            ? employeeClassroomScopes\r\n            : studentClassroomScopes);\r\n        env.googleTokenProvider = createTestTokenProvider(cfg.KED_TOKEN_URL + \"/google\", env.currentUser, scopes);\r\n    }\r\n    else {\r\n        throw new Error(\"Missing configuration parameter KED_TOKEN_PATH\");\r\n    }\r\n}\r\n","import env from '../globals/KED.env';\r\nimport cfg from '../globals/KED.cfg';\r\nimport { isomorphic } from 'kedbackend/clientweb';\r\nimport { EdsClient } from '../apis/edsclient';\r\nenv.edsClient = new EdsClient(isomorphic, cfg.EDS_API_URL, env.bearerProvider, function () { return env.currentUser.mail; });\r\n","import env from '../globals/KED.env';\r\nimport cfg from '../globals/KED.cfg';\r\nimport { KedBackendClientWeb } from 'kedbackend/clientweb';\r\nenv.kedBackendClient = new KedBackendClientWeb(cfg.KED_API_URL, env.bearerProvider);\r\n","import KED from './KED';\r\n;\r\nif (!KED.cfg)\r\n    KED.cfg = {};\r\nexport default KED.cfg;\r\nexport var cfg = KED.cfg;\r\n","import KED from './ked';\r\nif (!KED.env)\r\n    KED.env = {};\r\nexport default KED.env;\r\nexport var env = KED.env;\r\n","export var KED_NAMESPACE = \"KED\";\r\nvar result = typeof KED === 'undefined' ? {} : KED;\r\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\r\n    window[KED_NAMESPACE] = result;\r\n}\r\nexport default result;\r\n","import env from './KED.env';\r\nexport function getCurrentUser() {\r\n    return env.currentUser;\r\n}\r\n","import env from './KED.env';\r\nimport { KedBackendRepo } from 'kedbackend/repo';\r\nimport { getGlobalId, createUUID } from 'kedbackend/client';\r\nimport cfg from './KED.cfg';\r\nif (!env.db) {\r\n    // Put db on env so that it is shared between subject planner and other components!\r\n    env.db = new KedBackendRepo(function () { return env.kedBackendClient; }, function () { return env.currentUser ?\r\n        env.currentUser.mail :\r\n        \"\"; }, function () { return env.currentUser ?\r\n        env.currentUser.displayName || env.currentUser.mail :\r\n        \"\"; });\r\n}\r\nexport var db = env.db;\r\nexport var globalId = getGlobalId(cfg.KED_REALM);\r\nexport var Schools = {\r\n    standardSchool: db.schools.name(\"standard\").cacheOptimized().single(),\r\n    get mySchool() { return db.schools.name(env.currentUser.school).cacheOptimized().single(); }\r\n};\r\nexport var CourseInstances = {\r\n    getBranchId: function (school, courseId) {\r\n        return school.switchMap(function (school) {\r\n            return db.branches\r\n                .hasEdgesFrom([school.officialBranchId])\r\n                .name(\"draft\")\r\n                .tags(courseId)\r\n                .idsOnly()\r\n                .map(function (_a) {\r\n                var id = _a.id;\r\n                return id;\r\n            })\r\n                .toValue()\r\n                .map(function (ids) { return ids.length > 0 ? ids[0] : undefined; });\r\n        });\r\n    },\r\n    /** Get a DRAFT branch for given course ID and given school.\r\n     * If there is not yet such a branch, create it using mutationsOnEmpty() which will\r\n     * lead to the C# code DocumentRepository.ReadOrMutate() via DocumentController.\r\n     */\r\n    getOrCreateBranchId: function (school, courseId) {\r\n        return db.courseInstances.idsOnly().id(courseId).switchMap(function () {\r\n            return school.switchMap(function (school) {\r\n                return db.branches\r\n                    .hasEdgesFrom([school.officialBranchId])\r\n                    .name(\"draft\")\r\n                    .tags(courseId)\r\n                    .idsOnly()\r\n                    .mutationsOnEmpty(function (tx) {\r\n                    // These 2 mutations will occur server side, atomically.\r\n                    // Will be sent on each request in the query, but will only execute if query results in zero items.\r\n                    //console.log(\"School:\", school);\r\n                    var id = createUUID();\r\n                    tx.add(\"branches\", {\r\n                        id: id,\r\n                        acl: [\r\n                            \"role:USER:R\",\r\n                            \"schoolRole:\" + school.name + \"/EMPLOYEE:S\"\r\n                        ],\r\n                        name: 'draft',\r\n                        schoolId: school.id,\r\n                        treeParentId: school.officialBranchId,\r\n                        tags: [courseId]\r\n                    });\r\n                    // Approving the branch makes sure that it was created by an EMPLOYEE on given school.\r\n                    tx.link2(\"branches\", school.officialBranchId, \"approvedChildren\", id);\r\n                })\r\n                    .single()\r\n                    .map(function (_a) {\r\n                    var id = _a.id;\r\n                    return id;\r\n                });\r\n            });\r\n        });\r\n    },\r\n    getAllDescendantIds: function (courseId) {\r\n        return db.courseBlocks.tags(courseId).idsOnly().concat(db.courseContents.tags(courseId).idsOnly()).concat(db.courseTabs.tags(courseId).idsOnly()).concat(db.tasks.tags(courseId).idsOnly())\r\n            .map(function (x) { return x.id; });\r\n    }\r\n};\r\n","export var KED_NAMESPACE = \"KED\";\r\nvar result = typeof KED === 'undefined' ? {} : KED;\r\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\r\n    window[KED_NAMESPACE] = result;\r\n}\r\nexport default result;\r\n","import * as tslib_1 from \"tslib\";\r\nimport * as React from 'react';\r\nimport { db } from '../globals/db';\r\nimport { RemoveItem } from '../components/course-builder/sub-components/remove-item';\r\nvar ErrorSuccessFeedback = /** @class */ (function (_super) {\r\n    tslib_1.__extends(ErrorSuccessFeedback, _super);\r\n    function ErrorSuccessFeedback(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.state = {\r\n            errors: [],\r\n            infos: []\r\n        };\r\n        _this._unhandledRejection = _this._unhandledRejection.bind(_this);\r\n        _this._error = _this._error.bind(_this);\r\n        _this._customError = _this._customError.bind(_this);\r\n        _this._onInfo = _this._onInfo.bind(_this);\r\n        _this._dbWriterError = _this._dbWriterError.bind(_this);\r\n        _this._dbWriterStateChanged = _this._dbWriterStateChanged.bind(_this);\r\n        return _this;\r\n    }\r\n    ErrorSuccessFeedback.prototype._addError = function (message, details, retryable) {\r\n        var _this = this;\r\n        //console.error(message, {retryable: !!retryable, details});\r\n        this.setState(function (_a) {\r\n            var errors = _a.errors;\r\n            if (errors.some(function (e) { return e.message === message; }))\r\n                return { errors: errors };\r\n            if (errors.length > 2)\r\n                errors = errors.slice(1);\r\n            return {\r\n                errors: errors.concat([{ message: message, details: details, retryable: retryable }])\r\n            };\r\n        });\r\n        // Remove non-retryable errors after 30 seconds:\r\n        if (!retryable)\r\n            setTimeout(function () {\r\n                _this.setState(function (_a) {\r\n                    var errors = _a.errors;\r\n                    return ({\r\n                        errors: errors.filter(function (e) { return e.message !== message; })\r\n                    });\r\n                });\r\n            }, 30000);\r\n    };\r\n    ErrorSuccessFeedback.prototype._addInfo = function (message) {\r\n        var _this = this;\r\n        if (message === \"\") {\r\n            // Turn off current info messages\r\n            this.setState({ infos: [] });\r\n            return;\r\n        }\r\n        this.setState(function (_a) {\r\n            var infos = _a.infos;\r\n            if (infos.some(function (info) { return info === message; }))\r\n                return { infos: infos };\r\n            if (infos.length > 1)\r\n                infos = infos.slice(1);\r\n            return {\r\n                infos: [message] // was: infos.concat(message). But it sucks!\r\n            };\r\n        });\r\n        // Remove info message after 10 seconds:\r\n        setTimeout(function () {\r\n            _this.setState(function (_a) {\r\n                var infos = _a.infos;\r\n                return ({\r\n                    infos: infos.filter(function (msg) { return msg !== message; })\r\n                });\r\n            });\r\n        }, 10000);\r\n    };\r\n    ErrorSuccessFeedback.prototype._dbWriterError = function (error, retryable) {\r\n        this._addError(\"Det g\\u00E5r inte att spara till servern\", error, retryable);\r\n    };\r\n    ErrorSuccessFeedback.prototype._dbWriterStateChanged = function (_a) {\r\n        var isEdited = _a.isEdited, isSaving = _a.isSaving;\r\n        if (!isEdited) {\r\n            // If isEdited is false, a successful write must have happened, and\r\n            // there cannot be any retryable error anymore\r\n            this.setState(function (_a) {\r\n                var errors = _a.errors;\r\n                errors = errors.filter(function (e) { return !e.retryable; });\r\n                return { errors: errors };\r\n            });\r\n        }\r\n        this.setState({\r\n            dbWriterIsEdited: isEdited,\r\n            dbWriterIsSaving: isSaving\r\n        });\r\n    };\r\n    ErrorSuccessFeedback.prototype.componentDidMount = function () {\r\n        window.addEventListener('unhandledrejection', this._unhandledRejection);\r\n        window.addEventListener('error', this._error);\r\n        window.addEventListener('customerror', this._customError);\r\n        window.addEventListener('info', this._onInfo);\r\n        db.writer.onError(this._dbWriterError);\r\n        db.writer.onStateChange(this._dbWriterStateChanged);\r\n    };\r\n    ErrorSuccessFeedback.prototype.componentWillUnmount = function () {\r\n        window.removeEventListener('unhandledrejection', this._unhandledRejection);\r\n        window.removeEventListener('error', this._error);\r\n        window.removeEventListener('customerror', this._customError);\r\n        window.removeEventListener('info', this._onInfo);\r\n        db.writer.off(this._dbWriterError);\r\n        db.writer.off(this._dbWriterStateChanged);\r\n    };\r\n    ErrorSuccessFeedback.prototype._unhandledRejection = function (ev) {\r\n        this._addError(\"Ett ok\\u00E4nt fel intr\\u00E4ffade...\", ev.reason);\r\n    };\r\n    ErrorSuccessFeedback.prototype._error = function (ev) {\r\n        this._addError(ev.error ? ev.error.message : \"Ett ok\\u00E4nt fel intr\\u00E4ffade...\", ev.error);\r\n    };\r\n    ErrorSuccessFeedback.prototype._customError = function (ev) {\r\n        this._addError(ev.detail);\r\n    };\r\n    ErrorSuccessFeedback.prototype._onInfo = function (ev) {\r\n        this._addInfo(ev.detail);\r\n    };\r\n    ErrorSuccessFeedback.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.state, errors = _a.errors, infos = _a.infos, dbWriterIsSaving = _a.dbWriterIsSaving;\r\n        return React.createElement(\"div\", { className: \"error-success-feedback\", style: {\r\n                position: \"fixed\",\r\n                left: 0,\r\n                top: 0,\r\n                width: \"100%\",\r\n                pointerEvents: 'none'\r\n            } },\r\n            React.createElement(\"div\", { style: { display: 'table', margin: \"0 auto\" } },\r\n                errors.filter(function (e) { return !e.retryable || !dbWriterIsSaving; })\r\n                    .map(function (_a) {\r\n                    var message = _a.message, details = _a.details, retryable = _a.retryable, showDetails = _a.showDetails;\r\n                    return (React.createElement(\"div\", { key: message, className: \"error\" },\r\n                        React.createElement(\"div\", { style: { float: 'left' } }, message),\r\n                        React.createElement(\"div\", { style: { pointerEvents: 'auto' } },\r\n                            React.createElement(RemoveItem, { onClick: function () { return _this.removeError(message); } })),\r\n                        details || retryable ? React.createElement(\"div\", { style: { pointerEvents: 'auto' } },\r\n                            details ? React.createElement(React.Fragment, null,\r\n                                React.createElement(\"a\", { className: \"btn\", onClick: function () { return _this.toggleDetails(message); } }, showDetails ? \"Dlj detailer\" : \"Visa detailjer\"),\r\n                                \"\\u00A0\") : undefined,\r\n                            showDetails ? React.createElement(\"p\", null, '' + details) : React.createElement(React.Fragment, null, \"\\u00A0\"),\r\n                            retryable ? React.createElement(\"a\", { className: \"btn\", onClick: function () { return _this.retrySave(); } }, \"F\\u00F6rs\\u00F6k spara nu\") : undefined) : undefined));\r\n                }),\r\n                infos.map(function (message) {\r\n                    return React.createElement(\"p\", { key: message, className: \"info\" }, message);\r\n                })));\r\n    };\r\n    ErrorSuccessFeedback.prototype.removeError = function (message) {\r\n        this.setState(function (_a) {\r\n            var errors = _a.errors;\r\n            return ({\r\n                errors: errors.filter(function (e) { return e.message !== message; })\r\n            });\r\n        });\r\n    };\r\n    ErrorSuccessFeedback.prototype.retrySave = function () {\r\n        db.writer.retrySave();\r\n    };\r\n    ErrorSuccessFeedback.prototype.toggleDetails = function (message) {\r\n        this.setState(function (_a) {\r\n            var errors = _a.errors;\r\n            return ({ errors: errors.map(function (error) { return error.message === message ? tslib_1.__assign({}, error, { showDetails: !error.showDetails }) :\r\n                    error; })\r\n            });\r\n        });\r\n    };\r\n    return ErrorSuccessFeedback;\r\n}(React.Component));\r\nexport { ErrorSuccessFeedback };\r\n","import * as tslib_1 from \"tslib\";\r\nvar DEFAULT_CACHE_EXPIRATION = 30 * 60 * 1000; // 30 minutes.\r\nvar defaultOptions = {\r\n    isApiMethod: function (f) { return typeof f === 'function'; },\r\n    cacheExpiration: DEFAULT_CACHE_EXPIRATION\r\n};\r\nexport function makeSuspenseApi(api, options) {\r\n    if (options === void 0) { options = defaultOptions; }\r\n    options = tslib_1.__assign({}, defaultOptions, options);\r\n    var isApiMethod = options.isApiMethod, cacheExpiration = options.cacheExpiration;\r\n    var rv = Object.create(api);\r\n    var cache = {};\r\n    // Walk the instance + prototype chain to generate suspense version of each promise returning method\r\n    for (var proto = api; proto && proto !== Object.prototype; proto = Object.getPrototypeOf(proto)) {\r\n        suspendify(proto);\r\n    }\r\n    function suspendify(proto) {\r\n        Object.keys(proto).forEach(function (prop) {\r\n            if (!rv.hasOwnProperty(prop) && isApiMethod(prop)) {\r\n                rv[prop] = function () {\r\n                    var args = [];\r\n                    for (var _i = 0; _i < arguments.length; _i++) {\r\n                        args[_i] = arguments[_i];\r\n                    }\r\n                    var key = JSON.stringify(tslib_1.__spread([prop], args));\r\n                    var cachedEntry = cache[key];\r\n                    if (cachedEntry !== undefined) {\r\n                        if (cachedEntry.promise)\r\n                            throw cachedEntry.promise;\r\n                        if (cachedEntry.error)\r\n                            throw cachedEntry.error;\r\n                        if (cachedEntry.timeout > Date.now()) {\r\n                            return cachedEntry.value;\r\n                        }\r\n                    }\r\n                    try {\r\n                        var promise = proto[prop].apply(api, args).then(function (result) {\r\n                            cache[key] = { timeout: Date.now() + cacheExpiration, value: result };\r\n                        }).catch(function (error) {\r\n                            cache[key] = { timeout: Date.now() + cacheExpiration, error: error };\r\n                        });\r\n                        cache[key] = { timeout: Date.now() + cacheExpiration, promise: promise };\r\n                        throw promise;\r\n                    }\r\n                    catch (error) {\r\n                        if (error.then)\r\n                            throw error;\r\n                        cache[key] = { timeout: Date.now() + cacheExpiration, error: error };\r\n                    }\r\n                };\r\n            }\r\n        });\r\n    }\r\n    return rv;\r\n}\r\n","import * as tslib_1 from \"tslib\";\r\nexport function parseQueryString(locationSearch, options) {\r\n    var toLower = (options || {}).toLower;\r\n    var result = {};\r\n    if (locationSearch && locationSearch.length > 1)\r\n        locationSearch.substr(1)\r\n            .split('&')\r\n            .map(function (part) { return part.split('=').map(function (s) { return decodeURIComponent(s.trim()); }); })\r\n            .forEach(function (_a) {\r\n            var _b = tslib_1.__read(_a, 2), key = _b[0], value = _b[1];\r\n            return result[toLower ? key.toLowerCase() : key] = value;\r\n        });\r\n    return result;\r\n}\r\nfunction encodeParams(params) {\r\n    return Object.keys(params).filter(function (key) { return params[key] !== undefined; }).map(function (key) { return encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key]); }).join('&');\r\n}\r\nexport function generateQueryString(params) {\r\n    return \"?\" + encodeParams(params);\r\n}\r\nexport function parseHashQueryString(locationHash, options) {\r\n    return parseQueryString(locationHash, options);\r\n}\r\nexport function generateHashQueryString(params) {\r\n    return \"#\" + encodeParams(params);\r\n}\r\nexport function splitUrlAndQuery(urlWithPossibleQuery) {\r\n    var pQuery = urlWithPossibleQuery.indexOf('?');\r\n    return pQuery >= 0 ?\r\n        [urlWithPossibleQuery.substr(0, pQuery), urlWithPossibleQuery.substr(pQuery)] :\r\n        [urlWithPossibleQuery, \"\"];\r\n}\r\n","import * as tslib_1 from \"tslib\";\r\nimport moment from 'moment';\r\nexport function getFirstAndLastWeekOfTerm(term) {\r\n    return term === 'AT' ?\r\n        [32, 51] :\r\n        [1, 25];\r\n}\r\n//Not used anymore\r\n// export function getTermStartAndEnd(now: moment.Moment) : moment.Moment[] {\r\n//     return now.month() >= 6 ? // 6 = July in JS Dates and in moment as well!\r\n//     [moment(new Date(now.year(), 7, 1)), moment(new Date(now.year(), 11, 31))] : // aug1 - dec31\r\n//     [moment(new Date(now.year(), 0, 1)), moment(new Date(now.year(), 6, 31))]; // jan1 - july31\r\n// }\r\nexport function getTermStarEndDate(date, isFirstTerm) {\r\n    var addYear = date.getMonth() >= 7;\r\n    var termYear = null;\r\n    if (addYear) {\r\n        termYear = isFirstTerm ? date.getFullYear() : date.getFullYear() + 1;\r\n    }\r\n    else {\r\n        termYear = isFirstTerm ? date.getFullYear() - 1 : date.getFullYear();\r\n    }\r\n    var termYearMoment = moment(termYear.toString(), \"YYYY\");\r\n    if (termYearMoment.week() != 1) {\r\n        termYearMoment = termYearMoment.clone().add(1, 'week');\r\n    }\r\n    return isFirstTerm ? [moment(termYearMoment.clone()).week(32).startOf('week'), moment(termYearMoment.clone()).week(51).endOf('week')] :\r\n        [moment(termYearMoment.clone()), moment(termYearMoment.clone()).week(25).endOf('week')];\r\n}\r\nexport function getSchoolMoment(m) {\r\n    var thisYear = m.year();\r\n    var isAutumn = m.month() >= 6; // determine \r\n    var _a = tslib_1.__read(isAutumn ?\r\n        [thisYear, thisYear + 1] :\r\n        [thisYear - 1, thisYear], 2), autumnYear = _a[0], springYear = _a[1];\r\n    var academicYear = '' + autumnYear + '/' + springYear;\r\n    var term = isAutumn ? 'AT' : 'ST';\r\n    var week = m.week();\r\n    return { academicYear: academicYear, term: term, week: week };\r\n}\r\nexport function addYear(aYear, numYearsToAdd) {\r\n    return aYear.split('/')\r\n        .map(function (yearStr) { return parseInt(yearStr) + numYearsToAdd; })\r\n        .map(function (year) { return '' + year; })\r\n        .join('/');\r\n}\r\nexport function nextAcademicYear(aYear) {\r\n    return addYear(aYear, 1);\r\n}\r\nexport function prevAcademicYear(aYear) {\r\n    return addYear(aYear, -1);\r\n}\r\n","import moment from 'moment';\r\nimport { getSchoolMoment, addYear } from './school-moment';\r\nfunction isSchoolMoment(obj) {\r\n    return 'academicYear' in obj;\r\n}\r\nvar SchoolTerm = /** @class */ (function () {\r\n    function SchoolTerm(dateOrSchoolMoment) {\r\n        var schoolMoment = isSchoolMoment(dateOrSchoolMoment) ?\r\n            dateOrSchoolMoment : getSchoolMoment(moment(dateOrSchoolMoment));\r\n        this.academicYear = schoolMoment.academicYear;\r\n        this.term = schoolMoment.term;\r\n    }\r\n    Object.defineProperty(SchoolTerm.prototype, \"year\", {\r\n        get: function () {\r\n            return parseInt(this.academicYear\r\n                .split('/')[this.term === 'AT' ? 0 : 1]);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    SchoolTerm.prototype.nextTerm = function () {\r\n        return new SchoolTerm(this.term === 'AT' ?\r\n            {\r\n                term: 'ST',\r\n                academicYear: this.academicYear\r\n            } :\r\n            {\r\n                term: 'AT',\r\n                academicYear: addYear(this.academicYear, 1)\r\n            });\r\n    };\r\n    SchoolTerm.prototype.prevTerm = function () {\r\n        return new SchoolTerm(this.term === 'AT' ?\r\n            {\r\n                term: 'ST',\r\n                academicYear: addYear(this.academicYear, -1)\r\n            } :\r\n            {\r\n                term: 'AT',\r\n                academicYear: this.academicYear\r\n            });\r\n    };\r\n    SchoolTerm.prototype.toLocaleString = function (intl, shortYear) {\r\n        var year = this.term === 'AT' ?\r\n            this.academicYear.split('/')[0] :\r\n            this.academicYear.split('/')[1];\r\n        if (shortYear)\r\n            year = year.substr(2);\r\n        return this.term === 'AT' ? intl.formatMessage({ id: 'termplanner.secondTerm', defaultMessage: 'HT {year}' }, { year: year }) :\r\n            intl.formatMessage({ id: 'termplanner.firstTerm', defaultMessage: 'VT {year}' }, { year: year });\r\n    };\r\n    return SchoolTerm;\r\n}());\r\nexport { SchoolTerm };\r\n","import * as tslib_1 from \"tslib\";\r\nexport function capitalizeFirst(str) {\r\n    for (var i = 0, l = str.length; i < l; ++i) {\r\n        if (str.charCodeAt(i) < 0x2000) {\r\n            return str.substr(0, i) + str[i].toLocaleUpperCase() + str.substr(i + 1);\r\n        }\r\n    }\r\n    return str;\r\n}\r\nexport function extend(obj, extension) {\r\n    if (typeof extension !== 'object')\r\n        return obj;\r\n    Object.keys(extension).forEach(function (key) {\r\n        obj[key] = extension[key];\r\n    });\r\n    return obj;\r\n}\r\nexport function clone(obj, extension) {\r\n    var clone = {};\r\n    Object.getOwnPropertyNames(obj).forEach(function (key) {\r\n        Object.defineProperty(clone, key, Object.getOwnPropertyDescriptor(obj, key));\r\n    });\r\n    if (extension)\r\n        extend(clone, extension);\r\n    return clone;\r\n}\r\nvar concat = [].concat;\r\nexport function flatten(a) {\r\n    return concat.apply([], a);\r\n}\r\nexport function compareProp(prop) {\r\n    return function (a, b) {\r\n        var aProp = a[prop], bProp = b[prop];\r\n        return aProp > bProp ? 1 : aProp < bProp ? -1 : 0;\r\n    };\r\n}\r\nexport function compareProps(props, locales, options) {\r\n    props = Array.isArray(props) ? props : [props];\r\n    var localeCompare = function (a, b) {\r\n        return typeof a === 'string' ?\r\n            a.localeCompare(b, locales, options) :\r\n            a < b ? -1 : a > b ? 1 : 0;\r\n    };\r\n    function cmpPart(a, b, firstPart, rest) {\r\n        var firstA = a[firstPart];\r\n        var firstB = b[firstPart];\r\n        if (firstA === firstB)\r\n            return 0;\r\n        if (firstA == null)\r\n            return -1;\r\n        if (firstB == null)\r\n            return 1;\r\n        return rest.length === 0 ?\r\n            localeCompare(firstA, firstB) :\r\n            cmpPart(firstA, firstB, rest[0], rest.slice(1));\r\n    }\r\n    return props\r\n        .map(function (prop) { return prop.split('.'); })\r\n        .map(function (_a) {\r\n        var _b = tslib_1.__read(_a), firstPart = _b[0], rest = _b.slice(1);\r\n        return function (a, b) { return cmpPart(a, b, firstPart, rest); };\r\n    })\r\n        .reduce(function (cmp1, cmp2) {\r\n        return function (a, b) { return cmp1(a, b) || cmp2(a, b); };\r\n    });\r\n}\r\nexport function L(text) {\r\n    var args = [];\r\n    for (var _i = 1; _i < arguments.length; _i++) {\r\n        args[_i - 1] = arguments[_i];\r\n    }\r\n    var first = text[0];\r\n    return buildMessage(text, args);\r\n}\r\nfunction buildMessage(text, args) {\r\n    var rv = text[0];\r\n    for (var i = 1, l = text.length; i < l; ++i) {\r\n        rv += args[i - 1] + text[i];\r\n    }\r\n    return rv;\r\n}\r\nvar TC = /** @class */ (function () {\r\n    function TC(template) {\r\n        extend(this, template);\r\n    }\r\n    return TC;\r\n}());\r\nexport { TC };\r\nexport function dateTimeReviver(key, value) {\r\n    var a;\r\n    if (typeof value === 'string') {\r\n        a = /\\/Date\\((\\d*)\\)\\//.exec(value);\r\n        if (a) {\r\n            return new Date(+a[1]);\r\n        }\r\n    }\r\n    return value;\r\n}\r\n//let infoSerial = 1;\r\nexport function showInfo(msg) {\r\n    var event = new CustomEvent('info', { 'detail': msg });\r\n    window.dispatchEvent(event);\r\n}\r\nexport function showError(errMsg) {\r\n    var msg = typeof errMsg === 'string' ? errMsg : errMsg.message;\r\n    var event = new CustomEvent('customerror', { 'detail': msg });\r\n    console.error(errMsg);\r\n    window.dispatchEvent(event);\r\n}\r\nexport function maxLength(str, maxLen) {\r\n    return str.length > maxLen ?\r\n        str.substr(0, maxLen - 3) + \"...\" :\r\n        str;\r\n}\r\nexport function arrayToLookup(a, keyAccessor) {\r\n    var result = {};\r\n    for (var i = 0, l = a.length; i < l; ++i) {\r\n        var item = a[i];\r\n        var key = keyAccessor(item);\r\n        var array = result[key];\r\n        if (array)\r\n            array.push(item);\r\n        else\r\n            result[key] = [item];\r\n    }\r\n    return result;\r\n}\r\nexport function arrayToMap(a, keyAccessor) {\r\n    var result = {};\r\n    for (var i = 0, l = a.length; i < l; ++i) {\r\n        var item = a[i];\r\n        var key = keyAccessor(item);\r\n        result[key] = item;\r\n    }\r\n    return result;\r\n}\r\nexport function cherryPickProps(obj, propsToPick) {\r\n    var e_1, _a;\r\n    var result = {};\r\n    try {\r\n        for (var propsToPick_1 = tslib_1.__values(propsToPick), propsToPick_1_1 = propsToPick_1.next(); !propsToPick_1_1.done; propsToPick_1_1 = propsToPick_1.next()) {\r\n            var param = propsToPick_1_1.value;\r\n            if (param in obj)\r\n                result[param] = obj[param];\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (propsToPick_1_1 && !propsToPick_1_1.done && (_a = propsToPick_1.return)) _a.call(propsToPick_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return result;\r\n}\r\nexport function distinct(a, keyAccessor) {\r\n    var map = arrayToMap(a, keyAccessor || (function (x) { return x; }));\r\n    return Object.keys(map).map(function (key) { return map[key]; });\r\n}\r\nexport function shallowEquals(a, b) {\r\n    if (a === b)\r\n        return true;\r\n    if (!a || !b)\r\n        return false;\r\n    if (typeof a !== 'object' || typeof b !== 'object')\r\n        return false;\r\n    var keysA = Object.keys(a);\r\n    var keysB = Object.keys(b);\r\n    if (keysA.length !== keysB.length)\r\n        return false;\r\n    for (var i = 0, l = keysA.length; i < l; ++i) {\r\n        var key = keysA[i];\r\n        if (keysB[i] !== key)\r\n            return false;\r\n        if (a[key] !== b[key])\r\n            return false;\r\n    }\r\n    return true;\r\n}\r\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACvJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClBA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACtGA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrDA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACnPA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC1FA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACzDA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/JA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9JA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9JA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC3NA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvZA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjFA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9NA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACtJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjCA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACZA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/CA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACLA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AChBA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrVA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACrXA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/FA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnCA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1CA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtGA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtDA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvRA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7EA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxKA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}