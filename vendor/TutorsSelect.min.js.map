{"version":3,"file":"TutorsSelect.min.js","sources":["webpack://[name]/TutorsSelect.min.js"],"sourcesContent":["(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[18],{311:function(e,t,n){\"use strict\";n.r(t);var r=n(0),a=n(4),o=n(2),s=n.n(o),u=n(9),i=n(20),c=n(169),l=n(1),d=n(3),f=n(24),h=n(8),p=n(184),m=n(111),v=n(11),b=function(e){function t(t,n){var a=this,o=n(),s=new Date,u=Object(r.f)(Object(v.d)(s,s.getMonth()>=7),2),i=u[0],c=u[1];return a=e.call(this,{getClient:t,optimistic:!0,table:\"weekplans\",user:o?o.mail:\"\",getQueryOptions:function(){return Object(r.b)(a,void 0,void 0,(function(){return Object(r.d)(this,(function(e){return[2,{from:i.startOf(\"week\").add(-2,\"days\").toDate().valueOf(),to:c.startOf(\"week\").add(5,\"days\").toDate().valueOf(),role:\"USER\"}]}))}))}})||this}return Object(r.c)(t,e),t}(m.a),w=new b((function(){return a.a.kedBackendClient}),(function(){return a.a.currentUser}));a.a.kgTermPlannerRepo=w;var g=n(137);function k(e,t){return Object(r.b)(this,void 0,void 0,(function(){function n(t,n,a){var o=null;return{getBearer:function(){return o||this.refreshBearer()},refreshBearer:function(){return o=function(){return Object(r.b)(this,void 0,void 0,(function(){var o,s,u,i;return Object(r.d)(this,(function(r){switch(r.label){case 0:return[4,t.get(n,a)];case 1:return 200!==(o=r.sent()).status?[3,3]:[4,o.json()];case 2:return[2,r.sent()];case 3:return s=d.c.bind,u=[void 0,o.status],i=\"Could not retrieve tutor token for \"+e+\". Error Message: \",[4,o.text()];case 4:throw new(s.apply(d.c,u.concat([i+r.sent()])))}}))}))}()}}}var o,s,u,i,c,m;return Object(r.d)(this,(function(r){switch(r.label){case 0:return o={mail:e,displayName:t,roles:[\"USER\"],school:a.a.currentUser.school,tutorFor:e},s=n(a.a.kedBackendClient.http,\"tutor/token\",{userEmail:e}),u=new d.d(h.c,s,l.b.KED_API_URL),i=n(u.http,\"tutor/convert-token/google\"),c=new f.b(h.c,l.b.EDS_API_URL,s,(function(){return e})),(m={currentUser:o,bearerProvider:s,edsClient:c,googleTokenProvider:i,kedBackendClient:u,tutored:!0}).ksTermPlannerRepo=new p.a((function(){return u}),(function(){return o})),m.kgTermPlannerRepo=new b((function(){return u}),(function(){return o})),m.userTasksRepo=new g.a((function(){return u}),(function(){return o})),[4,s.getBearer().catch((function(e){console.error(e)}))];case 1:return r.sent(),[2,m]}}))}))}n.d(t,\"TutorsSelect\",(function(){return O}));var O=function(e){function t(t){var n=e.call(this,t)||this;return n.state={isLoading:!0,students:[]},n}return Object(r.c)(t,e),t.prototype.componentDidMount=function(){this.load()},t.prototype.load=function(){return Object(r.b)(this,void 0,void 0,(function(){var e,t,n;return Object(r.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,5,6]),[4,a.a.edsClient.getTeacherTutorStudents()];case 1:return(e=r.sent()).sort(Object(u.h)([\"lastName\",\"firstName\"])),t=e.length>0?e.map((function(e){return{mail:e.email,displayName:e.firstName+\" \"+e.lastName}})):[a.a.currentUser],[4,this.setState({students:t})];case 2:return r.sent(),[3,6];case 3:return n=r.sent(),console.error(\"Could not list tutor students\",n),[4,this.setState({students:[a.a.currentUser]})];case 4:return r.sent(),[3,6];case 5:return this.setState({isLoading:!1}),[7];case 6:return[2]}}))}))},t.prototype.onSelectUser=function(e){var t=this.state.students.filter((function(t){return t.mail===e}))[0],n=Object(r.a)(Object(r.a)({},t),{roles:[\"USER\"]});c.a.setNewEnv(n,(function(){return k(e,e)}))},t.prototype.render=function(){var e=this,t=this.state,n=t.isLoading,r=t.students;return n?s.a.createElement(i.a,null):s.a.createElement(\"div\",{className:\"tutors-select\"},s.a.createElement(\"select\",{onChange:function(t){return t.target.value&&e.onSelectUser(t.target.value)}},s.a.createElement(\"option\",{value:\"\"},\"VÃ¤lj elev\"),r.map((function(e){return s.a.createElement(\"option\",{key:e.mail,value:e.mail},e.displayName,\" (\",e.mail,\")\")}))))},t}(s.a.Component)}}]);"],"mappings":"AAAA","sourceRoot":""}