{"version":3,"file":"WeekNotebook.min.js","sources":["webpack://[name]/WeekNotebook.min.js"],"sourcesContent":["(window.webpackJsonp_name_=window.webpackJsonp_name_||[]).push([[19],{308:function(e,t,n){\"use strict\";n.r(t);var a=n(0),r=n(2),s=n.n(r),o=n(111),i=n(4),c=i.a.weekNotesRepo,u=function(e){function t(){var t=e.call(this,{getClient:function(){return i.a.kedBackendClient},optimistic:!1,table:\"notes\",user:i.a.currentUser?i.a.currentUser.mail:\"\",getQueryOptions:function(){return Object(a.b)(t,void 0,void 0,(function(){return Object(a.d)(this,(function(e){return[2,{role:\"USER\"}]}))}))}})||this;return t}return Object(a.c)(t,e),t}(o.a);c||(c=i.a.weekNotesRepo=new u);var l=n(180),d=n(3),h=n(99),g=n(101),m=n(183),f=n(20);function p(e,t,n){return Object(a.b)(this,void 0,void 0,(function(){var r,s,o;return Object(a.d)(this,(function(a){switch(a.label){case 0:return r=!1,s=setTimeout((function(){r=!0,n()}),e),[4,t()];case 1:return o=a.sent(),r||clearTimeout(s),[2,o]}}))}))}var v=n(14),b=n(31),w=function(e){function t(t){var n=e.call(this,t)||this;return n.onChange=n.onChange.bind(n),n.autoSaver=new l.a((function(){return n.save()})),n.state={isLoading:!0,showLoadingProgress:!1,showSavingProgress:!1,everEdited:!1,notes:\"\"},n}return Object(a.c)(t,e),t.prototype.componentDidMount=function(){this.showProgressIfLoadingTakesTime(),c.mem.subscribe(this.onChange)},t.prototype.showProgressIfLoadingTakesTime=function(){var e=this;this.timeoutHandle=setTimeout((function(){return e.state.isLoading&&e.setState({showLoadingProgress:!0})}),300)},t.prototype.componentWillUnmount=function(){c.mem.unsubscribe(this.onChange),this.autoSaver.stop(),clearTimeout(this.timeoutHandle)},t.prototype._save=function(){return Object(a.b)(this,void 0,void 0,(function(){var e,t=this;return Object(a.d)(this,(function(n){switch(n.label){case 0:e=3,n.label=1;case 1:return this.isNotesEdited()&&e?[4,c.upsert(this.state.weekNote,(function(e){e.content=t.state.notes}))]:[3,4];case 2:n.sent(),n.label=3;case 3:return--e,[3,1];case 4:return[2]}}))}))},t.prototype.save=function(){return Object(a.b)(this,void 0,void 0,(function(){var e,t=this;return Object(a.d)(this,(function(n){switch(n.label){case 0:return this.state.showSavingProgress||this.state.isLoading||!this.isNotesEdited()?[3,8]:[4,this.setState({error:void 0})];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,4,6,8]),[4,p(300,(function(){return t._save()}),(function(){return t.setState({showSavingProgress:!0})}))];case 3:return n.sent(),[3,8];case 4:return e=n.sent(),console.error(e),[4,this.setState({error:this.context.intl.formatMessage({id:\"common.errorSavingData\",defaultMessage:\"Kunde inte spara.\"})})];case 5:return n.sent(),[3,8];case 6:return[4,this.setState({showSavingProgress:!1})];case 7:return n.sent(),[7];case 8:return[2]}}))}))},t.prototype.isNotesEdited=function(){var e=this.state,t=e.weekNote,n=e.notes;return!!t&&n!==t.content},t.prototype.getTranslatedActions=function(e){var t=Object.assign({},\"sv\"===e.locale?g.a:m.a);return Object.keys(t).forEach((function(n){var a=g.a[n].title;t[n].title=e.formatMessage({id:\"wysiwyg.\"+n,defaultMessage:a}),\"image\"===n&&(t[n].promptMsg=e.formatMessage({id:\"wysiwyg.imagePromptMsg\",defaultMessage:g.a[n].promptMsg}))})),t},t.prototype.onChange=function(e){var t=e.length>0?e[e.length-1]:{id:Object(d.h)(),dateTime:Date.now(),content:\"\",acl:[new d.b(\"email\",i.a.currentUser.mail,\"S\")].map((function(e){return e.toString()}))},n={weekNote:t,isLoading:!1,showLoadingProgress:!1};this.state.weekNote&&this.state.weekNote.id===t.id&&0!==e.length||(n.notes=t.content),this.setState(n)},t.prototype.render=function(){var e=this,t=this.state,n=t.notes,a=t.showLoadingProgress,r=t.isLoading,o=t.showSavingProgress,i=t.error,c=t.everEdited,u=this.context.intl;return s.a.createElement(\"div\",null,s.a.createElement(\"div\",{className:\"ked_boxed kedNotepad\"},s.a.createElement(\"h3\",null,s.a.createElement(v.a,{id:\"weekNotebook.title\",defaultMessage:\"Anteckningar\"})),!r&&s.a.createElement(h.a,{actions:[\"bold\",\"italic\",\"underline\",\"strikethrough\",\"olist\",\"ulist\",\"outdent\",\"indent\",\"line\",\"clear\"],defaultActions:this.getTranslatedActions(u),html:n.substr(0,16384),onChange:function(t){e.setState({notes:t.substr(0,16384),everEdited:!0}),e.autoSaver.triggerChange(500)}}),s.a.createElement(\"hr\",null),i?s.a.createElement(\"p\",{className:\"error\"},i):a?s.a.createElement(\"span\",null,s.a.createElement(v.a,{id:\"common.loading\",defaultMessage:\"Laddar...\"}),s.a.createElement(f.a,null)):o?s.a.createElement(s.a.Fragment,null,s.a.createElement(\"span\",null,s.a.createElement(v.a,{id:\"common.saving\",defaultMessage:\"Sparar...\"}),\"   \"),s.a.createElement(f.a,null)):this.isNotesEdited()?s.a.createElement(s.a.Fragment,null,\" \"):c?s.a.createElement(v.a,{id:\"common.saved\",defaultMessage:\"Sparad\"}):s.a.createElement(s.a.Fragment,null,\" \")))},t.contextType=b.a,t}(s.a.Component);function E(e){var t=e.intl;return r.createElement(b.a.Provider,{value:{intl:t}},r.createElement(w,null))}n.d(t,\"WeekNotebook\",(function(){return w})),n.d(t,\"RootWeekNotebook\",(function(){return E}))}}]);"],"mappings":"AAAA","sourceRoot":""}